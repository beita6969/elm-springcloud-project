\documentclass[a4paper,12pt]{article}
\usepackage[UTF8]{ctex}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{array}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{float}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{subfigure}

\geometry{left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm}

% ä»£ç æ ·å¼è®¾ç½®
\lstset{
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue},
    commentstyle=\color{gray},
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny\color{gray},
    breaklines=true,
    frame=single,
    language=Java
}

% TikZåº“
\usetikzlibrary{shapes.geometric, arrows, positioning, fit, calc}
\pgfplotsset{compat=1.17}

\title{\huge åŸºäºSpring Cloud Alibabaçš„é¥¿äº†ä¹ˆå¤–å–å¹³å°DDDæ¶æ„è®¾è®¡ä¸å®ç°}
\author{å¼ æ˜è¾¾ \\ å­¦å·ï¼š20XXXXXXXX}
\date{2024å¹´12æœˆ}

\begin{document}

\maketitle
\newpage

\tableofcontents
\newpage

\section{éœ€æ±‚åˆ†æ}

\subsection{ç³»ç»Ÿè§’è‰²}

é¥¿äº†ä¹ˆå¤–å–å¹³å°ä½œä¸ºä¸€ä¸ªç»¼åˆæ€§çš„O2OæœåŠ¡å¹³å°ï¼Œæ¶‰åŠå¤šä¸ªå‚ä¸è§’è‰²çš„ååŒå·¥ä½œã€‚åœ¨æœ¬ç³»ç»Ÿçš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬æ˜ç¡®å®šä¹‰äº†å„ç±»ç”¨æˆ·è§’è‰²åŠå…¶æƒé™èŒƒå›´ï¼Œè¿™æ˜¯æ„å»ºæ•´ä¸ªå¾®æœåŠ¡æ¶æ„çš„åŸºç¡€ã€‚ç³»ç»Ÿçš„è§’è‰²è®¾è®¡ä¸ä»…è¦æ»¡è¶³å½“å‰çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè¿˜è¦å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œä»¥é€‚åº”æœªæ¥ä¸šåŠ¡å‘å±•çš„éœ€è¦ã€‚

åœ¨è§’è‰²è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰æ¨¡å‹ï¼Œé€šè¿‡è§’è‰²ä¸æƒé™çš„æ˜ å°„å…³ç³»ï¼Œå®ç°äº†çµæ´»çš„æƒé™ç®¡ç†æœºåˆ¶ã€‚æ¯ä¸ªè§’è‰²éƒ½æœ‰å…¶ç‰¹å®šçš„ä¸šåŠ¡èŒè´£å’Œç³»ç»Ÿæƒé™ï¼Œè¿™ç§è®¾è®¡æ–¹å¼ä¸ä»…æé«˜äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œä¹Ÿä½¿å¾—æƒé™ç®¡ç†æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚

\subsubsection{ç”¨æˆ·è§’è‰²}

ç”¨æˆ·æ˜¯æ•´ä¸ªå¤–å–å¹³å°çš„æ ¸å¿ƒå‚ä¸è€…ï¼Œä»–ä»¬é€šè¿‡å¹³å°å®Œæˆä»æµè§ˆå•†å“åˆ°ä¸‹å•æ”¯ä»˜çš„å®Œæ•´è´­ç‰©æµç¨‹ã€‚ç”¨æˆ·è§’è‰²åŒ…æ‹¬æ³¨å†Œç”¨æˆ·å’Œç™»å½•ç”¨æˆ·ä¸¤ç§çŠ¶æ€ã€‚æ³¨å†Œç”¨æˆ·é€šè¿‡æä¾›å¿…è¦çš„ä¸ªäººä¿¡æ¯å®Œæˆè´¦æˆ·åˆ›å»ºï¼ŒåŒ…æ‹¬æ‰‹æœºå·ç ã€ç™»å½•å¯†ç ä»¥åŠåŸºæœ¬çš„ä¸ªäººèµ„æ–™ã€‚ç™»å½•ç”¨æˆ·åˆ™æ˜¯å·²ç»å®Œæˆæ³¨å†Œå¹¶é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œä»–ä»¬å¯ä»¥äº«å—å¹³å°æä¾›çš„å…¨éƒ¨æœåŠ¡åŠŸèƒ½ã€‚

ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­çš„æƒé™åŒ…æ‹¬æµè§ˆå•†å®¶ä¿¡æ¯ã€æŸ¥çœ‹å•†å“è¯¦æƒ…ã€ç®¡ç†è´­ç‰©è½¦ã€åˆ›å»ºå’Œç®¡ç†è®¢å•ã€ç®¡ç†æ”¶è´§åœ°å€ã€æŸ¥çœ‹å†å²è®¢å•ç­‰ã€‚è¿™äº›æƒé™é€šè¿‡Spring Securityå’ŒJWTä»¤ç‰Œæœºåˆ¶è¿›è¡Œæ§åˆ¶ï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®å’Œæ“ä½œå±äºè‡ªå·±çš„æ•°æ®ã€‚

\subsubsection{å•†å®¶è§’è‰²}

å•†å®¶æ˜¯å¹³å°çš„æœåŠ¡æä¾›æ–¹ï¼Œä»–ä»¬é€šè¿‡å¹³å°å‘ç”¨æˆ·æä¾›å„ç±»é¤é¥®å•†å“ã€‚å•†å®¶è§’è‰²çš„è®¾è®¡éœ€è¦è€ƒè™‘åˆ°å•†å®¶è¿è¥çš„å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å•†å“ç®¡ç†ã€è®¢å•å¤„ç†ã€è¥ä¸šæ—¶é—´è®¾ç½®ç­‰ã€‚è™½ç„¶åœ¨å½“å‰çš„ç³»ç»Ÿå®ç°ä¸­ï¼Œå•†å®¶ç«¯çš„åŠŸèƒ½ä¸»è¦é€šè¿‡åå°ç®¡ç†å®Œæˆï¼Œä½†ç³»ç»Ÿæ¶æ„å·²ç»ä¸ºæœªæ¥çš„å•†å®¶è‡ªä¸»ç®¡ç†é¢„ç•™äº†æ‰©å±•æ¥å£ã€‚

å•†å®¶åœ¨ç³»ç»Ÿä¸­æ‹¥æœ‰ç®¡ç†è‡ªå·±åº—é“ºä¿¡æ¯ã€ä¸Šä¸‹æ¶å•†å“ã€è®¾ç½®å•†å“ä»·æ ¼ã€æŸ¥çœ‹è®¢å•ä¿¡æ¯ç­‰æƒé™ã€‚è¿™äº›æƒé™é€šè¿‡ç‹¬ç«‹çš„å•†å®¶æœåŠ¡ï¼ˆBusiness Serviceï¼‰è¿›è¡Œç®¡ç†ï¼Œç¡®ä¿å•†å®¶æ•°æ®çš„ç‹¬ç«‹æ€§å’Œå®‰å…¨æ€§ã€‚

\subsubsection{ç³»ç»Ÿç®¡ç†å‘˜è§’è‰²}

ç³»ç»Ÿç®¡ç†å‘˜è´Ÿè´£æ•´ä¸ªå¹³å°çš„è¿ç»´å’Œç®¡ç†å·¥ä½œã€‚ä»–ä»¬æ‹¥æœ‰æœ€é«˜çš„ç³»ç»Ÿæƒé™ï¼Œå¯ä»¥ç®¡ç†æ‰€æœ‰çš„ç”¨æˆ·å’Œå•†å®¶ä¿¡æ¯ï¼Œå¤„ç†ç³»ç»Ÿçº§åˆ«çš„é…ç½®å’Œå¼‚å¸¸æƒ…å†µã€‚ç®¡ç†å‘˜è§’è‰²çš„è®¾è®¡å……åˆ†è€ƒè™‘äº†ç³»ç»Ÿå®‰å…¨æ€§ï¼Œæ‰€æœ‰çš„ç®¡ç†æ“ä½œéƒ½ä¼šè¢«è®°å½•å’Œå®¡è®¡ã€‚

\subsection{ä¸»è¦ä¸šåŠ¡æµç¨‹}

é¥¿äº†ä¹ˆå¤–å–å¹³å°çš„ä¸šåŠ¡æµç¨‹è®¾è®¡éµå¾ªäº†ç”¨æˆ·ä½“éªŒä¼˜å…ˆçš„åŸåˆ™ï¼Œé€šè¿‡åˆç†çš„æµç¨‹è®¾è®¡ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿä¾¿æ·åœ°å®Œæˆè´­ç‰©æ“ä½œã€‚æ¯ä¸ªä¸šåŠ¡æµç¨‹éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œç¡®ä¿åœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„åŒæ—¶ï¼Œä¿æŒç³»ç»Ÿçš„é«˜æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ã€‚

\subsubsection{ç”¨æˆ·æ³¨å†Œå’Œç™»å½•}

ç”¨æˆ·æ³¨å†Œæ˜¯ç”¨æˆ·ä¸å¹³å°å»ºç«‹å…³ç³»çš„ç¬¬ä¸€æ­¥ã€‚åœ¨æ³¨å†Œæµç¨‹ä¸­ï¼Œç³»ç»Ÿè¦æ±‚ç”¨æˆ·æä¾›æ‰‹æœºå·ç ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œå¹¶è®¾ç½®å®‰å…¨çš„ç™»å½•å¯†ç ã€‚æ³¨å†Œè¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šå¯¹ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼ŒåŒ…æ‹¬æ‰‹æœºå·ç æ ¼å¼éªŒè¯ã€å¯†ç å¼ºåº¦æ£€æŸ¥ç­‰ã€‚æ‰€æœ‰çš„å¯†ç ä¿¡æ¯éƒ½ä¼šç»è¿‡BCryptåŠ å¯†ç®—æ³•å¤„ç†åå­˜å‚¨ï¼Œç¡®ä¿ç”¨æˆ·æ•°æ®çš„å®‰å…¨æ€§ã€‚

ç™»å½•æµç¨‹é‡‡ç”¨äº†JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯æœºåˆ¶ã€‚ç”¨æˆ·æäº¤ç™»å½•å‡­è¯åï¼Œç³»ç»Ÿä¼šéªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå¹¶ç”ŸæˆåŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œæƒé™çš„JWTä»¤ç‰Œã€‚è¿™ä¸ªä»¤ç‰Œä¼šåœ¨åç»­çš„æ‰€æœ‰è¯·æ±‚ä¸­ä½œä¸ºèº«ä»½å‡­è¯ï¼Œé€šè¿‡APIç½‘å…³çš„ç»Ÿä¸€è®¤è¯è¿‡æ»¤å™¨è¿›è¡ŒéªŒè¯ã€‚JWTä»¤ç‰Œçš„ä½¿ç”¨ä¸ä»…æé«˜äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œè¿˜å®ç°äº†æ— çŠ¶æ€çš„æœåŠ¡è®¾è®¡ï¼Œæœ‰åˆ©äºç³»ç»Ÿçš„æ¨ªå‘æ‰©å±•ã€‚

\subsubsection{ç”¨æˆ·æµè§ˆå•†å“}

å•†å“æµè§ˆæ˜¯ç”¨æˆ·åœ¨å¹³å°ä¸Šçš„ä¸»è¦æ´»åŠ¨ä¹‹ä¸€ã€‚ç³»ç»Ÿæä¾›äº†å¤šç»´åº¦çš„å•†å“æµè§ˆåŠŸèƒ½ï¼ŒåŒ…æ‹¬æŒ‰å•†å®¶æµè§ˆã€æŒ‰åˆ†ç±»æµè§ˆã€æŒ‰é”€é‡æ’åºç­‰ã€‚åœ¨æŠ€æœ¯å®ç°ä¸Šï¼Œå•†å“ä¿¡æ¯é€šè¿‡Redisç¼“å­˜è¿›è¡Œä¼˜åŒ–ï¼Œçƒ­é—¨å•†å“çš„ä¿¡æ¯ä¼šè¢«ç¼“å­˜åœ¨Redisä¸­ï¼Œå‡å°‘æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚åŒæ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨äº†å»¶è¿ŸåŠ è½½å’Œåˆ†é¡µæŸ¥è¯¢çš„ç­–ç•¥ï¼Œç¡®ä¿åœ¨å¤§æ•°æ®é‡æƒ…å†µä¸‹ä¾ç„¶èƒ½å¤Ÿä¿æŒè‰¯å¥½çš„å“åº”é€Ÿåº¦ã€‚

\subsubsection{ç”¨æˆ·æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦}

è´­ç‰©è½¦åŠŸèƒ½æ˜¯ç”µå•†å¹³å°çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚åœ¨DDDæ¶æ„è®¾è®¡ä¸­ï¼Œè´­ç‰©è½¦è¢«è®¾è®¡ä¸ºä¸€ä¸ªç‹¬ç«‹çš„èšåˆæ ¹ï¼ŒåŒ…å«äº†ç”¨æˆ·IDã€å•†å®¶IDä»¥åŠå•†å“åˆ—è¡¨ç­‰ä¿¡æ¯ã€‚ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°å‘è´­ç‰©è½¦ä¸­æ·»åŠ å•†å“ã€ä¿®æ”¹å•†å“æ•°é‡æˆ–åˆ é™¤å•†å“ã€‚è´­ç‰©è½¦çš„æ•°æ®å­˜å‚¨é‡‡ç”¨äº†Rediså’ŒMySQLçš„åŒå†™ç­–ç•¥ï¼ŒRedisç”¨äºæä¾›é«˜æ€§èƒ½çš„è¯»å†™æ“ä½œï¼ŒMySQLç”¨äºæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚

è´­ç‰©è½¦æœåŠ¡è¿˜å®ç°äº†ä¸€äº›ä¸šåŠ¡è§„åˆ™çš„éªŒè¯ï¼Œæ¯”å¦‚æ£€æŸ¥å•†å“æ˜¯å¦åœ¨å”®ã€åº“å­˜æ˜¯å¦å……è¶³ç­‰ã€‚è¿™äº›éªŒè¯é€šè¿‡è°ƒç”¨å•†å“æœåŠ¡çš„æ¥å£å®Œæˆï¼Œä½“ç°äº†å¾®æœåŠ¡ä¹‹é—´çš„åä½œå…³ç³»ã€‚

\subsubsection{ç”¨æˆ·ä¸‹å•}

ä¸‹å•æµç¨‹æ˜¯æ•´ä¸ªä¸šåŠ¡æµç¨‹ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œæ¶‰åŠåˆ°å¤šä¸ªå¾®æœåŠ¡çš„ååŒå·¥ä½œã€‚å½“ç”¨æˆ·ç¡®è®¤è®¢å•æ—¶ï¼Œç³»ç»Ÿéœ€è¦å®Œæˆä»¥ä¸‹æ“ä½œï¼šéªŒè¯è´­ç‰©è½¦ä¸­çš„å•†å“ä¿¡æ¯ã€è®¡ç®—è®¢å•æ€»ä»·ã€ç”Ÿæˆè®¢å•ç¼–å·ã€æ¸…ç©ºè´­ç‰©è½¦ã€æ‰£å‡å•†å“åº“å­˜ç­‰ã€‚è¿™äº›æ“ä½œéœ€è¦ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå› æ­¤ç³»ç»Ÿé‡‡ç”¨äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆã€‚

åœ¨è®¢å•åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šå‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«å…¶ä»–ç›¸å…³æœåŠ¡ç›‘å¬å’Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œåº“å­˜æœåŠ¡ä¼šç›‘å¬è®¢å•åˆ›å»ºäº‹ä»¶å¹¶æ‰§è¡Œåº“å­˜æ‰£å‡æ“ä½œã€‚è¿™ç§äº‹ä»¶é©±åŠ¨çš„æ¶æ„è®¾è®¡æé«˜äº†ç³»ç»Ÿçš„è§£è€¦æ€§å’Œå¯æ‰©å±•æ€§ã€‚

\subsubsection{ç”¨æˆ·è®¢å•ç®¡ç†}

è®¢å•ç®¡ç†åŠŸèƒ½å…è®¸ç”¨æˆ·æŸ¥çœ‹å’Œç®¡ç†è‡ªå·±çš„æ‰€æœ‰è®¢å•ã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è®¢å•çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å•†å“åˆ—è¡¨ã€é…é€åœ°å€ã€è®¢å•çŠ¶æ€ç­‰ã€‚å¯¹äºæœªæ”¯ä»˜çš„è®¢å•ï¼Œç”¨æˆ·å¯ä»¥ç»§ç»­å®Œæˆæ”¯ä»˜ï¼›å¯¹äºå·²æ”¯ä»˜ä½†æœªé…é€çš„è®¢å•ï¼Œç”¨æˆ·å¯ä»¥ç”³è¯·å–æ¶ˆã€‚è¿™äº›æ“ä½œéƒ½ä¼šè§¦å‘ç›¸åº”çš„é¢†åŸŸäº‹ä»¶ï¼Œç¡®ä¿ç³»ç»ŸçŠ¶æ€çš„ä¸€è‡´æ€§ã€‚

è®¢å•çŠ¶æ€çš„ç®¡ç†é‡‡ç”¨äº†çŠ¶æ€æœºæ¨¡å¼ï¼Œæ˜ç¡®å®šä¹‰äº†è®¢å•çš„å„ç§çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„è½¬æ¢è§„åˆ™ã€‚è¿™ç§è®¾è®¡æ–¹å¼ä½¿å¾—è®¢å•çŠ¶æ€çš„ç®¡ç†æ›´åŠ æ¸…æ™°å’Œå¯æ§ã€‚

\subsubsection{ç”¨æˆ·ä¿®æ”¹æ”¶è´§åœ°å€}

æ”¶è´§åœ°å€ç®¡ç†æ˜¯ç”¨æˆ·ä¸ªäººä¿¡æ¯ç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ç³»ç»Ÿå…è®¸ç”¨æˆ·æ·»åŠ å¤šä¸ªæ”¶è´§åœ°å€ï¼Œå¹¶è®¾ç½®é»˜è®¤åœ°å€ã€‚åœ¨æŠ€æœ¯å®ç°ä¸Šï¼Œåœ°å€ä¿¡æ¯è¢«è®¾è®¡ä¸ºç”¨æˆ·èšåˆçš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡å€¼å¯¹è±¡çš„æ–¹å¼è¿›è¡Œå°è£…ã€‚è¿™ç§è®¾è®¡ä¿è¯äº†åœ°å€ä¿¡æ¯çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚

\subsection{ç”¨æˆ·æ´»åŠ¨å›¾}

ä¸ºäº†æ›´ç›´è§‚åœ°å±•ç¤ºç”¨æˆ·åœ¨ç³»ç»Ÿä¸­çš„æ´»åŠ¨æµç¨‹ï¼Œæˆ‘ä»¬è®¾è®¡äº†è¯¦ç»†çš„ç”¨æˆ·æ´»åŠ¨å›¾ã€‚è¿™ä¸ªæ´»åŠ¨å›¾å±•ç¤ºäº†ç”¨æˆ·ä»è¿›å…¥ç³»ç»Ÿåˆ°å®Œæˆè®¢å•çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬å„ä¸ªå…³é”®èŠ‚ç‚¹å’Œå†³ç­–ç‚¹ã€‚

% ç”¨æˆ·æ´»åŠ¨å›¾
\begin{figure}[H]
\centering
\begin{tikzpicture}[node distance=2cm]
\tikzstyle{startstop} = [circle, minimum width=1cm, minimum height=1cm, text centered, draw=black, fill=green!30]
\tikzstyle{activity} = [rectangle, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=blue!20]
\tikzstyle{decision} = [diamond, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=orange!20]
\tikzstyle{arrow} = [thick,->,>=stealth]

\node (start) [startstop] {å¼€å§‹};
\node (login) [activity, below of=start] {ç”¨æˆ·ç™»å½•};
\node (auth) [decision, below of=login] {è®¤è¯æˆåŠŸ?};
\node (browse) [activity, below of=auth, yshift=-1cm] {æµè§ˆå•†å“};
\node (select) [activity, below of=browse] {é€‰æ‹©å•†å“};
\node (cart) [activity, below of=select] {åŠ å…¥è´­ç‰©è½¦};
\node (checkout) [decision, below of=cart] {å»ç»“ç®—?};
\node (order) [activity, below of=checkout, yshift=-1cm] {åˆ›å»ºè®¢å•};
\node (pay) [activity, below of=order] {æ”¯ä»˜è®¢å•};
\node (end) [startstop, below of=pay] {ç»“æŸ};

\draw [arrow] (start) -- (login);
\draw [arrow] (login) -- (auth);
\draw [arrow] (auth) -- node[anchor=east] {æ˜¯} (browse);
\draw [arrow] (auth.east) -- ++(2,0) |- node[anchor=south] {å¦} (login);
\draw [arrow] (browse) -- (select);
\draw [arrow] (select) -- (cart);
\draw [arrow] (cart) -- (checkout);
\draw [arrow] (checkout) -- node[anchor=east] {æ˜¯} (order);
\draw [arrow] (checkout.west) -- ++(-2,0) |- node[anchor=south] {å¦} (browse);
\draw [arrow] (order) -- (pay);
\draw [arrow] (pay) -- (end);
\end{tikzpicture}
\caption{ç”¨æˆ·æ´»åŠ¨å›¾}
\label{fig:user-activity}
\end{figure}

\subsection{ç”¨æˆ·ç”¨ä¾‹å›¾}

ç”¨ä¾‹å›¾æ˜¯éœ€æ±‚åˆ†æçš„é‡è¦å·¥å…·ï¼Œå®ƒæ¸…æ™°åœ°å±•ç¤ºäº†ç³»ç»Ÿçš„åŠŸèƒ½è¾¹ç•Œä»¥åŠå„ä¸ªè§’è‰²ä¸ç³»ç»ŸåŠŸèƒ½ä¹‹é—´çš„å…³ç³»ã€‚é€šè¿‡ç”¨ä¾‹å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°äº†è§£ç³»ç»Ÿéœ€è¦æä¾›å“ªäº›åŠŸèƒ½ï¼Œä»¥åŠè¿™äº›åŠŸèƒ½æ˜¯ä¸ºå“ªäº›è§’è‰²æœåŠ¡çš„ã€‚

% ç”¨æˆ·ç”¨ä¾‹å›¾
\begin{figure}[H]
\centering
\begin{tikzpicture}
\tikzstyle{actor} = [rectangle, minimum width=1.5cm, minimum height=2cm, text centered, draw=black]
\tikzstyle{usecase} = [ellipse, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=yellow!20]
\tikzstyle{system} = [rectangle, minimum width=10cm, minimum height=12cm, draw=black]

% ç³»ç»Ÿè¾¹ç•Œ
\node (system) [system] at (5,-6) {};
\node at (5,-0.5) {é¥¿äº†ä¹ˆå¤–å–å¹³å°ç³»ç»Ÿ};

% è§’è‰²
\node (user) [actor] at (-2,-6) {ç”¨æˆ·};

% ç”¨ä¾‹
\node (register) [usecase] at (3,-2) {ç”¨æˆ·æ³¨å†Œ};
\node (login) [usecase] at (7,-2) {ç”¨æˆ·ç™»å½•};
\node (browse) [usecase] at (3,-4) {æµè§ˆå•†å“};
\node (cart) [usecase] at (7,-4) {ç®¡ç†è´­ç‰©è½¦};
\node (order) [usecase] at (3,-6) {åˆ›å»ºè®¢å•};
\node (payment) [usecase] at (7,-6) {æ”¯ä»˜è®¢å•};
\node (address) [usecase] at (3,-8) {ç®¡ç†åœ°å€};
\node (history) [usecase] at (7,-8) {æŸ¥çœ‹å†å²è®¢å•};
\node (profile) [usecase] at (5,-10) {ä¸ªäººä¿¡æ¯ç®¡ç†};

% å…³è”å…³ç³»
\draw (user) -- (register);
\draw (user) -- (login);
\draw (user) -- (browse);
\draw (user) -- (cart);
\draw (user) -- (order);
\draw (user) -- (payment);
\draw (user) -- (address);
\draw (user) -- (history);
\draw (user) -- (profile);

\end{tikzpicture}
\caption{ç”¨æˆ·ç”¨ä¾‹å›¾}
\label{fig:user-usecase}
\end{figure}

\subsubsection{ç”¨æˆ·ç”¨ä¾‹æè¿°}

ä¸ºäº†æ›´è¯¦ç»†åœ°è¯´æ˜æ¯ä¸ªç”¨ä¾‹çš„å…·ä½“å†…å®¹ï¼Œæˆ‘ä»¬ç¼–å†™äº†å®Œæ•´çš„ç”¨ä¾‹æè¿°ã€‚è¿™äº›æè¿°åŒ…æ‹¬ç”¨ä¾‹çš„åç§°ã€æè¿°ã€å‚ä¸è€…ã€å‰ç½®æ¡ä»¶ã€åç½®æ¡ä»¶ä»¥åŠåŸºæœ¬æ“ä½œæµç¨‹ã€‚

\begin{table}[H]
\centering
\caption{ç”¨æˆ·æ³¨å†Œç”¨ä¾‹æè¿°}
\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{åç§°} & ç”¨æˆ·æ³¨å†Œ \\
\hline
\textbf{æè¿°} & ç”¨æˆ·é€šè¿‡æä¾›æ‰‹æœºå·ç ã€å¯†ç ç­‰ä¿¡æ¯å®Œæˆè´¦æˆ·æ³¨å†Œ \\
\hline
\textbf{å‚ä¸è€…} & æœªæ³¨å†Œç”¨æˆ· \\
\hline
\textbf{å‰ç½®æ¡ä»¶} & ç”¨æˆ·è®¿é—®ç³»ç»Ÿæ³¨å†Œé¡µé¢ \\
\hline
\textbf{åç½®æ¡ä»¶} & æ³¨å†ŒæˆåŠŸåç³»ç»Ÿåˆ›å»ºç”¨æˆ·è´¦æˆ·ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢ \\
\hline
\textbf{åŸºæœ¬æ“ä½œæµ} & 
1. ç”¨æˆ·è®¿é—®æ³¨å†Œé¡µé¢ï¼Œç‚¹å‡»"æ³¨å†Œ"æŒ‰é’® \newline
2. ç³»ç»Ÿå±•ç¤ºæ³¨å†Œè¡¨å•ï¼Œè¦æ±‚è¾“å…¥æ‰‹æœºå·ã€å¯†ç ã€ç¡®è®¤å¯†ç ç­‰ä¿¡æ¯ \newline
3. ç”¨æˆ·å¡«å†™å®Œæ•´ä¿¡æ¯åæäº¤æ³¨å†Œè¯·æ±‚ \newline
4. ç³»ç»ŸéªŒè¯æ‰‹æœºå·æ ¼å¼ã€å¯†ç å¼ºåº¦ç­‰ä¿¡æ¯ \newline
5. ç³»ç»Ÿæ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²è¢«æ³¨å†Œ \newline
6. éªŒè¯é€šè¿‡åï¼Œç³»ç»Ÿåˆ›å»ºç”¨æˆ·è´¦æˆ·ï¼Œå¯†ç è¿›è¡ŒBCryptåŠ å¯†å­˜å‚¨ \newline
7. ç³»ç»Ÿè‡ªåŠ¨ä¸ºç”¨æˆ·åˆ†é…é»˜è®¤è§’è‰²æƒé™ \newline
8. æ³¨å†ŒæˆåŠŸï¼Œç³»ç»Ÿæç¤ºç”¨æˆ·å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢ \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{ç”¨æˆ·ç™»å½•ç”¨ä¾‹æè¿°}
\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{åç§°} & ç”¨æˆ·ç™»å½• \\
\hline
\textbf{æè¿°} & å·²æ³¨å†Œç”¨æˆ·é€šè¿‡æ‰‹æœºå·å’Œå¯†ç ç™»å½•ç³»ç»Ÿ \\
\hline
\textbf{å‚ä¸è€…} & å·²æ³¨å†Œç”¨æˆ· \\
\hline
\textbf{å‰ç½®æ¡ä»¶} & ç”¨æˆ·å·²å®Œæˆæ³¨å†Œï¼Œè®¿é—®ç³»ç»Ÿç™»å½•é¡µé¢ \\
\hline
\textbf{åç½®æ¡ä»¶} & ç™»å½•æˆåŠŸåè·å¾—JWTä»¤ç‰Œï¼Œå¯ä»¥è®¿é—®ç³»ç»ŸåŠŸèƒ½ \\
\hline
\textbf{åŸºæœ¬æ“ä½œæµ} & 
1. ç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥æ‰‹æœºå·å’Œå¯†ç  \newline
2. ç‚¹å‡»"ç™»å½•"æŒ‰é’®æäº¤ç™»å½•è¯·æ±‚ \newline
3. ç³»ç»ŸéªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨ \newline
4. ç³»ç»Ÿä½¿ç”¨BCryptéªŒè¯å¯†ç æ˜¯å¦æ­£ç¡® \newline
5. éªŒè¯é€šè¿‡åï¼Œç³»ç»Ÿç”ŸæˆåŒ…å«ç”¨æˆ·ä¿¡æ¯çš„JWTä»¤ç‰Œ \newline
6. ç³»ç»Ÿä»æ•°æ®åº“åŠ è½½ç”¨æˆ·æƒé™ä¿¡æ¯å¹¶ç¼“å­˜åˆ°Redis \newline
7. è¿”å›JWTä»¤ç‰Œç»™å®¢æˆ·ç«¯ \newline
8. å®¢æˆ·ç«¯ä¿å­˜ä»¤ç‰Œï¼Œè·³è½¬åˆ°ç³»ç»Ÿé¦–é¡µ \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{é€‰æ‹©å•†å“ç”¨ä¾‹æè¿°}
\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{åç§°} & é€‰æ‹©å•†å“ \\
\hline
\textbf{æè¿°} & ç”¨æˆ·æµè§ˆå•†å®¶çš„å•†å“åˆ—è¡¨ï¼Œé€‰æ‹©éœ€è¦è´­ä¹°çš„å•†å“ \\
\hline
\textbf{å‚ä¸è€…} & ç™»å½•ç”¨æˆ· \\
\hline
\textbf{å‰ç½®æ¡ä»¶} & ç”¨æˆ·å·²ç™»å½•ç³»ç»Ÿï¼Œé€‰æ‹©äº†æŸä¸ªå•†å®¶ \\
\hline
\textbf{åç½®æ¡ä»¶} & é€‰ä¸­çš„å•†å“è¢«æ·»åŠ åˆ°è´­ç‰©è½¦ï¼Œæ›´æ–°è´­ç‰©è½¦æ€»ä»· \\
\hline
\textbf{åŸºæœ¬æ“ä½œæµ} & 
1. ç”¨æˆ·ä»å•†å®¶åˆ—è¡¨é€‰æ‹©ä¸€ä¸ªå•†å®¶ \newline
2. ç³»ç»Ÿå±•ç¤ºè¯¥å•†å®¶çš„æ‰€æœ‰åœ¨å”®å•†å“ \newline
3. å•†å“ä¿¡æ¯åŒ…æ‹¬åç§°ã€å›¾ç‰‡ã€ä»·æ ¼ã€æè¿°ç­‰ \newline
4. ç”¨æˆ·æµè§ˆå•†å“åˆ—è¡¨ï¼Œé€‰æ‹©æ„Ÿå…´è¶£çš„å•†å“ \newline
5. ç‚¹å‡»å•†å“æ—çš„"+"æŒ‰é’®å¢åŠ æ•°é‡ \newline
6. ç³»ç»Ÿå®æ—¶è®¡ç®—é€‰ä¸­å•†å“çš„å°è®¡å’Œæ€»ä»· \newline
7. å•†å“æ•°é‡å˜åŒ–æ—¶è‡ªåŠ¨åŒæ­¥åˆ°è´­ç‰©è½¦æœåŠ¡ \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{ç¡®å®šè®¢å•ç”¨ä¾‹æè¿°}
\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{åç§°} & ç¡®å®šè®¢å• \\
\hline
\textbf{æè¿°} & ç”¨æˆ·ç¡®è®¤è´­ç‰©è½¦ä¸­çš„å•†å“ä¿¡æ¯ï¼Œé€‰æ‹©é…é€åœ°å€ï¼Œç”Ÿæˆè®¢å• \\
\hline
\textbf{å‚ä¸è€…} & ç™»å½•ç”¨æˆ· \\
\hline
\textbf{å‰ç½®æ¡ä»¶} & ç”¨æˆ·å·²åœ¨è´­ç‰©è½¦ä¸­æ·»åŠ å•†å“ï¼Œç‚¹å‡»"å»ç»“ç®—"æŒ‰é’® \\
\hline
\textbf{åç½®æ¡ä»¶} & ç”Ÿæˆè®¢å•è®°å½•ï¼Œæ¸…ç©ºè´­ç‰©è½¦ï¼Œè·³è½¬åˆ°æ”¯ä»˜é¡µé¢ \\
\hline
\textbf{åŸºæœ¬æ“ä½œæµ} & 
1. ç”¨æˆ·åœ¨è´­ç‰©è½¦é¡µé¢ç‚¹å‡»"å»ç»“ç®—" \newline
2. ç³»ç»ŸéªŒè¯è´­ç‰©è½¦å•†å“çš„æœ‰æ•ˆæ€§å’Œåº“å­˜ \newline
3. ç³»ç»Ÿå±•ç¤ºè®¢å•ç¡®è®¤é¡µé¢ï¼ŒåŒ…æ‹¬å•†å“æ¸…å•å’Œé…é€åœ°å€ \newline
4. ç”¨æˆ·é€‰æ‹©æˆ–ä¿®æ”¹é…é€åœ°å€ \newline
5. ç³»ç»Ÿè®¡ç®—é…é€è´¹å’Œè®¢å•æ€»é‡‘é¢ \newline
6. ç”¨æˆ·ç¡®è®¤è®¢å•ä¿¡æ¯æ— è¯¯ \newline
7. ç‚¹å‡»"ç¡®è®¤ä¸‹å•"æŒ‰é’® \newline
8. ç³»ç»Ÿåˆ›å»ºè®¢å•ï¼Œå‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶ \newline
9. æ¸…ç©ºç”¨æˆ·åœ¨è¯¥å•†å®¶çš„è´­ç‰©è½¦ \newline
10. è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{æ”¯ä»˜è®¢å•ç”¨ä¾‹æè¿°}
\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{åç§°} & æ”¯ä»˜è®¢å• \\
\hline
\textbf{æè¿°} & ç”¨æˆ·ä¸ºå·²åˆ›å»ºçš„è®¢å•å®Œæˆæ”¯ä»˜æ“ä½œ \\
\hline
\textbf{å‚ä¸è€…} & ç™»å½•ç”¨æˆ· \\
\hline
\textbf{å‰ç½®æ¡ä»¶} & ç”¨æˆ·å·²åˆ›å»ºè®¢å•ï¼Œè®¢å•çŠ¶æ€ä¸ºå¾…æ”¯ä»˜ \\
\hline
\textbf{åç½®æ¡ä»¶} & æ”¯ä»˜æˆåŠŸåè®¢å•çŠ¶æ€æ›´æ–°ä¸ºå·²æ”¯ä»˜ï¼Œæ‰£å‡å•†å“åº“å­˜ \\
\hline
\textbf{åŸºæœ¬æ“ä½œæµ} & 
1. ç³»ç»Ÿå±•ç¤ºæ”¯ä»˜é¡µé¢ï¼Œæ˜¾ç¤ºè®¢å•é‡‘é¢ \newline
2. ç”¨æˆ·é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼ˆæ”¯ä»˜å®/å¾®ä¿¡/ä½™é¢ï¼‰ \newline
3. ç‚¹å‡»"ç«‹å³æ”¯ä»˜"æŒ‰é’® \newline
4. ç³»ç»Ÿè°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£ \newline
5. ç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹å¹³å°å®Œæˆæ”¯ä»˜ \newline
6. ç³»ç»Ÿæ¥æ”¶æ”¯ä»˜å›è°ƒé€šçŸ¥ \newline
7. éªŒè¯æ”¯ä»˜ç»“æœçš„çœŸå®æ€§ \newline
8. æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜ \newline
9. å‘å¸ƒæ”¯ä»˜æˆåŠŸäº‹ä»¶ \newline
10. åº“å­˜æœåŠ¡ç›‘å¬äº‹ä»¶å¹¶æ‰£å‡åº“å­˜ \newline
11. å±•ç¤ºæ”¯ä»˜æˆåŠŸé¡µé¢ \\
\hline
\end{tabular}
\end{table}

\section{ç³»ç»Ÿè®¾è®¡}

\subsection{æŠ€æœ¯æ¶æ„æ·±åº¦åˆ†æ}

\subsubsection{å¾®æœåŠ¡æ¶æ„è®¾è®¡ä¼˜åŒ–}

% å›¾6: é‡æ–°ä¼˜åŒ–çš„å¾®æœåŠ¡æ¶æ„å›¾
\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=1.0, every node/.style={font=\footnotesize}]

% å®šä¹‰ä¸“ä¸šæ ·å¼
\tikzstyle{layer-bg} = [rectangle, fill=gray!8, minimum width=16cm, minimum height=2.5cm, 
                       rounded corners=8pt, draw=gray!30, very thick]
\tikzstyle{client} = [rectangle, rounded corners=6pt, minimum width=2.8cm, minimum height=1.2cm, 
                     text centered, draw=blue!70, fill=blue!12, font=\scriptsize\bfseries,
                     drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!40}]
\tikzstyle{lb} = [rectangle, rounded corners=6pt, minimum width=5cm, minimum height=1.5cm, 
                 text centered, draw=orange!70, fill=orange!15, font=\scriptsize\bfseries,
                 drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!40}]
\tikzstyle{gateway} = [rectangle, rounded corners=6pt, minimum width=3.5cm, minimum height=1.3cm, 
                      text centered, draw=red!70, fill=red!12, font=\scriptsize\bfseries,
                      drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!40}]
\tikzstyle{service} = [rectangle, rounded corners=6pt, minimum width=2.3cm, minimum height=1cm, 
                      text centered, draw=green!70, fill=green!12, font=\scriptsize\bfseries,
                      drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!40}]
\tikzstyle{middleware} = [rectangle, rounded corners=6pt, minimum width=2.8cm, minimum height=1.1cm, 
                         text centered, draw=purple!70, fill=purple!12, font=\scriptsize\bfseries,
                         drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!40}]
\tikzstyle{data} = [cylinder, shape border rotate=90, minimum width=2.5cm, minimum height=1.2cm, 
                   text centered, draw=teal!70, fill=teal!12, font=\scriptsize\bfseries,
                   drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!40}]

% å±‚æ¬¡èƒŒæ™¯
\node (client-bg) [layer-bg] at (0,10) {};
\node (lb-bg) [layer-bg] at (0,8) {};
\node (gateway-bg) [layer-bg] at (0,6) {};
\node (service-bg) [layer-bg] at (0,4) {};
\node (data-bg) [layer-bg] at (0,2) {};

% å·¦ä¾§å±‚æ¬¡æ ‡ç­¾
\node [font=\bfseries\large, color=black, rotate=90] at (-8.5,10) {ç”¨æˆ·æ¥å…¥å±‚};
\node [font=\bfseries\large, color=black, rotate=90] at (-8.5,8) {è´Ÿè½½å‡è¡¡å±‚};
\node [font=\bfseries\large, color=black, rotate=90] at (-8.5,6) {APIç½‘å…³å±‚};
\node [font=\bfseries\large, color=black, rotate=90] at (-8.5,4) {ä¸šåŠ¡æœåŠ¡å±‚};
\node [font=\bfseries\large, color=black, rotate=90] at (-8.5,2) {æ•°æ®å­˜å‚¨å±‚};

% ç¬¬ä¸€å±‚ï¼šç”¨æˆ·æ¥å…¥å±‚
\node (web) [client] at (-3.5,10) {Webå‰ç«¯\\Vue3 + Element\\å“åº”å¼è®¾è®¡};
\node (mobile) [client] at (0,10) {ç§»åŠ¨ç«¯\\H5 + å°ç¨‹åº\\PWAæ”¯æŒ};
\node (admin) [client] at (3.5,10) {ç®¡ç†åå°\\React + Ant Design\\è¿è¥ç®¡ç†};

% ç¬¬äºŒå±‚ï¼šè´Ÿè½½å‡è¡¡å±‚
\node (nginx) [lb] at (0,8) {Nginxè´Ÿè½½å‡è¡¡é›†ç¾¤\\SSLè¯ä¹¦ç®¡ç† + å¥åº·æ£€æŸ¥ + æµé‡åˆ†å‘};

% ç¬¬ä¸‰å±‚ï¼šAPIç½‘å…³å±‚
\node (gateway1) [gateway] at (-2.5,6) {GatewayèŠ‚ç‚¹1\\è®¤è¯é‰´æƒ\\é™æµç†”æ–­};
\node (gateway2) [gateway] at (2.5,6) {GatewayèŠ‚ç‚¹2\\è·¯ç”±è½¬å‘\\ç›‘æ§ç»Ÿè®¡};
\node (nacos) [middleware] at (6.5,6) {Nacosé›†ç¾¤\\æœåŠ¡æ³¨å†Œå‘ç°\\é…ç½®ç®¡ç†ä¸­å¿ƒ};

% ç¬¬å››å±‚ï¼šä¸šåŠ¡æœåŠ¡å±‚ - åˆ†ç»„æ’åˆ—
\node (user) [service] at (-5,4) {ç”¨æˆ·æœåŠ¡\\:10100\\è®¤è¯æˆæƒ};
\node (business) [service] at (-2.5,4) {å•†å®¶æœåŠ¡\\:10300\\åº—é“ºç®¡ç†};
\node (food) [service] at (0,4) {é£Ÿå“æœåŠ¡\\:10200\\å•†å“ç®¡ç†};
\node (order) [service] at (2.5,4) {è®¢å•æœåŠ¡\\:10601\\äº¤æ˜“å¤„ç†};
\node (cart) [service] at (5,4) {è´­ç‰©è½¦æœåŠ¡\\:10400\\ä¸´æ—¶å­˜å‚¨};
\node (address) [service] at (7.5,4) {åœ°å€æœåŠ¡\\:10500\\ä½ç½®ç®¡ç†};

% ç¬¬äº”å±‚ï¼šæ•°æ®å­˜å‚¨å±‚
\node (redis) [data] at (-3,2) {Redisé›†ç¾¤\\åˆ†å¸ƒå¼ç¼“å­˜\\ä¼šè¯å­˜å‚¨};
\node (mysql) [data] at (1,2) {MySQLé›†ç¾¤\\ä¸»ä»è¯»å†™åˆ†ç¦»\\æ•°æ®æŒä¹…åŒ–};
\node (sentinel) [middleware] at (5,2) {Sentinel\\æµé‡é˜²æŠ¤\\æœåŠ¡é™çº§};

% ç®€åŒ–çš„è¿æ¥çº¿ - æŒ‰å±‚æ¬¡åˆ†ç»„
% ç”¨æˆ·åˆ°è´Ÿè½½å‡è¡¡
\foreach \client in {web,mobile,admin}
  \draw[->, thick, blue!60, line width=1.5pt] (\client) -- (nginx);

% è´Ÿè½½å‡è¡¡åˆ°ç½‘å…³
\draw[->, thick, orange!70, line width=1.8pt] (nginx) -- (gateway1);
\draw[->, thick, orange!70, line width=1.8pt] (nginx) -- (gateway2);

% ç½‘å…³åˆ°æœåŠ¡ï¼ˆåˆ†ç»„è¿æ¥ï¼‰
\draw[->, thick, red!60, line width=1.3pt] (gateway1) -- (user);
\draw[->, thick, red!60, line width=1.3pt] (gateway1) -- (business);
\draw[->, thick, red!60, line width=1.3pt] (gateway1) -- (food);
\draw[->, thick, red!60, line width=1.3pt] (gateway2) -- (order);
\draw[->, thick, red!60, line width=1.3pt] (gateway2) -- (cart);
\draw[->, thick, red!60, line width=1.3pt] (gateway2) -- (address);

% æœåŠ¡æ³¨å†Œè¿æ¥ï¼ˆä»£è¡¨æ€§è¿çº¿ï¼‰
\draw[<->, thick, purple!60, dashed, line width=1.2pt] (nacos) -- (user);
\draw[<->, thick, purple!60, dashed, line width=1.2pt] (nacos) -- (order);
\draw[<->, thick, purple!60, dashed, line width=1.2pt] (nacos) -- (cart);

% æ•°æ®å±‚è¿æ¥ï¼ˆå‚ç›´è¿æ¥ï¼‰
\draw[<->, thick, green!60, line width=1.2pt] (user) -- ++(0,-1.5) -| (redis);
\draw[<->, thick, green!60, line width=1.2pt] (cart) -- ++(0,-1.5) -| (redis);
\draw[<->, thick, teal!60, line width=1.2pt] (business) -- ++(0,-1.5) -| (mysql);
\draw[<->, thick, teal!60, line width=1.2pt] (order) -- ++(0,-1.5) -| (mysql);

% å³ä¾§ä¿¡æ¯é¢æ¿
\node [text width=3.5cm, font=\footnotesize] at (11,8) {
\textbf{æ¶æ„ç‰¹æ€§ï¼š}\\[0.2cm]
ğŸ”’ \textbf{å®‰å…¨ä¿éšœ}\\
â€¢ JWTè®¤è¯ä½“ç³»\\
â€¢ HTTPSå…¨ç¨‹åŠ å¯†\\
â€¢ æ¥å£æƒé™æ§åˆ¶\\[0.1cm]
âš¡ \textbf{æ€§èƒ½ä¼˜åŒ–}\\
â€¢ Redisåˆ†å¸ƒå¼ç¼“å­˜\\
â€¢ æ•°æ®åº“è¯»å†™åˆ†ç¦»\\
â€¢ CDNé™æ€èµ„æºåŠ é€Ÿ\\[0.1cm]
ğŸ›¡ï¸ \textbf{é«˜å¯ç”¨è®¾è®¡}\\
â€¢ å¾®æœåŠ¡é›†ç¾¤éƒ¨ç½²\\
â€¢ ç†”æ–­é™çº§æœºåˆ¶\\
â€¢ å®æ—¶å¥åº·ç›‘æ§
};

\node [text width=3.5cm, font=\footnotesize] at (11,4) {
\textbf{æŠ€æœ¯æ ˆï¼š}\\[0.2cm]
ğŸŒ \textbf{å‰ç«¯æŠ€æœ¯}\\
â€¢ Vue3 + TypeScript\\
â€¢ Element Plus UI\\
â€¢ Viteæ„å»ºå·¥å…·\\[0.1cm]
âš™ï¸ \textbf{åç«¯æŠ€æœ¯}\\
â€¢ Spring Cloud Alibaba\\
â€¢ Spring Boot 2.7\\
â€¢ MyBatis Plus\\[0.1cm]
ğŸ—„ï¸ \textbf{ä¸­é—´ä»¶}\\
â€¢ Nacosæ³¨å†Œä¸­å¿ƒ\\
â€¢ Redisç¼“å­˜é›†ç¾¤\\
â€¢ MySQLæ•°æ®åº“
};

\end{tikzpicture}
\caption{ä¼˜åŒ–åçš„å¾®æœåŠ¡æ¶æ„æ€»è§ˆå›¾}
\label{fig:microservice-architecture-overview}
\end{figure}

\subsubsection{å¾®æœåŠ¡æ‹†åˆ†ç­–ç•¥æ·±åº¦è§£æ}

å¾®æœåŠ¡çš„æ‹†åˆ†æ˜¯æ•´ä¸ªæ¶æ„è®¾è®¡çš„æ ¸å¿ƒå†³ç­–ã€‚æˆ‘ä»¬é‡‡ç”¨äº†åŸºäºDDDé™ç•Œä¸Šä¸‹æ–‡çš„æ‹†åˆ†ç­–ç•¥ï¼Œè¿™ç§ç­–ç•¥çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå°†ä¸šåŠ¡é€»è¾‘å†…èšåœ¨åˆé€‚çš„æœåŠ¡è¾¹ç•Œå†…ã€‚

åœ¨ç”¨æˆ·æœåŠ¡ï¼ˆUser Serviceï¼‰çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·è®¤è¯ã€ç”¨æˆ·ä¿¡æ¯ç®¡ç†ã€ç”¨æˆ·çŠ¶æ€ç®¡ç†ç­‰åŠŸèƒ½èšåˆåœ¨ä¸€èµ·ã€‚è¿™ä¸ªå†³ç­–åŸºäºç”¨æˆ·æ•°æ®çš„å¼ºä¸€è‡´æ€§è¦æ±‚ï¼Œä»¥åŠè¿™äº›åŠŸèƒ½ä¹‹é—´çš„ç´§å¯†è€¦åˆå…³ç³»ã€‚ç”¨æˆ·æœåŠ¡æ‰¿æ‹…äº†æ•´ä¸ªç³»ç»Ÿçš„èº«ä»½è®¤è¯èŒè´£ï¼Œæ˜¯å…¶ä»–æœåŠ¡çš„åŸºç¡€ä¾èµ–ã€‚

å•†å®¶æœåŠ¡ï¼ˆBusiness Serviceï¼‰å’Œé£Ÿå“æœåŠ¡ï¼ˆFood Serviceï¼‰çš„æ‹†åˆ†æ˜¯ä¸€ä¸ªå€¼å¾—æ·±å…¥è®¨è®ºçš„è®¾è®¡å†³ç­–ã€‚ä»ä¸šåŠ¡è§’åº¦çœ‹ï¼Œé£Ÿå“å±äºå•†å®¶ï¼Œåº”è¯¥ä½œä¸ºå•†å®¶èšåˆçš„ä¸€éƒ¨åˆ†ã€‚ä½†ä»æŸ¥è¯¢æ€§èƒ½å’Œå¼€å‘æ•ˆç‡è§’åº¦è€ƒè™‘ï¼Œé£Ÿå“ä¿¡æ¯çš„æŸ¥è¯¢é¢‘ç‡è¿œé«˜äºå•†å®¶ä¿¡æ¯ï¼Œå°†å…¶ç‹¬ç«‹ä¸ºå•ç‹¬çš„æœåŠ¡å¯ä»¥å®ç°æ›´å¥½çš„ç¼“å­˜ç­–ç•¥å’ŒæŸ¥è¯¢ä¼˜åŒ–ã€‚

è®¢å•æœåŠ¡ï¼ˆOrder Serviceï¼‰æ˜¯æ•´ä¸ªç³»ç»Ÿæœ€å¤æ‚çš„æœåŠ¡ï¼Œå®ƒéœ€è¦ä¸å¤šä¸ªæœåŠ¡è¿›è¡Œäº¤äº’ã€‚åœ¨è®¾è®¡æ—¶ï¼Œæˆ‘ä»¬å°†è®¢å•æ˜ç»†ï¼ˆOrderItemï¼‰è®¾è®¡ä¸ºè®¢å•èšåˆçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ç‹¬ç«‹çš„æœåŠ¡ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è®¢å•æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé¿å…åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤æ‚æ€§ã€‚

è´­ç‰©è½¦æœåŠ¡ï¼ˆCart Serviceï¼‰è¢«è®¾è®¡ä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œä¸»è¦è€ƒè™‘åˆ°è´­ç‰©è½¦çš„ç”Ÿå‘½å‘¨æœŸç›¸å¯¹ç‹¬ç«‹ï¼Œä»¥åŠå…¶é«˜é¢‘çš„è¯»å†™æ“ä½œç‰¹ç‚¹ã€‚è´­ç‰©è½¦æ•°æ®é‡‡ç”¨Redis + MySQLçš„åŒå†™ç­–ç•¥ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½ï¼Œåˆç¡®ä¿äº†æ•°æ®çš„å¯é æ€§ã€‚

é…é€åœ°å€æœåŠ¡ï¼ˆDeliveryAddress Serviceï¼‰è™½ç„¶åœ¨æ¦‚å¿µä¸Šå±äºç”¨æˆ·çš„ä¸€éƒ¨åˆ†ï¼Œä½†è€ƒè™‘åˆ°åœ°å€ç®¡ç†çš„å¤æ‚æ€§ï¼ˆå¦‚åœ°ç†ä½ç½®è®¡ç®—ã€é…é€èŒƒå›´åˆ¤æ–­ç­‰æœªæ¥æ‰©å±•ï¼‰ï¼Œæˆ‘ä»¬å°†å…¶ç‹¬ç«‹ä¸ºå•ç‹¬çš„æœåŠ¡ã€‚è¿™ç§è®¾è®¡ä¸ºæœªæ¥çš„åœ°ç†ä½ç½®ç›¸å…³åŠŸèƒ½æ‰©å±•ç•™ä¸‹äº†ç©ºé—´ã€‚

\subsubsection{æœåŠ¡é€šä¿¡æ¨¡å¼è®¾è®¡}

åœ¨å¾®æœåŠ¡é€šä¿¡æ–¹é¢ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†åŒæ­¥è°ƒç”¨å’Œå¼‚æ­¥äº‹ä»¶é©±åŠ¨ç›¸ç»“åˆçš„æ¨¡å¼ã€‚åŒæ­¥è°ƒç”¨ä¸»è¦ç”¨äºæŸ¥è¯¢ç±»æ“ä½œå’Œéœ€è¦ç«‹å³è·å¾—ç»“æœçš„ä¸šåŠ¡åœºæ™¯ã€‚é€šè¿‡OpenFeignå®ç°çš„æœåŠ¡é—´è°ƒç”¨ï¼Œæä¾›äº†ç±»å‹å®‰å…¨çš„æ¥å£å®šä¹‰å’Œè‡ªåŠ¨åŒ–çš„è´Ÿè½½å‡è¡¡ã€‚

å¼‚æ­¥äº‹ä»¶é©±åŠ¨ä¸»è¦ç”¨äºä¸šåŠ¡çŠ¶æ€å˜æ›´çš„é€šçŸ¥å’Œè·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯ã€‚ä¾‹å¦‚ï¼Œè®¢å•åˆ›å»ºäº‹ä»¶ä¼šè§¦å‘åº“å­˜é¢„æ‰£ã€è´­ç‰©è½¦æ¸…ç†ç­‰æ“ä½œã€‚è¿™ç§è®¾è®¡å®ç°äº†æœåŠ¡é—´çš„æ¾è€¦åˆï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚

æˆ‘ä»¬å®ç°äº†è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç»“åˆäº†éšæœºå’Œè½®è¯¢çš„ä¼˜ç‚¹ã€‚åœ¨æœåŠ¡å¯åŠ¨åˆæœŸä½¿ç”¨éšæœºç­–ç•¥ï¼Œé¿å…äº†æ‰€æœ‰è¯·æ±‚éƒ½æ‰“åˆ°ç¬¬ä¸€ä¸ªæœåŠ¡å®ä¾‹çš„é—®é¢˜ï¼›åœ¨æœåŠ¡ç¨³å®šè¿è¡Œååˆ‡æ¢åˆ°è½®è¯¢ç­–ç•¥ï¼Œä¿è¯äº†è´Ÿè½½çš„å‡åŒ€åˆ†å¸ƒã€‚è¿™ç§ç­–ç•¥åœ¨å®é™…æµ‹è¯•ä¸­è¡¨ç°è‰¯å¥½ï¼Œæœ‰æ•ˆé¿å…äº†å†·å¯åŠ¨æ—¶çš„æ€§èƒ½é—®é¢˜ã€‚

\subsection{æ•°æ®åº“è®¾è®¡}

æ•°æ®åº“è®¾è®¡æ˜¯ç³»ç»Ÿè®¾è®¡çš„åŸºç¡€ï¼Œè‰¯å¥½çš„æ•°æ®åº“è®¾è®¡ä¸ä»…èƒ½å¤Ÿæé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œè¿˜èƒ½å¤Ÿä¸ºæœªæ¥çš„æ‰©å±•æä¾›æ”¯æŒã€‚åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†åˆ†åº“åˆ†è¡¨çš„ç­–ç•¥ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œè¿™ç§è®¾è®¡ç¬¦åˆå¾®æœåŠ¡æ¶æ„çš„åŸºæœ¬åŸåˆ™ï¼Œèƒ½å¤Ÿä¿è¯å„ä¸ªæœåŠ¡çš„æ•°æ®ç‹¬ç«‹æ€§ã€‚

æ•°æ®åº“è®¾è®¡éµå¾ªäº†ç¬¬ä¸‰èŒƒå¼çš„è¦æ±‚ï¼Œé¿å…äº†æ•°æ®å†—ä½™ï¼ŒåŒæ—¶è€ƒè™‘åˆ°äº†æŸ¥è¯¢æ€§èƒ½çš„éœ€æ±‚ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹é€‚å½“åœ°è¿›è¡Œäº†åèŒƒå¼åŒ–è®¾è®¡ã€‚æ¯ä¸ªæ•°æ®è¡¨éƒ½è®¾è®¡äº†åˆé€‚çš„ç´¢å¼•ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚å¯¹äºç»å¸¸éœ€è¦å…³è”æŸ¥è¯¢çš„è¡¨ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨åº”ç”¨å±‚è¿›è¡Œæ•°æ®èšåˆçš„æ–¹å¼æ¥é¿å…è·¨åº“æŸ¥è¯¢ã€‚

% ä¼˜åŒ–åçš„æ•°æ®åº“ERå›¾
\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=1.1]
% å®šä¹‰æ ·å¼
\tikzstyle{entity} = [rectangle, rounded corners=5pt, minimum width=4cm, minimum height=2cm, 
                      text centered, draw=black, thick, fill=blue!15, font=\footnotesize\bfseries]
\tikzstyle{weak_entity} = [rectangle, rounded corners=5pt, minimum width=3.5cm, minimum height=1.8cm, 
                           text centered, draw=black, thick, double, fill=green!15, font=\footnotesize\bfseries]
\tikzstyle{relationship} = [diamond, minimum width=2.5cm, minimum height=1.2cm, 
                           text centered, draw=black, thick, fill=orange!20, font=\tiny\bfseries]
\tikzstyle{attribute} = [ellipse, minimum width=1.8cm, minimum height=0.8cm, 
                        text centered, draw=black, fill=yellow!20, font=\tiny]
\tikzstyle{key_attribute} = [ellipse, minimum width=1.8cm, minimum height=0.8cm, 
                            text centered, draw=black, thick, fill=yellow!40, font=\tiny\bfseries]

% æ ¸å¿ƒå®ä½“å±‚ - æ°´å¹³å¸ƒå±€
\node (user) [entity] at (0,6) {ç”¨æˆ·\\(User)\\\\user\_id, user\_name,\\password, user\_sex};
\node (business) [entity] at (8,6) {å•†å®¶\\(Business)\\\\business\_id, business\_name,\\business\_address, star\_price};
\node (food) [entity] at (16,6) {é£Ÿå“\\(Food)\\\\food\_id, food\_name,\\food\_price, food\_img};

% ä¸­é—´å±‚å®ä½“
\node (order) [entity] at (4,2) {è®¢å•\\(Orders)\\\\order\_id, order\_total,\\order\_date, order\_state};
\node (order_detail) [weak_entity] at (12,2) {è®¢å•æ˜ç»†\\(OrderDetail)\\\\quantity, unit\_price};

% è¾…åŠ©å®ä½“
\node (cart) [entity] at (0,2) {è´­ç‰©è½¦\\(Cart)\\\\cart\_id, quantity};
\node (address) [entity] at (8,2) {é…é€åœ°å€\\(DeliveryAddress)\\\\da\_id, contact\_name,\\contact\_tel, address};
\node (credit) [entity] at (16,2) {ç§¯åˆ†\\(Credit)\\\\credit\_id, credit\_value,\\operation\_type};

% ä¸»è¦å…³ç³»
\node (user_order) [relationship] at (2,4) {ä¸‹å•\\1:N};
\node (business_order) [relationship] at (6,4) {æ¥å•\\1:N};
\node (order_detail_rel) [relationship] at (8,1) {åŒ…å«\\1:N};
\node (food_detail) [relationship] at (14,4) {é€‰æ‹©\\N:M};
\node (user_cart) [relationship] at (-2,4) {æ‹¥æœ‰\\1:N};
\node (business_food) [relationship] at (12,6) {ç»è¥\\1:N};
\node (user_address) [relationship] at (4,0) {ç®¡ç†\\1:N};
\node (user_credit) [relationship] at (8,4) {è·å¾—\\1:1};

% ä¸»è¦è¿çº¿
\draw [thick] (user) -- (user_order) -- (order);
\draw [thick] (business) -- (business_order) -- (order);
\draw [thick] (order) -- (order_detail_rel) -- (order_detail);
\draw [thick] (food) -- (food_detail) -- (order_detail);
\draw [thick] (user) -- (user_cart) -- (cart);
\draw [thick] (business) -- (business_food) -- (food);
\draw [thick] (user) -- (user_address) -- (address);
\draw [thick] (user) -- (user_credit) -- (credit);

% è¾…åŠ©è¿çº¿
\draw [dashed, gray] (cart) -- node[above,font=\tiny] {æ·»åŠ åˆ°} (food);
\draw [dashed, gray] (order) -- node[above,font=\tiny] {é…é€åˆ°} (address);
\draw [dashed, gray] (business) -- node[above,font=\tiny] {å±äº} (cart);

% æ·»åŠ åŸºæ•°æ ‡æ³¨
\node [font=\tiny] at (1,4.5) {1};
\node [font=\tiny] at (3,3.5) {N};
\node [font=\tiny] at (5,4.5) {1};
\node [font=\tiny] at (7,3.5) {N};
\node [font=\tiny] at (7,1.5) {1};
\node [font=\tiny] at (9,1.5) {N};
\node [font=\tiny] at (13,4.5) {N};
\node [font=\tiny] at (15,3.5) {M};

% å›¾ä¾‹
\node [text width=3cm, font=\tiny] at (2,-1) {
\textbf{å›¾ä¾‹è¯´æ˜ï¼š}\\
\tikz \node[entity, scale=0.4] {}; å¼ºå®ä½“\\
\tikz \node[weak_entity, scale=0.4] {}; å¼±å®ä½“\\
\tikz \node[relationship, scale=0.4] {}; å…³ç³»\\
--- å¼ºå…³ç³»\\
--- å¼±å…³ç³»
};

% æ•°æ®è¡¨ç»Ÿè®¡
\node [text width=4cm, font=\tiny] at (14,-1) {
\textbf{æ•°æ®åº“ç»Ÿè®¡ï¼š}\\
â€¢ æ ¸å¿ƒå®ä½“ï¼š6ä¸ª\\
â€¢ å…³ç³»è¡¨ï¼š8ä¸ª\\
â€¢ ä¸»è¦å­—æ®µï¼š40+ä¸ª\\
â€¢ å¤–é”®çº¦æŸï¼š12ä¸ª\\
â€¢ ç´¢å¼•æ•°é‡ï¼š25ä¸ª
};

\end{tikzpicture}
\caption{ä¼˜åŒ–åçš„æ•°æ®åº“å®ä½“å…³ç³»å›¾}
\label{fig:optimized-er-diagram}
\end{figure}

\subsubsection{æ ¸å¿ƒæ•°æ®è¡¨è®¾è®¡}

åŸºäºDDDèšåˆè®¾è®¡åŸåˆ™ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªé™ç•Œä¸Šä¸‹æ–‡è®¾è®¡äº†ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆã€‚ä»¥ä¸‹è¯¦ç»†åˆ—å‡ºäº†æ ¸å¿ƒæ•°æ®è¡¨çš„è®¾è®¡ï¼š

\begin{table}[H]
\centering
\caption{ç”¨æˆ·è¡¨ï¼ˆuserï¼‰ç»“æ„è®¾è®¡}
\begin{tabular}{|p{3cm}|p{2cm}|p{1.5cm}|p{6cm}|}
\hline
\textbf{å­—æ®µå} & \textbf{æ•°æ®ç±»å‹} & \textbf{çº¦æŸ} & \textbf{è¯´æ˜} \\
\hline
user\_id & varchar(20) & PK & ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œæ”¯æŒå­—æ¯æ•°å­—ç»„åˆ \\
\hline
user\_name & varchar(50) & NOT NULL & ç”¨æˆ·å§“åï¼Œ2-20ä¸ªå­—ç¬¦ \\
\hline
password & varchar(32) & NOT NULL & MD5åŠ å¯†å¯†ç ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®BCryptï¼‰ \\
\hline
user\_sex & tinyint(1) & DEFAULT 1 & æ€§åˆ«ï¼š0-å¥³ï¼Œ1-ç”·ï¼Œ2-æœªçŸ¥ \\
\hline
user\_img & varchar(255) & NULL & ç”¨æˆ·å¤´åƒURL \\
\hline
del\_tag & tinyint(1) & DEFAULT 0 & åˆ é™¤æ ‡è®°ï¼š0-æ­£å¸¸ï¼Œ1-å·²åˆ é™¤ \\
\hline
created\_time & datetime & NOT NULL & åˆ›å»ºæ—¶é—´ \\
\hline
updated\_time & datetime & NOT NULL & æ›´æ–°æ—¶é—´ \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{å•†å®¶è¡¨ï¼ˆbusinessï¼‰ç»“æ„è®¾è®¡}
\begin{tabular}{|p{3cm}|p{2cm}|p{1.5cm}|p{6cm}|}
\hline
\textbf{å­—æ®µå} & \textbf{æ•°æ®ç±»å‹} & \textbf{çº¦æŸ} & \textbf{è¯´æ˜} \\
\hline
business\_id & int(11) & PK, AI & å•†å®¶ä¸»é”®ï¼Œè‡ªå¢ \\
\hline
business\_name & varchar(255) & NOT NULL & å•†å®¶åç§° \\
\hline
business\_address & varchar(255) & NOT NULL & å•†å®¶åœ°å€ \\
\hline
business\_explain & varchar(255) & NULL & å•†å®¶ä»‹ç» \\
\hline
business\_img & varchar(255) & NULL & å•†å®¶å›¾ç‰‡URL \\
\hline
order\_type\_id & int(11) & NOT NULL & å•†å®¶åˆ†ç±»ID \\
\hline
star\_price & decimal(10,2) & DEFAULT 0 & èµ·é€ä»·æ ¼ \\
\hline
delivery\_price & decimal(10,2) & DEFAULT 0 & é…é€è´¹ \\
\hline
remarks & varchar(255) & NULL & å¤‡æ³¨ä¿¡æ¯ \\
\hline
business\_status & tinyint(1) & DEFAULT 1 & è¥ä¸šçŠ¶æ€ï¼š0-ä¼‘æ¯ï¼Œ1-è¥ä¸š \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{è®¢å•è¡¨ï¼ˆordersï¼‰ç»“æ„è®¾è®¡}
\begin{tabular}{|p{3cm}|p{2cm}|p{1.5cm}|p{6cm}|}
\hline
\textbf{å­—æ®µå} & \textbf{æ•°æ®ç±»å‹} & \textbf{çº¦æŸ} & \textbf{è¯´æ˜} \\
\hline
order\_id & int(11) & PK, AI & è®¢å•ä¸»é”® \\
\hline
user\_id & varchar(20) & NOT NULL & ç”¨æˆ·IDï¼Œå¤–é”®å…³è” \\
\hline
business\_id & int(11) & NOT NULL & å•†å®¶IDï¼Œå¤–é”®å…³è” \\
\hline
order\_date & datetime & NOT NULL & ä¸‹å•æ—¶é—´ \\
\hline
order\_total & decimal(10,2) & NOT NULL & è®¢å•æ€»é‡‘é¢ \\
\hline
da\_id & int(11) & NOT NULL & é…é€åœ°å€ID \\
\hline
order\_state & tinyint(1) & DEFAULT 0 & è®¢å•çŠ¶æ€ï¼š0-å¾…æ”¯ä»˜ï¼Œ1-å·²æ”¯ä»˜ï¼Œ2-é…é€ä¸­ï¼Œ3-å·²å®Œæˆï¼Œ4-å·²å–æ¶ˆ \\
\hline
payment\_method & tinyint(1) & DEFAULT 1 & æ”¯ä»˜æ–¹å¼ï¼š1-åœ¨çº¿æ”¯ä»˜ï¼Œ2-è´§åˆ°ä»˜æ¬¾ \\
\hline
payment\_time & datetime & NULL & æ”¯ä»˜æ—¶é—´ \\
\hline
delivery\_time & datetime & NULL & é…é€æ—¶é—´ \\
\hline
remarks & text & NULL & è®¢å•å¤‡æ³¨ \\
\hline
\end{tabular}
\end{table}

åœ¨å…·ä½“çš„è¡¨è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ ¸å¿ƒå®ä½“éƒ½è®¾è®¡äº†ç›¸åº”çš„æ•°æ®è¡¨ã€‚ç”¨æˆ·è¡¨ï¼ˆuserï¼‰å­˜å‚¨ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·IDã€æ‰‹æœºå·ã€å¯†ç ã€ç”¨æˆ·åã€æ€§åˆ«ã€å¤´åƒç­‰ã€‚å•†å®¶è¡¨ï¼ˆbusinessï¼‰å­˜å‚¨å•†å®¶çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å•†å®¶IDã€å•†å®¶åç§°ã€å•†å®¶åœ°å€ã€è¥ä¸šæ—¶é—´ã€é…é€è´¹ç­‰ã€‚é£Ÿå“è¡¨ï¼ˆfoodï¼‰å­˜å‚¨å•†å“ä¿¡æ¯ï¼ŒåŒ…æ‹¬é£Ÿå“IDã€æ‰€å±å•†å®¶IDã€é£Ÿå“åç§°ã€ä»·æ ¼ã€æè¿°ã€å›¾ç‰‡ç­‰ã€‚

è®¢å•è¡¨ï¼ˆordersï¼‰çš„è®¾è®¡ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒéœ€è¦è®°å½•è®¢å•çš„å®Œæ•´ä¿¡æ¯ã€‚è®¢å•è¡¨åŒ…æ‹¬è®¢å•IDã€ç”¨æˆ·IDã€å•†å®¶IDã€è®¢å•çŠ¶æ€ã€è®¢å•æ€»é¢ã€ä¸‹å•æ—¶é—´ã€æ”¯ä»˜æ—¶é—´ç­‰å­—æ®µã€‚ä¸ºäº†è®°å½•è®¢å•ä¸­çš„å•†å“æ˜ç»†ï¼Œæˆ‘ä»¬è®¾è®¡äº†è®¢å•æ˜ç»†è¡¨ï¼ˆorder_detailï¼‰ï¼Œé€šè¿‡è®¢å•IDä¸è®¢å•è¡¨å…³è”ã€‚

è´­ç‰©è½¦è¡¨ï¼ˆcartï¼‰é‡‡ç”¨äº†ç®€åŒ–çš„è®¾è®¡ï¼Œåªè®°å½•ç”¨æˆ·IDã€å•†å®¶IDã€é£Ÿå“IDå’Œæ•°é‡ã€‚è¿™ç§è®¾è®¡ä½¿å¾—è´­ç‰©è½¦çš„æ“ä½œå˜å¾—ç®€å•é«˜æ•ˆã€‚é…é€åœ°å€è¡¨ï¼ˆdelivery_addressï¼‰è®°å½•ç”¨æˆ·çš„æ”¶è´§åœ°å€ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ°å€IDã€ç”¨æˆ·IDã€è”ç³»äººå§“åã€è”ç³»ç”µè¯ã€è¯¦ç»†åœ°å€ç­‰ã€‚

\subsection{DDDé¢†åŸŸé©±åŠ¨è®¾è®¡}

é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Designï¼ŒDDDï¼‰æ˜¯æœ¬ç³»ç»Ÿæ¶æ„è®¾è®¡çš„æ ¸å¿ƒç†å¿µã€‚é€šè¿‡DDDï¼Œæˆ‘ä»¬å°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ç»„ç»‡æˆæ¸…æ™°çš„é¢†åŸŸæ¨¡å‹ï¼Œä½¿å¾—ä»£ç ç»“æ„æ›´åŠ è´´è¿‘ä¸šåŠ¡å®é™…ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

æœ¬é¡¹ç›®å®ç°äº†å®Œæ•´çš„DDDæˆ˜ç•¥è®¾è®¡å’Œæˆ˜æœ¯è®¾è®¡ã€‚åœ¨æˆ˜ç•¥è®¾è®¡å±‚é¢ï¼Œæˆ‘ä»¬é€šè¿‡äº‹ä»¶é£æš´ï¼ˆEvent Stormingï¼‰è¯†åˆ«äº†æ ¸å¿ƒé¢†åŸŸã€æ”¯æ’‘åŸŸå’Œé€šç”¨åŸŸï¼Œæ˜ç¡®äº†å„ä¸ªé™ç•Œä¸Šä¸‹æ–‡çš„è¾¹ç•Œã€‚åœ¨æˆ˜æœ¯è®¾è®¡å±‚é¢ï¼Œæˆ‘ä»¬ä¸¥æ ¼æŒ‰ç…§DDDçš„æ¨¡å¼å®ç°äº†èšåˆã€å®ä½“ã€å€¼å¯¹è±¡ã€é¢†åŸŸæœåŠ¡ç­‰ç»„ä»¶ã€‚

\subsubsection{å…±äº«å†…æ ¸ï¼ˆShared Kernelï¼‰è®¾è®¡}

å…±äº«å†…æ ¸æ˜¯DDDæ¶æ„çš„åŸºç¡€è®¾æ–½ï¼Œæˆ‘ä»¬åœ¨`shared_kernel`æ¨¡å—ä¸­å®ç°äº†å®Œæ•´çš„DDDåŸºç¡€ç±»åº“ã€‚è¿™ä¸ªè®¾è®¡éµå¾ªäº†DRYåŸåˆ™ï¼Œé¿å…äº†å„ä¸ªå¾®æœåŠ¡ä¸­é‡å¤å®ç°åŸºç¡€ç»„ä»¶ã€‚

\textbf{å®ä½“åŸºç±»ï¼ˆEntityï¼‰}çš„è®¾è®¡ä½“ç°äº†DDDä¸­å®ä½“çš„æ ¸å¿ƒç‰¹å¾ï¼š

\begin{lstlisting}[caption=EntityåŸºç±»å®ç°]
public abstract class Entity<ID> implements Serializable {
    
    public abstract ID getId();
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        Entity<?> entity = (Entity<?>) obj;
        return getId() != null && getId().equals(entity.getId());
    }
    
    @Override
    public int hashCode() {
        return getId() != null ? getId().hashCode() : 0;
    }
}
\end{lstlisting}

å®ä½“çš„ç›¸ç­‰æ€§åŸºäºå”¯ä¸€æ ‡è¯†è€Œéå±æ€§å€¼ï¼Œè¿™ç¡®ä¿äº†å³ä½¿å®ä½“çš„å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå…¶èº«ä»½ä»ç„¶ä¿æŒä¸å˜ã€‚è¿™ç§è®¾è®¡åœ¨è®¢å•çŠ¶æ€å˜æ›´ã€ç”¨æˆ·ä¿¡æ¯æ›´æ–°ç­‰åœºæ™¯ä¸­éå¸¸é‡è¦ã€‚

\textbf{èšåˆæ ¹åŸºç±»ï¼ˆAggregateRootï¼‰}åœ¨å®ä½“åŸºç¡€ä¸Šå¢åŠ äº†é¢†åŸŸäº‹ä»¶ç®¡ç†åŠŸèƒ½ï¼š

\begin{lstlisting}[caption=AggregateRootåŸºç±»å®ç°]
public abstract class AggregateRoot<ID> extends Entity<ID> {
    
    private final List<DomainEvent> domainEvents = new ArrayList<>();
    
    protected void addDomainEvent(DomainEvent event) {
        domainEvents.add(event);
    }
    
    public List<DomainEvent> getDomainEvents() {
        List<DomainEvent> events = new ArrayList<>(domainEvents);
        domainEvents.clear();
        return Collections.unmodifiableList(events);
    }
    
    public void clearDomainEvents() {
        domainEvents.clear();
    }
}
\end{lstlisting}

èšåˆæ ¹è´Ÿè´£ç»´æŠ¤èšåˆå†…éƒ¨çš„ä¸šåŠ¡ä¸å˜æ€§çº¦æŸï¼Œå¹¶é€šè¿‡é¢†åŸŸäº‹ä»¶ä¸å¤–éƒ¨ä¸–ç•Œé€šä¿¡ã€‚äº‹ä»¶çš„æ”¶é›†å’Œå‘å¸ƒé‡‡ç”¨äº†å†…å­˜ä¸­çš„äº‹ä»¶åˆ—è¡¨ï¼Œåœ¨é€‚å½“çš„æ—¶æœºï¼ˆé€šå¸¸æ˜¯äº‹åŠ¡æäº¤åï¼‰ç»Ÿä¸€å‘å¸ƒã€‚

\textbf{å€¼å¯¹è±¡åŸºç±»ï¼ˆValueObjectï¼‰}å¼ºè°ƒäº†ä¸å¯å˜æ€§å’ŒåŸºäºå€¼çš„ç›¸ç­‰æ€§ï¼š

\begin{lstlisting}[caption=ValueObjectåŸºç±»è®¾è®¡]
public abstract class ValueObject implements Serializable {
    
    @Override
    public abstract boolean equals(Object obj);
    
    @Override
    public abstract int hashCode();
}
\end{lstlisting}

å€¼å¯¹è±¡çš„è®¾è®¡ç®€æ´è€Œé‡è¦ï¼Œå®ƒé€šè¿‡ç±»å‹ç³»ç»Ÿå¼ºåˆ¶äº†ä¸å¯å˜æ€§çº¦æŸï¼Œé¿å…äº†åŸå§‹ç±»å‹çš„æ»¥ç”¨ï¼Œæé«˜äº†ä»£ç çš„è¡¨è¾¾åŠ›ã€‚

\subsubsection{é¢†åŸŸäº‹ä»¶æœºåˆ¶è®¾è®¡}

é¢†åŸŸäº‹ä»¶æ˜¯DDDæ¶æ„ä¸­å®ç°ä¸šåŠ¡è§£è€¦çš„é‡è¦æœºåˆ¶ã€‚æˆ‘ä»¬è®¾è®¡äº†å®Œæ•´çš„äº‹ä»¶ä½“ç³»ï¼ŒåŒ…æ‹¬äº‹ä»¶å®šä¹‰ã€å‘å¸ƒå’Œå¤„ç†æœºåˆ¶ã€‚

\textbf{é¢†åŸŸäº‹ä»¶åŸºç±»}æä¾›äº†äº‹ä»¶çš„åŸºæœ¬å±æ€§ï¼š

\begin{lstlisting}[caption=DomainEventåŸºç±»]
public abstract class DomainEvent {
    
    private final String eventId;
    private final LocalDateTime occurredOn;
    private final String eventType;
    
    protected DomainEvent() {
        this.eventId = UUID.randomUUID().toString();
        this.occurredOn = LocalDateTime.now();
        this.eventType = this.getClass().getSimpleName();
    }
    
    // getters...
}
\end{lstlisting}

æ¯ä¸ªäº‹ä»¶éƒ½æœ‰å”¯ä¸€æ ‡è¯†ã€å‘ç”Ÿæ—¶é—´å’Œäº‹ä»¶ç±»å‹ï¼Œè¿™äº›ä¿¡æ¯å¯¹äºäº‹ä»¶çš„è¿½è¸ªå’Œå®¡è®¡è‡³å…³é‡è¦ã€‚äº‹ä»¶IDçš„å…¨å±€å”¯ä¸€æ€§ç¡®ä¿äº†äº‹ä»¶çš„å¹‚ç­‰æ€§å¤„ç†ã€‚

\textbf{äº‹ä»¶å‘å¸ƒå™¨æ¥å£}å®šä¹‰äº†ç»Ÿä¸€çš„äº‹ä»¶å‘å¸ƒå¥‘çº¦ï¼š

\begin{lstlisting}[caption=DomainEventPublisheræ¥å£]
public interface DomainEventPublisher {
    
    void publish(DomainEvent event);
    
    void publishAll(List<DomainEvent> events);
}
\end{lstlisting}

æˆ‘ä»¬åŸºäºSpringçš„ApplicationEventPublisherå®ç°äº†æœ¬åœ°äº‹ä»¶å‘å¸ƒå™¨ï¼š

\begin{lstlisting}[caption=Springäº‹ä»¶å‘å¸ƒå™¨å®ç°]
public class SpringDomainEventPublisher implements DomainEventPublisher {
    
    private final ApplicationEventPublisher applicationEventPublisher;
    
    public SpringDomainEventPublisher(ApplicationEventPublisher publisher) {
        this.applicationEventPublisher = publisher;
    }
    
    @Override
    public void publish(DomainEvent event) {
        applicationEventPublisher.publishEvent(event);
    }
    
    @Override
    public void publishAll(List<DomainEvent> events) {
        events.forEach(this::publish);
    }
}
\end{lstlisting}

è¿™ç§å®ç°æ–¹å¼ä½¿å¾—é¢†åŸŸå±‚ä¸Springæ¡†æ¶ä¿æŒäº†é€‚åº¦çš„è§£è€¦ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼ä½¿ç”¨äº‹ä»¶å‘å¸ƒåŠŸèƒ½ã€‚

\subsubsection{é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰}

é¢†åŸŸå±‚æ˜¯DDDæ¶æ„çš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«äº†ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚åœ¨é¢†åŸŸå±‚ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å„ç§é¢†åŸŸå¯¹è±¡ï¼ŒåŒ…æ‹¬å®ä½“ï¼ˆEntityï¼‰ã€å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰ã€èšåˆæ ¹ï¼ˆAggregate Rootï¼‰ã€é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰ç­‰ã€‚

\textbf{ç”¨æˆ·èšåˆçš„è®¾è®¡}æ˜¯DDDå®è·µçš„å…¸å‹ç¤ºä¾‹ã€‚ç”¨æˆ·èšåˆæ ¹å°è£…äº†ç”¨æˆ·çš„æ‰€æœ‰ä¸šåŠ¡è¡Œä¸ºï¼š

\begin{lstlisting}[caption=Userèšåˆæ ¹å…³é”®æ–¹æ³•]
public class User extends AggregateRoot<UserId> {
    
    public static User register(UserId userId, UserName userName, 
                               Password password, UserSex userSex) {
        User user = new User(userId, userName, password, userSex);
        
        // å‘å¸ƒç”¨æˆ·æ³¨å†Œäº‹ä»¶
        user.addDomainEvent(new UserRegisteredEvent(
            userId, userName, userSex
        ));
        
        return user;
    }
    
    public void changePassword(String oldPassword, String newPassword) {
        if (!this.password.matches(oldPassword)) {
            throw new IllegalArgumentException("åŸå¯†ç é”™è¯¯");
        }
        
        Password newPwd = Password.create(newPassword);
        this.password = newPwd;
        
        // å‘å¸ƒå¯†ç ä¿®æ”¹äº‹ä»¶
        addDomainEvent(new UserPasswordChangedEvent(userId));
    }
    
    public boolean validateLogin(String plainPassword) {
        if (this.delTag) {
            throw new IllegalStateException("ç”¨æˆ·å·²è¢«åˆ é™¤");
        }
        return this.password.matches(plainPassword);
    }
}
\end{lstlisting}

ç”¨æˆ·èšåˆçš„è®¾è®¡ä½“ç°äº†DDDçš„å‡ ä¸ªé‡è¦åŸåˆ™ï¼šä¸šåŠ¡é€»è¾‘å†…èšåœ¨èšåˆå†…éƒ¨ã€é€šè¿‡å·¥å‚æ–¹æ³•æ§åˆ¶å¯¹è±¡åˆ›å»ºã€åœ¨çŠ¶æ€å˜æ›´æ—¶å‘å¸ƒé¢†åŸŸäº‹ä»¶ã€é€šè¿‡å¼‚å¸¸å¤„ç†ä¸šåŠ¡è§„åˆ™è¿åã€‚

\textbf{å€¼å¯¹è±¡çš„ç²¾å¿ƒè®¾è®¡}æé«˜äº†æ¨¡å‹çš„è¡¨è¾¾åŠ›ã€‚ä»¥Passwordå€¼å¯¹è±¡ä¸ºä¾‹ï¼š

\begin{lstlisting}[caption=Passwordå€¼å¯¹è±¡å®ç°]
public class Password extends ValueObject {
    private final String encryptedValue;
    
    private Password(String encryptedValue) {
        this.encryptedValue = encryptedValue;
    }
    
    public static Password create(String plainPassword) {
        validatePassword(plainPassword);
        return new Password(encrypt(plainPassword));
    }
    
    public static Password fromEncrypted(String encryptedPassword) {
        if (encryptedPassword == null || encryptedPassword.isEmpty()) {
            throw new IllegalArgumentException("åŠ å¯†å¯†ç ä¸èƒ½ä¸ºç©º");
        }
        return new Password(encryptedPassword);
    }
    
    public boolean matches(String plainPassword) {
        return this.encryptedValue.equals(encrypt(plainPassword));
    }
    
    private static void validatePassword(String password) {
        if (password == null || password.length() < 6) {
            throw new IllegalArgumentException("å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½");
        }
        // æ›´å¤šéªŒè¯è§„åˆ™...
    }
    
    private static String encrypt(String plainPassword) {
        // MD5åŠ å¯†å®ç°
        // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†ç®—æ³•å¦‚BCrypt
    }
}
\end{lstlisting}

Passwordå€¼å¯¹è±¡å°è£…äº†å¯†ç çš„åŠ å¯†ã€éªŒè¯ç­‰æ‰€æœ‰ç›¸å…³é€»è¾‘ï¼Œé¿å…äº†åœ¨åº”ç”¨å±‚æˆ–åŸºç¡€è®¾æ–½å±‚æ•£è½è¿™äº›ä¸šåŠ¡è§„åˆ™ã€‚å·¥å‚æ–¹æ³•çš„ä½¿ç”¨ç¡®ä¿äº†å¯†ç åˆ›å»ºçš„å®‰å…¨æ€§ã€‚

å®ä½“æ˜¯é¢†åŸŸä¸­å…·æœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡ï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ªä¸šåŠ¡æµç¨‹ã€‚åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ï¼ˆUserï¼‰ã€å•†å®¶ï¼ˆBusinessï¼‰ã€é£Ÿå“ï¼ˆFoodï¼‰ã€è®¢å•ï¼ˆOrderï¼‰ç­‰éƒ½æ˜¯å…¸å‹çš„å®ä½“ã€‚æ¯ä¸ªå®ä½“éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä¸šåŠ¡è¡Œä¸ºå’ŒçŠ¶æ€å˜åŒ–è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œè®¢å•å®ä½“åŒ…å«äº†åˆ›å»ºè®¢å•ã€æ”¯ä»˜è®¢å•ã€å–æ¶ˆè®¢å•ã€ç¡®è®¤é€è¾¾ç­‰ä¸šåŠ¡æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°è£…äº†è®¢å•çŠ¶æ€è½¬æ¢çš„ä¸šåŠ¡è§„åˆ™ã€‚

å€¼å¯¹è±¡æ˜¯ä¸å…·æœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡ï¼Œå®ƒä»¬é€šè¿‡å…¶å±æ€§å€¼æ¥å®šä¹‰ç›¸ç­‰æ€§ã€‚åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œé‡‘é¢ï¼ˆMoneyï¼‰ã€ç”¨æˆ·IDï¼ˆUserIdï¼‰ã€è®¢å•çŠ¶æ€ï¼ˆOrderStatusï¼‰ã€é…é€åœ°å€ï¼ˆDeliveryAddressï¼‰ç­‰éƒ½è¢«è®¾è®¡ä¸ºå€¼å¯¹è±¡ã€‚å€¼å¯¹è±¡çš„ä¸å¯å˜æ€§ä¿è¯äº†ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§ã€‚ä¾‹å¦‚ï¼ŒMoneyå€¼å¯¹è±¡å°è£…äº†é‡‘é¢çš„è®¡ç®—é€»è¾‘ï¼ŒåŒ…æ‹¬åŠ æ³•ã€å‡æ³•ã€æ¯”è¾ƒç­‰æ“ä½œï¼Œé¿å…äº†æµ®ç‚¹æ•°è®¡ç®—çš„ç²¾åº¦é—®é¢˜ã€‚

èšåˆæ˜¯ä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥ç»´æŠ¤ä¸šåŠ¡è§„åˆ™çš„ä¸€è‡´æ€§ã€‚èšåˆæ ¹æ˜¯èšåˆçš„å…¥å£ç‚¹ï¼Œæ‰€æœ‰å¯¹èšåˆå†…éƒ¨å¯¹è±¡çš„è®¿é—®éƒ½å¿…é¡»é€šè¿‡èšåˆæ ¹è¿›è¡Œã€‚åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œè®¢å•ï¼ˆOrderï¼‰æ˜¯ä¸€ä¸ªå…¸å‹çš„èšåˆæ ¹ï¼Œå®ƒåŒ…å«äº†è®¢å•é¡¹ï¼ˆOrderItemï¼‰ç­‰èšåˆå†…çš„å®ä½“ã€‚é€šè¿‡èšåˆçš„è®¾è®¡ï¼Œæˆ‘ä»¬ç¡®ä¿äº†è®¢å•æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚

é¢†åŸŸæœåŠ¡ç”¨äºå¤„ç†ä¸å±äºä»»ä½•ç‰¹å®šå®ä½“æˆ–å€¼å¯¹è±¡çš„é¢†åŸŸé€»è¾‘ï¼Œé€šå¸¸æ¶‰åŠå¤šä¸ªèšåˆä¹‹é—´çš„åä½œã€‚ä¾‹å¦‚ï¼Œè®¢å•é¢†åŸŸæœåŠ¡ï¼ˆOrderDomainServiceï¼‰è´Ÿè´£å¤„ç†è®¢å•éªŒè¯ã€åº“å­˜æ£€æŸ¥ç­‰è·¨èšåˆçš„ä¸šåŠ¡é€»è¾‘ã€‚

\subsubsection{åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰}

åº”ç”¨å±‚æ˜¯DDDæ¶æ„ä¸­çš„åè°ƒå±‚ï¼Œå®ƒçš„æ ¸å¿ƒèŒè´£æ˜¯ç¼–æ’é¢†åŸŸå¯¹è±¡æ¥å®Œæˆä¸šåŠ¡ç”¨ä¾‹ã€‚åº”ç”¨å±‚ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯ä½œä¸ºé¢†åŸŸå±‚çš„è–„è–„ä¸€å±‚åŒ…è£…ï¼Œå¤„ç†äº‹åŠ¡è¾¹ç•Œã€æƒé™éªŒè¯ã€æ•°æ®è½¬æ¢ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚

\textbf{åº”ç”¨æœåŠ¡çš„è®¾è®¡åŸåˆ™}éµå¾ªäº†å•ä¸€èŒè´£å’Œæ¥å£éš”ç¦»åŸåˆ™ã€‚æ¯ä¸ªåº”ç”¨æœåŠ¡ä¸“æ³¨äºä¸€ä¸ªèšåˆçš„æ“ä½œï¼Œé¿å…äº†è·¨èšåˆçš„å¤æ‚åè°ƒã€‚ä»¥ç”¨æˆ·åº”ç”¨æœåŠ¡ä¸ºä¾‹ï¼š

\begin{lstlisting}[caption=UserApplicationServiceæ ¸å¿ƒæ–¹æ³•]
@Service
public class UserApplicationService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private UserDomainService userDomainService;
    
    @Autowired
    private DomainEventPublisher eventPublisher;
    
    @Transactional
    public CommonResult<String> register(RegisterUserCommand command) {
        try {
            // åˆ›å»ºå€¼å¯¹è±¡
            UserId userId = new UserId(command.getUserId());
            UserName userName = new UserName(command.getUserName());
            Password password = Password.create(command.getPassword());
            UserSex userSex = UserSex.fromCode(command.getUserSex());
            
            // æ£€æŸ¥ä¸šåŠ¡è§„åˆ™
            if (!userDomainService.isUserIdAvailable(userId)) {
                return new CommonResult<>(403, "ç”¨æˆ·IDå·²å­˜åœ¨", null);
            }
            
            // åˆ›å»ºç”¨æˆ·èšåˆ
            User user = User.register(userId, userName, password, userSex);
            
            // æŒä¹…åŒ–
            userRepository.save(user);
            
            // å‘å¸ƒé¢†åŸŸäº‹ä»¶
            eventPublisher.publishAll(user.getDomainEvents());
            
            return new CommonResult<>(200, "æ³¨å†ŒæˆåŠŸ", userId.getValue());
            
        } catch (IllegalArgumentException e) {
            return new CommonResult<>(400, e.getMessage(), null);
        }
    }
}
\end{lstlisting}

åº”ç”¨æœåŠ¡çš„æ–¹æ³•ä½“ç°äº†æ ‡å‡†çš„DDDåº”ç”¨å±‚æ¨¡å¼ï¼šæ¥æ”¶å‘½ä»¤å¯¹è±¡ã€åˆ›å»ºæˆ–åŠ è½½èšåˆã€è°ƒç”¨èšåˆæ–¹æ³•ã€æŒä¹…åŒ–å˜æ›´ã€å‘å¸ƒäº‹ä»¶ã€‚è¿™ç§æ¨¡å¼ç¡®ä¿äº†ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ‰§è¡Œå’Œäº‹ä»¶çš„åŠæ—¶å‘å¸ƒã€‚

\textbf{å‘½ä»¤å’ŒæŸ¥è¯¢çš„èŒè´£åˆ†ç¦»}åœ¨åº”ç”¨å±‚å¾—åˆ°äº†æ¸…æ™°çš„ä½“ç°ã€‚å‘½ä»¤æ“ä½œè´Ÿè´£æ”¹å˜ç³»ç»ŸçŠ¶æ€ï¼ŒæŸ¥è¯¢æ“ä½œè´Ÿè´£è¯»å–æ•°æ®ã€‚æˆ‘ä»¬ä¸ºæ¯ç§æ“ä½œå®šä¹‰äº†ä¸“é—¨çš„å‘½ä»¤å¯¹è±¡ï¼š

\begin{lstlisting}[caption=æ³¨å†Œç”¨æˆ·å‘½ä»¤å¯¹è±¡]
public class RegisterUserCommand {
    private String userId;
    private String userName;
    private String password;
    private Integer userSex;
    
    // éªŒè¯æ–¹æ³•
    public void validate() {
        if (StringUtils.isEmpty(userId)) {
            throw new IllegalArgumentException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        }
        if (StringUtils.isEmpty(userName)) {
            throw new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        }
        if (StringUtils.isEmpty(password)) {
            throw new IllegalArgumentException("å¯†ç ä¸èƒ½ä¸ºç©º");
        }
    }
    
    // getters and setters...
}
\end{lstlisting}

å‘½ä»¤å¯¹è±¡å°è£…äº†è¯·æ±‚å‚æ•°ï¼Œå¹¶æä¾›äº†åŸºç¡€çš„éªŒè¯é€»è¾‘ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ¥å£å±‚çš„ä»£ç æ›´åŠ ç®€æ´ï¼ŒåŒæ—¶ä¿è¯äº†å‚æ•°éªŒè¯çš„ä¸€è‡´æ€§ã€‚

\textbf{æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰}ç”¨äºå‘å®¢æˆ·ç«¯è¿”å›æ•°æ®ï¼Œé¿å…äº†é¢†åŸŸå¯¹è±¡çš„ç›´æ¥æš´éœ²ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·DTOè®¾è®¡]
public class UserDTO {
    private String userId;
    private String userName;
    private Integer userSex;
    private String userSexDesc;
    private String userImg;
    private Integer delTag;
    
    // ä»é¢†åŸŸå¯¹è±¡è½¬æ¢çš„å·¥å‚æ–¹æ³•
    public static UserDTO fromDomain(User user) {
        UserDTO dto = new UserDTO();
        dto.setUserId(user.getUserId().getValue());
        dto.setUserName(user.getUserName().getValue());
        dto.setUserSex(user.getUserSex().getCode());
        dto.setUserSexDesc(user.getUserSex().getDescription());
        dto.setUserImg(user.getUserImg());
        dto.setDelTag(user.isDeleted() ? 1 : 0);
        return dto;
    }
}
\end{lstlisting}

DTOçš„è®¾è®¡è€ƒè™‘äº†å®¢æˆ·ç«¯çš„ä½¿ç”¨ä¾¿åˆ©æ€§ï¼Œä¾‹å¦‚å°†æšä¸¾å€¼è½¬æ¢ä¸ºæ˜“äºç†è§£çš„æè¿°æ–‡æœ¬ã€‚

\subsubsection{åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructure Layerï¼‰}

åŸºç¡€è®¾æ–½å±‚ä¸ºä¸Šå±‚æä¾›æŠ€æœ¯æ”¯æŒï¼Œæ˜¯DDDæ¶æ„ä¸­æœ€é è¿‘æŠ€æœ¯å®ç°çš„å±‚æ¬¡ã€‚è¿™ä¸€å±‚çš„è®¾è®¡ä¸¥æ ¼éµå¾ªäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼Œæ‰€æœ‰çš„æŠ€æœ¯å®ç°éƒ½æ˜¯å¯¹é¢†åŸŸå±‚æˆ–åº”ç”¨å±‚å®šä¹‰æ¥å£çš„å…·ä½“å®ç°ã€‚

\textbf{ä»“å‚¨æ¨¡å¼çš„å®ç°}æ˜¯åŸºç¡€è®¾æ–½å±‚çš„æ ¸å¿ƒç»„ä»¶ã€‚ä»“å‚¨è´Ÿè´£èšåˆçš„æŒä¹…åŒ–å’Œé‡å»ºï¼Œéšè—äº†æ•°æ®å­˜å‚¨çš„æŠ€æœ¯ç»†èŠ‚ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·ä»“å‚¨æ¥å£å®šä¹‰]
public interface UserRepository {
    
    void save(User user);
    
    void update(User user);
    
    Optional<User> findById(UserId userId);
    
    boolean existsById(UserId userId);
    
    void delete(UserId userId);
}
\end{lstlisting}

ä»“å‚¨æ¥å£å®šä¹‰åœ¨é¢†åŸŸå±‚ï¼Œä½“ç°äº†DDDä¸­"åŸºç¡€è®¾æ–½å±‚ä¾èµ–é¢†åŸŸå±‚"çš„ä¾èµ–æ–¹å‘ã€‚ä»“å‚¨çš„å®ç°ç±»åœ¨åŸºç¡€è®¾æ–½å±‚ï¼Œè´Ÿè´£å…·ä½“çš„æ•°æ®è®¿é—®é€»è¾‘ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·ä»“å‚¨å®ç°ç±»]
@Repository
public class UserRepositoryImpl implements UserRepository {
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public void save(User user) {
        com.neusoft.po.User userPO = convertToPO(user);
        userMapper.save(userPO);
    }
    
    @Override
    public Optional<User> findById(UserId userId) {
        com.neusoft.po.User userPO = userMapper.getUserByUserId(userId.getValue());
        if (userPO == null) {
            return Optional.empty();
        }
        return Optional.of(convertToDomain(userPO));
    }
    
    private User convertToDomain(com.neusoft.po.User userPO) {
        return new User(
            new UserId(userPO.getUserId()),
            new UserName(userPO.getUserName()),
            Password.fromEncrypted(userPO.getPassword()),
            UserSex.fromCode(userPO.getUserSex()),
            userPO.getUserImg(),
            userPO.getDelTag() == 1
        );
    }
    
    private com.neusoft.po.User convertToPO(User user) {
        com.neusoft.po.User userPO = new com.neusoft.po.User();
        userPO.setUserId(user.getUserId().getValue());
        userPO.setUserName(user.getUserName().getValue());
        userPO.setPassword(user.getPassword().getEncryptedValue());
        userPO.setUserSex(user.getUserSex().getCode());
        userPO.setUserImg(user.getUserImg());
        userPO.setDelTag(user.isDeleted() ? 1 : 0);
        return userPO;
    }
}
\end{lstlisting}

ä»“å‚¨å®ç°çš„å…³é”®æ˜¯é¢†åŸŸå¯¹è±¡ä¸æŒä¹…åŒ–å¯¹è±¡ï¼ˆPOï¼‰ä¹‹é—´çš„è½¬æ¢ã€‚è¿™ç§è½¬æ¢ç¡®ä¿äº†é¢†åŸŸæ¨¡å‹çš„çº¯ç²¹æ€§ï¼Œé¿å…äº†JPAæ³¨è§£ç­‰æŒä¹…åŒ–æŠ€æœ¯æ±¡æŸ“é¢†åŸŸå¯¹è±¡ã€‚

\textbf{äº‹ä»¶åŸºç¡€è®¾æ–½çš„å®ç°}æ”¯æ’‘äº†äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚æˆ‘ä»¬åŸºäºSpringçš„äº‹ä»¶æœºåˆ¶å®ç°äº†æœ¬åœ°äº‹ä»¶æ€»çº¿ï¼ŒåŒæ—¶ä¸ºæœªæ¥çš„åˆ†å¸ƒå¼äº‹ä»¶é¢„ç•™äº†æ‰©å±•ç‚¹ï¼š

\begin{lstlisting}[caption=é¢†åŸŸäº‹ä»¶å¤„ç†å™¨ç¤ºä¾‹]
@Component
public class UserEventHandler {
    
    private static final Logger logger = LoggerFactory.getLogger(UserEventHandler.class);
    
    @EventListener
    @Async
    public void handleUserRegistered(UserRegisteredEvent event) {
        logger.info("ç”¨æˆ·æ³¨å†Œäº‹ä»¶: userId={}, userName={}", 
                   event.getUserId().getValue(), 
                   event.getUserName().getValue());
        
        // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘æ¬¢è¿é‚®ä»¶å‘é€ã€ç§¯åˆ†åˆå§‹åŒ–ç­‰åç»­å¤„ç†
        // sendWelcomeEmail(event.getUserId());
        // initializeUserPoints(event.getUserId());
    }
    
    @EventListener
    public void handlePasswordChanged(UserPasswordChangedEvent event) {
        logger.info("ç”¨æˆ·å¯†ç å˜æ›´äº‹ä»¶: userId={}", event.getUserId().getValue());
        
        // å¯ä»¥è§¦å‘å®‰å…¨æ—¥å¿—è®°å½•ã€é€šçŸ¥é‚®ä»¶ç­‰
        // recordSecurityLog(event);
        // sendPasswordChangeNotification(event.getUserId());
    }
}
\end{lstlisting}

äº‹ä»¶å¤„ç†å™¨é‡‡ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼ï¼Œé¿å…å½±å“ä¸»ä¸šåŠ¡æµç¨‹çš„æ€§èƒ½ã€‚äº‹ä»¶å¤„ç†çš„å¤±è´¥ä¸ä¼šå¯¼è‡´ä¸»ä¸šåŠ¡çš„å›æ»šï¼Œè¿™ç¬¦åˆæœ€ç»ˆä¸€è‡´æ€§çš„è®¾è®¡ç†å¿µã€‚

\textbf{ç¼“å­˜åŸºç¡€è®¾æ–½}ä¸ºé«˜é¢‘è®¿é—®çš„æ•°æ®æä¾›æ€§èƒ½ä¼˜åŒ–ï¼š

\begin{lstlisting}[caption=Redisç¼“å­˜å®ç°]
@Component
public class UserCacheService {
    
    @Autowired
    private StringRedisTemplate redisTemplate;
    
    private static final String USER_CACHE_PREFIX = "user:";
    private static final int CACHE_EXPIRE_HOURS = 2;
    
    public void cacheUser(User user) {
        String key = USER_CACHE_PREFIX + user.getUserId().getValue();
        String userJson = JsonUtils.toJson(UserDTO.fromDomain(user));
        
        redisTemplate.opsForValue().set(key, userJson, 
                                       CACHE_EXPIRE_HOURS, TimeUnit.HOURS);
    }
    
    public Optional<UserDTO> getCachedUser(UserId userId) {
        String key = USER_CACHE_PREFIX + userId.getValue();
        String userJson = redisTemplate.opsForValue().get(key);
        
        if (userJson != null) {
            return Optional.of(JsonUtils.fromJson(userJson, UserDTO.class));
        }
        return Optional.empty();
    }
    
    public void evictUser(UserId userId) {
        String key = USER_CACHE_PREFIX + userId.getValue();
        redisTemplate.delete(key);
    }
}
\end{lstlisting}

ç¼“å­˜å±‚ä½¿ç”¨DTOè€Œéé¢†åŸŸå¯¹è±¡ï¼Œé¿å…äº†åºåˆ—åŒ–å¤æ‚æ€§ã€‚ç¼“å­˜çš„å¤±æ•ˆç­–ç•¥é…åˆä¸šåŠ¡æ“ä½œï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚

\subsubsection{APIæ¥å£è®¾è®¡è§„èŒƒ}

ä¸ºäº†ç¡®ä¿å¾®æœåŠ¡é—´çš„é«˜æ•ˆåä½œï¼Œæˆ‘ä»¬åˆ¶å®šäº†ç»Ÿä¸€çš„APIè®¾è®¡è§„èŒƒï¼Œæ‰€æœ‰æ¥å£éƒ½éµå¾ªRESTfulè®¾è®¡åŸåˆ™ï¼š

\begin{table}[H]
\centering
\caption{ä¼˜åŒ–åçš„æ ¸å¿ƒAPIæ¥å£è§„èŒƒ}
\setlength{\tabcolsep}{6pt}
\begin{tabular}{|c|p{4.2cm}|p{2.8cm}|p{2cm}|p{3.2cm}|}
\hline
\rowcolor{gray!20}
\textbf{æ–¹æ³•} & \textbf{æ¥å£è·¯å¾„} & \textbf{åŠŸèƒ½æè¿°} & \textbf{å‚æ•°ç±»å‹} & \textbf{å“åº”æ ¼å¼} \\
\hline
\rowcolor{blue!10}
\multicolumn{5}{|c|}{\textbf{ç”¨æˆ·æœåŠ¡æ¥å£}} \\
\hline
POST & /api/v2/users/register & ç”¨æˆ·æ³¨å†Œ & Request Body & \{\texttt{code:200, msg:"æ³¨å†ŒæˆåŠŸ"}\} \\
\hline
POST & /api/v2/users/login & ç”¨æˆ·ç™»å½• & Request Body & \{\texttt{code:200, data:\{userId, token\}}\} \\
\hline
PUT & /api/v2/users/\{id\} & æ›´æ–°ç”¨æˆ·ä¿¡æ¯ & Path + Body & \{\texttt{code:200, data:UserDTO}\} \\
\hline
GET & /api/v2/users/\{id\} & è·å–ç”¨æˆ·ä¿¡æ¯ & Pathå‚æ•° & \{\texttt{code:200, data:UserDTO}\} \\
\hline
\rowcolor{green!10}
\multicolumn{5}{|c|}{\textbf{å•†å®¶ä¸é£Ÿå“æœåŠ¡æ¥å£}} \\
\hline
GET & /api/v2/businesses & è·å–å•†å®¶åˆ—è¡¨ & Queryå‚æ•° & \{\texttt{code:200, data:[BusinessDTO]}\} \\
\hline
GET & /api/v2/businesses/\{id\} & è·å–å•†å®¶è¯¦æƒ… & Pathå‚æ•° & \{\texttt{code:200, data:BusinessDTO}\} \\
\hline
GET & /api/v2/foods/business/\{id\} & è·å–å•†å®¶èœå“ & Pathå‚æ•° & \{\texttt{code:200, data:[FoodDTO]}\} \\
\hline
\rowcolor{orange!10}
\multicolumn{5}{|c|}{\textbf{è´­ç‰©è½¦ä¸è®¢å•æœåŠ¡æ¥å£}} \\
\hline
POST & /api/v2/carts/items & æ·»åŠ è´­ç‰©è½¦ & Request Body & \{\texttt{code:200, msg:"æ·»åŠ æˆåŠŸ"}\} \\
\hline
GET & /api/v2/carts/\{userId\} & æŸ¥çœ‹è´­ç‰©è½¦ & Pathå‚æ•° & \{\texttt{code:200, data:[CartDTO]}\} \\
\hline
POST & /api/v2/orders & åˆ›å»ºè®¢å• & Request Body & \{\texttt{code:200, data:\{orderId\}}\} \\
\hline
POST & /api/v2/orders/\{id\}/pay & æ”¯ä»˜è®¢å• & Path + Body & \{\texttt{code:200, msg:"æ”¯ä»˜æˆåŠŸ"}\} \\
\hline
GET & /api/v2/orders/user/\{id\} & æŸ¥çœ‹ç”¨æˆ·è®¢å• & Pathå‚æ•° & \{\texttt{code:200, data:[OrderDTO]}\} \\
\hline
\rowcolor{purple!10}
\multicolumn{5}{|c|}{\textbf{åœ°å€æœåŠ¡æ¥å£}} \\
\hline
GET & /api/v2/addresses/\{userId\} & è·å–ç”¨æˆ·åœ°å€ & Pathå‚æ•° & \{\texttt{code:200, data:[AddressDTO]}\} \\
\hline
POST & /api/v2/addresses & æ–°å¢æ”¶è´§åœ°å€ & Request Body & \{\texttt{code:200, msg:"æ·»åŠ æˆåŠŸ"}\} \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{APIæ¥å£å‚æ•°è§„èŒƒè¯¦æƒ…}
\setlength{\tabcolsep}{8pt}
\begin{tabular}{|p{3cm}|p{4cm}|p{6cm}|}
\hline
\rowcolor{gray!20}
\textbf{å‚æ•°ç±»å‹} & \textbf{ä¼ é€’æ–¹å¼} & \textbf{ç¤ºä¾‹æ ¼å¼} \\
\hline
Request Body & JSONæ ¼å¼è¯·æ±‚ä½“ & \texttt{\{"userId":"user001", "password":"123456"\}} \\
\hline
Pathå‚æ•° & URLè·¯å¾„ä¸­çš„å˜é‡ & \texttt{/api/v2/users/user001} \\
\hline
Queryå‚æ•° & URLæŸ¥è¯¢å­—ç¬¦ä¸² & \texttt{?page=1\&size=10\&orderTypeId=1} \\
\hline
Path + Body & è·¯å¾„å‚æ•°+è¯·æ±‚ä½“ & \texttt{PUT /users/user001 + JSON Body} \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{APIå“åº”çŠ¶æ€ç è§„èŒƒ}
\begin{tabular}{|p{2cm}|p{3cm}|p{8cm}|}
\hline
\textbf{çŠ¶æ€ç } & \textbf{å«ä¹‰} & \textbf{ä½¿ç”¨åœºæ™¯} \\
\hline
200 & æˆåŠŸ & è¯·æ±‚æˆåŠŸå¤„ç†ï¼Œè¿”å›é¢„æœŸç»“æœ \\
\hline
400 & å®¢æˆ·ç«¯é”™è¯¯ & è¯·æ±‚å‚æ•°é”™è¯¯ã€æ ¼å¼ä¸æ­£ç¡®ã€ä¸šåŠ¡è§„åˆ™éªŒè¯å¤±è´¥ \\
\hline
401 & æœªè®¤è¯ & ç¼ºå°‘è®¤è¯ä¿¡æ¯æˆ–è®¤è¯ä¿¡æ¯æ— æ•ˆ \\
\hline
403 & ç¦æ­¢è®¿é—® & å·²è®¤è¯ä½†æƒé™ä¸è¶³ï¼Œå¦‚ç”¨æˆ·IDå·²å­˜åœ¨ã€å¯†ç é”™è¯¯ç­‰ \\
\hline
404 & èµ„æºä¸å­˜åœ¨ & è¯·æ±‚çš„èµ„æºï¼ˆç”¨æˆ·ã€è®¢å•ç­‰ï¼‰ä¸å­˜åœ¨ \\
\hline
409 & èµ„æºå†²çª & ä¸šåŠ¡çŠ¶æ€å†²çªï¼Œå¦‚è®¢å•å·²æ”¯ä»˜ã€å•†å“å·²ä¸‹æ¶ç­‰ \\
\hline
429 & è¯·æ±‚è¿‡å¤š & è§¦å‘é™æµè§„åˆ™ï¼Œè¯·æ±‚é¢‘ç‡è¶…è¿‡é˜ˆå€¼ \\
\hline
500 & æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ & ç³»ç»Ÿå¼‚å¸¸ã€æ•°æ®åº“è¿æ¥å¤±è´¥ç­‰ä¸å¯é¢„æœŸé”™è¯¯ \\
\hline
503 & æœåŠ¡ä¸å¯ç”¨ & æœåŠ¡ç†”æ–­ã€ä¾èµ–æœåŠ¡ä¸å¯ç”¨ç­‰ \\
\hline
\end{tabular}
\end{table}

\subsubsection{ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡è®¾è®¡}

åŸºäºä¸šåŠ¡ç‰¹ç‚¹å’Œç”¨æˆ·ä½“éªŒè¦æ±‚ï¼Œæˆ‘ä»¬åˆ¶å®šäº†è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡ä½“ç³»ï¼š

\begin{table}[H]
\centering
\caption{ç³»ç»Ÿæ€§èƒ½åŸºå‡†æŒ‡æ ‡}
\begin{tabular}{|p{3cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|}
\hline
\textbf{æ€§èƒ½æŒ‡æ ‡} & \textbf{ç›®æ ‡å€¼} & \textbf{è­¦å‘Šé˜ˆå€¼} & \textbf{å½“å‰å€¼} & \textbf{æµ‹è¯•ç¯å¢ƒ} \\
\hline
APIå“åº”æ—¶é—´(P95) & < 200ms & 150ms & 120ms & å¹¶å‘100ç”¨æˆ· \\
\hline
APIå“åº”æ—¶é—´(P99) & < 500ms & 400ms & 280ms & å¹¶å‘100ç”¨æˆ· \\
\hline
ç³»ç»Ÿååé‡(QPS) & > 1000 & 800 & 1200 & å‹æµ‹ç»“æœ \\
\hline
æ•°æ®åº“è¿æ¥æ± åˆ©ç”¨ç‡ & < 80\% & 70\% & 45\% & æ­£å¸¸è´Ÿè½½ \\
\hline
JVMå †å†…å­˜ä½¿ç”¨ç‡ & < 80\% & 70\% & 55\% & è¿è¡Œ8å°æ—¶ \\
\hline
Redisç¼“å­˜å‘½ä¸­ç‡ & > 95\% & 90\% & 97\% & çƒ­ç‚¹æ•°æ® \\
\hline
æœåŠ¡å¯ç”¨æ€§ & > 99.9\% & 99.5\% & 99.95\% & æœˆåº¦ç»Ÿè®¡ \\
\hline
é”™è¯¯ç‡ & < 0.1\% & 0.05\% & 0.02\% & ä¸šåŠ¡é”™è¯¯ \\
\hline
\end{tabular}
\end{table}

\subsubsection{æ¥å£å±‚ï¼ˆInterface Layerï¼‰}

æ¥å£å±‚æ˜¯ç³»ç»Ÿä¸å¤–ç•Œäº¤äº’çš„å…¥å£ï¼ŒåŒ…æ‹¬REST APIã€æ¶ˆæ¯ç›‘å¬å™¨ã€å®šæ—¶ä»»åŠ¡ç­‰ã€‚åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œä¸»è¦é€šè¿‡Spring MVCå®ç°RESTful APIæ¥å£ã€‚

æ§åˆ¶å™¨ï¼ˆControllerï¼‰æ˜¯æ¥å£å±‚çš„ä¸»è¦ç»„ä»¶ï¼Œå®ƒè´Ÿè´£æ¥æ”¶HTTPè¯·æ±‚ï¼Œè°ƒç”¨åº”ç”¨æœåŠ¡å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶è¿”å›å“åº”ã€‚æ§åˆ¶å™¨çš„è®¾è®¡éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªæ§åˆ¶å™¨åªè´Ÿè´£ä¸€ç±»èµ„æºçš„æ“ä½œã€‚ä¾‹å¦‚ï¼ŒOrderControllerè´Ÿè´£å¤„ç†æ‰€æœ‰ä¸è®¢å•ç›¸å…³çš„HTTPè¯·æ±‚ã€‚

æ¥å£å±‚è¿˜è´Ÿè´£è¯·æ±‚çš„éªŒè¯ã€å¼‚å¸¸å¤„ç†ã€å“åº”æ ¼å¼åŒ–ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚é€šè¿‡Springçš„AOPæœºåˆ¶ï¼Œæˆ‘ä»¬å®ç°äº†ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼Œæé«˜äº†ä»£ç çš„æ•´æ´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

\subsection{åˆ†æä¸šåŠ¡é€»è¾‘}

æ·±å…¥åˆ†æä¸šåŠ¡é€»è¾‘æ˜¯ç³»ç»Ÿè®¾è®¡çš„å…³é”®æ­¥éª¤ã€‚é€šè¿‡å¯¹ä¸šåŠ¡é€»è¾‘çš„æ¢³ç†å’ŒæŠ½è±¡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè¯†åˆ«å‡ºç³»ç»Ÿçš„æ ¸å¿ƒæ¦‚å¿µå’Œå…³é”®æµç¨‹ï¼Œä¸ºåç»­çš„è®¾è®¡å’Œå®ç°æä¾›æŒ‡å¯¼ã€‚

\subsubsection{ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ç®¡ç†}

ç”¨æˆ·ç®¡ç†æ˜¯ç³»ç»Ÿçš„åŸºç¡€åŠŸèƒ½ï¼Œæ¶‰åŠç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç»´æŠ¤ç­‰å¤šä¸ªæ–¹é¢ã€‚åœ¨DDDçš„è®¾è®¡ä¸­ï¼Œç”¨æˆ·è¢«è®¾è®¡ä¸ºä¸€ä¸ªèšåˆæ ¹ï¼ŒåŒ…å«äº†ç”¨æˆ·çš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯å’Œè¡Œä¸ºã€‚ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç³»ç»Ÿéœ€è¦éªŒè¯æ‰‹æœºå·çš„å”¯ä¸€æ€§ï¼Œè¿™é€šè¿‡UserDomainServiceæ¥å®ç°ã€‚å¯†ç çš„åŠ å¯†å­˜å‚¨ä½¿ç”¨BCryptç®—æ³•ï¼Œç¡®ä¿å³ä½¿æ•°æ®åº“æ³„éœ²ä¹Ÿæ— æ³•ç›´æ¥è·å–ç”¨æˆ·å¯†ç ã€‚

ç™»å½•æµç¨‹é‡‡ç”¨JWTä»¤ç‰Œæœºåˆ¶ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿç”ŸæˆåŒ…å«ç”¨æˆ·IDå’Œè§’è‰²ä¿¡æ¯çš„JWTä»¤ç‰Œã€‚è¿™ä¸ªä»¤ç‰Œåœ¨åç»­çš„è¯·æ±‚ä¸­ä½œä¸ºèº«ä»½å‡­è¯ï¼Œé€šè¿‡APIç½‘å…³çš„è®¤è¯è¿‡æ»¤å™¨è¿›è¡ŒéªŒè¯ã€‚ç”¨æˆ·çš„æƒé™ä¿¡æ¯å­˜å‚¨åœ¨Redisä¸­ï¼Œè®¾ç½®äº†åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½åˆç¡®ä¿äº†æ•°æ®çš„æ—¶æ•ˆæ€§ã€‚

\subsubsection{å•†å“ç®¡ç†}

å•†å“ç®¡ç†æ¶‰åŠå•†å®¶å’Œé£Ÿå“ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚å•†å®¶æ˜¯é£Ÿå“çš„æ‹¥æœ‰è€…ï¼Œä¸€ä¸ªå•†å®¶å¯ä»¥ç»è¥å¤šç§é£Ÿå“ã€‚åœ¨DDDè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å°†å•†å®¶è®¾è®¡ä¸ºèšåˆæ ¹ï¼Œé£Ÿå“ä½œä¸ºå•†å®¶èšåˆå†…çš„å®ä½“ã€‚è¿™ç§è®¾è®¡åæ˜ äº†ä¸šåŠ¡ä¸Šçš„ä»å±å…³ç³»ï¼Œä¹Ÿä¾¿äºç»´æŠ¤æ•°æ®çš„ä¸€è‡´æ€§ã€‚

å•†å“çš„ä»·æ ¼è°ƒæ•´ã€ä¸Šä¸‹æ¶ç­‰æ“ä½œéƒ½é€šè¿‡å•†å®¶èšåˆæ ¹è¿›è¡Œï¼Œç¡®ä¿äº†ä¸šåŠ¡è§„åˆ™çš„ç»Ÿä¸€æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå½“å•†å®¶æš‚åœè¥ä¸šæ—¶ï¼Œæ‰€æœ‰å•†å“è‡ªåŠ¨ä¸‹æ¶ï¼›å½“å•†å®¶æ¢å¤è¥ä¸šæ—¶ï¼Œä¹‹å‰çš„å•†å“çŠ¶æ€å¾—ä»¥æ¢å¤ã€‚è¿™äº›ä¸šåŠ¡è§„åˆ™éƒ½å°è£…åœ¨é¢†åŸŸå¯¹è±¡å†…éƒ¨ï¼Œä¿è¯äº†ä¸šåŠ¡é€»è¾‘çš„å†…èšæ€§ã€‚

\subsubsection{è®¢å•ç®¡ç†}

è®¢å•ç®¡ç†æ˜¯ç³»ç»Ÿæœ€å¤æ‚çš„ä¸šåŠ¡é¢†åŸŸï¼Œæ¶‰åŠå¤šä¸ªæœåŠ¡çš„ååŒå·¥ä½œã€‚è®¢å•çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬åˆ›å»ºã€æ”¯ä»˜ã€é…é€ã€å®Œæˆç­‰å¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰ç‰¹å®šçš„ä¸šåŠ¡è§„åˆ™å’ŒçŠ¶æ€è½¬æ¢é€»è¾‘ã€‚

åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œç³»ç»Ÿéœ€è¦éªŒè¯è´­ç‰©è½¦ä¸­çš„å•†å“æ˜¯å¦æœ‰æ•ˆã€åº“å­˜æ˜¯å¦å……è¶³ã€ç”¨æˆ·æ˜¯å¦é€‰æ‹©äº†é…é€åœ°å€ç­‰ã€‚è¿™äº›éªŒè¯é€šè¿‡é¢†åŸŸæœåŠ¡æ¥å®Œæˆï¼Œç¡®ä¿äº†è®¢å•æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚è®¢å•åˆ›å»ºæˆåŠŸåï¼Œç³»ç»Ÿä¼šå‘å¸ƒOrderCreatedEventäº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«åº“å­˜æœåŠ¡ç›‘å¬ï¼Œç”¨äºé¢„æ‰£åº“å­˜ã€‚

æ”¯ä»˜æµç¨‹é‡‡ç”¨äº†äº‹ä»¶é©±åŠ¨çš„è®¾è®¡ï¼Œæ”¯ä»˜æˆåŠŸåå‘å¸ƒPaymentSuccessEventäº‹ä»¶ï¼Œè®¢å•æœåŠ¡ç›‘å¬è¿™ä¸ªäº‹ä»¶å¹¶æ›´æ–°è®¢å•çŠ¶æ€ã€‚å¦‚æœæ”¯ä»˜è¶…æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å–æ¶ˆè®¢å•å¹¶æ¢å¤åº“å­˜ï¼Œè¿™é€šè¿‡å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°ã€‚

\subsubsection{é…é€ç®¡ç†}

é…é€åœ°å€ç®¡ç†å…è®¸ç”¨æˆ·ç»´æŠ¤å¤šä¸ªæ”¶è´§åœ°å€ï¼Œå¹¶è®¾ç½®é»˜è®¤åœ°å€ã€‚åœ¨DDDè®¾è®¡ä¸­ï¼Œé…é€åœ°å€è¢«è®¾è®¡ä¸ºå€¼å¯¹è±¡ï¼Œå› ä¸ºåœ°å€æœ¬èº«æ²¡æœ‰ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒæ€»æ˜¯å±äºæŸä¸ªç”¨æˆ·ã€‚ç”¨æˆ·å¯ä»¥æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤åœ°å€ï¼Œä»¥åŠè®¾ç½®é»˜è®¤åœ°å€ã€‚è¿™äº›æ“ä½œéƒ½é€šè¿‡ç”¨æˆ·èšåˆæ ¹æ¥å®Œæˆï¼Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚

\subsubsection{è´­ç‰©è½¦ç®¡ç†}

è´­ç‰©è½¦æ˜¯ç”¨æˆ·è´­ç‰©è¿‡ç¨‹ä¸­çš„ä¸´æ—¶å­˜å‚¨åŒºåŸŸã€‚åœ¨è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬å°†è´­ç‰©è½¦è®¾è®¡ä¸ºç‹¬ç«‹çš„èšåˆæ ¹ï¼Œå› ä¸ºè´­ç‰©è½¦æœ‰å…¶ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸå’Œä¸šåŠ¡è§„åˆ™ã€‚ä¸€ä¸ªç”¨æˆ·åœ¨ä¸€ä¸ªå•†å®¶åªèƒ½æœ‰ä¸€ä¸ªè´­ç‰©è½¦ï¼Œè¿™ä¸ªçº¦æŸé€šè¿‡è´­ç‰©è½¦IDçš„è®¾è®¡æ¥ä¿è¯ï¼ˆç”¨æˆ·ID + å•†å®¶IDçš„ç»„åˆï¼‰ã€‚

è´­ç‰©è½¦æ”¯æŒæ·»åŠ å•†å“ã€ä¿®æ”¹æ•°é‡ã€åˆ é™¤å•†å“ã€æ¸…ç©ºç­‰æ“ä½œã€‚æ¯ä¸ªæ“ä½œéƒ½ä¼šè§¦å‘ç›¸åº”çš„é¢†åŸŸäº‹ä»¶ï¼Œä¾‹å¦‚ItemAddedToCartEventã€CartClearedEventç­‰ã€‚è¿™äº›äº‹ä»¶å¯ä»¥è¢«å…¶ä»–æœåŠ¡ç›‘å¬ï¼Œç”¨äºå®ç°å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¦‚è´­ç‰©è½¦å•†å“çš„å®æ—¶ä»·æ ¼æ›´æ–°ã€‚

\subsection{ä¼˜åŒ–åçš„å››è‰²å»ºæ¨¡}

å››è‰²å»ºæ¨¡æ³•æ˜¯ä¸€ç§å¼ºå¤§çš„é¢†åŸŸå»ºæ¨¡å·¥å…·ï¼Œé€šè¿‡ä¼˜åŒ–åçš„è®¾è®¡ï¼Œæˆ‘ä»¬æ›´æ¸…æ™°åœ°å±•ç¤ºäº†ä¸šåŠ¡å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼š

% é‡æ–°ä¼˜åŒ–çš„å››è‰²å»ºæ¨¡å›¾
\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=1.2, every node/.style={font=\small}]

% å®šä¹‰æ”¹è¿›çš„æ ·å¼
\tikzstyle{ppt} = [rectangle, rounded corners=8pt, minimum width=3.5cm, minimum height=2.2cm, 
                  text centered, draw=black, thick, fill=green!25, font=\small\bfseries, 
                  drop shadow={shadow xshift=2pt, shadow yshift=-2pt, fill=gray!50}]
\tikzstyle{moment} = [rectangle, rounded corners=8pt, minimum width=3.5cm, minimum height=2.2cm, 
                     text centered, draw=black, thick, fill=red!25, font=\small\bfseries,
                     drop shadow={shadow xshift=2pt, shadow yshift=-2pt, fill=gray!50}]
\tikzstyle{role} = [rectangle, rounded corners=8pt, minimum width=3.5cm, minimum height=2.2cm, 
                   text centered, draw=black, thick, fill=yellow!25, font=\small\bfseries,
                   drop shadow={shadow xshift=2pt, shadow yshift=-2pt, fill=gray!50}]
\tikzstyle{desc} = [rectangle, rounded corners=8pt, minimum width=3.5cm, minimum height=2.2cm, 
                   text centered, draw=black, thick, fill=blue!25, font=\small\bfseries,
                   drop shadow={shadow xshift=2pt, shadow yshift=-2pt, fill=gray!50}]
\tikzstyle{layer_bg} = [rectangle, rounded corners=5pt, fill=gray!10, draw=gray!30, very thick]
\tikzstyle{relation} = [thick, ->, >=stealth, color=gray!70, line width=1.5pt]

% èƒŒæ™¯å±‚
\node [layer_bg, minimum width=16cm, minimum height=3cm] at (7.5,8) {};
\node [layer_bg, minimum width=16cm, minimum height=3cm] at (7.5,5) {};
\node [layer_bg, minimum width=16cm, minimum height=3cm] at (7.5,2) {};
\node [layer_bg, minimum width=16cm, minimum height=3cm] at (7.5,-1) {};

% å±‚æ¬¡æ ‡ç­¾
\node [font=\bfseries\large, color=black] at (-1.5,8) {\rotatebox{90}{è§’è‰²å±‚}};
\node [font=\bfseries\large, color=black] at (-1.5,5) {\rotatebox{90}{å®ä½“å±‚}};
\node [font=\bfseries\large, color=black] at (-1.5,2) {\rotatebox{90}{äº‹ä»¶å±‚}};
\node [font=\bfseries\large, color=black] at (-1.5,-1) {\rotatebox{90}{æè¿°å±‚}};

% è§’è‰²åŸå‹å±‚ï¼ˆé»„è‰²ï¼‰- æœ€é¡¶å±‚
\node (customer) [role] at (3,8) {é¡¾å®¢è§’è‰²\\Customer\\\\â€¢ æµè§ˆå•†å“\\â€¢ ä¸‹å•è´­ä¹°\\â€¢ æ”¯ä»˜è®¢å•};
\node (merchant) [role] at (8,8) {å•†æˆ·è§’è‰²\\Merchant\\\\â€¢ ç®¡ç†å•†å“\\â€¢ å¤„ç†è®¢å•\\â€¢ æä¾›æœåŠ¡};
\node (admin) [role] at (13,8) {ç®¡ç†å‘˜\\Admin\\\\â€¢ ç³»ç»Ÿç»´æŠ¤\\â€¢ æ•°æ®ç›‘æ§\\â€¢ ç”¨æˆ·ç®¡ç†};

% PPTåŸå‹å±‚ï¼ˆç»¿è‰²ï¼‰- æ ¸å¿ƒå®ä½“
\node (user) [ppt] at (1,5) {ç”¨æˆ·\\User\\\\â€¢ ä¸ªäººä¿¡æ¯\\â€¢ ç™»å½•çŠ¶æ€\\â€¢ æƒé™è§’è‰²};
\node (business) [ppt] at (5,5) {å•†å®¶\\Business\\\\â€¢ åº—é“ºä¿¡æ¯\\â€¢ è¥ä¸šçŠ¶æ€\\â€¢ é…é€èŒƒå›´};
\node (food) [ppt] at (9,5) {é£Ÿå“\\Food\\\\â€¢ å•†å“ä¿¡æ¯\\â€¢ ä»·æ ¼åº“å­˜\\â€¢ åˆ†ç±»æ ‡ç­¾};
\node (cart) [ppt] at (13,5) {è´­ç‰©è½¦\\Cart\\\\â€¢ å•†å“æ¸…å•\\â€¢ æ•°é‡é‡‘é¢\\â€¢ ä¸´æ—¶å­˜å‚¨};

% æ—¶æ ‡åŸå‹å±‚ï¼ˆçº¢è‰²ï¼‰- ä¸šåŠ¡äº‹ä»¶
\node (order) [moment] at (2,2) {è®¢å•\\Order\\\\â€¢ ä¸‹å•æ—¶é—´\\â€¢ è®¢å•çŠ¶æ€\\â€¢ é…é€ä¿¡æ¯};
\node (payment) [moment] at (6,2) {æ”¯ä»˜è®°å½•\\Payment\\\\â€¢ æ”¯ä»˜æ—¶é—´\\â€¢ æ”¯ä»˜æ–¹å¼\\â€¢ äº¤æ˜“çŠ¶æ€};
\node (cartop) [moment] at (10,2) {è´­ç‰©è½¦æ“ä½œ\\CartOperation\\\\â€¢ æ“ä½œæ—¶é—´\\â€¢ æ“ä½œç±»å‹\\â€¢ å•†å“å˜åŒ–};
\node (delivery) [moment] at (14,2) {é…é€è®°å½•\\Delivery\\\\â€¢ é…é€æ—¶é—´\\â€¢ é…é€çŠ¶æ€\\â€¢ é…é€å‘˜ä¿¡æ¯};

% æè¿°åŸå‹å±‚ï¼ˆè“è‰²ï¼‰- åˆ†ç±»å’ŒçŠ¶æ€
\node (orderstatus) [desc] at (2,-1) {è®¢å•çŠ¶æ€\\OrderStatus\\\\â€¢ å¾…æ”¯ä»˜\\â€¢ é…é€ä¸­\\â€¢ å·²å®Œæˆ};
\node (paystatus) [desc] at (6,-1) {æ”¯ä»˜æ–¹å¼\\PaymentMethod\\\\â€¢ æ”¯ä»˜å®\\â€¢ å¾®ä¿¡\\â€¢ é“¶è¡Œå¡};
\node (foodcat) [desc] at (10,-1) {é£Ÿå“åˆ†ç±»\\FoodCategory\\\\â€¢ ä¸­é¤\\â€¢ è¥¿é¤\\â€¢ é¥®å“};
\node (usertype) [desc] at (14,-1) {ç”¨æˆ·ç±»å‹\\UserType\\\\â€¢ æ™®é€šç”¨æˆ·\\â€¢ VIPç”¨æˆ·\\â€¢ å•†å®¶ç”¨æˆ·};

% å…³ç³»è¿çº¿ - åˆ†ç»„ç»˜åˆ¶
% è§’è‰²åˆ°å®ä½“çš„å…³ç³»
\draw[relation, color=orange!80] (customer) -- (user);
\draw[relation, color=orange!80] (merchant) -- (business);
\draw[relation, color=orange!80] (admin) -- (user);

% å®ä½“åˆ°äº‹ä»¶çš„å…³ç³»
\draw[relation, color=blue!80] (user) -- (order);
\draw[relation, color=blue!80] (user) -- (payment);
\draw[relation, color=blue!80] (cart) -- (cartop);
\draw[relation, color=blue!80] (business) -- (delivery);

% äº‹ä»¶åˆ°æè¿°çš„å…³ç³»
\draw[relation, color=purple!80] (order) -- (orderstatus);
\draw[relation, color=purple!80] (payment) -- (paystatus);
\draw[relation, color=purple!80] (cartop) to[out=-45,in=45] (foodcat);
\draw[relation, color=purple!80] (delivery) -- (usertype);

% æ¨ªå‘å…³ç³»
\draw[relation, color=green!80] (user) -- (cart);
\draw[relation, color=green!80] (business) -- (food);
\draw[relation, color=green!80] (food) -- (cart);

% å›¾ä¾‹ - é‡æ–°è®¾è®¡
\node [text width=4cm, font=\footnotesize] at (17,5) {
\textbf{å››è‰²å»ºæ¨¡å›¾ä¾‹ï¼š}\\[0.2cm]
\tikz \node[ppt, scale=0.3] {}; \textbf{PPTåŸå‹}ï¼ˆç»¿è‰²ï¼‰\\
äººã€åœ°ç‚¹ã€äº‹ç‰©\\[0.1cm]
\tikz \node[moment, scale=0.3] {}; \textbf{æ—¶æ ‡åŸå‹}ï¼ˆçº¢è‰²ï¼‰\\
æ—¶é—´äº‹ä»¶ã€æ´»åŠ¨\\[0.1cm]
\tikz \node[role, scale=0.3] {}; \textbf{è§’è‰²åŸå‹}ï¼ˆé»„è‰²ï¼‰\\
å‚ä¸è€…è§’è‰²\\[0.1cm]
\tikz \node[desc, scale=0.3] {}; \textbf{æè¿°åŸå‹}ï¼ˆè“è‰²ï¼‰\\
åˆ†ç±»ã€çŠ¶æ€
};

% ä¸šåŠ¡ä»·å€¼è¯´æ˜
\node [text width=4cm, font=\footnotesize] at (17,1) {
\textbf{ä¸šåŠ¡ä»·å€¼ï¼š}\\[0.2cm]
â€¢ æ¸…æ™°çš„å±‚æ¬¡ç»“æ„\\
â€¢ å®Œæ•´çš„ä¸šåŠ¡è¦†ç›–\\  
â€¢ æ ‡å‡†çš„å»ºæ¨¡è§„èŒƒ\\
â€¢ ä¾¿äºå¾®æœåŠ¡åˆ’åˆ†\\
â€¢ æ”¯æŒç³»ç»Ÿæ‰©å±•
};

\end{tikzpicture}
\caption{é‡æ–°ä¼˜åŒ–çš„å››è‰²å»ºæ¨¡å›¾}
\label{fig:redesigned-four-color}
\end{figure}

\subsubsection{å››è‰²å»ºæ¨¡ä¸šåŠ¡ä»·å€¼åˆ†æ}

é€šè¿‡ä¼˜åŒ–åçš„å››è‰²å»ºæ¨¡ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¸…æ™°åœ°è¯†åˆ«ï¼š

\begin{itemize}
\item \textbf{æ ¸å¿ƒä¸šåŠ¡æµç¨‹}ï¼šç”¨æˆ·ä¸‹å•â†’è®¢å•å¤„ç†â†’æ”¯ä»˜â†’é…é€
\item \textbf{å…³é”®ä¸šåŠ¡å¯¹è±¡}ï¼šç”¨æˆ·ã€å•†å®¶ã€é£Ÿå“ã€è®¢å•ã€è´­ç‰©è½¦
\item \textbf{ä¸šåŠ¡è§„åˆ™è½½ä½“}ï¼šè®¢å•çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€é£Ÿå“åˆ†ç±»
\item \textbf{å‚ä¸è€…èŒè´£}ï¼šé¡¾å®¢æ¶ˆè´¹ã€å•†æˆ·æœåŠ¡ã€ç®¡ç†å‘˜ç»´æŠ¤
\end{itemize}

\subsubsection{å»ºæ¨¡æ­¥éª¤}

ä½¿ç”¨å››è‰²å»ºæ¨¡æ³•è¿›è¡Œé¢†åŸŸå»ºæ¨¡çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªè¿­ä»£å’Œæ·±åŒ–çš„è¿‡ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¯†åˆ«ç³»ç»Ÿä¸­çš„æ—¶æ ‡åŸå‹ï¼ˆMoment-Intervalï¼‰ï¼Œè¿™äº›æ˜¯éœ€è¦è¿½è¸ªçš„ä¸šåŠ¡äº‹ä»¶ã€‚åœ¨å¤–å–ç³»ç»Ÿä¸­ï¼Œè®¢å•ã€æ”¯ä»˜è®°å½•ã€è´­ç‰©è½¦æ“ä½œè®°å½•ç­‰éƒ½æ˜¯å…¸å‹çš„æ—¶æ ‡åŸå‹ã€‚è¿™äº›å¯¹è±¡è®°å½•äº†ä¸šåŠ¡æ´»åŠ¨çš„å‘ç”Ÿæ—¶é—´å’Œç›¸å…³ä¿¡æ¯ã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»¬è¯†åˆ«PPTåŸå‹ï¼ˆPart-Place-Thingï¼‰ï¼Œè¿™äº›æ˜¯å‚ä¸ä¸šåŠ¡æ´»åŠ¨çš„äººã€åœ°ç‚¹æˆ–äº‹ç‰©ã€‚ç”¨æˆ·ã€å•†å®¶ã€é£Ÿå“ã€è´­ç‰©è½¦ç­‰éƒ½å±äºPPTåŸå‹ã€‚è¿™äº›å¯¹è±¡æ˜¯ä¸šåŠ¡æ´»åŠ¨çš„å‚ä¸è€…æˆ–æ ‡çš„ç‰©ã€‚

ç„¶åï¼Œæˆ‘ä»¬æŠ½è±¡å‡ºè§’è‰²åŸå‹ï¼ˆRoleï¼‰ï¼Œè¿™äº›æ˜¯å¯ä»¥åœ¨ä¸åŒåœºæ™¯ä¸‹æ‰®æ¼”ä¸åŒè§’è‰²çš„æŠ½è±¡æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨ä¸‹å•æ—¶æ˜¯é¡¾å®¢è§’è‰²ï¼Œå•†å®¶åœ¨æ¥å•æ—¶æ˜¯å•†æˆ·è§’è‰²ã€‚è§’è‰²çš„è¯†åˆ«æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ä¸šåŠ¡ä¸­çš„èŒè´£åˆ†é…ã€‚

æœ€åï¼Œæˆ‘ä»¬å®šä¹‰æè¿°åŸå‹ï¼ˆDescriptionï¼‰ï¼Œè¿™äº›æ˜¯ç”¨äºåˆ†ç±»æˆ–æè¿°å…¶ä»–å¯¹è±¡çš„å‚è€ƒæ•°æ®ã€‚è®¢å•çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€é£Ÿå“åˆ†ç±»ç­‰éƒ½æ˜¯æè¿°åŸå‹ã€‚è¿™äº›å¯¹è±¡é€šå¸¸æ˜¯ç›¸å¯¹ç¨³å®šçš„ï¼Œä½œä¸ºå…¶ä»–å¯¹è±¡çš„å±æ€§æˆ–åˆ†ç±»ä¾æ®ã€‚

\subsubsection{å¾®æœåŠ¡åˆ’åˆ†}

åŸºäºå››è‰²å»ºæ¨¡çš„ç»“æœå’Œä¸šåŠ¡é€»è¾‘çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥åˆç†åœ°åˆ’åˆ†å¾®æœåŠ¡è¾¹ç•Œã€‚å¾®æœåŠ¡çš„åˆ’åˆ†éœ€è¦è€ƒè™‘å¤šä¸ªå› ç´ ï¼ŒåŒ…æ‹¬ä¸šåŠ¡è¾¹ç•Œã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚ã€å›¢é˜Ÿç»„ç»‡ç»“æ„ã€æŠ€æœ¯å¤æ‚åº¦ç­‰ã€‚

ç”¨æˆ·æœåŠ¡ï¼ˆUser Serviceï¼‰è´Ÿè´£ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†ç­‰ã€‚è¿™ä¸ªæœåŠ¡æ‹¥æœ‰ç”¨æˆ·æ•°æ®çš„å®Œæ•´æ‰€æœ‰æƒï¼Œå…¶ä»–æœåŠ¡éœ€è¦ç”¨æˆ·ä¿¡æ¯æ—¶é€šè¿‡æ¥å£è°ƒç”¨è·å–ã€‚ç”¨æˆ·æœåŠ¡è¿˜è´Ÿè´£ç”Ÿæˆå’ŒéªŒè¯JWTä»¤ç‰Œï¼Œæ˜¯ç³»ç»Ÿå®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ã€‚

å•†å®¶æœåŠ¡ï¼ˆBusiness Serviceï¼‰ç®¡ç†å•†å®¶å’Œé£Ÿå“ä¿¡æ¯ã€‚è™½ç„¶é£Ÿå“å±äºå•†å®¶ï¼Œä½†è€ƒè™‘åˆ°æŸ¥è¯¢çš„ä¾¿åˆ©æ€§ï¼Œæˆ‘ä»¬å°†é£Ÿå“ä¿¡æ¯ä¹Ÿæ”¾åœ¨å•†å®¶æœåŠ¡ä¸­ã€‚è¿™ç§è®¾è®¡é¿å…äº†é¢‘ç¹çš„è·¨æœåŠ¡æŸ¥è¯¢ï¼Œæé«˜äº†ç³»ç»Ÿæ€§èƒ½ã€‚

è®¢å•æœåŠ¡ï¼ˆOrder Serviceï¼‰æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒæœåŠ¡ï¼Œè´Ÿè´£è®¢å•çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚è®¢å•æœåŠ¡éœ€è¦ä¸å¤šä¸ªå…¶ä»–æœåŠ¡åä½œï¼ŒåŒ…æ‹¬è°ƒç”¨å•†å®¶æœåŠ¡è·å–å•†å“ä¿¡æ¯ã€è°ƒç”¨ç”¨æˆ·æœåŠ¡éªŒè¯ç”¨æˆ·èº«ä»½ã€å‘å¸ƒäº‹ä»¶é€šçŸ¥åº“å­˜æœåŠ¡ç­‰ã€‚è®¢å•æœåŠ¡çš„è®¾è®¡å……åˆ†ä½“ç°äº†å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡åä½œæ¨¡å¼ã€‚

è´­ç‰©è½¦æœåŠ¡ï¼ˆCart Serviceï¼‰æä¾›è´­ç‰©è½¦çš„ç®¡ç†åŠŸèƒ½ã€‚è´­ç‰©è½¦æ•°æ®å…·æœ‰ä¸´æ—¶æ€§ç‰¹ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨Redisä½œä¸ºä¸»è¦å­˜å‚¨ï¼ŒMySQLä½œä¸ºå¤‡ä»½å­˜å‚¨ã€‚è¿™ç§è®¾è®¡æ—¢ä¿è¯äº†æ€§èƒ½ï¼Œåˆç¡®ä¿äº†æ•°æ®çš„å¯é æ€§ã€‚

æ”¯ä»˜æœåŠ¡ï¼ˆPay Serviceï¼‰å°è£…äº†ä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„äº¤äº’é€»è¾‘ã€‚æ”¯ä»˜æœåŠ¡çš„è®¾è®¡è€ƒè™‘äº†æ”¯ä»˜çš„å¼‚æ­¥ç‰¹æ€§ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥å¤„ç†æ”¯ä»˜ç»“æœçš„é€šçŸ¥ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„å¯é æ€§ã€‚

é…é€åœ°å€æœåŠ¡ï¼ˆDeliveryAddress Serviceï¼‰ä½œä¸ºç”¨æˆ·æœåŠ¡çš„è¡¥å……ï¼Œä¸“é—¨ç®¡ç†ç”¨æˆ·çš„é…é€åœ°å€ä¿¡æ¯ã€‚è™½ç„¶åœ°å€å±äºç”¨æˆ·ï¼Œä½†è€ƒè™‘åˆ°åœ°å€ç®¡ç†çš„å¤æ‚æ€§å’Œç‹¬ç«‹æ€§ï¼Œæˆ‘ä»¬å°†å…¶è®¾è®¡ä¸ºç‹¬ç«‹çš„æœåŠ¡ã€‚

\subsubsection{åˆ’åˆ†ä¾æ®}

å¾®æœåŠ¡åˆ’åˆ†éµå¾ªäº†ä»¥ä¸‹åŸåˆ™ï¼šå•ä¸€èŒè´£åŸåˆ™ç¡®ä¿æ¯ä¸ªæœåŠ¡åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸï¼›é«˜å†…èšä½è€¦åˆåŸåˆ™ä½¿å¾—æœåŠ¡å†…éƒ¨åŠŸèƒ½ç´§å¯†ç›¸å…³ï¼ŒæœåŠ¡ä¹‹é—´ä¾èµ–æœ€å°åŒ–ï¼›ä¸šåŠ¡è¾¹ç•Œæ¸…æ™°åŸåˆ™æ ¹æ®DDDçš„é™ç•Œä¸Šä¸‹æ–‡æ¥åˆ’åˆ†æœåŠ¡è¾¹ç•Œï¼›æ•°æ®ç‹¬ç«‹æ€§åŸåˆ™ä¿è¯æ¯ä¸ªæœåŠ¡æ‹¥æœ‰è‡ªå·±çš„æ•°æ®å­˜å‚¨ï¼›å¯ç‹¬ç«‹éƒ¨ç½²åŸåˆ™ä½¿å¾—æ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚

æœåŠ¡ç²’åº¦çš„æŠŠæ¡æ˜¯å¾®æœåŠ¡è®¾è®¡çš„å…³é”®ã€‚è¿‡ç»†çš„ç²’åº¦ä¼šå¯¼è‡´æœåŠ¡æ•°é‡è¿‡å¤šï¼Œå¢åŠ è¿ç»´å¤æ‚åº¦ï¼›è¿‡ç²—çš„ç²’åº¦åˆ™å¤±å»äº†å¾®æœåŠ¡çš„ä¼˜åŠ¿ã€‚æˆ‘ä»¬åœ¨è®¾è®¡æ—¶é‡‡ç”¨äº†æ¸è¿›å¼æ‹†åˆ†çš„ç­–ç•¥ï¼Œå…ˆä»è¾ƒç²—çš„ç²’åº¦å¼€å§‹ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•é€æ­¥ç»†åŒ–ã€‚

\subsubsection{åˆ’åˆ†ç»“æœ}

æœ€ç»ˆçš„å¾®æœåŠ¡æ¶æ„åŒ…å«äº†7ä¸ªæ ¸å¿ƒä¸šåŠ¡æœåŠ¡å’Œå¤šä¸ªåŸºç¡€è®¾æ–½æœåŠ¡ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œï¼Œé€šè¿‡å®šä¹‰è‰¯å¥½çš„APIè¿›è¡Œé€šä¿¡ã€‚æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯å•å‘çš„ï¼Œé¿å…äº†å¾ªç¯ä¾èµ–ã€‚è¿™ç§æ¶æ„è®¾è®¡æ—¢ä¿è¯äº†ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œåˆæ§åˆ¶äº†å¤æ‚åº¦åœ¨å¯ç®¡ç†çš„èŒƒå›´å†…ã€‚

\section{SpringCloudç³»ç»Ÿå®ç°}

\subsection{SpringCloudé¡¹ç›®æ€»ä½“è®¾è®¡}

Spring Cloud Alibabaä¸ºæœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚æ•´ä½“æ¶æ„é‡‡ç”¨äº†åˆ†å±‚è®¾è®¡ï¼ŒåŒ…æ‹¬æ¥å…¥å±‚ã€ç½‘å…³å±‚ã€æœåŠ¡å±‚ã€æ•°æ®å±‚ç­‰å¤šä¸ªå±‚æ¬¡ã€‚æ¯ä¸€å±‚éƒ½æœ‰å…¶ç‰¹å®šçš„èŒè´£ï¼Œé€šè¿‡æ¸…æ™°çš„æ¥å£å®šä¹‰å®ç°å±‚ä¸å±‚ä¹‹é—´çš„äº¤äº’ã€‚

é¡¹ç›®é‡‡ç”¨Mavenå¤šæ¨¡å—ç»“æ„ç»„ç»‡ï¼Œçˆ¶å·¥ç¨‹å®šä¹‰äº†ç»Ÿä¸€çš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†ï¼Œå„ä¸ªå­æ¨¡å—ç»§æ‰¿çˆ¶å·¥ç¨‹çš„é…ç½®ã€‚æ•´ä½“é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

\begin{lstlisting}[caption=é¡¹ç›®æ¨¡å—ç»“æ„]
elm_springcloud/
â”œâ”€â”€ springcloud_elm/          # ä¸»é¡¹ç›®ç›®å½•
â”‚   â”œâ”€â”€ pom.xml               # çˆ¶å·¥ç¨‹POMæ–‡ä»¶
â”‚   â”œâ”€â”€ shared_kernel/        # å…±äº«å†…æ ¸æ¨¡å—
â”‚   â”œâ”€â”€ api_service/          # OpenFeignæ¥å£æ¨¡å—  
â”‚   â”œâ”€â”€ user_server_10100/    # ç”¨æˆ·å¾®æœåŠ¡
â”‚   â”œâ”€â”€ food_server_10200/    # é£Ÿå“å¾®æœåŠ¡
â”‚   â”œâ”€â”€ business_server_10300/# å•†å®¶å¾®æœåŠ¡
â”‚   â”œâ”€â”€ cart_server_10400/    # è´­ç‰©è½¦å¾®æœåŠ¡
â”‚   â”œâ”€â”€ deliveryaddress_server_10500/ # åœ°å€å¾®æœåŠ¡
â”‚   â”œâ”€â”€ orders_server_10601/  # è®¢å•å¾®æœåŠ¡
â”‚   â”œâ”€â”€ credit_server_10700/  # ç§¯åˆ†å¾®æœåŠ¡
â”‚   â””â”€â”€ gateway_server_14000/ # ç½‘å…³å¾®æœåŠ¡
â”œâ”€â”€ elmclient/                # å‰ç«¯Vueé¡¹ç›®
â””â”€â”€ nacos/                    # Nacosæ³¨å†Œä¸­å¿ƒ
\end{lstlisting}



é¡¹ç›®é‡‡ç”¨Mavenå¤šæ¨¡å—ç»“æ„ç»„ç»‡ï¼Œçˆ¶å·¥ç¨‹å®šä¹‰äº†ç»Ÿä¸€çš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†ï¼Œå„ä¸ªå­æ¨¡å—ç»§æ‰¿çˆ¶å·¥ç¨‹çš„é…ç½®ã€‚è¿™ç§ç»“æ„ä¸ä»…ä¾¿äºä¾èµ–ç®¡ç†ï¼Œè¿˜èƒ½ç¡®ä¿å„ä¸ªæœåŠ¡ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Spring Bootåº”ç”¨ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œå’Œéƒ¨ç½²ã€‚

åœ¨æŠ€æœ¯é€‰å‹ä¸Šï¼Œæˆ‘ä»¬é€‰æ‹©äº†Spring Cloud Alibabaç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼Œæä¾›äº†æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€æœåŠ¡å…ƒæ•°æ®ç®¡ç†ç­‰åŠŸèƒ½ã€‚Spring Cloud Gatewayä½œä¸ºAPIç½‘å…³ï¼Œæä¾›äº†è·¯ç”±è½¬å‘ã€è´Ÿè½½å‡è¡¡ã€é™æµç†”æ–­ç­‰åŠŸèƒ½ã€‚OpenFeignç”¨äºæœåŠ¡é—´çš„HTTPè°ƒç”¨ï¼Œç®€åŒ–äº†å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚Sentinelæä¾›äº†æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰åŠŸèƒ½ï¼Œä¿éšœäº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚

\textbf{ã€æˆªå›¾ä½ç½®38ï¼šSentinelæ§åˆ¶å°ç•Œé¢ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Sentinelæ§åˆ¶å°ä¸»ç•Œé¢æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹å†…å®¹ï¼š
\begin{enumerate}
\item è®¿é—®åœ°å€ï¼š\texttt{http://localhost:8080}
\item ç”¨æˆ·å/å¯†ç ï¼š\texttt{sentinel/sentinel}
\item æ˜¾ç¤ºåº”ç”¨åˆ—è¡¨ï¼ŒåŒ…æ‹¬å·²æ¥å…¥çš„å¾®æœåŠ¡
\item å±•ç¤ºå®æ—¶ç›‘æ§é¢æ¿ï¼Œæ˜¾ç¤ºQPSã€å“åº”æ—¶é—´ç­‰æŒ‡æ ‡
\item æ˜¾ç¤ºæµæ§è§„åˆ™ã€é™çº§è§„åˆ™ã€çƒ­ç‚¹è§„åˆ™ç­‰èœå•
\item ç•Œé¢åº”æ˜¾ç¤ºå½“å‰æ´»è·ƒçš„è¿æ¥æ•°å’Œç»Ÿè®¡æ•°æ®
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®39ï¼šSentinelæµæ§è§„åˆ™é…ç½®ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Sentinelæµæ§è§„åˆ™é…ç½®æˆªå›¾ï¼š
\begin{enumerate}
\item è¿›å…¥"æµæ§è§„åˆ™"èœå•ï¼Œç‚¹å‡»"æ–°å¢æµæ§è§„åˆ™"
\item é…ç½®æµæ§è§„åˆ™ï¼š
  \begin{itemize}
    \item èµ„æºåï¼š/user/login
    \item é˜ˆå€¼ç±»å‹ï¼šQPS
    \item å•æœºé˜ˆå€¼ï¼š5ï¼ˆæ¯ç§’æœ€å¤š5ä¸ªè¯·æ±‚ï¼‰
    \item æµæ§æ¨¡å¼ï¼šç›´æ¥
    \item æµæ§æ•ˆæœï¼šå¿«é€Ÿå¤±è´¥
  \end{itemize}
\item æ˜¾ç¤ºè§„åˆ™ä¿å­˜æˆåŠŸçš„ç¡®è®¤ä¿¡æ¯
\item å±•ç¤ºå·²é…ç½®çš„æµæ§è§„åˆ™åˆ—è¡¨
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®40ï¼šSentinelç†”æ–­è§„åˆ™æ•ˆæœã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Sentinelç†”æ–­è§„åˆ™æµ‹è¯•æˆªå›¾ï¼š
\begin{enumerate}
\item é…ç½®ç†”æ–­è§„åˆ™ï¼ˆå¼‚å¸¸æ¯”ä¾‹é˜ˆå€¼50%ï¼Œæ—¶é—´çª—å£10ç§’ï¼‰
\item æ¨¡æ‹ŸæœåŠ¡å¼‚å¸¸ï¼Œè¿ç»­å‘é€å¤±è´¥è¯·æ±‚
\item æ˜¾ç¤ºç†”æ–­å™¨å¼€å¯ï¼ŒçŠ¶æ€å˜ä¸ºOPEN
\item åœ¨ç›‘æ§ç•Œé¢çœ‹åˆ°è¯·æ±‚è¢«ç†”æ–­ï¼Œè¿”å›é™çº§å“åº”
\item ç­‰å¾…æ—¶é—´çª—å£è¿‡åï¼Œç†”æ–­å™¨è‡ªåŠ¨æ¢å¤ä¸ºCLOSED
\item å±•ç¤ºç†”æ–­å™¨çŠ¶æ€å˜åŒ–çš„å®Œæ•´è¿‡ç¨‹
\end{enumerate}

\subsection{NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒ}

\subsubsection{Nacosç®€ä»‹ä¸æ¶æ„ä¼˜åŠ¿}

Nacosï¼ˆDynamic Naming and Configuration Serviceï¼‰æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼ŒNacosæ‰¿æ‹…äº†æœåŠ¡æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒçš„åŒé‡è§’è‰²ã€‚

Nacosç›¸æ¯”ä¼ ç»Ÿçš„Eureka + Config Serverç»„åˆå…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚é¦–å…ˆï¼ŒNacosæä¾›äº†ç»Ÿä¸€çš„æ§åˆ¶å°ç•Œé¢ï¼Œå¯ä»¥åŒæ—¶ç®¡ç†æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¿¡æ¯ï¼Œé™ä½äº†è¿ç»´å¤æ‚åº¦ã€‚å…¶æ¬¡ï¼ŒNacosæ”¯æŒæœåŠ¡çš„æƒé‡é…ç½®å’Œæµé‡è°ƒåº¦ï¼Œè¿™å¯¹äºç°åº¦å‘å¸ƒå’Œè´Ÿè½½å‡è¡¡éå¸¸æœ‰ç”¨ã€‚ç¬¬ä¸‰ï¼ŒNacosçš„é…ç½®ç®¡ç†æ”¯æŒå¤šç¯å¢ƒã€å¤šç§Ÿæˆ·ï¼Œä»¥åŠé…ç½®çš„ç‰ˆæœ¬ç®¡ç†å’Œå›æ»šåŠŸèƒ½ã€‚

ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ŒNacosç»´æŠ¤äº†æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹çš„æ³¨å†Œä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡åç§°ã€IPåœ°å€ã€ç«¯å£å·ã€å¥åº·çŠ¶æ€ã€æƒé‡ã€å…ƒæ•°æ®ç­‰ã€‚æœåŠ¡å®ä¾‹åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å‘Nacosæ³¨å†Œï¼Œå¹¶é€šè¿‡å¿ƒè·³æœºåˆ¶ä¿æŒæ³¨å†Œä¿¡æ¯çš„æœ‰æ•ˆæ€§ã€‚Nacosæ”¯æŒä¸´æ—¶å®ä¾‹å’ŒæŒä¹…åŒ–å®ä¾‹ä¸¤ç§æ¨¡å¼ï¼Œä¸´æ—¶å®ä¾‹é€‚åˆäº‘åŸç”Ÿç¯å¢ƒï¼ŒæŒä¹…åŒ–å®ä¾‹é€‚åˆä¼ ç»ŸIDCç¯å¢ƒã€‚

ä½œä¸ºé…ç½®ä¸­å¿ƒï¼ŒNacosæä¾›äº†é…ç½®çš„é›†ä¸­ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°èƒ½åŠ›ã€‚æ‰€æœ‰å¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶éƒ½å­˜å‚¨åœ¨Nacosä¸­ï¼Œæ”¯æŒPropertiesã€YAMLã€JSONç­‰å¤šç§æ ¼å¼ã€‚æœåŠ¡å¯åŠ¨æ—¶ä¼šä»Nacosæ‹‰å–é…ç½®ï¼Œå½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼ŒNacosä¼šå®æ—¶æ¨é€ç»™ç›¸å…³çš„æœåŠ¡å®ä¾‹ï¼Œå®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚

\textbf{ã€æˆªå›¾ä½ç½®26ï¼šNacosæœåŠ¡æ³¨å†Œä¸­å¿ƒæ§åˆ¶å°ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Nacosæ§åˆ¶å°ä¸»ç•Œé¢æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹å†…å®¹ï¼š
\begin{enumerate}
\item è®¿é—®åœ°å€ï¼š\texttt{http://localhost:8848/nacos}
\item ç”¨æˆ·å/å¯†ç ï¼š\texttt{nacos/nacos}
\item æ˜¾ç¤ºæœåŠ¡ç®¡ç†èœå•ï¼ŒåŒ…æ‹¬æœåŠ¡åˆ—è¡¨ã€æœåŠ¡è¯¦æƒ…
\item æ˜¾ç¤ºé…ç½®ç®¡ç†èœå•ï¼ŒåŒ…æ‹¬é…ç½®åˆ—è¡¨ã€ç›‘å¬æŸ¥è¯¢
\item æ˜¾ç¤ºå‘½åç©ºé—´ç®¡ç†ï¼Œå±•ç¤ºå¤šç¯å¢ƒéš”ç¦»
\item ç•Œé¢åº”æ˜¾ç¤ºNacosç‰ˆæœ¬å·å’Œé›†ç¾¤çŠ¶æ€
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®27ï¼šNacosæœåŠ¡åˆ—è¡¨ç•Œé¢ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥æœåŠ¡åˆ—è¡¨é¡µé¢æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹æ³¨å†Œçš„å¾®æœåŠ¡ï¼š
\begin{enumerate}
\item \texttt{user-server}ï¼ˆç«¯å£10100ï¼‰- å¥åº·å®ä¾‹æ•°1/1
\item \texttt{business-server}ï¼ˆç«¯å£10300ï¼‰- å¥åº·å®ä¾‹æ•°1/1  
\item \texttt{food-server}ï¼ˆç«¯å£10200ï¼‰- å¥åº·å®ä¾‹æ•°1/1
\item \texttt{order-server}ï¼ˆç«¯å£10601ï¼‰- å¥åº·å®ä¾‹æ•°1/1
\item \texttt{cart-server}ï¼ˆç«¯å£10400ï¼‰- å¥åº·å®ä¾‹æ•°1/1
\item \texttt{address-server}ï¼ˆç«¯å£10500ï¼‰- å¥åº·å®ä¾‹æ•°1/1
\item \texttt{gateway-server}ï¼ˆç«¯å£14000ï¼‰- å¥åº·å®ä¾‹æ•°1/1
\item æ¯ä¸ªæœåŠ¡åº”æ˜¾ç¤ºIPåœ°å€ã€ç«¯å£ã€æƒé‡ã€æ˜¯å¦å¥åº·ç­‰ä¿¡æ¯
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®28ï¼šNacosé…ç½®ç®¡ç†ç•Œé¢ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥é…ç½®ç®¡ç†é¡µé¢æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š
\begin{enumerate}
\item \texttt{user-server.yml} - ç”¨æˆ·æœåŠ¡é…ç½®
\item \texttt{business-server.yml} - å•†å®¶æœåŠ¡é…ç½®
\item \texttt{gateway-server.yml} - ç½‘å…³æœåŠ¡é…ç½®
\item \texttt{common-config.yml} - å…¬å…±é…ç½®
\item æ˜¾ç¤ºé…ç½®çš„Data IDã€Groupã€æè¿°ã€æ“ä½œæŒ‰é’®
\item ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œå±•ç¤ºYAMLé…ç½®å†…å®¹
\end{enumerate}

\subsubsection{Nacosé›†ç¾¤éƒ¨ç½²ä¸é«˜å¯ç”¨è®¾è®¡}

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éƒ¨ç½²äº†Nacosé›†ç¾¤ä»¥ä¿è¯é«˜å¯ç”¨æ€§ã€‚Nacosé›†ç¾¤é‡‡ç”¨APæ¨¡å¼ï¼ˆå¯ç”¨æ€§ä¼˜å…ˆï¼‰çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç­–ç•¥ï¼Œä½¿ç”¨Distroåè®®ä¿è¯é›†ç¾¤æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚

é›†ç¾¤éƒ¨ç½²é…ç½®å¦‚ä¸‹ï¼š

\begin{lstlisting}[caption=Nacosé›†ç¾¤é…ç½®]
# cluster.conf
192.168.1.100:8848
192.168.1.101:8848  
192.168.1.102:8848

# application.properties
server.port=8848
spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://192.168.1.200:3306/nacos_config?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC
db.user.0=nacos
db.password.0=nacos

nacos.cmdb.dumpTaskInterval=3600
nacos.cmdb.eventTaskInterval=10
nacos.cmdb.labelTaskInterval=300
nacos.cmdb.loadDataAtStart=false
\end{lstlisting}

é›†ç¾¤æ¶æ„é‡‡ç”¨äº†MySQLä½œä¸ºé…ç½®æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œç¡®ä¿é…ç½®æ•°æ®çš„å¯é æ€§ã€‚é€šè¿‡Nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¸ºå®¢æˆ·ç«¯æä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼š

\begin{lstlisting}[caption=Nginxè´Ÿè½½å‡è¡¡é…ç½®]
upstream nacos-cluster {
    server 192.168.1.100:8848 weight=1;
    server 192.168.1.101:8848 weight=1;
    server 192.168.1.102:8848 weight=1;
}

server {
    listen 80;
    server_name nacos.example.com;
    
    location / {
        proxy_pass http://nacos-cluster;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
\end{lstlisting}

\subsubsection{æœåŠ¡æ³¨å†Œä¸å‘ç°çš„å®ç°ç»†èŠ‚}

æœåŠ¡æ³¨å†Œæ˜¯å¾®æœåŠ¡æ¶æ„çš„åŸºç¡€åŠŸèƒ½ã€‚åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½åŒ…å«äº†Nacoså®¢æˆ·ç«¯çš„é…ç½®ï¼š

\begin{lstlisting}[caption=å¾®æœåŠ¡bootstrap.ymlé…ç½®]
spring:
  application:
    name: user-server
  cloud:
    nacos:
      discovery:
        server-addr: nacos.example.com:80
        namespace: 84c19f6a-f112-4bc2-a4d3-e7a3d5b5a9c2
        group: DEFAULT_GROUP
        cluster-name: BJ
        metadata:
          version: 1.0.0
          region: beijing
      config:
        server-addr: nacos.example.com:80
        namespace: 84c19f6a-f112-4bc2-a4d3-e7a3d5b5a9c2
        group: DEFAULT_GROUP
        file-extension: yml
        shared-configs:
          - data-id: common-config.yml
            group: DEFAULT_GROUP
            refresh: true
\end{lstlisting}

æœåŠ¡å‘ç°çš„å®ç°åŸºäºSpring Cloud LoadBalancerã€‚æˆ‘ä»¬å®ç°äº†è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç»“åˆäº†éšæœºå’Œè½®è¯¢çš„ä¼˜ç‚¹ï¼š

\begin{lstlisting}[caption=è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥]
@Component
public class CustomLoadBalancer implements ReactorServiceInstanceLoadBalancer {
    
    private final AtomicInteger counter = new AtomicInteger(0);
    private final String serviceId;
    
    public CustomLoadBalancer(ObjectProvider<ServiceInstanceListSupplier> serviceInstanceListSupplierProvider, String serviceId) {
        this.serviceId = serviceId;
        this.serviceInstanceListSupplierProvider = serviceInstanceListSupplierProvider;
    }
    
    @Override
    public Mono<Response<ServiceInstance>> choose(Request request) {
        ServiceInstanceListSupplier supplier = serviceInstanceListSupplierProvider
                .getIfAvailable(NoopServiceInstanceListSupplier::new);
        return supplier.get(request).next()
                .map(serviceInstances -> processInstanceResponse(serviceInstances));
    }
    
    private Response<ServiceInstance> processInstanceResponse(List<ServiceInstance> serviceInstances) {
        if (serviceInstances.isEmpty()) {
            return new EmptyResponse();
        }
        
        // å‰ä¸‰æ¬¡ä½¿ç”¨éšæœºç­–ç•¥ï¼Œä¹‹åä½¿ç”¨è½®è¯¢ç­–ç•¥
        int currentCount = counter.incrementAndGet();
        ServiceInstance instance;
        
        if (currentCount <= 3) {
            // éšæœºç­–ç•¥
            int randomIndex = ThreadLocalRandom.current().nextInt(serviceInstances.size());
            instance = serviceInstances.get(randomIndex);
        } else {
            // è½®è¯¢ç­–ç•¥
            int index = (currentCount - 4) % serviceInstances.size();
            instance = serviceInstances.get(index);
        }
        
        return new DefaultResponse(instance);
    }
}
\end{lstlisting}

è¿™ç§æ··åˆç­–ç•¥æœ‰æ•ˆé¿å…äº†æœåŠ¡å¯åŠ¨æ—¶çš„"æƒŠç¾¤æ•ˆåº”"ï¼Œåœ¨ä¿è¯è´Ÿè½½å‡è¡¡çš„åŒæ—¶æä¾›äº†æ›´å¥½çš„æ€§èƒ½ç‰¹æ€§ã€‚

\textbf{ã€æˆªå›¾ä½ç½®29ï¼šè´Ÿè½½å‡è¡¡æ•ˆæœæ¼”ç¤ºã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥è´Ÿè½½å‡è¡¡æµ‹è¯•æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹å†…å®¹ï¼š
\begin{enumerate}
\item å¯åŠ¨å¤šä¸ªç›¸åŒæœåŠ¡å®ä¾‹ï¼ˆå¦‚2ä¸ªuser-serverå®ä¾‹ï¼‰
\item é€šè¿‡Postmanæˆ–curlå¤šæ¬¡è°ƒç”¨ç”¨æˆ·æœåŠ¡æ¥å£ï¼š\\
  \texttt{GET http://localhost:14000/user/getUserByUserId?userId=test001}
\item æ˜¾ç¤ºè¯·æ±‚è¢«åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹
\item åœ¨æœåŠ¡æ—¥å¿—ä¸­æ˜¾ç¤ºä¸åŒå®ä¾‹å¤„ç†è¯·æ±‚çš„è®°å½•
\item å±•ç¤ºNacosæ§åˆ¶å°ä¸­å¤šä¸ªå®ä¾‹çš„æ³¨å†ŒçŠ¶æ€
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®30ï¼šæœåŠ¡å®ä¾‹æƒé‡é…ç½®ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥NacosæœåŠ¡å®ä¾‹æƒé‡é…ç½®æˆªå›¾ï¼š
\begin{enumerate}
\item è¿›å…¥Nacosæ§åˆ¶å°çš„æœåŠ¡è¯¦æƒ…é¡µé¢
\item é€‰æ‹©user-serveræœåŠ¡ï¼Œç‚¹å‡»å®ä¾‹è¯¦æƒ…
\item å±•ç¤ºæƒé‡é…ç½®ç•Œé¢ï¼Œæ˜¾ç¤ºå½“å‰æƒé‡å€¼
\item ä¿®æ”¹æŸä¸ªå®ä¾‹çš„æƒé‡ï¼ˆå¦‚ä»1.0æ”¹ä¸º2.0ï¼‰
\item æ˜¾ç¤ºæƒé‡ä¿®æ”¹åçš„è´Ÿè½½åˆ†é…æ•ˆæœ
\end{enumerate}

\subsubsection{é…ç½®ç®¡ç†ä¸åŠ¨æ€åˆ·æ–°æœºåˆ¶}

Nacosçš„é…ç½®ç®¡ç†åŠŸèƒ½ä¸ºå¾®æœåŠ¡æä¾›äº†å¼ºå¤§çš„é…ç½®çƒ­æ›´æ–°èƒ½åŠ›ã€‚æˆ‘ä»¬ä¸ºä¸åŒçš„å¾®æœåŠ¡å’Œç¯å¢ƒè®¾è®¡äº†åˆ†å±‚çš„é…ç½®ç»“æ„ï¼š

\begin{lstlisting}[caption=åˆ†å±‚é…ç½®ç»“æ„]
# å…¬å…±é…ç½® (common-config.yml)
logging:
  level:
    com.neusoft: INFO
    root: WARN
    
spring:
  redis:
    host: redis.example.com
    port: 6379
    database: 0
    timeout: 5000
    
management:
  endpoints:
    web:
      exposure:
        include: "*"

# ç”¨æˆ·æœåŠ¡é…ç½® (user-server.yml)        
spring:
  datasource:
    url: jdbc:mysql://mysql.example.com:3306/elm_user?useSSL=false&serverTimezone=UTC
    username: ${DB_USERNAME:elm_user}
    password: ${DB_PASSWORD:elm_password}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      connection-timeout: 30000
      
mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.neusoft.po
  configuration:
    map-underscore-to-camel-case: true
    
# DDDç›¸å…³é…ç½®
app:
  domain:
    event:
      async: true
      thread-pool-size: 10
  cache:
    user:
      expire-hours: 2
      max-size: 10000
\end{lstlisting}

ä¸ºäº†å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨äº†`@RefreshScope`æ³¨è§£ï¼š

\begin{lstlisting}[caption=é…ç½®åŠ¨æ€åˆ·æ–°å®ç°]
@Component
@RefreshScope
@ConfigurationProperties(prefix = "app.cache.user")
public class UserCacheProperties {
    
    private int expireHours = 2;
    private int maxSize = 10000;
    
    // getters and setters
}

@Service
@RefreshScope
public class UserCacheService {
    
    @Autowired
    private UserCacheProperties cacheProperties;
    
    @EventListener
    public void handleRefreshEvent(RefreshEvent event) {
        log.info("é…ç½®åˆ·æ–°äº‹ä»¶: {}", event.getEventDesc());
        // é‡æ–°åˆå§‹åŒ–ç¼“å­˜é…ç½®
        initializeCacheConfig();
    }
    
    private void initializeCacheConfig() {
        // æ ¹æ®æ–°çš„é…ç½®é‡æ–°åˆå§‹åŒ–ç¼“å­˜
    }
}
\end{lstlisting}

é…ç½®å˜æ›´çš„ç›‘å¬å’Œæ¨é€æœºåˆ¶ä¿è¯äº†ç³»ç»Ÿèƒ½å¤Ÿå®æ—¶å“åº”é…ç½®å˜åŒ–ï¼Œè€Œæ— éœ€é‡å¯æœåŠ¡ã€‚è¿™ç§èƒ½åŠ›å¯¹äºç”Ÿäº§ç¯å¢ƒçš„è¿ç»´å’Œè°ƒä¼˜å…·æœ‰é‡è¦æ„ä¹‰ã€‚

\textbf{ã€æˆªå›¾ä½ç½®31ï¼šé…ç½®åŠ¨æ€åˆ·æ–°æ¼”ç¤ºã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥é…ç½®åŠ¨æ€åˆ·æ–°æµ‹è¯•æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹æ“ä½œè¿‡ç¨‹ï¼š
\begin{enumerate}
\item åœ¨Nacosæ§åˆ¶å°ç¼–è¾‘user-server.ymlé…ç½®æ–‡ä»¶
\item ä¿®æ”¹æŸä¸ªé…ç½®é¡¹ï¼ˆå¦‚ç¼“å­˜è¿‡æœŸæ—¶é—´ä»2å°æ—¶æ”¹ä¸º3å°æ—¶ï¼‰
\item ç‚¹å‡»å‘å¸ƒæŒ‰é’®ï¼Œæ˜¾ç¤ºé…ç½®å‘å¸ƒæˆåŠŸ
\item åœ¨ç”¨æˆ·æœåŠ¡çš„æ§åˆ¶å°æ—¥å¿—ä¸­æ˜¾ç¤ºé…ç½®åˆ·æ–°äº‹ä»¶
\item è°ƒç”¨æœåŠ¡çš„actuatorç«¯ç‚¹éªŒè¯é…ç½®å·²æ›´æ–°ï¼š\\
  \texttt{GET http://localhost:10100/actuator/env}
\item æ˜¾ç¤ºæ–°é…ç½®å€¼å·²ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®32ï¼šé…ç½®ç‰ˆæœ¬ç®¡ç†ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥é…ç½®ç‰ˆæœ¬ç®¡ç†æˆªå›¾ï¼š
\begin{enumerate}
\item åœ¨Nacosé…ç½®è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡»"å†å²ç‰ˆæœ¬"
\item æ˜¾ç¤ºé…ç½®çš„ç‰ˆæœ¬å†å²è®°å½•ï¼ˆç‰ˆæœ¬å·ã€ä¿®æ”¹æ—¶é—´ã€ä¿®æ”¹äººï¼‰
\item é€‰æ‹©æŸä¸ªå†å²ç‰ˆæœ¬ï¼Œç‚¹å‡»"å›æ»š"æŒ‰é’®
\item æ˜¾ç¤ºå›æ»šç¡®è®¤å¯¹è¯æ¡†å’Œå›æ»šæˆåŠŸæç¤º
\item éªŒè¯é…ç½®å·²å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
\end{enumerate}

\subsection{å…±äº«å†…æ ¸æ¨¡å—ï¼ˆshared-kernelï¼‰}

\subsubsection{shared-kernelæ¨¡å—ç®€ä»‹}

å…±äº«å†…æ ¸æ¨¡å—æ˜¯æ‰€æœ‰å¾®æœåŠ¡çš„å…¬å…±ä¾èµ–ï¼Œå®ƒåŒ…å«äº†DDDæ¶æ„çš„åŸºç¡€ç±»ã€å·¥å…·ç±»ã€å¸¸é‡å®šä¹‰ç­‰ã€‚è¿™ä¸ªæ¨¡å—çš„è®¾è®¡éµå¾ªäº†DRYï¼ˆDon't Repeat Yourselfï¼‰åŸåˆ™ï¼Œé¿å…äº†ä»£ç é‡å¤ï¼Œä¸ºæ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿæä¾›äº†ç»Ÿä¸€çš„åŸºç¡€è®¾æ–½ã€‚

å…±äº«å†…æ ¸çš„è®¾è®¡ç†å¿µæºäºDDDæˆ˜ç•¥è®¾è®¡ä¸­çš„å…±äº«å†…æ ¸æ¨¡å¼ï¼Œå®ƒå…è®¸å¤šä¸ªé™ç•Œä¸Šä¸‹æ–‡å…±äº«ä¸€äº›æ ¸å¿ƒçš„é¢†åŸŸæ¦‚å¿µå’ŒåŸºç¡€è®¾æ–½ä»£ç ã€‚åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé€‚åº¦çš„ä»£ç å…±äº«å¯ä»¥æé«˜å¼€å‘æ•ˆç‡ï¼Œä¿è¯ç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚

\subsubsection{DDDåŸºç¡€ç±»åº“è®¾è®¡}

å…±äº«å†…æ ¸ä¸­æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯DDDåŸºç¡€ç±»åº“ï¼Œå®ƒä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›äº†ç»Ÿä¸€çš„é¢†åŸŸå»ºæ¨¡åŸºç¡€ï¼š

\begin{lstlisting}[caption=EntityåŸºç±»è®¾è®¡]
public abstract class Entity<ID> implements Serializable {
    public abstract ID getId();
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (!(obj instanceof Entity)) return false;
        Entity<?> entity = (Entity<?>) obj;
        return getId() != null && getId().equals(entity.getId());
    }
    
    @Override
    public int hashCode() {
        return getId() != null ? getId().hashCode() : 0;
    }
}
\end{lstlisting}

\begin{lstlisting}[caption=ValueObjectåŸºç±»è®¾è®¡]
public abstract class ValueObject implements Serializable {
    @Override
    public abstract boolean equals(Object obj);
    
    @Override
    public abstract int hashCode();
    
    protected void validate() {
        // å­ç±»å¯é‡å†™éªŒè¯é€»è¾‘
    }
}
\end{lstlisting>

\begin{lstlisting}[caption=AggregateRootèšåˆæ ¹è®¾è®¡]
public abstract class AggregateRoot<ID> extends Entity<ID> {
    private final List<DomainEvent> domainEvents = new ArrayList<>();
    
    protected void addDomainEvent(DomainEvent event) {
        domainEvents.add(event);
    }
    
    public List<DomainEvent> getDomainEvents() {
        List<DomainEvent> events = new ArrayList<>(domainEvents);
        domainEvents.clear();
        return Collections.unmodifiableList(events);
    }
    
    public void clearDomainEvents() {
        domainEvents.clear();
    }
}
\end{lstlisting}

\subsubsection{é€šç”¨é…ç½®ç±»è®¾è®¡}

å…±äº«å†…æ ¸æä¾›äº†ç»Ÿä¸€çš„é…ç½®ç®¡ç†ï¼Œç¡®ä¿æ‰€æœ‰å¾®æœåŠ¡ä½¿ç”¨ä¸€è‡´çš„é…ç½®ç­–ç•¥ï¼š

\begin{lstlisting}[caption=é€šç”¨é…ç½®ç±»]
@Configuration
@Order(1)
public class CommonConfig {
    
    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        mapper.registerModule(new JavaTimeModule());
        mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
        return mapper;
    }
    
    @Bean
    public DomainEventPublisher domainEventPublisher(
            ApplicationEventPublisher publisher) {
        return new SpringDomainEventPublisher(publisher);
    }
}
\end{lstlisting>

\subsubsection{å…¬ç”¨å¸¸é‡ç±»è®¾è®¡}

ç³»ç»Ÿä¸­çš„å¸¸é‡ç»Ÿä¸€åœ¨å…±äº«å†…æ ¸ä¸­å®šä¹‰ï¼Œä¿è¯äº†å¸¸é‡çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ï¼š

\begin{lstlisting}[caption=ç³»ç»Ÿå¸¸é‡å®šä¹‰]
package com.neusoft.shared.constants;

/**
 * ç³»ç»Ÿå¸¸é‡ç±»
 */
public final class SystemConstants {
    
    public static final class ResponseCode {
        public static final int SUCCESS = 200;
        public static final int UNAUTHORIZED = 401;
        public static final int INTERNAL_ERROR = 500;
    }
    
    public static final class Cache {
        public static final String USER_CACHE_PREFIX = "user:";
        public static final int DEFAULT_EXPIRE_HOURS = 2;
    }
    
    public static final class JWT {
        public static final String SECRET_KEY = "elm_springcloud_secret_key_2024";
        public static final long EXPIRE_TIME = 24 * 60 * 60 * 1000;
        public static final String TOKEN_PREFIX = "Bearer ";
    }
}
\end{lstlisting}

\subsubsection{å…¨å±€å¼‚å¸¸å¤„ç†}

ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ç¡®ä¿äº†æ‰€æœ‰å¾®æœåŠ¡çš„é”™è¯¯å“åº”æ ¼å¼ä¸€è‡´ï¼š

\begin{lstlisting}[caption=å…¨å±€å¼‚å¸¸å¤„ç†å™¨]
package com.neusoft.shared.exception;

import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import javax.validation.ConstraintViolationException;
import java.time.LocalDateTime;

/**
 * å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 */
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusinessException(BusinessException e) {
        ErrorResponse error = ErrorResponse.builder()
                .code(e.getCode())
                .message(e.getMessage())
                .timestamp(LocalDateTime.now())
                .build();
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
    }
    
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleSystemException(Exception e) {
        ErrorResponse error = ErrorResponse.builder()
                .code(SystemConstants.ResponseCode.INTERNAL_ERROR)
                .message("ç³»ç»Ÿå†…éƒ¨é”™è¯¯")
                .timestamp(LocalDateTime.now())
                .build();
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(error);
    }
}
\end{lstlisting}

\subsubsection{é€šç”¨å·¥å…·ç±»}

å…±äº«å†…æ ¸æä¾›äº†ä¸€ç³»åˆ—é€šç”¨å·¥å…·ç±»ï¼ŒåŒ…æ‹¬JSONå¤„ç†ã€æ—¥æœŸå¤„ç†ã€å­—ç¬¦ä¸²å¤„ç†ç­‰ï¼š

\begin{lstlisting}[caption=JSONå·¥å…·ç±»]
package com.neusoft.shared.utils;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

/**
 * JSONå·¥å…·ç±»
 */
@Component
public class JsonUtils {
    
    private static ObjectMapper objectMapper;
    
    @Autowired
    public void setObjectMapper(ObjectMapper objectMapper) {
        JsonUtils.objectMapper = objectMapper;
    }
    
    public static String toJson(Object obj) {
        try {
            return objectMapper.writeValueAsString(obj);
        } catch (JsonProcessingException e) {
            throw new RuntimeException("JSONåºåˆ—åŒ–å¤±è´¥", e);
        }
    }
    
    public static <T> T fromJson(String json, Class<T> clazz) {
        try {
            return objectMapper.readValue(json, clazz);
        } catch (JsonProcessingException e) {
            throw new RuntimeException("JSONååºåˆ—åŒ–å¤±è´¥", e);
        }
    }
}
\end{lstlisting}

\subsection{OpenFeignå¾®æœåŠ¡ï¼ˆapi-serviceï¼‰}

\subsubsection{api-serviceæ¨¡å—ç®€ä»‹}

APIæœåŠ¡æ¨¡å—å®šä¹‰äº†æ‰€æœ‰å¾®æœåŠ¡çš„Feignå®¢æˆ·ç«¯æ¥å£ï¼Œè¿™ä¸ªæ¨¡å—çš„å­˜åœ¨ä½¿å¾—æœåŠ¡é—´çš„è°ƒç”¨å˜å¾—ç®€å•å’Œç±»å‹å®‰å…¨ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šå®šä¹‰è‡ªå·±çš„Feignæ¥å£ï¼Œå…¶ä»–æœåŠ¡é€šè¿‡ä¾èµ–è¿™ä¸ªæ¨¡å—æ¥è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚

OpenFeignæ˜¯Spring Cloudæä¾›çš„å£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚é€šè¿‡æ³¨è§£çš„æ–¹å¼å®šä¹‰æ¥å£ï¼ŒOpenFeignä¼šè‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»å®ç°HTTPè°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§ç­‰åŠŸèƒ½ã€‚

\subsubsection{ä¾èµ–é…ç½®}

APIæœåŠ¡æ¨¡å—çš„POMæ–‡ä»¶é…ç½®äº†æ‰€æœ‰å¿…è¦çš„ä¾èµ–ï¼š

\begin{lstlisting}[caption=api-service POMé…ç½®,language=XML]
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.neusoft</groupId>
        <artifactId>springcloud_elm</artifactId>
        <version>1.0.0</version>
    </parent>
    
    <artifactId>api-service</artifactId>
    <packaging>jar</packaging>
    
    <dependencies>
        <!-- Spring Cloud OpenFeign -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>
        
        <!-- Spring Cloud LoadBalancer -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-loadbalancer</artifactId>
        </dependency>
        
        <!-- å…±äº«å†…æ ¸æ¨¡å— -->
        <dependency>
            <groupId>com.neusoft</groupId>
            <artifactId>shared-kernel</artifactId>
            <version>1.0.0</version>
        </dependency>
    </dependencies>
</project>
\end{lstlisting}

\subsubsection{Feignå®¢æˆ·ç«¯æ¥å£å®šä¹‰}

ä¸ºæ¯ä¸ªå¾®æœåŠ¡å®šä¹‰å¯¹åº”çš„Feignå®¢æˆ·ç«¯æ¥å£ï¼Œå®ç°ç±»å‹å®‰å…¨çš„æœåŠ¡é—´è°ƒç”¨ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·æœåŠ¡Feignæ¥å£]
package com.neusoft.feign;

import com.neusoft.po.CommonResult;
import com.neusoft.po.User;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.*;

/**
 * ç”¨æˆ·æœåŠ¡Feignå®¢æˆ·ç«¯
 */
@FeignClient(value = "user-server", fallback = UserFeignClientFallback.class)
public interface UserFeignClient {
    
    @GetMapping("/user/getUserByUserId")
    CommonResult<User> getUserByUserId(@RequestParam("userId") String userId);
    
    @PostMapping("/user/login")
    CommonResult<User> login(@RequestParam("userId") String userId, 
                           @RequestParam("password") String password);
    
    @PostMapping("/user/register")
    CommonResult<String> register(@RequestBody User user);
    
    @PutMapping("/user/updateUser")
    CommonResult<String> updateUser(@RequestBody User user);
}
\end{lstlisting}

\begin{lstlisting}[caption=å•†å®¶æœåŠ¡Feignæ¥å£]
package com.neusoft.feign;

import com.neusoft.po.Business;
import com.neusoft.po.CommonResult;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.*;
import java.util.List;

/**
 * å•†å®¶æœåŠ¡Feignå®¢æˆ·ç«¯
 */
@FeignClient(value = "business-server", fallback = BusinessFeignClientFallback.class)
public interface BusinessFeignClient {
    
    @GetMapping("/business/listBusiness")
    CommonResult<List<Business>> listBusiness();
    
    @GetMapping("/business/getBusinessById")
    CommonResult<Business> getBusinessById(@RequestParam("businessId") Integer businessId);
    
    @GetMapping("/business/listBusinessByOrderTypeId")
    CommonResult<List<Business>> listBusinessByOrderTypeId(
            @RequestParam("orderTypeId") Integer orderTypeId);
}
\end{lstlisting}

\subsubsection{ç†”æ–­é™çº§é…ç½®}

ä¸ºæ¯ä¸ªFeignå®¢æˆ·ç«¯é…ç½®ç†”æ–­é™çº§å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„å¥å£®æ€§ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·æœåŠ¡ç†”æ–­é™çº§]
package com.neusoft.feign.fallback;

import com.neusoft.feign.UserFeignClient;
import com.neusoft.po.CommonResult;
import com.neusoft.po.User;
import org.springframework.stereotype.Component;

/**
 * ç”¨æˆ·æœåŠ¡ç†”æ–­é™çº§å¤„ç†
 */
@Component
public class UserFeignClientFallback implements UserFeignClient {
    
    @Override
    public CommonResult<User> getUserByUserId(String userId) {
        return new CommonResult<>(503, "ç”¨æˆ·æœåŠ¡æš‚æ—¶ä¸å¯ç”¨", null);
    }
    
    @Override
    public CommonResult<User> login(String userId, String password) {
        return new CommonResult<>(503, "ç™»å½•æœåŠ¡æš‚æ—¶ä¸å¯ç”¨", null);
    }
    
    // çœç•¥å…¶ä»–é™çº§æ–¹æ³•...
}
\end{lstlisting}

\textbf{ã€æˆªå›¾ä½ç½®33ï¼šOpenFeignæœåŠ¡è°ƒç”¨æ¼”ç¤ºã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥OpenFeignæœåŠ¡é—´è°ƒç”¨æµ‹è¯•æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹å†…å®¹ï¼š
\begin{enumerate}
\item é€šè¿‡Postmanè°ƒç”¨ä¸šåŠ¡æ¥å£ï¼ˆéœ€è¦è·¨æœåŠ¡è°ƒç”¨ï¼‰ï¼š\\
  \texttt{GET http://localhost:14000/business/getBusinessById?businessId=1}
\item åœ¨ä¸šåŠ¡æœåŠ¡çš„æ§åˆ¶å°æ—¥å¿—ä¸­æ˜¾ç¤ºè°ƒç”¨é£Ÿå“æœåŠ¡çš„OpenFeignè¯·æ±‚
\item æ˜¾ç¤ºFeignå®¢æˆ·ç«¯çš„è¯·æ±‚æ—¥å¿—ï¼ŒåŒ…æ‹¬è¯·æ±‚URLã€å‚æ•°ã€å“åº”æ—¶é—´
\item å±•ç¤ºè°ƒç”¨é“¾è·¯ï¼šGateway â†’ Business Service â†’ Food Service
\item è¿”å›å®Œæ•´çš„ä¸šåŠ¡æ•°æ®ï¼Œè¯æ˜æœåŠ¡é—´è°ƒç”¨æˆåŠŸ
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®34ï¼šFeignç†”æ–­é™çº§æµ‹è¯•ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Feignç†”æ–­é™çº§æµ‹è¯•æˆªå›¾ï¼š
\begin{enumerate}
\item æ•…æ„åœæ­¢é£Ÿå“æœåŠ¡ï¼ˆfood-server-10200ï¼‰
\item å†æ¬¡è°ƒç”¨éœ€è¦é£Ÿå“æœåŠ¡çš„ä¸šåŠ¡æ¥å£
\item æ˜¾ç¤ºFeignå®¢æˆ·ç«¯æ£€æµ‹åˆ°æœåŠ¡ä¸å¯ç”¨
\item è‡ªåŠ¨è§¦å‘ç†”æ–­é™çº§ï¼Œè¿”å›é™çº§å“åº”ï¼š\\
  \texttt{\{"code": 503, "msg": "é£Ÿå“æœåŠ¡æš‚æ—¶ä¸å¯ç”¨", "data": null\}}
\item åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºç†”æ–­å™¨çŠ¶æ€å˜åŒ–å’Œé™çº§æ–¹æ³•æ‰§è¡Œ
\end{enumerate}

\subsubsection{è´Ÿè½½å‡è¡¡é…ç½®}

é…ç½®è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ç°æ™ºèƒ½çš„æœåŠ¡è°ƒç”¨åˆ†å‘ï¼š

\begin{lstlisting}[caption=è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®]
package com.neusoft.config;

import org.springframework.cloud.client.ServiceInstance;
import org.springframework.cloud.loadbalancer.core.ReactorServiceInstanceLoadBalancer;
import org.springframework.cloud.loadbalancer.core.ServiceInstanceListSupplier;
import org.springframework.cloud.loadbalancer.support.LoadBalancerClientFactory;
import reactor.core.publisher.Mono;
import java.util.List;
import java.util.Random;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥
 * å‰å‡ æ¬¡è¯·æ±‚ä½¿ç”¨éšæœºç­–ç•¥ï¼Œåç»­ä½¿ç”¨è½®è¯¢ç­–ç•¥
 */
public class CustomLoadBalancer implements ReactorServiceInstanceLoadBalancer {
    
    private final AtomicInteger position = new AtomicInteger(0);
    
    @Override
    public Mono<Response<ServiceInstance>> choose(Request request) {
        return Mono.fromCallable(() -> {
            List<ServiceInstance> instances = getInstances();
            if (instances.isEmpty()) return new EmptyResponse();
            
            int currentPosition = position.incrementAndGet();
            ServiceInstance instance;
            
            if (currentPosition <= 3) {
                // å‰3æ¬¡ä½¿ç”¨éšæœºç­–ç•¥é¿å…å†·å¯åŠ¨é—®é¢˜
                instance = instances.get(new Random().nextInt(instances.size()));
            } else {
                // ç¨³å®šæœŸä½¿ç”¨è½®è¯¢ç­–ç•¥
                instance = instances.get((currentPosition - 4) % instances.size());
            }
            
            return new DefaultResponse(instance);
        });
    }
    
    private List<ServiceInstance> getInstances() {
        // è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨
        return List.of();
    }
 }
 \end{lstlisting}

\subsection{ç”¨æˆ·å¾®æœåŠ¡ï¼ˆuser-server-10100ï¼‰}

\subsubsection{user-serviceæ¨¡å—ç®€ä»‹}

ç”¨æˆ·å¾®æœåŠ¡æ˜¯æ•´ä¸ªç³»ç»Ÿçš„åŸºç¡€æœåŠ¡ä¹‹ä¸€ï¼Œè´Ÿè´£ç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚åœ¨DDDæ¶æ„ä¸­ï¼Œç”¨æˆ·è¢«è®¾è®¡ä¸ºèšåˆæ ¹ï¼ŒåŒ…å«äº†ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯å’Œè¡Œä¸ºã€‚ç”¨æˆ·æœåŠ¡æ‰¿æ‹…äº†æ•´ä¸ªç³»ç»Ÿçš„èº«ä»½è®¤è¯èŒè´£ï¼Œæ˜¯å…¶ä»–æœåŠ¡çš„åŸºç¡€ä¾èµ–ã€‚

ç«¯å£é…ç½®ä¸º10100ï¼ŒæœåŠ¡åç§°ä¸ºuser-serverï¼Œé€šè¿‡Nacosè¿›è¡ŒæœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚è¯¥æœåŠ¡æä¾›å®Œæ•´çš„ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»æ³¨å†Œåˆ°ç™»å½•ï¼Œä»ä¿¡æ¯æ›´æ–°åˆ°çŠ¶æ€ç®¡ç†ã€‚

\subsubsection{æ ¸å¿ƒé…ç½®æ–‡ä»¶}

ç”¨æˆ·æœåŠ¡çš„bootstrap.ymlé…ç½®å¦‚ä¸‹ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·æœåŠ¡bootstrap.ymlé…ç½®,language=YAML]
spring:
  application:
    name: user-server
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
      config:
        server-addr: localhost:8848
        file-extension: yml
        
server:
  port: 10100
  
# æ•°æ®æºé…ç½®
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/elm_user?useSSL=false&serverTimezone=UTC
    username: root
    password: root
      
  # Redisé…ç½®
  redis:
    host: localhost
    port: 6379
    database: 0
\end{lstlisting>

\subsubsection{ç”¨æˆ·æœåŠ¡æ ¸å¿ƒåŠŸèƒ½å®ç°}

ç”¨æˆ·æ§åˆ¶å™¨æä¾›äº†å®Œæ•´çš„ç”¨æˆ·ç®¡ç†æ¥å£ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·æ§åˆ¶å™¨å®ç°]
package com.neusoft.controller;

import com.neusoft.po.CommonResult;
import com.neusoft.po.User;
import com.neusoft.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

/**
 * ç”¨æˆ·æ§åˆ¶å™¨
 * æä¾›ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ç­‰æ¥å£
 */
@RestController
@RequestMapping("/user")
@CrossOrigin("*")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @PostMapping("/login")
    public CommonResult<User> login(@RequestParam("userId") String userId,
                                   @RequestParam("password") String password) {
        User user = userService.login(userId, password);
        return user != null ? 
            new CommonResult<>(200, "ç™»å½•æˆåŠŸ", user) : 
            new CommonResult<>(403, "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯", null);
    }
    
    @PostMapping("/register")
    public CommonResult<String> register(@RequestBody User user) {
        if (userService.getUserByUserId(user.getUserId()) != null) {
            return new CommonResult<>(403, "ç”¨æˆ·IDå·²å­˜åœ¨", null);
        }
        
        int result = userService.saveUser(user);
        return result > 0 ?
            new CommonResult<>(200, "æ³¨å†ŒæˆåŠŸ", user.getUserId()) :
            new CommonResult<>(500, "æ³¨å†Œå¤±è´¥", null);
    }
    
    @GetMapping("/getUserByUserId")
    public CommonResult<User> getUserByUserId(@RequestParam("userId") String userId) {
        User user = userService.getUserByUserId(userId);
        if (user != null) {
            user.setPassword(null); // æ¸…é™¤æ•æ„Ÿä¿¡æ¯
            return new CommonResult<>(200, "æŸ¥è¯¢æˆåŠŸ", user);
        }
        return new CommonResult<>(404, "ç”¨æˆ·ä¸å­˜åœ¨", null);
    }
    
    // çœç•¥å…¶ä»–æ–¹æ³•...
}
}
\end{lstlisting}

\begin{lstlisting}[caption=ç”¨æˆ·æœåŠ¡ä¸šåŠ¡é€»è¾‘å®ç°]
package com.neusoft.service.impl;

import com.neusoft.mapper.UserMapper;
import com.neusoft.po.User;
import com.neusoft.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.stereotype.Service;
import org.springframework.util.DigestUtils;
import java.util.concurrent.TimeUnit;

/**
 * ç”¨æˆ·æœåŠ¡å®ç°ç±»
 */
@Service
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private StringRedisTemplate redisTemplate;
    
    private static final String USER_CACHE_PREFIX = "user:";
    
    @Override
    public User login(String userId, String password) {
        User user = getUserFromCacheOrDB(userId);
        
        if (user != null && user.getPassword().equals(DigestUtils.md5DigestAsHex(password.getBytes()))) {
            return user;
        }
        return null;
    }
    
    @Override
    public int saveUser(User user) {
        user.setPassword(DigestUtils.md5DigestAsHex(user.getPassword().getBytes()));
        int result = userMapper.saveUser(user);
        
        if (result > 0) {
            cacheUserInfo(user);
        }
        return result;
    }
    
    @Override
    public User getUserByUserId(String userId) {
        return getUserFromCacheOrDB(userId);
    }
    
    private User getUserFromCacheOrDB(String userId) {
        String cacheKey = USER_CACHE_PREFIX + userId;
        String cachedUser = redisTemplate.opsForValue().get(cacheKey);
        
        if (cachedUser != null) {
            return JsonUtils.fromJson(cachedUser, User.class);
        }
        
        User user = userMapper.getUserByUserId(userId);
        if (user != null) {
            cacheUserInfo(user);
        }
        return user;
    }
    
    private void cacheUserInfo(User user) {
        String cacheKey = USER_CACHE_PREFIX + user.getUserId();
        redisTemplate.opsForValue().set(cacheKey, JsonUtils.toJson(user), 2, TimeUnit.HOURS);
    }
}
}
\end{lstlisting}

\subsection{å•†å®¶å¾®æœåŠ¡ï¼ˆbusiness-server-10300ï¼‰}

\subsubsection{business-serviceæ¨¡å—ç®€ä»‹}

å•†å®¶å¾®æœåŠ¡ç®¡ç†å•†å®¶å’Œé£Ÿå“ä¿¡æ¯ï¼Œæ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡æœåŠ¡ä¹‹ä¸€ã€‚åœ¨DDDè®¾è®¡ä¸­ï¼Œå•†å®¶æ˜¯ä¸€ä¸ªèšåˆæ ¹ï¼Œé£Ÿå“æ˜¯èšåˆå†…çš„å®ä½“ã€‚è¿™ç§è®¾è®¡åæ˜ äº†ä¸šåŠ¡ä¸Šçš„ä»å±å…³ç³»ã€‚

å•†å®¶æœåŠ¡æä¾›äº†å•†å®¶ä¿¡æ¯ç®¡ç†ã€é£Ÿå“ç®¡ç†ã€è¥ä¸šçŠ¶æ€æ§åˆ¶ç­‰åŠŸèƒ½ã€‚ç«¯å£é…ç½®ä¸º10300ï¼ŒæœåŠ¡åç§°ä¸ºbusiness-serverã€‚

\subsubsection{å•†å®¶æœåŠ¡æ ¸å¿ƒåŠŸèƒ½å®ç°}

\begin{lstlisting}[caption=å•†å®¶æ§åˆ¶å™¨å®ç°]
package com.neusoft.controller;

import com.neusoft.po.Business;
import com.neusoft.po.CommonResult;
import com.neusoft.service.BusinessService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import java.util.List;

/**
 * å•†å®¶æ§åˆ¶å™¨
 */
@RestController
@RequestMapping("/business")
public class BusinessController {
    
    @Autowired
    private BusinessService businessService;
    
    @GetMapping("/listBusiness")
    public CommonResult<List<Business>> listBusiness() {
        List<Business> list = businessService.findAll();
        return new CommonResult<>(200, "æŸ¥è¯¢æˆåŠŸ", list);
    }
    
    @GetMapping("/getBusinessById")
    public CommonResult<Business> getBusinessById(@RequestParam("businessId") Integer businessId) {
        Business business = businessService.findById(businessId);
        return business != null ?
            new CommonResult<>(200, "æŸ¥è¯¢æˆåŠŸ", business) :
            new CommonResult<>(404, "å•†å®¶ä¸å­˜åœ¨", null);
    }
    
    // çœç•¥å…¶ä»–æ–¹æ³•...
}
}
\end{lstlisting}

\subsection{è®¢å•å¾®æœåŠ¡ï¼ˆorders-server-10601ï¼‰}

\subsubsection{order-serviceæ¨¡å—ç®€ä»‹}

è®¢å•å¾®æœåŠ¡æ˜¯ç³»ç»Ÿæœ€å¤æ‚çš„æœåŠ¡ï¼Œæ¶‰åŠå¤šä¸ªæœåŠ¡çš„åè°ƒå’Œäº‹åŠ¡çš„ç®¡ç†ã€‚è®¢å•çš„åˆ›å»ºã€æ”¯ä»˜ã€é…é€ã€å®Œæˆç­‰æµç¨‹éƒ½åœ¨è¿™ä¸ªæœåŠ¡ä¸­å®ç°ã€‚

ç«¯å£é…ç½®ä¸º10601ï¼ŒæœåŠ¡åç§°ä¸ºorders-serverã€‚è¯¥æœåŠ¡éœ€è¦ä¸ç”¨æˆ·æœåŠ¡ã€å•†å®¶æœåŠ¡ã€è´­ç‰©è½¦æœåŠ¡ç­‰å¤šä¸ªæœåŠ¡è¿›è¡Œäº¤äº’ã€‚

\subsubsection{è®¢å•æœåŠ¡æ ¸å¿ƒåŠŸèƒ½å®ç°}

\begin{lstlisting}[caption=è®¢å•æ§åˆ¶å™¨å®ç°]
package com.neusoft.controller;

import com.neusoft.po.CommonResult;
import com.neusoft.po.Orders;
import com.neusoft.service.OrdersService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import java.util.List;

/**
 * è®¢å•æ§åˆ¶å™¨
 */
@RestController
@RequestMapping("/orders")
public class OrdersController {
    
    @Autowired
    private OrdersService ordersService;
    
    @PostMapping("/createOrders")
    public CommonResult<Integer> createOrders(@RequestBody Orders orders) {
        int orderId = ordersService.createOrders(orders);
        return orderId > 0 ?
            new CommonResult<>(200, "è®¢å•åˆ›å»ºæˆåŠŸ", orderId) :
            new CommonResult<>(500, "è®¢å•åˆ›å»ºå¤±è´¥", null);
    }
    
    @GetMapping("/listOrdersByUserId")
    public CommonResult<List<Orders>> listOrdersByUserId(@RequestParam("userId") String userId) {
        List<Orders> list = ordersService.findByUserId(userId);
        return new CommonResult<>(200, "æŸ¥è¯¢æˆåŠŸ", list);
    }
    
    // çœç•¥å…¶ä»–æ–¹æ³•...
}
}
\end{lstlisting}

\subsection{ç½‘å…³å¾®æœåŠ¡ï¼ˆgateway-server-14000ï¼‰}

\subsubsection{gateway-serviceæ¨¡å—ç®€ä»‹}

APIç½‘å…³æ˜¯æ‰€æœ‰å¤–éƒ¨è¯·æ±‚çš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯æˆæƒã€é™æµç†”æ–­ç­‰åŠŸèƒ½ã€‚æˆ‘ä»¬é€‰æ‹©äº†Spring Cloud Gatewayä½œä¸ºç½‘å…³å®ç°ã€‚

ç«¯å£é…ç½®ä¸º14000ï¼Œä½œä¸ºç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ï¼Œæ‰€æœ‰çš„å‰ç«¯è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ç½‘å…³å¤„ç†ã€‚

\subsubsection{ç½‘å…³æ ¸å¿ƒé…ç½®}

\begin{lstlisting}[caption=ç½‘å…³é…ç½®æ–‡ä»¶,language=YAML]
spring:
  application:
    name: gateway-server
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      routes:
        - id: user-server
          uri: lb://user-server
          predicates:
            - Path=/user/**
        - id: business-server
          uri: lb://business-server
          predicates:
            - Path=/business/**
        - id: orders-server
          uri: lb://orders-server
          predicates:
            - Path=/orders/**
            
server:
  port: 14000
\end{lstlisting}

\subsubsection{ç½‘å…³è¿‡æ»¤å™¨å®ç°}

\begin{lstlisting}[caption=JWTè®¤è¯è¿‡æ»¤å™¨]
package com.neusoft.filter;

import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.GlobalFilter;
import org.springframework.core.annotation.Order;
import org.springframework.http.HttpStatus;
import org.springframework.http.server.reactive.ServerHttpRequest;
import org.springframework.http.server.reactive.ServerHttpResponse;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

/**
 * JWTè®¤è¯å…¨å±€è¿‡æ»¤å™¨
 */
@Component
@Order(1)
public class JWTAuthenticationFilter implements GlobalFilter {
    
    private static final String[] EXCLUDE_PATHS = {
        "/user/login", "/user/register", "/business/listBusiness"
    };
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        String path = request.getURI().getPath();
        
        if (isExcludePath(path)) {
            return chain.filter(exchange);
        }
        
        String authHeader = request.getHeaders().getFirst("Authorization");
        if (authHeader == null || !authHeader.startsWith("Bearer ")) {
            return unauthorized(exchange.getResponse());
        }
        
        String token = authHeader.substring(7);
        if (!validateJWT(token)) {
            return unauthorized(exchange.getResponse());
        }
        
        return chain.filter(exchange);
    }
    
    private boolean isExcludePath(String path) {
        return Arrays.stream(EXCLUDE_PATHS).anyMatch(path::startsWith);
    }
    
    private Mono<Void> unauthorized(ServerHttpResponse response) {
        response.setStatusCode(HttpStatus.UNAUTHORIZED);
        return response.setComplete();
    }
    
    private boolean validateJWT(String token) {
        // JWTéªŒè¯é€»è¾‘
        return token != null && !token.isEmpty();
    }
            ServerHttpResponse response = exchange.getResponse();
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return response.setComplete();
        }
        
        // æå–JWTä»¤ç‰Œ
        String token = authHeader.substring(7);
        
        // éªŒè¯JWTä»¤ç‰Œ
        if (!validateJWT(token)) {
            ServerHttpResponse response = exchange.getResponse();
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return response.setComplete();
        }
        
        // è®¤è¯é€šè¿‡ï¼Œç»§ç»­å¤„ç†è¯·æ±‚
        return chain.filter(exchange);
    }
    
    /**
     * æ£€æŸ¥è·¯å¾„æ˜¯å¦éœ€è¦æ’é™¤è®¤è¯
     */
    private boolean isExcludePath(String path) {
        for (String excludePath : EXCLUDE_PATHS) {
            if (path.startsWith(excludePath)) {
                return true;
            }
        }
        return false;
    }
    
    /**
     * éªŒè¯JWTä»¤ç‰Œ
     */
    private boolean validateJWT(String token) {
        try {
            // å®é™…å®ç°ä¸­è¿›è¡ŒJWTéªŒè¯
            // è¿™é‡Œç®€åŒ–å¤„ç†
            return token != null && !token.isEmpty();
        } catch (Exception e) {
            return false;
        }
    }
}
\end{lstlisting>

\subsubsection{Nacoséƒ¨ç½²ä¸é…ç½®}

Nacosçš„éƒ¨ç½²é‡‡ç”¨å•æœºæ¨¡å¼ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®éƒ¨ç½²Nacosé›†ç¾¤ä»¥ä¿è¯é«˜å¯ç”¨æ€§ã€‚NacosæœåŠ¡å™¨å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡Webæ§åˆ¶å°è¿›è¡Œç®¡ç†ï¼Œé»˜è®¤è®¿é—®åœ°å€æ˜¯http://localhost:8848/nacosã€‚

åœ¨é¡¹ç›®ä¸­é›†æˆNacoséœ€è¦æ·»åŠ ç›¸åº”çš„ä¾èµ–ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½éœ€è¦åœ¨bootstrap.ymlä¸­é…ç½®Nacosçš„åœ°å€å’Œç›¸å…³å‚æ•°ã€‚é…ç½®åŒ…æ‹¬æœåŠ¡æ³¨å†Œå‘ç°çš„ç›¸å…³è®¾ç½®ï¼Œå¦‚æœåŠ¡åç§°ã€Nacosåœ°å€ã€å‘½åç©ºé—´ç­‰ï¼Œä»¥åŠé…ç½®ç®¡ç†çš„ç›¸å…³è®¾ç½®ï¼Œå¦‚é…ç½®æ–‡ä»¶çš„dataIdã€groupç­‰ã€‚

% ä»£ç ç¤ºä¾‹å ä½
\begin{lstlisting}[caption=bootstrap.ymlé…ç½®ç¤ºä¾‹]
# è¯·åœ¨æ­¤å¤„æ·»åŠ æ‚¨çš„Nacosé…ç½®
# åŒ…æ‹¬æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†çš„ç›¸å…³é…ç½®
\end{lstlisting}

\subsubsection{æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶}

æœåŠ¡æ³¨å†Œæ˜¯å¾®æœåŠ¡æ¶æ„çš„åŸºç¡€åŠŸèƒ½ã€‚å½“ä¸€ä¸ªæœåŠ¡å®ä¾‹å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å‘Nacosæ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ã€‚æ³¨å†Œä¿¡æ¯åŒ…æ‹¬æœåŠ¡åã€IPåœ°å€ã€ç«¯å£å·ã€æƒé‡ã€å…ƒæ•°æ®ç­‰ã€‚Nacosä¼šä¸ºæ¯ä¸ªæœåŠ¡å®ä¾‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹IDï¼Œç”¨äºæ ‡è¯†å’Œç®¡ç†ã€‚

æœåŠ¡å‘ç°å…è®¸æœåŠ¡æ¶ˆè´¹è€…åŠ¨æ€åœ°è·å–æœåŠ¡æä¾›è€…çš„åœ°å€ä¿¡æ¯ã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡Spring Cloud LoadBalancerå®ç°äº†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚å½“æœåŠ¡Aéœ€è¦è°ƒç”¨æœåŠ¡Bæ—¶ï¼Œå®ƒä¼šå…ˆä»Nacosè·å–æœåŠ¡Bçš„æ‰€æœ‰å¥åº·å®ä¾‹ï¼Œç„¶åæ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ä¸€ä¸ªå®ä¾‹è¿›è¡Œè°ƒç”¨ã€‚

å¥åº·æ£€æŸ¥æ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚Nacosé€šè¿‡å¿ƒè·³æœºåˆ¶ç›‘æ§æœåŠ¡å®ä¾‹çš„å¥åº·çŠ¶æ€ã€‚æœåŠ¡å®ä¾‹éœ€è¦å®šæœŸå‘Nacoså‘é€å¿ƒè·³ï¼Œå¦‚æœNacosåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œå°±ä¼šå°†è¯¥å®ä¾‹æ ‡è®°ä¸ºä¸å¥åº·ã€‚ä¸å¥åº·çš„å®ä¾‹ä¸ä¼šè¢«æœåŠ¡å‘ç°è¿”å›ï¼Œä»è€Œé¿å…äº†è°ƒç”¨å¤±è´¥ã€‚

\subsection{å…±äº«å†…æ ¸æ¨¡å—ï¼ˆshared-kernelï¼‰}

å…±äº«å†…æ ¸æ¨¡å—æ˜¯æ‰€æœ‰å¾®æœåŠ¡çš„å…¬å…±ä¾èµ–ï¼Œå®ƒåŒ…å«äº†DDDæ¶æ„çš„åŸºç¡€ç±»ã€å·¥å…·ç±»ã€å¸¸é‡å®šä¹‰ç­‰ã€‚è¿™ä¸ªæ¨¡å—çš„è®¾è®¡éµå¾ªäº†DRYï¼ˆDon't Repeat Yourselfï¼‰åŸåˆ™ï¼Œé¿å…äº†ä»£ç é‡å¤ã€‚

åœ¨DDDåŸºç¡€ç±»æ–¹é¢ï¼Œæˆ‘ä»¬å®šä¹‰äº†Entityã€ValueObjectã€AggregateRootç­‰åŸºç±»ã€‚EntityåŸºç±»æä¾›äº†å®ä½“çš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬IDçš„ç®¡ç†ã€equalså’ŒhashCodeæ–¹æ³•çš„å®ç°ç­‰ã€‚ValueObjectåŸºç±»ç¡®ä¿äº†å€¼å¯¹è±¡çš„ä¸å¯å˜æ€§ã€‚AggregateRootåŸºç±»åœ¨Entityçš„åŸºç¡€ä¸Šå¢åŠ äº†é¢†åŸŸäº‹ä»¶çš„ç®¡ç†åŠŸèƒ½ã€‚

é¢†åŸŸäº‹ä»¶æœºåˆ¶æ˜¯DDDæ¶æ„çš„é‡è¦ç‰¹æ€§ã€‚æˆ‘ä»¬å®šä¹‰äº†DomainEventæ¥å£å’ŒDomainEventPublisheræ¥å£ã€‚æ¯ä¸ªèšåˆæ ¹å¯ä»¥åœ¨ä¸šåŠ¡æ“ä½œä¸­äº§ç”Ÿé¢†åŸŸäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶ä¼šè¢«æ”¶é›†å¹¶åœ¨é€‚å½“çš„æ—¶æœºå‘å¸ƒã€‚äº‹ä»¶çš„å‘å¸ƒé‡‡ç”¨äº†Springçš„ApplicationEventPublisheræœºåˆ¶ï¼Œä¿è¯äº†äº‹ä»¶å¤„ç†çš„å¯é æ€§ã€‚

å·¥å…·ç±»åŒ…æ‹¬äº†å„ç§å¸¸ç”¨çš„è¾…åŠ©åŠŸèƒ½ï¼Œå¦‚æ—¥æœŸå¤„ç†ã€å­—ç¬¦ä¸²å¤„ç†ã€åŠ å¯†è§£å¯†ã€JSONåºåˆ—åŒ–ç­‰ã€‚è¿™äº›å·¥å…·ç±»éƒ½ç»è¿‡äº†å……åˆ†çš„æµ‹è¯•ï¼Œå¯ä»¥åœ¨å„ä¸ªå¾®æœåŠ¡ä¸­å®‰å…¨ä½¿ç”¨ã€‚

\subsection{APIæœåŠ¡æ¨¡å—ï¼ˆapi-serviceï¼‰}

APIæœåŠ¡æ¨¡å—å®šä¹‰äº†æ‰€æœ‰å¾®æœåŠ¡çš„Feignå®¢æˆ·ç«¯æ¥å£ã€‚è¿™ä¸ªæ¨¡å—çš„å­˜åœ¨ä½¿å¾—æœåŠ¡é—´çš„è°ƒç”¨å˜å¾—ç®€å•å’Œç±»å‹å®‰å…¨ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šå®šä¹‰è‡ªå·±çš„Feignæ¥å£ï¼Œå…¶ä»–æœåŠ¡é€šè¿‡ä¾èµ–è¿™ä¸ªæ¨¡å—æ¥è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚

Feignå®¢æˆ·ç«¯çš„è®¾è®¡è€ƒè™‘äº†å®¹é”™å¤„ç†ã€‚æ¯ä¸ªFeignæ¥å£éƒ½é…ç½®äº†é™çº§å¤„ç†ç±»ï¼Œå½“è¿œç¨‹æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨é™çº§æ–¹æ³•è¿”å›é»˜è®¤å€¼æˆ–é”™è¯¯ä¿¡æ¯ã€‚è¿™ç§è®¾è®¡æé«˜äº†ç³»ç»Ÿçš„å¥å£®æ€§ï¼Œé¿å…äº†çº§è”æ•…éšœã€‚

è´Ÿè½½å‡è¡¡æ˜¯å¾®æœåŠ¡è°ƒç”¨çš„é‡è¦ç‰¹æ€§ã€‚æˆ‘ä»¬å®ç°äº†è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç»“åˆäº†éšæœºå’Œè½®è¯¢çš„ç‰¹ç‚¹ã€‚åœ¨å‰ä¸‰æ¬¡è°ƒç”¨æ—¶ä½¿ç”¨éšæœºç­–ç•¥ï¼Œä¹‹ååˆ‡æ¢åˆ°è½®è¯¢ç­–ç•¥ã€‚è¿™ç§æ··åˆç­–ç•¥æ—¢ä¿è¯äº†è´Ÿè½½çš„å‡è¡¡åˆ†å¸ƒï¼Œåˆé¿å…äº†å¯åŠ¨æ—¶çš„çƒ­ç‚¹é—®é¢˜ã€‚

\subsection{ç”¨æˆ·æœåŠ¡ï¼ˆuser-serviceï¼‰}

ç”¨æˆ·æœåŠ¡æ˜¯ç³»ç»Ÿçš„åŸºç¡€æœåŠ¡ä¹‹ä¸€ï¼Œè´Ÿè´£ç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚åœ¨DDDæ¶æ„ä¸­ï¼Œç”¨æˆ·è¢«è®¾è®¡ä¸ºèšåˆæ ¹ï¼ŒåŒ…å«äº†ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯å’Œè¡Œä¸ºã€‚

ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½å®ç°äº†å®Œæ•´çš„éªŒè¯æµç¨‹ã€‚å½“ç”¨æˆ·æäº¤æ³¨å†Œä¿¡æ¯æ—¶ï¼Œç³»ç»Ÿä¼šéªŒè¯æ‰‹æœºå·çš„æ ¼å¼å’Œå”¯ä¸€æ€§ï¼Œå¯†ç çš„å¼ºåº¦ç­‰ã€‚éªŒè¯é€šè¿‡åï¼Œç”¨æˆ·å¯†ç ä¼šé€šè¿‡BCryptç®—æ³•åŠ å¯†å­˜å‚¨ã€‚åŒæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæ–°ç”¨æˆ·åˆ†é…é»˜è®¤çš„è§’è‰²å’Œæƒé™ã€‚

ç™»å½•åŠŸèƒ½é‡‡ç”¨äº†JWTä»¤ç‰Œè®¤è¯æœºåˆ¶ã€‚ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«ç”¨æˆ·IDã€è§’è‰²ç­‰ä¿¡æ¯çš„JWTä»¤ç‰Œã€‚è¿™ä¸ªä»¤ç‰Œä¼šè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨åç»­çš„è¯·æ±‚ä¸­éœ€è¦åœ¨Headerä¸­æºå¸¦è¿™ä¸ªä»¤ç‰Œã€‚JWTä»¤ç‰Œçš„æœ‰æ•ˆæœŸå¯ä»¥é…ç½®ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•ã€‚

ç”¨æˆ·ä¿¡æ¯çš„ç®¡ç†åŒ…æ‹¬æŸ¥çœ‹å’Œä¿®æ”¹ä¸ªäººä¿¡æ¯ã€ä¿®æ”¹å¯†ç ç­‰åŠŸèƒ½ã€‚æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½ä¼šäº§ç”Ÿç›¸åº”çš„é¢†åŸŸäº‹ä»¶ï¼Œå¦‚UserProfileUpdatedEventã€UserPasswordChangedEventç­‰ã€‚è¿™äº›äº‹ä»¶å¯ä»¥è¢«å…¶ä»–æœåŠ¡ç›‘å¬ï¼Œå®ç°ä¸šåŠ¡çš„æ‰©å±•ã€‚

\subsection{å•†å®¶æœåŠ¡ï¼ˆbusiness-serviceï¼‰}

å•†å®¶æœåŠ¡ç®¡ç†å•†å®¶å’Œé£Ÿå“ä¿¡æ¯ï¼Œæ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡æœåŠ¡ä¹‹ä¸€ã€‚åœ¨DDDè®¾è®¡ä¸­ï¼Œå•†å®¶æ˜¯ä¸€ä¸ªèšåˆæ ¹ï¼Œé£Ÿå“æ˜¯èšåˆå†…çš„å®ä½“ã€‚è¿™ç§è®¾è®¡åæ˜ äº†ä¸šåŠ¡ä¸Šçš„ä»å±å…³ç³»ã€‚

å•†å®¶ä¿¡æ¯çš„ç®¡ç†åŒ…æ‹¬å•†å®¶çš„åŸºæœ¬ä¿¡æ¯ã€è¥ä¸šæ—¶é—´ã€é…é€èŒƒå›´ã€èµ·é€ä»·æ ¼ç­‰ã€‚å•†å®¶å¯ä»¥è®¾ç½®è‡ªå·±çš„è¥ä¸šçŠ¶æ€ï¼Œå½“å•†å®¶æš‚åœè¥ä¸šæ—¶ï¼Œæ‰€æœ‰çš„é£Ÿå“ä¼šè‡ªåŠ¨ä¸‹æ¶ã€‚è¿™ä¸ªä¸šåŠ¡è§„åˆ™é€šè¿‡é¢†åŸŸäº‹ä»¶æœºåˆ¶å®ç°ï¼Œå•†å®¶çŠ¶æ€å˜æ›´ä¼šå‘å¸ƒBusinessStatusChangedEventäº‹ä»¶ã€‚

é£Ÿå“ç®¡ç†æ˜¯å•†å®¶æœåŠ¡çš„é‡è¦åŠŸèƒ½ã€‚å•†å®¶å¯ä»¥æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤é£Ÿå“ï¼Œè®¾ç½®é£Ÿå“çš„ä»·æ ¼ã€åº“å­˜ç­‰ã€‚é£Ÿå“çš„ä»·æ ¼è°ƒæ•´ä¼šäº§ç”ŸFoodPriceAdjustedEventäº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å¯ä»¥è¢«å…¶ä»–æœåŠ¡ç›‘å¬ï¼Œä¾‹å¦‚è´­ç‰©è½¦æœåŠ¡å¯èƒ½éœ€è¦æ›´æ–°è´­ç‰©è½¦ä¸­çš„å•†å“ä»·æ ¼ã€‚

å•†å®¶æœåŠ¡è¿˜æä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½ï¼Œå¦‚æŒ‰åˆ†ç±»æŸ¥è¯¢å•†å®¶ã€æŒ‰è·ç¦»æ’åºã€æŒ‰è¯„åˆ†æ’åºç­‰ã€‚è¿™äº›æŸ¥è¯¢åŠŸèƒ½é€šè¿‡ç»„åˆä¸åŒçš„æŸ¥è¯¢æ¡ä»¶å®ç°ï¼Œæä¾›äº†çµæ´»çš„æœç´¢èƒ½åŠ›ã€‚

\subsection{è®¢å•æœåŠ¡ï¼ˆorder-serviceï¼‰}

è®¢å•æœåŠ¡æ˜¯ç³»ç»Ÿæœ€å¤æ‚çš„æœåŠ¡ï¼Œæ¶‰åŠå¤šä¸ªæœåŠ¡çš„åè°ƒå’Œäº‹åŠ¡çš„ç®¡ç†ã€‚è®¢å•çš„åˆ›å»ºã€æ”¯ä»˜ã€é…é€ã€å®Œæˆç­‰æµç¨‹éƒ½åœ¨è¿™ä¸ªæœåŠ¡ä¸­å®ç°ã€‚

è®¢å•åˆ›å»ºæ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œéœ€è¦åè°ƒå¤šä¸ªæœåŠ¡ã€‚é¦–å…ˆï¼Œç³»ç»Ÿéœ€è¦ä»è´­ç‰©è½¦æœåŠ¡è·å–ç”¨æˆ·é€‰æ‹©çš„å•†å“ï¼›ç„¶åï¼Œè°ƒç”¨å•†å®¶æœåŠ¡éªŒè¯å•†å“çš„æœ‰æ•ˆæ€§å’Œåº“å­˜ï¼›æ¥ç€ï¼Œåˆ›å»ºè®¢å•èšåˆï¼Œè®¡ç®—è®¢å•æ€»ä»·ï¼›æœ€åï¼Œæ¸…ç©ºè´­ç‰©è½¦ï¼Œå‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­çš„ä»»ä½•ä¸€æ­¥å¤±è´¥éƒ½ä¼šå¯¼è‡´è®¢å•åˆ›å»ºå¤±è´¥ã€‚

æ”¯ä»˜æµç¨‹é‡‡ç”¨äº†å¼‚æ­¥å¤„ç†æ¨¡å¼ã€‚ç”¨æˆ·å‘èµ·æ”¯ä»˜åï¼Œè®¢å•æœåŠ¡ä¼šåˆ›å»ºä¸€ä¸ªå¾…æ”¯ä»˜çš„è®¢å•ï¼Œç„¶åè°ƒç”¨æ”¯ä»˜æœåŠ¡è¿›è¡Œæ”¯ä»˜ã€‚æ”¯ä»˜æœåŠ¡ä¼šä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°äº¤äº’ï¼Œå®Œæˆå®é™…çš„æ”¯ä»˜æ“ä½œã€‚æ”¯ä»˜å®Œæˆåï¼Œæ”¯ä»˜æœåŠ¡ä¼šå‘å¸ƒæ”¯ä»˜æˆåŠŸäº‹ä»¶ï¼Œè®¢å•æœåŠ¡ç›‘å¬è¿™ä¸ªäº‹ä»¶å¹¶æ›´æ–°è®¢å•çŠ¶æ€ã€‚

è®¢å•çŠ¶æ€çš„ç®¡ç†é‡‡ç”¨äº†çŠ¶æ€æœºæ¨¡å¼ã€‚è®¢å•çš„çŠ¶æ€åŒ…æ‹¬å¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€é…é€ä¸­ã€å·²å®Œæˆã€å·²å–æ¶ˆç­‰ã€‚æ¯ä¸ªçŠ¶æ€éƒ½æœ‰æ˜ç¡®çš„è½¬æ¢è§„åˆ™ï¼Œä¾‹å¦‚åªæœ‰å¾…æ”¯ä»˜çš„è®¢å•å¯ä»¥è¿›è¡Œæ”¯ä»˜ï¼Œåªæœ‰å·²æ”¯ä»˜çš„è®¢å•å¯ä»¥å¼€å§‹é…é€ã€‚è¿™äº›è§„åˆ™éƒ½åœ¨Orderèšåˆæ ¹ä¸­å®ç°ï¼Œä¿è¯äº†çŠ¶æ€è½¬æ¢çš„æ­£ç¡®æ€§ã€‚

åº“å­˜çš„ç®¡ç†æ˜¯è®¢å•æœåŠ¡çš„å¦ä¸€ä¸ªé‡è¦åŠŸèƒ½ã€‚åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œç³»ç»Ÿä¼šé¢„æ‰£åº“å­˜ï¼›å¦‚æœæ”¯ä»˜è¶…æ—¶ï¼Œä¼šæ¢å¤åº“å­˜ï¼›æ”¯ä»˜æˆåŠŸåï¼Œä¼šç¡®è®¤æ‰£å‡åº“å­˜ã€‚è¿™ä¸ªæœºåˆ¶é€šè¿‡å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—å®ç°ï¼Œä¿è¯äº†åº“å­˜æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚

\subsection{æ”¯ä»˜æœåŠ¡ï¼ˆpay-serviceï¼‰}

æ”¯ä»˜æœåŠ¡å°è£…äº†ä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„äº¤äº’é€»è¾‘ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ”¯ä»˜æ¥å£ã€‚æ”¯ä»˜æœåŠ¡çš„è®¾è®¡è€ƒè™‘äº†æ”¯ä»˜çš„å®‰å…¨æ€§ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚

æ”¯ä»˜æµç¨‹çš„å®‰å…¨æ€§é€šè¿‡å¤šç§æœºåˆ¶ä¿è¯ã€‚é¦–å…ˆï¼Œæ‰€æœ‰çš„æ”¯ä»˜è¯·æ±‚éƒ½éœ€è¦éªŒè¯ç”¨æˆ·çš„èº«ä»½å’Œæƒé™ï¼›å…¶æ¬¡ï¼Œæ”¯ä»˜é‡‘é¢ä¼šä¸è®¢å•é‡‘é¢è¿›è¡Œæ ¸å¯¹ï¼Œé˜²æ­¢é‡‘é¢ç¯¡æ”¹ï¼›æœ€åï¼Œä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„é€šä¿¡é‡‡ç”¨äº†åŠ å¯†å’Œç­¾åæœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨ä¼ è¾“ã€‚

æ”¯ä»˜çš„å¯é æ€§é€šè¿‡å¹‚ç­‰æ€§è®¾è®¡å’Œé‡è¯•æœºåˆ¶ä¿è¯ã€‚æ¯ä¸ªæ”¯ä»˜è¯·æ±‚éƒ½æœ‰å”¯ä¸€çš„æ”¯ä»˜å•å·ï¼Œé‡å¤çš„æ”¯ä»˜è¯·æ±‚ä¼šè¿”å›ç›¸åŒçš„ç»“æœã€‚å¦‚æœæ”¯ä»˜è¯·æ±‚å¤±è´¥ï¼Œç³»ç»Ÿä¼šæ ¹æ®å¤±è´¥åŸå› å†³å®šæ˜¯å¦é‡è¯•ã€‚å¯¹äºç½‘ç»œè¶…æ—¶ç­‰ä¸´æ—¶æ€§æ•…éšœï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡è¯•ï¼›å¯¹äºä½™é¢ä¸è¶³ç­‰ä¸šåŠ¡é”™è¯¯ï¼Œç³»ç»Ÿä¼šç›´æ¥è¿”å›å¤±è´¥ã€‚

æ”¯ä»˜æœåŠ¡æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼ŒåŒ…æ‹¬æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€ä½™é¢æ”¯ä»˜ç­‰ã€‚ä¸åŒçš„æ”¯ä»˜æ–¹å¼æœ‰ä¸åŒçš„å¤„ç†æµç¨‹ï¼Œä½†å¯¹å¤–æä¾›ç»Ÿä¸€çš„æ¥å£ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ·»åŠ æ–°çš„æ”¯ä»˜æ–¹å¼å˜å¾—ç®€å•ï¼Œåªéœ€è¦å®ç°ç›¸åº”çš„æ”¯ä»˜å¤„ç†å™¨å³å¯ã€‚

\subsection{è´­ç‰©è½¦æœåŠ¡ï¼ˆcart-serviceï¼‰}

è´­ç‰©è½¦æœåŠ¡æä¾›äº†è´­ç‰©è½¦çš„ç®¡ç†åŠŸèƒ½ï¼Œæ˜¯ç”¨æˆ·è´­ç‰©æµç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚è´­ç‰©è½¦çš„è®¾è®¡è€ƒè™‘äº†æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§çš„å¹³è¡¡ã€‚

è´­ç‰©è½¦æ•°æ®çš„å­˜å‚¨é‡‡ç”¨äº†Rediså’ŒMySQLçš„åŒå†™ç­–ç•¥ã€‚Redisæä¾›é«˜æ€§èƒ½çš„è¯»å†™æ“ä½œï¼Œæ»¡è¶³è´­ç‰©è½¦é¢‘ç¹æ“ä½œçš„éœ€æ±‚ï¼›MySQLæä¾›æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚å½“ç”¨æˆ·æ“ä½œè´­ç‰©è½¦æ—¶ï¼Œç³»ç»Ÿä¼šåŒæ—¶æ›´æ–°Rediså’ŒMySQLï¼Œè¯»å–æ—¶ä¼˜å…ˆä»Redisè¯»å–ã€‚

è´­ç‰©è½¦çš„ä¸šåŠ¡è§„åˆ™åŒ…æ‹¬ï¼šä¸€ä¸ªç”¨æˆ·åœ¨ä¸€ä¸ªå•†å®¶åªèƒ½æœ‰ä¸€ä¸ªè´­ç‰©è½¦ï¼›è´­ç‰©è½¦ä¸­çš„å•†å“å¿…é¡»æ˜¯åŒä¸€ä¸ªå•†å®¶çš„ï¼›å•†å“çš„æ•°é‡æœ‰ä¸Šé™é™åˆ¶ç­‰ã€‚è¿™äº›è§„åˆ™éƒ½åœ¨Cartèšåˆæ ¹ä¸­å®ç°ï¼Œä¿è¯äº†æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚

è´­ç‰©è½¦æœåŠ¡è¿˜å®ç°äº†ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¦‚è´­ç‰©è½¦å•†å“çš„å®æ—¶ä»·æ ¼æ›´æ–°ã€æ— æ•ˆå•†å“çš„è‡ªåŠ¨æ¸…ç†ç­‰ã€‚è¿™äº›åŠŸèƒ½é€šè¿‡ç›‘å¬å•†å“ä»·æ ¼å˜æ›´äº‹ä»¶å’Œå®šæ—¶ä»»åŠ¡å®ç°ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒã€‚

\subsection{é…é€åœ°å€æœåŠ¡ï¼ˆaddress-serviceï¼‰}

é…é€åœ°å€æœåŠ¡ç®¡ç†ç”¨æˆ·çš„æ”¶è´§åœ°å€ä¿¡æ¯ã€‚è™½ç„¶åœ°å€åœ¨æ¦‚å¿µä¸Šå±äºç”¨æˆ·ï¼Œä½†è€ƒè™‘åˆ°åœ°å€ç®¡ç†çš„ç‹¬ç«‹æ€§å’Œå¤æ‚æ€§ï¼Œæˆ‘ä»¬å°†å…¶è®¾è®¡ä¸ºç‹¬ç«‹çš„æœåŠ¡ã€‚

åœ°å€ä¿¡æ¯åŒ…æ‹¬è”ç³»äººå§“åã€è”ç³»ç”µè¯ã€è¯¦ç»†åœ°å€ç­‰ã€‚ç”¨æˆ·å¯ä»¥æ·»åŠ å¤šä¸ªåœ°å€ï¼Œå¹¶è®¾ç½®å…¶ä¸­ä¸€ä¸ªä¸ºé»˜è®¤åœ°å€ã€‚åœ¨DDDè®¾è®¡ä¸­ï¼Œåœ°å€è¢«è®¾è®¡ä¸ºå€¼å¯¹è±¡ï¼Œå› ä¸ºåœ°å€æœ¬èº«æ²¡æœ‰ä¸šåŠ¡è¡Œä¸ºï¼Œåªæ˜¯æ•°æ®çš„è½½ä½“ã€‚

åœ°å€æœåŠ¡æä¾›äº†å®Œæ•´çš„CRUDæ“ä½œï¼Œä»¥åŠä¸€äº›ä¸šåŠ¡æ“ä½œå¦‚è®¾ç½®é»˜è®¤åœ°å€ã€‚å½“ç”¨æˆ·è®¾ç½®æ–°çš„é»˜è®¤åœ°å€æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†åŸæ¥çš„é»˜è®¤åœ°å€å–æ¶ˆã€‚è¿™ä¸ªä¸šåŠ¡è§„åˆ™é€šè¿‡é¢†åŸŸæœåŠ¡å®ç°ï¼Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚

\subsection{è®¤è¯æœåŠ¡ï¼ˆauth-serviceï¼‰}

è®¤è¯æœåŠ¡è´Ÿè´£ç”¨æˆ·çš„èº«ä»½è®¤è¯å’Œæƒé™ç®¡ç†ã€‚è™½ç„¶ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯åœ¨ç”¨æˆ·æœåŠ¡ä¸­ç®¡ç†ï¼Œä½†è®¤è¯ç›¸å…³çš„åŠŸèƒ½è¢«ç‹¬ç«‹å‡ºæ¥ï¼Œå½¢æˆä¸“é—¨çš„è®¤è¯æœåŠ¡ã€‚

æƒé™ç®¡ç†é‡‡ç”¨äº†RBACï¼ˆRole-Based Access Controlï¼‰æ¨¡å‹ã€‚ç³»ç»Ÿä¸­å®šä¹‰äº†è§’è‰²å’Œæƒé™ï¼Œç”¨æˆ·é€šè¿‡è§’è‰²è·å¾—ç›¸åº”çš„æƒé™ã€‚è§’è‰²å’Œæƒé™çš„å…³ç³»æ˜¯å¤šå¯¹å¤šçš„ï¼Œä¸€ä¸ªè§’è‰²å¯ä»¥æœ‰å¤šä¸ªæƒé™ï¼Œä¸€ä¸ªæƒé™ä¹Ÿå¯ä»¥è¢«å¤šä¸ªè§’è‰²æ‹¥æœ‰ã€‚

è®¤è¯ä¿¡æ¯çš„ç¼“å­˜ä½¿ç”¨Rediså®ç°ã€‚ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå…¶è§’è‰²å’Œæƒé™ä¿¡æ¯ä¼šè¢«ç¼“å­˜åˆ°Redisä¸­ã€‚åç»­çš„è¯·æ±‚å¯ä»¥ç›´æ¥ä»Redisè·å–æƒé™ä¿¡æ¯ï¼Œé¿å…äº†é¢‘ç¹çš„æ•°æ®åº“æŸ¥è¯¢ã€‚ç¼“å­˜è®¾ç½®äº†åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä½¿ç”¨äº†éšæœºçš„è¿‡æœŸæ—¶é—´åç§»ï¼Œé¿å…äº†ç¼“å­˜é›ªå´©ã€‚

\subsection{APIç½‘å…³ï¼ˆgateway-serviceï¼‰}

APIç½‘å…³æ˜¯æ‰€æœ‰å¤–éƒ¨è¯·æ±‚çš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯æˆæƒã€é™æµç†”æ–­ç­‰åŠŸèƒ½ã€‚æˆ‘ä»¬é€‰æ‹©äº†Spring Cloud Gatewayä½œä¸ºç½‘å…³å®ç°ã€‚

è·¯ç”±é…ç½®é‡‡ç”¨äº†åŠ¨æ€è·¯ç”±çš„æ–¹å¼ã€‚æ‰€æœ‰çš„è·¯ç”±è§„åˆ™éƒ½é…ç½®åœ¨Nacosä¸­ï¼Œç½‘å…³å¯åŠ¨æ—¶ä¼šä»NacosåŠ è½½è·¯ç”±é…ç½®ã€‚å½“è·¯ç”±è§„åˆ™éœ€è¦å˜æ›´æ—¶ï¼Œåªéœ€è¦åœ¨Nacosä¸­ä¿®æ”¹é…ç½®ï¼Œç½‘å…³ä¼šè‡ªåŠ¨åˆ·æ–°è·¯ç”±è§„åˆ™ã€‚

è®¤è¯è¿‡æ»¤å™¨æ˜¯ç½‘å…³çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡è®¤è¯è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨ä¼šéªŒè¯è¯·æ±‚ä¸­çš„JWTä»¤ç‰Œã€‚å¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œè¿‡æ»¤å™¨ä¼šä»ä»¤ç‰Œä¸­æå–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­ä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡ã€‚å¦‚æœä»¤ç‰Œæ— æ•ˆæˆ–è¿‡æœŸï¼Œè¿‡æ»¤å™¨ä¼šç›´æ¥è¿”å›401é”™è¯¯ã€‚

é™æµå’Œç†”æ–­åŠŸèƒ½é€šè¿‡é›†æˆSentinelå®ç°ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªè·¯ç”±é…ç½®äº†QPSé™åˆ¶ï¼Œå½“è¯·æ±‚é‡è¶…è¿‡é™åˆ¶æ—¶ï¼Œä¼šè¿”å›é™æµé”™è¯¯ã€‚åŒæ—¶ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œç½‘å…³ä¼šè‡ªåŠ¨ç†”æ–­ï¼Œè¿”å›é™çº§å“åº”ï¼Œé¿å…æ•…éšœæ‰©æ•£ã€‚

å…¨å±€å¼‚å¸¸å¤„ç†ç¡®ä¿äº†æ‰€æœ‰çš„å¼‚å¸¸éƒ½èƒ½è¢«å¦¥å–„å¤„ç†ã€‚æ— è®ºæ˜¯ç½‘å…³è‡ªèº«çš„å¼‚å¸¸ï¼Œè¿˜æ˜¯ä¸‹æ¸¸æœåŠ¡è¿”å›çš„å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«ç»Ÿä¸€å¤„ç†å¹¶è¿”å›æ ‡å‡†çš„é”™è¯¯å“åº”ã€‚è¿™ç§è®¾è®¡æå‡äº†å®¢æˆ·ç«¯çš„å¼€å‘ä½“éªŒã€‚

\textbf{ã€æˆªå›¾ä½ç½®35ï¼šSpring Cloud Gatewayè·¯ç”±é…ç½®ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Gatewayè·¯ç”±é…ç½®å’Œæµ‹è¯•æˆªå›¾ï¼Œå±•ç¤ºä»¥ä¸‹å†…å®¹ï¼š
\begin{enumerate}
\item è®¿é—®Gateway actuatorç«¯ç‚¹æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ï¼š\\
  \texttt{GET http://localhost:14000/actuator/gateway/routes}
\item æ˜¾ç¤ºæ‰€æœ‰é…ç½®çš„è·¯ç”±è§„åˆ™ï¼ŒåŒ…æ‹¬ï¼š
  \begin{itemize}
    \item user-serverè·¯ç”±ï¼š/user/** â†’ lb://user-server
    \item business-serverè·¯ç”±ï¼š/business/** â†’ lb://business-server
    \item order-serverè·¯ç”±ï¼š/orders/** â†’ lb://orders-server
  \end{itemize}
\item æ˜¾ç¤ºæ¯ä¸ªè·¯ç”±çš„predicateså’Œfiltersé…ç½®
\item é€šè¿‡Gatewayè®¿é—®å…·ä½“æœåŠ¡ï¼ŒéªŒè¯è·¯ç”±è½¬å‘æ­£å¸¸
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®36ï¼šGatewayè®¤è¯è¿‡æ»¤å™¨æµ‹è¯•ã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Gatewayè®¤è¯è¿‡æ»¤å™¨æµ‹è¯•æˆªå›¾ï¼š
\begin{enumerate}
\item ä¸æºå¸¦Tokenè®¿é—®éœ€è¦è®¤è¯çš„æ¥å£ï¼š\\
  \texttt{GET http://localhost:14000/user/getUserByUserId?userId=test001}
\item æ˜¾ç¤ºè¿”å›401 Unauthorizedé”™è¯¯
\item æºå¸¦æœ‰æ•ˆTokenè®¿é—®ç›¸åŒæ¥å£ï¼Œæ˜¾ç¤ºè®¿é—®æˆåŠŸ
\item åœ¨Gatewayæ—¥å¿—ä¸­æ˜¾ç¤ºè®¤è¯è¿‡æ»¤å™¨çš„æ‰§è¡Œè¿‡ç¨‹
\item å±•ç¤ºTokenéªŒè¯çš„è¯¦ç»†æµç¨‹
\end{enumerate}

\textbf{ã€æˆªå›¾ä½ç½®37ï¼šGatewayé™æµç†”æ–­æ¼”ç¤ºã€‘}

è¯·åœ¨æ­¤å¤„æ’å…¥Gatewayé™æµç†”æ–­æµ‹è¯•æˆªå›¾ï¼š
\begin{enumerate}
\item é…ç½®QPSé™æµè§„åˆ™ï¼ˆå¦‚æ¯ç§’æœ€å¤š5ä¸ªè¯·æ±‚ï¼‰
\item ä½¿ç”¨å‹æµ‹å·¥å…·å‘é€å¤§é‡å¹¶å‘è¯·æ±‚
\item æ˜¾ç¤ºé™æµç”Ÿæ•ˆï¼Œè¿”å›429 Too Many Requests
\item åœæ­¢æŸä¸ªä¸‹æ¸¸æœåŠ¡ï¼Œè§¦å‘ç†”æ–­æœºåˆ¶
\item æ˜¾ç¤ºç†”æ–­åè¿”å›é™çº§å“åº”
\item æœåŠ¡æ¢å¤åï¼Œç†”æ–­å™¨è‡ªåŠ¨æ¢å¤
\end{enumerate}

\section{ç³»ç»Ÿå®ç°}

ç³»ç»Ÿå®ç°éƒ¨åˆ†å±•ç¤ºäº†æ•´ä¸ªå¤–å–å¹³å°çš„ç”¨æˆ·ç•Œé¢å’Œäº¤äº’æµç¨‹ã€‚å‰ç«¯é‡‡ç”¨Vue 3æ¡†æ¶å¼€å‘ï¼Œé€šè¿‡ç»„ä»¶åŒ–çš„æ–¹å¼æ„å»ºäº†ä¸€ä¸ªç°ä»£åŒ–çš„å•é¡µåº”ç”¨ã€‚æ¯ä¸ªé¡µé¢éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿè·å¾—æµç•…çš„ä½¿ç”¨ä½“éªŒã€‚

\subsection{é¦–é¡µå±•ç¤º}

é¦–é¡µæ˜¯ç”¨æˆ·è¿›å…¥ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œæ‰¿æ‹…ç€é‡è¦çš„å¯¼èˆªå’Œå±•ç¤ºåŠŸèƒ½ã€‚é¡µé¢è®¾è®¡é‡‡ç”¨äº†ç®€æ´æ˜äº†çš„é£æ ¼ï¼Œçªå‡ºäº†æ ¸å¿ƒåŠŸèƒ½å’Œçƒ­é—¨å•†å®¶ã€‚

% é¦–é¡µç•Œé¢å ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
é¦–é¡µç•Œé¢æˆªå›¾å ä½\\
è¯·å±•ç¤ºåŒ…å«ä»¥ä¸‹å…ƒç´ çš„é¦–é¡µï¼š\\
- é¡¶éƒ¨æœç´¢æ \\
- åˆ†ç±»å¯¼èˆªï¼ˆç¾é£Ÿã€æ°´æœã€è¶…å¸‚ç­‰ï¼‰\\
- è½®æ’­å¹¿å‘Šä½\\
- çƒ­é—¨å•†å®¶æ¨è\\
- å•†å®¶åˆ—è¡¨ï¼ˆåŒ…å«å•†å®¶å›¾ç‰‡ã€åç§°ã€è¯„åˆ†ã€é…é€è´¹ç­‰ä¿¡æ¯ï¼‰
}}
\end{center}

é¦–é¡µçš„å®ç°é‡ç‚¹è€ƒè™‘äº†æ€§èƒ½ä¼˜åŒ–ã€‚å•†å®¶åˆ—è¡¨é‡‡ç”¨äº†è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯ï¼Œåªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„å•†å®¶å¡ç‰‡ï¼Œå¤§å¤§å‡å°‘äº†DOMèŠ‚ç‚¹çš„æ•°é‡ã€‚å›¾ç‰‡åŠ è½½ä½¿ç”¨äº†æ‡’åŠ è½½ç­–ç•¥ï¼Œåªæœ‰è¿›å…¥å¯è§†åŒºåŸŸçš„å›¾ç‰‡æ‰ä¼šå¼€å§‹åŠ è½½ã€‚è¿™äº›ä¼˜åŒ–æªæ–½ç¡®ä¿äº†å³ä½¿åœ¨å•†å®¶æ•°é‡å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œé¡µé¢ä¾ç„¶èƒ½å¤Ÿä¿æŒè‰¯å¥½çš„æ€§èƒ½ã€‚

æœç´¢åŠŸèƒ½æä¾›äº†å®æ—¶æœç´¢å»ºè®®ã€‚å½“ç”¨æˆ·è¾“å…¥å…³é”®è¯æ—¶ï¼Œç³»ç»Ÿä¼šå®æ—¶æŸ¥è¯¢åŒ¹é…çš„å•†å®¶å’Œå•†å“ï¼Œå¹¶åœ¨ä¸‹æ‹‰æ¡†ä¸­å±•ç¤ºæœç´¢å»ºè®®ã€‚æœç´¢ç®—æ³•è€ƒè™‘äº†å¤šä¸ªç»´åº¦ï¼ŒåŒ…æ‹¬å•†å®¶åç§°ã€å•†å“åç§°ã€å•†å®¶åˆ†ç±»ç­‰ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„å†…å®¹ã€‚

\subsection{å•†å®¶åˆ—è¡¨é¡µ}

å•†å®¶åˆ—è¡¨é¡µå±•ç¤ºäº†ç‰¹å®šåˆ†ç±»ä¸‹çš„æ‰€æœ‰å•†å®¶ã€‚é¡µé¢æä¾›äº†å¤šç§æ’åºæ–¹å¼ï¼ŒåŒ…æ‹¬ç»¼åˆæ’åºã€é”€é‡æ’åºã€è¯„åˆ†æ’åºã€é…é€è´¹æ’åºç­‰ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ’åºæ–¹å¼ã€‚

% å•†å®¶åˆ—è¡¨é¡µå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
å•†å®¶åˆ—è¡¨é¡µæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- åˆ†ç±»ç­›é€‰æ ‡ç­¾\\
- æ’åºé€‰é¡¹ï¼ˆç»¼åˆã€é”€é‡ã€è¯„åˆ†ã€é…é€è´¹ï¼‰\\
- å•†å®¶å¡ç‰‡åˆ—è¡¨\\
- ç­›é€‰æ¡ä»¶ï¼ˆé…é€è´¹ã€äººå‡æ¶ˆè´¹ç­‰ï¼‰
}}
\end{center}

ç­›é€‰åŠŸèƒ½å…è®¸ç”¨æˆ·æ ¹æ®é…é€è´¹ã€äººå‡æ¶ˆè´¹ã€å•†å®¶ç‰¹è‰²ç­‰æ¡ä»¶ç­›é€‰å•†å®¶ã€‚å¤šä¸ªç­›é€‰æ¡ä»¶å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œç³»ç»Ÿä¼šå®æ—¶æ›´æ–°ç¬¦åˆæ¡ä»¶çš„å•†å®¶åˆ—è¡¨ã€‚ç­›é€‰æ¡ä»¶çš„çŠ¶æ€ä¼šä¿å­˜åœ¨URLå‚æ•°ä¸­ï¼Œç¡®ä¿ç”¨æˆ·åˆ·æ–°é¡µé¢åç­›é€‰æ¡ä»¶ä¸ä¼šä¸¢å¤±ã€‚

\subsection{å•†å“è¯¦æƒ…é¡µ}

å•†å“è¯¦æƒ…é¡µæ˜¯ç”¨æˆ·é€‰æ‹©å•†å“çš„æ ¸å¿ƒé¡µé¢ã€‚é¡µé¢åˆ†ä¸ºä¸¤ä¸ªä¸»è¦åŒºåŸŸï¼šå·¦ä¾§æ˜¯å•†å“åˆ†ç±»èœå•ï¼Œå³ä¾§æ˜¯å•†å“åˆ—è¡¨ã€‚è¿™ç§å¸ƒå±€ä½¿å¾—ç”¨æˆ·å¯ä»¥å¿«é€Ÿæµè§ˆä¸åŒåˆ†ç±»çš„å•†å“ã€‚

% å•†å“è¯¦æƒ…é¡µå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
å•†å“è¯¦æƒ…é¡µæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- å•†å®¶ä¿¡æ¯å¤´éƒ¨ï¼ˆåç§°ã€è¯„åˆ†ã€é…é€ä¿¡æ¯ï¼‰\\
- å·¦ä¾§å•†å“åˆ†ç±»èœå•\\
- å³ä¾§å•†å“åˆ—è¡¨\\
- å•†å“å¡ç‰‡ï¼ˆå›¾ç‰‡ã€åç§°ã€ä»·æ ¼ã€åŠ å‡æŒ‰é’®ï¼‰\\
- åº•éƒ¨è´­ç‰©è½¦æ ï¼ˆæ˜¾ç¤ºå·²é€‰å•†å“æ•°é‡å’Œæ€»ä»·ï¼‰
}}
\end{center}

å•†å“çš„æ·»åŠ å’Œåˆ é™¤æ“ä½œé‡‡ç”¨äº†ä¹è§‚æ›´æ–°ç­–ç•¥ã€‚å½“ç”¨æˆ·ç‚¹å‡»æ·»åŠ æˆ–åˆ é™¤æŒ‰é’®æ—¶ï¼Œç•Œé¢ä¼šç«‹å³æ›´æ–°ï¼ŒåŒæ—¶å‘åç«¯å‘é€è¯·æ±‚ã€‚å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œç•Œé¢ä¼šå›æ»šåˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚è¿™ç§ç­–ç•¥æä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œé¿å…äº†ç­‰å¾…æœåŠ¡å™¨å“åº”çš„å»¶è¿Ÿã€‚

è´­ç‰©è½¦çš„å®æ—¶è®¡ç®—åŠŸèƒ½å±•ç¤ºäº†ç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚æ¯å½“ç”¨æˆ·ä¿®æ”¹å•†å“æ•°é‡æ—¶ï¼Œç³»ç»Ÿä¼šå®æ—¶è®¡ç®—è´­ç‰©è½¦çš„æ€»ä»·ã€é…é€è´¹ã€æ˜¯å¦æ»¡è¶³èµ·é€ä»·ç­‰ä¿¡æ¯ã€‚è¿™äº›è®¡ç®—éƒ½åœ¨å‰ç«¯å®Œæˆï¼Œç¡®ä¿äº†å³æ—¶çš„åé¦ˆã€‚

\subsection{è´­ç‰©è½¦ç•Œé¢}

è´­ç‰©è½¦ç•Œé¢æä¾›äº†å¯¹å·²é€‰å•†å“çš„é›†ä¸­ç®¡ç†ã€‚ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æ‰€æœ‰å·²é€‰å•†å“ï¼Œä¿®æ”¹æ•°é‡ï¼Œæˆ–è€…åˆ é™¤ä¸éœ€è¦çš„å•†å“ã€‚ç•Œé¢è®¾è®¡ç®€æ´æ¸…æ™°ï¼Œæ“ä½œç›´è§‚ã€‚

% è´­ç‰©è½¦ç•Œé¢å ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
è´­ç‰©è½¦ç•Œé¢æˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- å•†å®¶åˆ†ç»„çš„è´­ç‰©è½¦å•†å“\\
- æ¯ä¸ªå•†å“çš„è¯¦ç»†ä¿¡æ¯å’Œæ•°é‡æ§åˆ¶\\
- å°è®¡é‡‘é¢æ˜¾ç¤º\\
- æ¸…ç©ºè´­ç‰©è½¦æŒ‰é’®\\
- å»ç»“ç®—æŒ‰é’®
}}
\end{center}

\subsection{è®¢å•ç¡®è®¤é¡µ}

è®¢å•ç¡®è®¤é¡µæ˜¯ä¸‹å•æµç¨‹çš„å…³é”®é¡µé¢ã€‚ç”¨æˆ·åœ¨è¿™é‡Œéœ€è¦ç¡®è®¤é…é€åœ°å€ã€å•†å“æ¸…å•ã€é…é€æ—¶é—´ç­‰ä¿¡æ¯ã€‚é¡µé¢è®¾è®¡æ³¨é‡ä¿¡æ¯çš„æ¸…æ™°å±•ç¤ºå’Œæ“ä½œçš„ä¾¿æ·æ€§ã€‚

% è®¢å•ç¡®è®¤é¡µå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
è®¢å•ç¡®è®¤é¡µæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- é…é€åœ°å€é€‰æ‹©ï¼ˆå¯åˆ‡æ¢åœ°å€ï¼‰\\
- å•†å“æ¸…å•\\
- é…é€æ—¶é—´é€‰æ‹©\\
- è®¢å•å¤‡æ³¨è¾“å…¥\\
- è´¹ç”¨æ˜ç»†ï¼ˆå•†å“æ€»ä»·ã€é…é€è´¹ã€ä¼˜æƒ ç­‰ï¼‰\\
- ç¡®è®¤ä¸‹å•æŒ‰é’®
}}
\end{center}

åœ°å€é€‰æ‹©åŠŸèƒ½æä¾›äº†ä¾¿æ·çš„åˆ‡æ¢ä½“éªŒã€‚ç”¨æˆ·å¯ä»¥ä»å·²ä¿å­˜çš„åœ°å€ä¸­é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥æ–°å¢åœ°å€ã€‚é»˜è®¤åœ°å€ä¼šè‡ªåŠ¨é€‰ä¸­ï¼Œå‡å°‘äº†ç”¨æˆ·çš„æ“ä½œæ­¥éª¤ã€‚

\subsection{æ”¯ä»˜é¡µé¢}

æ”¯ä»˜é¡µé¢æä¾›äº†å¤šç§æ”¯ä»˜æ–¹å¼ä¾›ç”¨æˆ·é€‰æ‹©ã€‚é¡µé¢è®¾è®¡ç®€æ´æ˜äº†ï¼Œçªå‡ºäº†æ”¯ä»˜é‡‘é¢å’Œæ”¯ä»˜æ–¹å¼é€‰æ‹©ã€‚

% æ”¯ä»˜é¡µé¢å ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
æ”¯ä»˜é¡µé¢æˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- è®¢å•é‡‘é¢æ˜¾ç¤º\\
- æ”¯ä»˜æ–¹å¼é€‰æ‹©ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ã€ä½™é¢ç­‰ï¼‰\\
- æ”¯ä»˜å€’è®¡æ—¶\\
- ç«‹å³æ”¯ä»˜æŒ‰é’®\\
- æ”¯ä»˜å®‰å…¨æç¤º
}}
\end{center}

æ”¯ä»˜å€’è®¡æ—¶åŠŸèƒ½æé†’ç”¨æˆ·åŠæ—¶å®Œæˆæ”¯ä»˜ã€‚å¦‚æœè¶…è¿‡æ”¯ä»˜æ—¶é™ï¼Œè®¢å•ä¼šè‡ªåŠ¨å–æ¶ˆï¼Œåº“å­˜ä¼šè‡ªåŠ¨æ¢å¤ã€‚è¿™ä¸ªæœºåˆ¶ä¿è¯äº†åº“å­˜çš„æœ‰æ•ˆåˆ©ç”¨ã€‚

\subsection{å†å²è®¢å•é¡µ}

å†å²è®¢å•é¡µå±•ç¤ºäº†ç”¨æˆ·çš„æ‰€æœ‰å†å²è®¢å•ã€‚è®¢å•æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼Œæœ€æ–°çš„è®¢å•æ˜¾ç¤ºåœ¨æœ€å‰é¢ã€‚æ¯ä¸ªè®¢å•éƒ½æ˜¾ç¤ºäº†å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å•†å®¶åç§°ã€å•†å“åˆ—è¡¨ã€è®¢å•é‡‘é¢ã€è®¢å•çŠ¶æ€ç­‰ã€‚

% å†å²è®¢å•é¡µå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
å†å²è®¢å•é¡µæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- è®¢å•åˆ—è¡¨ï¼ˆæŒ‰æ—¶é—´å€’åºï¼‰\\
- æ¯ä¸ªè®¢å•çš„æ¦‚è¦ä¿¡æ¯\\
- è®¢å•çŠ¶æ€æ ‡ç­¾\\
- å†æ¥ä¸€å•æŒ‰é’®\\
- æŸ¥çœ‹è¯¦æƒ…å…¥å£
}}
\end{center}

è®¢å•çŠ¶æ€çš„å±•ç¤ºé‡‡ç”¨äº†ä¸åŒçš„é¢œè‰²å’Œå›¾æ ‡ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿè¯†åˆ«è®¢å•çš„å½“å‰çŠ¶æ€ã€‚å¯¹äºå¯æ“ä½œçš„è®¢å•ï¼ˆå¦‚å¾…æ”¯ä»˜ã€å¾…è¯„ä»·ï¼‰ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºç›¸åº”çš„æ“ä½œæŒ‰é’®ã€‚

\subsection{åœ°å€ç®¡ç†é¡µ}

åœ°å€ç®¡ç†é¡µå…è®¸ç”¨æˆ·ç®¡ç†æ‰€æœ‰çš„é…é€åœ°å€ã€‚ç”¨æˆ·å¯ä»¥æ·»åŠ æ–°åœ°å€ã€ç¼–è¾‘ç°æœ‰åœ°å€ã€åˆ é™¤åœ°å€ï¼Œä»¥åŠè®¾ç½®é»˜è®¤åœ°å€ã€‚

% åœ°å€ç®¡ç†é¡µå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
åœ°å€ç®¡ç†é¡µæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- åœ°å€åˆ—è¡¨\\
- é»˜è®¤åœ°å€æ ‡è¯†\\
- ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®\\
- æ–°å¢åœ°å€æŒ‰é’®\\
- åœ°å€è¯¦ç»†ä¿¡æ¯å±•ç¤º
}}
\end{center}

\subsection{ä¸ªäººä¸­å¿ƒé¡µ}

ä¸ªäººä¸­å¿ƒé¡µæ˜¯ç”¨æˆ·ç®¡ç†ä¸ªäººä¿¡æ¯çš„å…¥å£ã€‚é¡µé¢å±•ç¤ºäº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶æä¾›äº†å„ç§åŠŸèƒ½å…¥å£ï¼Œå¦‚è®¢å•ç®¡ç†ã€åœ°å€ç®¡ç†ã€è®¾ç½®ç­‰ã€‚

% ä¸ªäººä¸­å¿ƒé¡µå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
ä¸ªäººä¸­å¿ƒé¡µæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- ç”¨æˆ·å¤´åƒå’Œæ˜µç§°\\
- è´¦æˆ·ä½™é¢å’Œç§¯åˆ†\\
- åŠŸèƒ½å…¥å£åˆ—è¡¨\\
- è®¾ç½®æŒ‰é’®\\
- é€€å‡ºç™»å½•é€‰é¡¹
}}
\end{center}

\section{ç³»ç»Ÿæµ‹è¯•}

ç³»ç»Ÿæµ‹è¯•æ˜¯ä¿è¯è½¯ä»¶è´¨é‡çš„é‡è¦ç¯èŠ‚ã€‚æˆ‘ä»¬é‡‡ç”¨äº†å¤šå±‚æ¬¡çš„æµ‹è¯•ç­–ç•¥ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ç­‰ï¼Œç¡®ä¿ç³»ç»Ÿçš„åŠŸèƒ½æ­£ç¡®æ€§å’Œæ€§èƒ½æŒ‡æ ‡è¾¾åˆ°é¢„æœŸã€‚

åœ¨å¾®æœåŠ¡æ¶æ„å’ŒDDDè®¾è®¡çš„èƒŒæ™¯ä¸‹ï¼Œæµ‹è¯•ç­–ç•¥éœ€è¦ç‰¹åˆ«è€ƒè™‘æœåŠ¡é—´çš„åä½œã€é¢†åŸŸæ¨¡å‹çš„æ­£ç¡®æ€§ã€äº‹ä»¶é©±åŠ¨æ¶æ„çš„å¯é æ€§ç­‰æ–¹é¢ã€‚æˆ‘ä»¬å»ºç«‹äº†å®Œæ•´çš„æµ‹è¯•é‡‘å­—å¡”ï¼Œä»åº•å±‚çš„å•å…ƒæµ‹è¯•åˆ°é¡¶å±‚çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œç¡®ä¿ç³»ç»Ÿçš„æ¯ä¸ªå±‚é¢éƒ½å¾—åˆ°å……åˆ†éªŒè¯ã€‚

\subsection{DDDé¢†åŸŸæ¨¡å‹æµ‹è¯•}

\subsubsection{èšåˆæ ¹æµ‹è¯•ç­–ç•¥}

é¢†åŸŸæ¨¡å‹çš„æµ‹è¯•æ˜¯DDDæ¶æ„ä¸­æœ€é‡è¦çš„æµ‹è¯•ç±»å‹ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªèšåˆæ ¹è®¾è®¡äº†å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–äº†æ‰€æœ‰çš„ä¸šåŠ¡è§„åˆ™å’ŒçŠ¶æ€è½¬æ¢ã€‚

\begin{lstlisting}[caption=ç”¨æˆ·èšåˆæ ¹æµ‹è¯•]
@ExtendWith(MockitoExtension.class)
class UserTest {
    
    @Test
    @DisplayName("ç”¨æˆ·æ³¨å†Œåº”è¯¥åˆ›å»ºç”¨æˆ·å¹¶å‘å¸ƒæ³¨å†Œäº‹ä»¶")
    void should_create_user_and_publish_event_when_register() {
        // Given
        UserId userId = new UserId("test001");
        UserName userName = new UserName("å¼ ä¸‰");
        Password password = Password.create("123456");
        
        // When
        User user = User.register(userId, userName, password, UserSex.MALE);
        
        // Then
        assertThat(user.getUserId()).isEqualTo(userId);
        assertThat(user.getDomainEvents()).hasSize(1);
        assertThat(user.getDomainEvents().get(0)).isInstanceOf(UserRegisteredEvent.class);
    }
    
    @Test
    @DisplayName("ä¿®æ”¹å¯†ç åº”è¯¥éªŒè¯åŸå¯†ç å¹¶å‘å¸ƒäº‹ä»¶")
    void should_validate_old_password_and_publish_event() {
        // Given
        User user = createTestUser();
        
        // When
        user.changePassword("123456", "newPassword123");
        
        // Then
        assertThat(user.getPassword().matches("newPassword123")).isTrue();
        assertThat(user.getDomainEvents()).hasSize(1);
    }
    
    // çœç•¥å…¶ä»–æµ‹è¯•æ–¹æ³•...
    
    private User createTestUser() {
        return new User(new UserId("test001"), new UserName("å¼ ä¸‰"), 
                       Password.create("123456"), UserSex.MALE, "", false);
    }
}
\end{lstlisting}

è¿™äº›æµ‹è¯•ç”¨ä¾‹ä¸“æ³¨äºéªŒè¯ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§ï¼Œä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨ç³»ç»Ÿï¼Œæ‰§è¡Œé€Ÿåº¦å¿«ï¼Œåé¦ˆåŠæ—¶ã€‚

\subsubsection{å€¼å¯¹è±¡æµ‹è¯•}

å€¼å¯¹è±¡çš„æµ‹è¯•é‡ç‚¹éªŒè¯å…¶ä¸å˜æ€§çº¦æŸå’Œä¸šåŠ¡è§„åˆ™ï¼š

\begin{lstlisting}[caption=Passwordå€¼å¯¹è±¡æµ‹è¯•]
class PasswordTest {
    
    @Test
    @DisplayName("åˆ›å»ºå¯†ç åº”è¯¥åŠ å¯†å­˜å‚¨")
    void should_encrypt_when_create_password() {
        Password password = Password.create("123456");
        
        assertThat(password.getEncryptedValue()).isNotEqualTo("123456");
        assertThat(password.matches("123456")).isTrue();
    }
    
    @ParameterizedTest
    @ValueSource(strings = {"", "12345", "1234567890123456789012345"})
    @DisplayName("æ— æ•ˆå¯†ç é•¿åº¦åº”è¯¥æŠ›å‡ºå¼‚å¸¸")
    void should_throw_exception_for_invalid_password_length(String invalidPassword) {
        assertThatThrownBy(() -> Password.create(invalidPassword))
            .isInstanceOf(IllegalArgumentException.class);
    }
    
    // çœç•¥å…¶ä»–æµ‹è¯•æ–¹æ³•...
}
}
\end{lstlisting}

\subsubsection{é¢†åŸŸæœåŠ¡æµ‹è¯•}

é¢†åŸŸæœåŠ¡çš„æµ‹è¯•å…³æ³¨è·¨èšåˆçš„ä¸šåŠ¡é€»è¾‘ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·é¢†åŸŸæœåŠ¡æµ‹è¯•]
@ExtendWith(MockitoExtension.class)
class UserDomainServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserDomainService userDomainService;
    
    @Test
    @DisplayName("æ£€æŸ¥ç”¨æˆ·IDå¯ç”¨æ€§åº”è¯¥è°ƒç”¨ä»“å‚¨æŸ¥è¯¢")
    void should_check_repository_when_verify_user_id_availability() {
        UserId userId = new UserId("test001");
        when(userRepository.existsById(userId)).thenReturn(false);
        
        boolean available = userDomainService.isUserIdAvailable(userId);
        
        assertThat(available).isTrue();
        verify(userRepository).existsById(userId);
    }
}
\end{lstlisting}

\subsection{åº”ç”¨æœåŠ¡é›†æˆæµ‹è¯•}

åº”ç”¨æœåŠ¡çš„æµ‹è¯•éœ€è¦éªŒè¯æ•´ä¸ªç”¨ä¾‹çš„æ‰§è¡Œæµç¨‹ï¼ŒåŒ…æ‹¬é¢†åŸŸå¯¹è±¡çš„åè°ƒã€äº‹åŠ¡çš„ç®¡ç†ã€äº‹ä»¶çš„å‘å¸ƒç­‰ï¼š

\begin{lstlisting}[caption=ç”¨æˆ·åº”ç”¨æœåŠ¡é›†æˆæµ‹è¯•]
@SpringBootTest
@Transactional
class UserApplicationServiceIntegrationTest {
    
    @Autowired
    private UserApplicationService userApplicationService;
    
    @Autowired
    private UserRepository userRepository;
    
    @MockBean
    private DomainEventPublisher eventPublisher;
    
    @Test
    @DisplayName("ç”¨æˆ·æ³¨å†Œåº”è¯¥å®Œæ•´æ‰§è¡Œå¹¶å‘å¸ƒäº‹ä»¶")
    void should_complete_registration_and_publish_event() {
        RegisterUserCommand command = new RegisterUserCommand();
        command.setUserId("integration_test_001");
        command.setUserName("é›†æˆæµ‹è¯•ç”¨æˆ·");
        command.setPassword("123456");
        command.setUserSex(1);
        
        CommonResult<String> result = userApplicationService.register(command);
        
        assertThat(result.getCode()).isEqualTo(200);
        
        Optional<User> savedUser = userRepository.findById(new UserId("integration_test_001"));
        assertThat(savedUser).isPresent();
        verify(eventPublisher).publishAll(any());
    }
    
    // çœç•¥å…¶ä»–æµ‹è¯•æ–¹æ³•...
}
}
\end{lstlisting}

\subsection{APIæ¥å£æµ‹è¯•}

APIæ¥å£æµ‹è¯•æ˜¯éªŒè¯ç³»ç»ŸåŠŸèƒ½çš„åŸºç¡€ã€‚æˆ‘ä»¬ä½¿ç”¨Apifoxä½œä¸ºAPIæµ‹è¯•å·¥å…·ï¼Œå®ƒæä¾›äº†å®Œæ•´çš„APIæ–‡æ¡£ç®¡ç†ã€æµ‹è¯•ç”¨ä¾‹ç®¡ç†ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰åŠŸèƒ½ã€‚

\subsubsection{æµ‹è¯•ç¯å¢ƒæ­å»º}

æµ‹è¯•ç¯å¢ƒçš„æ­å»ºéœ€è¦ç¡®ä¿æ‰€æœ‰çš„å¾®æœåŠ¡éƒ½æ­£å¸¸è¿è¡Œã€‚æˆ‘ä»¬ç¼–å†™äº†è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå¯ä»¥ä¸€é”®å¯åŠ¨æ‰€æœ‰çš„æœåŠ¡ã€‚æµ‹è¯•æ•°æ®é€šè¿‡SQLè„šæœ¬åˆå§‹åŒ–ï¼Œç¡®ä¿æ¯æ¬¡æµ‹è¯•éƒ½æœ‰ä¸€è‡´çš„åˆå§‹çŠ¶æ€ã€‚

\subsubsection{æµ‹è¯•ç”¨ä¾‹è®¾è®¡}

æµ‹è¯•ç”¨ä¾‹çš„è®¾è®¡è¦†ç›–äº†æ‰€æœ‰çš„APIæ¥å£ã€‚æ¯ä¸ªæ¥å£éƒ½è®¾è®¡äº†æ­£å¸¸åœºæ™¯å’Œå¼‚å¸¸åœºæ™¯çš„æµ‹è¯•ç”¨ä¾‹ã€‚æ­£å¸¸åœºæ™¯éªŒè¯åŠŸèƒ½çš„æ­£ç¡®æ€§ï¼Œå¼‚å¸¸åœºæ™¯éªŒè¯ç³»ç»Ÿçš„å¥å£®æ€§ã€‚

% APIæµ‹è¯•ç»“æœå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
APIæµ‹è¯•ç»“æœæˆªå›¾å ä½\\
è¯·ä½¿ç”¨Apifoxå±•ç¤ºï¼š\\
- APIæ–‡æ¡£åˆ—è¡¨\\
- æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œç»“æœ\\
- æ¥å£å“åº”æ—¶é—´ç»Ÿè®¡\\
- æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
}}
\end{center}

ç”¨æˆ·æ³¨å†Œæ¥å£çš„æµ‹è¯•åŒ…æ‹¬äº†å¤šç§åœºæ™¯ï¼šæ­£å¸¸æ³¨å†Œã€æ‰‹æœºå·å·²å­˜åœ¨ã€å¯†ç æ ¼å¼ä¸æ­£ç¡®ç­‰ã€‚æ¯ç§åœºæ™¯éƒ½éªŒè¯äº†è¿”å›çš„çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚

ç™»å½•æ¥å£çš„æµ‹è¯•é‡ç‚¹éªŒè¯äº†JWTä»¤ç‰Œçš„ç”Ÿæˆå’ŒéªŒè¯æœºåˆ¶ã€‚æµ‹è¯•ç”¨ä¾‹åŒ…æ‹¬æ­£ç¡®çš„ç™»å½•å‡­è¯ã€é”™è¯¯çš„å¯†ç ã€ä¸å­˜åœ¨çš„ç”¨æˆ·ç­‰åœºæ™¯ã€‚åŒæ—¶è¿˜æµ‹è¯•äº†ä»¤ç‰Œçš„è¿‡æœŸæœºåˆ¶ã€‚

è®¢å•åˆ›å»ºæ¥å£çš„æµ‹è¯•æœ€ä¸ºå¤æ‚ï¼Œå› ä¸ºæ¶‰åŠå¤šä¸ªæœåŠ¡çš„åä½œã€‚æµ‹è¯•ç”¨ä¾‹éœ€è¦å‡†å¤‡å®Œæ•´çš„æµ‹è¯•æ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·ã€å•†å®¶ã€å•†å“ã€è´­ç‰©è½¦ç­‰ã€‚æµ‹è¯•éªŒè¯äº†è®¢å•åˆ›å»ºçš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬åº“å­˜æ‰£å‡ã€è´­ç‰©è½¦æ¸…ç©ºç­‰ã€‚

\subsubsection{è‡ªåŠ¨åŒ–æµ‹è¯•}

è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡Apifoxçš„æµ‹è¯•é›†åŠŸèƒ½å®ç°ã€‚æˆ‘ä»¬å°†ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ç»„ç»‡æˆæµ‹è¯•é›†ï¼Œå¯ä»¥ä¸€é”®æ‰§è¡Œæ‰€æœ‰çš„æµ‹è¯•ã€‚æµ‹è¯•é›†æ”¯æŒå‚æ•°åŒ–æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æµ‹è¯•æ•°æ®æ‰§è¡Œç›¸åŒçš„æµ‹è¯•é€»è¾‘ã€‚

æµ‹è¯•ç»“æœçš„åˆ†æåŒ…æ‹¬äº†å“åº”æ—¶é—´ã€æˆåŠŸç‡ã€é”™è¯¯åˆ†å¸ƒç­‰å¤šä¸ªç»´åº¦ã€‚é€šè¿‡è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆå’Œæ½œåœ¨é—®é¢˜ã€‚

\section{ç³»ç»Ÿå®ç°å±•ç¤º}

\subsection{å‰ç«¯ç•Œé¢å®ç°}

é¥¿äº†ä¹ˆå¤–å–å¹³å°çš„å‰ç«¯é‡‡ç”¨Vue.jsæ¡†æ¶å¼€å‘ï¼Œç»“åˆElement-UIç»„ä»¶åº“å®ç°äº†ç¾è§‚ä¸”åŠŸèƒ½å®Œå–„çš„ç”¨æˆ·ç•Œé¢ã€‚æ•´ä¸ªå‰ç«¯ç•Œé¢éµå¾ªäº†ç°ä»£åŒ–çš„è®¾è®¡ç†å¿µï¼Œæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

\subsubsection{é¦–é¡µå±•ç¤º}

ç³»ç»Ÿé¦–é¡µæ˜¯ç”¨æˆ·è¿›å…¥å¹³å°åçœ‹åˆ°çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œè®¾è®¡ç®€æ´æ˜äº†ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹åŠŸèƒ½æ¨¡å—ï¼š

% é¦–é¡µæˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®19ï¼šç³»ç»Ÿé¦–é¡µç•Œé¢ã€‘}\\[0.5cm]
\textbf{å±•ç¤ºå†…å®¹ï¼š}\\
â€¢ é¡¶éƒ¨å¯¼èˆªæ ï¼šåŒ…å«Logoã€ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦å›¾æ ‡\\
â€¢ è½®æ’­å›¾ï¼šå±•ç¤ºå¹³å°æ¨èå•†å®¶å’Œä¼˜æƒ æ´»åŠ¨\\
â€¢ å•†å®¶åˆ†ç±»ï¼šå¿«é€Ÿç­›é€‰ä¸åŒç±»å‹çš„å•†å®¶\\
â€¢ å•†å®¶åˆ—è¡¨ï¼šæ˜¾ç¤ºé™„è¿‘å•†å®¶åŠè¯„åˆ†ã€é…é€æ—¶é—´ç­‰ä¿¡æ¯\\
â€¢ åº•éƒ¨å¯¼èˆªï¼šé¦–é¡µã€è®¢å•ã€æˆ‘çš„ç­‰ä¸»è¦åŠŸèƒ½å…¥å£\\[0.5cm]
\textbf{æŠ€æœ¯å®ç°ï¼š}\\
â€¢ Vueç»„ä»¶åŒ–å¼€å‘ï¼Œå“åº”å¼å¸ƒå±€è®¾è®¡\\
â€¢ Element-UIçš„Carouselã€Cardç­‰ç»„ä»¶\\
â€¢ å•†å®¶æ•°æ®é€šè¿‡APIç½‘å…³ä»business-serverè·å–
}}
\end{figure}

ä¸»è¦åŠŸèƒ½åŒ…æ‹¬å•†å®¶åˆ†ç±»ç­›é€‰ã€å•†å®¶åˆ—è¡¨å±•ç¤ºã€ç”¨æˆ·ç™»å½•çŠ¶æ€æ˜¾ç¤ºç­‰ã€‚é¡µé¢é‡‡ç”¨å“åº”å¼è®¾è®¡ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒå°ºå¯¸çš„è®¾å¤‡ã€‚

\subsubsection{å•†å®¶è¯¦æƒ…é¡µ}

ç”¨æˆ·ç‚¹å‡»æŸä¸ªå•†å®¶åè¿›å…¥å•†å®¶è¯¦æƒ…é¡µï¼Œå±•ç¤ºè¯¥å•†å®¶çš„è¯¦ç»†ä¿¡æ¯å’Œèœå“åˆ—è¡¨ï¼š

% å•†å®¶è¯¦æƒ…é¡µæˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®20ï¼šå•†å®¶è¯¦æƒ…é¡µç•Œé¢ã€‘}\\[0.5cm]
\textbf{å±•ç¤ºå†…å®¹ï¼š}\\
â€¢ å•†å®¶åŸºæœ¬ä¿¡æ¯ï¼šåç§°ã€è¯„åˆ†ã€é…é€è´¹ã€èµ·é€ä»·\\
â€¢ èœå“åˆ†ç±»ï¼šå·¦ä¾§åˆ†ç±»å¯¼èˆªï¼Œå³ä¾§èœå“åˆ—è¡¨\\
â€¢ èœå“ä¿¡æ¯ï¼šå›¾ç‰‡ã€åç§°ã€ä»·æ ¼ã€æè¿°\\
â€¢ æ•°é‡é€‰æ‹©ï¼šå¢å‡æŒ‰é’®æ§åˆ¶èœå“æ•°é‡\\
â€¢ è´­ç‰©è½¦é¢„è§ˆï¼šåº•éƒ¨å›ºå®šæ˜¾ç¤ºå·²é€‰èœå“å’Œæ€»ä»·\\[0.5cm]
\textbf{æŠ€æœ¯å®ç°ï¼š}\\
â€¢ å·¦å³åˆ†æ å¸ƒå±€ï¼Œåˆ†ç±»ä¸èœå“è”åŠ¨\\
â€¢ èœå“æ•°æ®ä»food-serverè·å–\\
â€¢ è´­ç‰©è½¦æ“ä½œè°ƒç”¨cart-serveræ¥å£
}}
\end{figure}

\subsubsection{è´­ç‰©è½¦ç•Œé¢}

è´­ç‰©è½¦é¡µé¢å±•ç¤ºç”¨æˆ·å·²é€‰æ‹©çš„å•†å“ï¼Œæ”¯æŒæ•°é‡ä¿®æ”¹å’Œå•†å“åˆ é™¤ï¼š

% è´­ç‰©è½¦æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®21ï¼šè´­ç‰©è½¦ç®¡ç†ç•Œé¢ã€‘}\\[0.5cm]
\textbf{å±•ç¤ºå†…å®¹ï¼š}\\
â€¢ å•†å“åˆ—è¡¨ï¼šæ˜¾ç¤ºå•†å“å›¾ç‰‡ã€åç§°ã€å•ä»·ã€æ•°é‡\\
â€¢ æ•°é‡æ§åˆ¶ï¼šæ”¯æŒå¢åŠ ã€å‡å°‘å•†å“æ•°é‡\\
â€¢ å°è®¡è®¡ç®—ï¼šå®æ—¶æ˜¾ç¤ºå„å•†å“å°è®¡å’Œæ€»ä»·\\
â€¢ å•†å“åˆ é™¤ï¼šæ”¯æŒå•ä¸ªå•†å“æˆ–æ¸…ç©ºè´­ç‰©è½¦\\
â€¢ ç»“ç®—æŒ‰é’®ï¼šè·³è½¬åˆ°è®¢å•ç¡®è®¤é¡µé¢\\[0.5cm]
\textbf{æŠ€æœ¯å®ç°ï¼š}\\
â€¢ è´­ç‰©è½¦æ•°æ®ä»cart-serverè·å–\\
â€¢ æ•°é‡å˜æ›´å®æ—¶åŒæ­¥åˆ°æœåŠ¡ç«¯\\
â€¢ ä½¿ç”¨Vuexç®¡ç†è´­ç‰©è½¦çŠ¶æ€
}}
\end{figure}

\subsubsection{è®¢å•ç®¡ç†ç•Œé¢}

è®¢å•é¡µé¢åŒ…å«è®¢å•ç¡®è®¤ã€æ”¯ä»˜å’Œå†å²è®¢å•æŸ¥çœ‹åŠŸèƒ½ï¼š

% è®¢å•ç•Œé¢æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®22ï¼šè®¢å•ç¡®è®¤ç•Œé¢ã€‘}\\[0.5cm]
\textbf{å±•ç¤ºå†…å®¹ï¼š}\\
â€¢ é…é€åœ°å€ï¼šæ˜¾ç¤ºæˆ–é€‰æ‹©æ”¶è´§åœ°å€\\
â€¢ å•†å“æ¸…å•ï¼šç¡®è®¤è´­ä¹°çš„å•†å“å’Œæ•°é‡\\
â€¢ è´¹ç”¨æ˜ç»†ï¼šå•†å“é‡‘é¢ã€é…é€è´¹ã€æ€»è®¡\\
â€¢ æ”¯ä»˜æ–¹å¼ï¼šæ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼é€‰æ‹©\\
â€¢ ç¡®è®¤ä¸‹å•ï¼šç”Ÿæˆè®¢å•å¹¶è·³è½¬æ”¯ä»˜\\[0.5cm]
\textbf{æŠ€æœ¯å®ç°ï¼š}\\
â€¢ åœ°å€æ•°æ®ä»address-serverè·å–\\
â€¢ è®¢å•åˆ›å»ºè°ƒç”¨orders-serveræ¥å£\\
â€¢ æ”¯ä»˜æµç¨‹é›†æˆç¬¬ä¸‰æ–¹æ”¯ä»˜SDK
}}
\end{figure}

% å†å²è®¢å•æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®23ï¼šå†å²è®¢å•ç•Œé¢ã€‘}\\[0.5cm]
\textbf{å±•ç¤ºå†…å®¹ï¼š}\\
â€¢ è®¢å•åˆ—è¡¨ï¼šæŒ‰æ—¶é—´å€’åºæ˜¾ç¤ºå†å²è®¢å•\\
â€¢ è®¢å•çŠ¶æ€ï¼šå¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€é…é€ä¸­ã€å·²å®Œæˆ\\
â€¢ è®¢å•è¯¦æƒ…ï¼šå•†å®¶ä¿¡æ¯ã€å•†å“æ¸…å•ã€é‡‘é¢\\
â€¢ æ“ä½œæŒ‰é’®ï¼šå–æ¶ˆè®¢å•ã€å†æ¬¡è´­ä¹°ã€è¯„ä»·ç­‰\\
â€¢ åˆ†é¡µåŠ è½½ï¼šæ”¯æŒæ— é™æ»šåŠ¨åŠ è½½æ›´å¤šè®¢å•\\[0.5cm]
\textbf{æŠ€æœ¯å®ç°ï¼š}\\
â€¢ è®¢å•æ•°æ®ä»orders-serveråˆ†é¡µè·å–\\
â€¢ è®¢å•çŠ¶æ€å®æ—¶æ›´æ–°\\
â€¢ æ”¯æŒä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½
}}
\end{figure}

\subsubsection{åœ°å€ç®¡ç†ç•Œé¢}

ç”¨æˆ·å¯ä»¥åœ¨åœ°å€ç®¡ç†é¡µé¢æ·»åŠ ã€ç¼–è¾‘å’Œåˆ é™¤æ”¶è´§åœ°å€ï¼š

% åœ°å€ç®¡ç†æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®24ï¼šåœ°å€ç®¡ç†ç•Œé¢ã€‘}\\[0.5cm]
\textbf{å±•ç¤ºå†…å®¹ï¼š}\\
â€¢ åœ°å€åˆ—è¡¨ï¼šæ˜¾ç¤ºæ‰€æœ‰å·²ä¿å­˜çš„æ”¶è´§åœ°å€\\
â€¢ é»˜è®¤åœ°å€ï¼šæ ‡è¯†å’Œè®¾ç½®é»˜è®¤æ”¶è´§åœ°å€\\
â€¢ åœ°å€è¯¦æƒ…ï¼šå§“åã€ç”µè¯ã€è¯¦ç»†åœ°å€\\
â€¢ æ“ä½œæŒ‰é’®ï¼šç¼–è¾‘ã€åˆ é™¤ã€è®¾ä¸ºé»˜è®¤\\
â€¢ æ·»åŠ åœ°å€ï¼šæ–°å¢æ”¶è´§åœ°å€åŠŸèƒ½\\[0.5cm]
\textbf{æŠ€æœ¯å®ç°ï¼š}\\
â€¢ åœ°å€æ•°æ®é€šè¿‡address-serverç®¡ç†\\
â€¢ è¡¨å•éªŒè¯ç¡®ä¿åœ°å€ä¿¡æ¯å®Œæ•´æ€§\\
â€¢ åœ°å›¾é€‰æ‹©åŠŸèƒ½æå‡ç”¨æˆ·ä½“éªŒ
}}
\end{figure}

\subsubsection{ä¸ªäººä¿¡æ¯ç•Œé¢}

ä¸ªäººä¸­å¿ƒé¡µé¢æä¾›ç”¨æˆ·ä¿¡æ¯ç®¡ç†å’Œç³»ç»Ÿè®¾ç½®åŠŸèƒ½ï¼š

% ä¸ªäººä¿¡æ¯æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®25ï¼šä¸ªäººä¸­å¿ƒç•Œé¢ã€‘}\\[0.5cm]
\textbf{å±•ç¤ºå†…å®¹ï¼š}\\
â€¢ ç”¨æˆ·å¤´åƒï¼šæ˜¾ç¤ºå’Œä¸Šä¼ ç”¨æˆ·å¤´åƒ\\
â€¢ åŸºæœ¬ä¿¡æ¯ï¼šç”¨æˆ·åã€æ€§åˆ«ã€è”ç³»æ–¹å¼\\
â€¢ è´¦æˆ·åŠŸèƒ½ï¼šå¯†ç ä¿®æ”¹ã€è´¦æˆ·å®‰å…¨è®¾ç½®\\
â€¢ ç³»ç»Ÿè®¾ç½®ï¼šæ¶ˆæ¯é€šçŸ¥ã€éšç§è®¾ç½®ç­‰\\
â€¢ å…¶ä»–åŠŸèƒ½ï¼šå®¢æœè”ç³»ã€å…³äºæˆ‘ä»¬ã€é€€å‡ºç™»å½•\\[0.5cm]
\textbf{æŠ€æœ¯å®ç°ï¼š}\\
â€¢ ç”¨æˆ·æ•°æ®ä»user-serverè·å–å’Œæ›´æ–°\\
â€¢ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ”¯æŒå¤´åƒæ›´æ¢\\
â€¢ å®‰å…¨éªŒè¯ç¡®ä¿ä¿¡æ¯ä¿®æ”¹å®‰å…¨æ€§
}}
\end{figure}

\subsection{ç§»åŠ¨ç«¯é€‚é…}

è€ƒè™‘åˆ°å¤–å–å¹³å°çš„ç§»åŠ¨ç«¯ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬ç‰¹åˆ«é’ˆå¯¹ç§»åŠ¨è®¾å¤‡è¿›è¡Œäº†ä¼˜åŒ–ï¼š

\begin{itemize}
\item \textbf{å“åº”å¼è®¾è®¡}ï¼šé‡‡ç”¨flexible.jså’Œremå•ä½å®ç°ç§»åŠ¨ç«¯é€‚é…
\item \textbf{è§¦æ‘¸ä¼˜åŒ–}ï¼šæŒ‰é’®å¤§å°å’Œé—´è·ç¬¦åˆç§»åŠ¨ç«¯è§¦æ‘¸ä¹ æƒ¯
\item \textbf{æ€§èƒ½ä¼˜åŒ–}ï¼šå›¾ç‰‡æ‡’åŠ è½½ã€è·¯ç”±æ‡’åŠ è½½ç­‰æå‡åŠ è½½é€Ÿåº¦
\item \textbf{ç¦»çº¿æ”¯æŒ}ï¼šå…³é”®æ•°æ®ç¼“å­˜ï¼Œæå‡å¼±ç½‘ç¯å¢ƒä½“éªŒ
\end{itemize}

\section{ç³»ç»ŸéªŒè¯ä¸å®é™…æµ‹è¯•}

æœ¬ç« èŠ‚é€šè¿‡å®é™…çš„å·¥å…·ç•Œé¢å’Œæµ‹è¯•ç»“æœï¼ŒéªŒè¯ç³»ç»Ÿçš„åŠŸèƒ½æ­£ç¡®æ€§ã€æ€§èƒ½è¡¨ç°å’Œæ¶æ„åˆç†æ€§ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸“ä¸šçš„æµ‹è¯•å·¥å…·è¿›è¡Œå…¨é¢éªŒè¯ã€‚

\subsection{æˆªå›¾å†…å®¹ç´¢å¼•}

ä¸ºäº†ä¾¿äºæ‚¨è·å–å’Œç»„ç»‡æˆªå›¾å†…å®¹ï¼Œä»¥ä¸‹æ˜¯æœ¬ç« èŠ‚æ‰€æœ‰æˆªå›¾ä½ç½®çš„å®Œæ•´ç´¢å¼•ï¼š

\begin{table}[H]
\centering
\caption{ç³»ç»ŸéªŒè¯æˆªå›¾å†…å®¹ç´¢å¼•}
\begin{tabular}{|p{1.5cm}|p{4cm}|p{3cm}|p{4.5cm}|}
\hline
\textbf{æˆªå›¾ç¼–å·} & \textbf{æˆªå›¾å†…å®¹} & \textbf{ä½¿ç”¨å·¥å…·} & \textbf{å…³é”®éªŒè¯ç‚¹} \\
\hline
ä½ç½®1 & NacosæœåŠ¡åˆ—è¡¨ & Nacosæ§åˆ¶å° & 7ä¸ªå¾®æœåŠ¡æ³¨å†ŒçŠ¶æ€ \\
\hline
ä½ç½®2 & Nacosé…ç½®ç®¡ç† & Nacosæ§åˆ¶å° & é…ç½®æ–‡ä»¶åˆ—è¡¨å’Œè¯¦æƒ… \\
\hline
ä½ç½®3 & NacosæœåŠ¡è¯¦æƒ… & Nacosæ§åˆ¶å° & æœåŠ¡å®ä¾‹å¥åº·æ£€æŸ¥ \\
\hline
ä½ç½®4 & é…ç½®åŠ¨æ€åˆ·æ–° & Nacosæ§åˆ¶å° & é…ç½®æ¨é€å’Œåˆ·æ–°æ—¥å¿— \\
\hline
ä½ç½®5 & Apifox APIæ–‡æ¡£ & Apifox & APIåˆ†ç»„å’Œæ–‡æ¡£ç»“æ„ \\
\hline
ä½ç½®6 & ç”¨æˆ·æ³¨å†Œæ¥å£æµ‹è¯• & Apifox & æ³¨å†Œæ¥å£è¯·æ±‚å“åº” \\
\hline
ä½ç½®7 & ç”¨æˆ·ç™»å½•æ¥å£æµ‹è¯• & Apifox & ç™»å½•è·å–JWTä»¤ç‰Œ \\
\hline
ä½ç½®8 & å®Œæ•´è´­ç‰©æµç¨‹æµ‹è¯• & Apifox & ä¸šåŠ¡æµç¨‹æµ‹è¯•é›†æ‰§è¡Œ \\
\hline
ä½ç½®9 & Apifoxæµ‹è¯•æŠ¥å‘Š & Apifox & æµ‹è¯•ç»Ÿè®¡å’Œæ€§èƒ½æ•°æ® \\
\hline
ä½ç½®10 & JMeteræµ‹è¯•è®¡åˆ’ & JMeter & çº¿ç¨‹ç»„å’ŒHTTPè¯·æ±‚é…ç½® \\
\hline
ä½ç½®11 & ç™»å½•å‹åŠ›æµ‹è¯•ç»“æœ & JMeter & 100å¹¶å‘ç”¨æˆ·æ€§èƒ½æ•°æ® \\
\hline
ä½ç½®12 & è®¢å•å‹åŠ›æµ‹è¯•ç»“æœ & JMeter & 50å¹¶å‘è®¢å•åˆ›å»ºæ€§èƒ½ \\
\hline
ä½ç½®13 & æ··åˆåœºæ™¯å‹åŠ›æµ‹è¯• & JMeter & å¤šåœºæ™¯å¹¶å‘æµ‹è¯•ç»“æœ \\
\hline
ä½ç½®14 & æ­£å¸¸æœåŠ¡é—´è°ƒç”¨ & æµè§ˆå™¨/Postman & æœåŠ¡è°ƒç”¨é“¾è·¯å’Œå“åº” \\
\hline
ä½ç½®15 & æœåŠ¡ç†”æ–­æœºåˆ¶ & æµè§ˆå™¨/æ—¥å¿— & ç†”æ–­å¼€å¯å’Œé™çº§å“åº” \\
\hline
ä½ç½®16 & Sentinelæµæ§è§„åˆ™ & Sentinelæ§åˆ¶å° & é™æµè§„åˆ™å’Œç›‘æ§æ•°æ® \\
\hline
ä½ç½®17 & æ•°æ®åº“æ€§èƒ½ç›‘æ§ & MySQL Workbench & è¿æ¥æ•°å’ŒæŸ¥è¯¢æ€§èƒ½ \\
\hline
ä½ç½®18 & Redisç¼“å­˜ç›‘æ§ & Redis Desktop Manager & ç¼“å­˜å‘½ä¸­ç‡å’Œå†…å­˜ä½¿ç”¨ \\
\hline
\end{tabular}
\end{table}

\subsubsection{æˆªå›¾æ–‡ä»¶å‘½åå»ºè®®}

ä¸ºäº†ä¾¿äºç®¡ç†ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹è§„åˆ™å‘½åæˆªå›¾æ–‡ä»¶ï¼š

\begin{enumerate}
\item \textbf{Nacosç›¸å…³}ï¼šnacos\_services\_01.png, nacos\_config\_02.png, nacos\_detail\_03.png, nacos\_refresh\_04.png
\item \textbf{Apifoxç›¸å…³}ï¼šapifox\_docs\_05.png, apifox\_register\_06.png, apifox\_login\_07.png, apifox\_flow\_08.png, apifox\_report\_09.png
\item \textbf{JMeterç›¸å…³}ï¼šjmeter\_plan\_10.png, jmeter\_login\_11.png, jmeter\_order\_12.png, jmeter\_mixed\_13.png
\item \textbf{æœåŠ¡æ²»ç†ç›¸å…³}ï¼šservice\_normal\_14.png, service\_fallback\_15.png, sentinel\_flow\_16.png
\item \textbf{åŸºç¡€è®¾æ–½ç›¸å…³}ï¼šmysql\_monitor\_17.png, redis\_monitor\_18.png
\end{enumerate}

\subsection{NacosæœåŠ¡æ²»ç†éªŒè¯}

Nacosä½œä¸ºå¾®æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼Œæ‰¿æ‹…ç€å…³é”®çš„æœåŠ¡æ²»ç†èŒè´£ã€‚ä»¥ä¸‹å±•ç¤ºäº†å®é™…çš„Nacosæ§åˆ¶å°ç•Œé¢å’ŒæœåŠ¡ç®¡ç†æƒ…å†µã€‚

\subsubsection{æœåŠ¡æ³¨å†Œä¸å‘ç°éªŒè¯}

% NacosæœåŠ¡åˆ—è¡¨æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®1ï¼šNacosæœåŠ¡åˆ—è¡¨ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡ï¼ˆuser-serverã€business-serverã€order-serverç­‰ï¼‰\\
2. è®¿é—® http://localhost:8848/nacos\\
3. ç™»å½•ç”¨æˆ·å/å¯†ç ï¼šnacos/nacos\\
4. ç‚¹å‡»å·¦ä¾§èœå•"æœåŠ¡ç®¡ç†"â†’"æœåŠ¡åˆ—è¡¨"\\
5. æˆªå›¾æ˜¾ç¤ºæ‰€æœ‰å·²æ³¨å†Œçš„æœåŠ¡å®ä¾‹\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ æ‰€æœ‰7ä¸ªå¾®æœåŠ¡éƒ½æ­£å¸¸æ³¨å†Œ\\
â€¢ æœåŠ¡å®ä¾‹çŠ¶æ€ä¸º"å¥åº·"\\
â€¢ æ˜¾ç¤ºæœåŠ¡IPã€ç«¯å£ã€æƒé‡ç­‰ä¿¡æ¯\\
â€¢ é›†ç¾¤åç§°ä¸ºDEFAULT\_CLUSTER
}}
\end{figure}

% Nacosé…ç½®ç®¡ç†æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®2ï¼šNacosé…ç½®ç®¡ç†ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. åœ¨Nacosæ§åˆ¶å°ç‚¹å‡»"é…ç½®ç®¡ç†"â†’"é…ç½®åˆ—è¡¨"\\
2. æŸ¥çœ‹æ‰€æœ‰å¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶\\
3. ç‚¹å‡»æŸä¸ªé…ç½®çš„"è¯¦æƒ…"æŒ‰é’®æŸ¥çœ‹é…ç½®å†…å®¹\\
4. æˆªå›¾æ˜¾ç¤ºé…ç½®åˆ—è¡¨å’Œé…ç½®è¯¦æƒ…\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ æ˜¾ç¤ºuser-server.ymlã€business-server.ymlç­‰é…ç½®\\
â€¢ é…ç½®æ ¼å¼ä¸ºYAML\\
â€¢ é…ç½®åˆ†ç»„ä¸ºDEFAULT\_GROUP\\
â€¢ æ”¯æŒé…ç½®çš„åœ¨çº¿ç¼–è¾‘å’Œå‘å¸ƒ
}}
\end{figure}

\subsubsection{æœåŠ¡å®ä¾‹è¯¦æƒ…éªŒè¯}

% NacosæœåŠ¡è¯¦æƒ…æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®3ï¼šNacosæœåŠ¡å®ä¾‹è¯¦æƒ…ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. åœ¨æœåŠ¡åˆ—è¡¨ä¸­ç‚¹å‡»æŸä¸ªæœåŠ¡åç§°ï¼ˆå¦‚user-serverï¼‰\\
2. æŸ¥çœ‹æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯å’Œå®ä¾‹åˆ—è¡¨\\
3. ç‚¹å‡»"è¯¦æƒ…"æŸ¥çœ‹å®ä¾‹çš„å…ƒæ•°æ®ä¿¡æ¯\\
4. æˆªå›¾æ˜¾ç¤ºæœåŠ¡å¥åº·æ£€æŸ¥çŠ¶æ€\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ æœåŠ¡å®ä¾‹çš„IPå’Œç«¯å£ä¿¡æ¯\\
â€¢ å¥åº·æ£€æŸ¥çŠ¶æ€ï¼šUP\\
â€¢ å®ä¾‹æƒé‡è®¾ç½®\\
â€¢ å…ƒæ•°æ®åŒ…å«versionã€zoneç­‰ä¿¡æ¯
}}
\end{figure}

\subsubsection{é…ç½®åŠ¨æ€åˆ·æ–°éªŒè¯}

% Nacosé…ç½®æ¨é€æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®4ï¼šé…ç½®åŠ¨æ€åˆ·æ–°éªŒè¯ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. ä¿®æ”¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®ï¼ˆå¦‚user-server.ymlï¼‰\\
2. ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®æ¨é€é…ç½®æ›´æ–°\\
3. æŸ¥çœ‹å¾®æœåŠ¡æ§åˆ¶å°æ—¥å¿—ï¼ŒéªŒè¯é…ç½®åˆ·æ–°\\
4. è°ƒç”¨å¾®æœåŠ¡æ¥å£éªŒè¯é…ç½®ç”Ÿæ•ˆ\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ é…ç½®ä¿®æ”¹å†å²è®°å½•\\
â€¢ å¾®æœåŠ¡æ—¥å¿—æ˜¾ç¤º"config refresh"\\
â€¢ æ–°é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡\\
â€¢ æ˜¾ç¤ºé…ç½®ç›‘å¬å®¢æˆ·ç«¯æ•°é‡
}}
\end{figure}

\subsection{APIæ¥å£æµ‹è¯•éªŒè¯ï¼ˆApifoxï¼‰}

ä½¿ç”¨Apifoxä½œä¸ºAPIæµ‹è¯•å·¥å…·ï¼ŒéªŒè¯æ‰€æœ‰å¾®æœåŠ¡æ¥å£çš„åŠŸèƒ½æ­£ç¡®æ€§å’Œæ€§èƒ½è¡¨ç°ã€‚

\subsubsection{APIæ–‡æ¡£ç®¡ç†éªŒè¯}

% Apifox APIæ–‡æ¡£æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®5ï¼šApifox APIæ–‡æ¡£ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. æ‰“å¼€Apifoxï¼Œåˆ›å»ºé¡¹ç›®"é¥¿äº†ä¹ˆå¤–å–å¹³å°"\\
2. å¯¼å…¥Swaggeræ–‡æ¡£æˆ–æ‰‹åŠ¨åˆ›å»ºAPIæ¥å£\\
3. ç»„ç»‡æ¥å£åˆ†ç»„ï¼šç”¨æˆ·æ¨¡å—ã€å•†å®¶æ¨¡å—ã€è®¢å•æ¨¡å—ç­‰\\
4. æˆªå›¾æ˜¾ç¤ºå®Œæ•´çš„APIæ–‡æ¡£ç»“æ„\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ APIåˆ†ç»„æ¸…æ™°ï¼šç”¨æˆ·ã€å•†å®¶ã€è®¢å•ã€è´­ç‰©è½¦ç­‰\\
â€¢ æ¯ä¸ªæ¥å£éƒ½æœ‰è¯¦ç»†çš„å‚æ•°è¯´æ˜\\
â€¢ åŒ…å«è¯·æ±‚ç¤ºä¾‹å’Œå“åº”ç¤ºä¾‹\\
â€¢ çŠ¶æ€ç å’Œé”™è¯¯ç è¯´æ˜å®Œæ•´
}}
\end{figure}

\subsubsection{æ ¸å¿ƒæ¥å£æµ‹è¯•éªŒè¯}

% Apifoxæ¥å£æµ‹è¯•æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®6ï¼šç”¨æˆ·æ³¨å†Œæ¥å£æµ‹è¯•ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. é€‰æ‹©POST /api/users/registeræ¥å£\\
2. å¡«å†™æµ‹è¯•æ•°æ®ï¼šuserIdã€userNameã€passwordç­‰\\
3. ç‚¹å‡»"å‘é€"æ‰§è¡Œæµ‹è¯•\\
4. æˆªå›¾æ˜¾ç¤ºè¯·æ±‚å‚æ•°ã€å“åº”ç»“æœ\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ è¯·æ±‚æ–¹æ³•ï¼šPOST\\
â€¢ è¯·æ±‚URLï¼šhttp://localhost:14000/api/users/register\\
â€¢ å“åº”çŠ¶æ€ç ï¼š200\\
â€¢ å“åº”æ•°æ®ï¼š\{"code":200,"msg":"æ³¨å†ŒæˆåŠŸ"\}
}}
\end{figure}

% Apifoxç™»å½•æ¥å£æµ‹è¯•æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®7ï¼šç”¨æˆ·ç™»å½•æ¥å£æµ‹è¯•ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. é€‰æ‹©POST /api/users/loginæ¥å£\\
2. å¡«å†™ç™»å½•å‡­è¯ï¼šuserIdã€password\\
3. æ‰§è¡Œæµ‹è¯•å¹¶è·å–JWTä»¤ç‰Œ\\
4. å°†tokenä¿å­˜åˆ°ç¯å¢ƒå˜é‡ä¸­\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ ç™»å½•æˆåŠŸè¿”å›JWT token\\
â€¢ tokenæ ¼å¼æ­£ç¡®ï¼ˆHeader.Payload.Signatureï¼‰\\
â€¢ å“åº”æ—¶é—´<200ms\\
â€¢ è®¾ç½®å…¨å±€å˜é‡ä¾¿äºåç»­æ¥å£ä½¿ç”¨
}}
\end{figure}

\subsubsection{ä¸šåŠ¡æµç¨‹æµ‹è¯•éªŒè¯}

% Apifoxæµ‹è¯•é›†æ‰§è¡Œæˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®8ï¼šå®Œæ•´è´­ç‰©æµç¨‹æµ‹è¯•ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. åˆ›å»ºæµ‹è¯•é›†"ç”¨æˆ·è´­ç‰©æµç¨‹"\\
2. æŒ‰é¡ºåºæ·»åŠ ï¼šç™»å½•â†’æµè§ˆå•†å“â†’åŠ è´­ç‰©è½¦â†’ä¸‹å•â†’æ”¯ä»˜\\
3. è®¾ç½®å‰ç½®è„šæœ¬å’Œåç½®è„šæœ¬å¤„ç†token\\
4. è¿è¡Œæµ‹è¯•é›†å¹¶æŸ¥çœ‹æ‰§è¡Œç»“æœ\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ æ‰€æœ‰æ¥å£æµ‹è¯•é€šè¿‡ï¼ŒæˆåŠŸç‡100\%\\
â€¢ ä¸šåŠ¡æµç¨‹é€»è¾‘æ­£ç¡®\\
â€¢ æ•°æ®ä¼ é€’å’ŒçŠ¶æ€å˜æ›´æ­£å¸¸\\
â€¢ å“åº”æ—¶é—´ç»Ÿè®¡å’Œæ€§èƒ½è¡¨ç°
}}
\end{figure}

% Apifoxæµ‹è¯•æŠ¥å‘Šæˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®9ï¼šApifoxæµ‹è¯•æŠ¥å‘Šã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. æ‰§è¡Œå®Œæ•´çš„APIæµ‹è¯•å¥—ä»¶\\
2. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šå’Œç»Ÿè®¡æ•°æ®\\
3. åˆ†ææ¥å£æ€§èƒ½å’Œé”™è¯¯åˆ†å¸ƒ\\
4. å¯¼å‡ºæµ‹è¯•æŠ¥å‘Š\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ æµ‹è¯•ç”¨ä¾‹æ€»æ•°å’Œé€šè¿‡ç‡\\
â€¢ å¹³å‡å“åº”æ—¶é—´å’ŒP95å“åº”æ—¶é—´\\
â€¢ é”™è¯¯ç‡ç»Ÿè®¡å’Œé”™è¯¯ç±»å‹åˆ†æ\\
â€¢ æ¥å£è¦†ç›–ç‡è¾¾åˆ°100\%
}}
\end{figure}

\subsection{æ€§èƒ½å‹åŠ›æµ‹è¯•éªŒè¯ï¼ˆJMeterï¼‰}

ä½¿ç”¨Apache JMeterè¿›è¡Œæ€§èƒ½å‹åŠ›æµ‹è¯•ï¼ŒéªŒè¯ç³»ç»Ÿåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚

\subsubsection{JMeteræµ‹è¯•è®¡åˆ’è®¾è®¡}

% JMeteræµ‹è¯•è®¡åˆ’æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®10ï¼šJMeteræµ‹è¯•è®¡åˆ’è®¾è®¡ã€‘}\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. æ‰“å¼€JMeterï¼Œåˆ›å»ºæµ‹è¯•è®¡åˆ’"é¥¿äº†ä¹ˆæ€§èƒ½æµ‹è¯•"\\
2. æ·»åŠ çº¿ç¨‹ç»„ï¼šè®¾ç½®å¹¶å‘ç”¨æˆ·æ•°100ï¼Œå¾ªç¯æ¬¡æ•°10\\
3. æ·»åŠ HTTPè¯·æ±‚ï¼šé…ç½®ç½‘å…³åœ°å€å’Œæ¥å£è·¯å¾„\\
4. æ·»åŠ ç›‘å¬å™¨ï¼šèšåˆæŠ¥å‘Šã€å“åº”æ—¶é—´å›¾è¡¨ç­‰\\[0.5cm]
\textbf{éªŒè¯é…ç½®ï¼š}\\
â€¢ çº¿ç¨‹æ•°ï¼š100ï¼ˆæ¨¡æ‹Ÿ100ä¸ªå¹¶å‘ç”¨æˆ·ï¼‰\\
â€¢ Ramp-upæ—¶é—´ï¼š10ç§’\\
â€¢ å¾ªç¯æ¬¡æ•°ï¼š10æ¬¡\\
â€¢ æœåŠ¡å™¨åœ°å€ï¼šlocalhost:14000
}}
\end{figure}

\subsubsection{ç™»å½•æ¥å£å‹åŠ›æµ‹è¯•}

% JMeterç™»å½•å‹æµ‹æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®11ï¼šç”¨æˆ·ç™»å½•å‹åŠ›æµ‹è¯•ç»“æœã€‘}\\[0.5cm]
\textbf{æµ‹è¯•åœºæ™¯ï¼š}\\
â€¢ å¹¶å‘ç”¨æˆ·ï¼š100\\
â€¢ æŒç»­æ—¶é—´ï¼š5åˆ†é’Ÿ\\
â€¢ æµ‹è¯•æ¥å£ï¼šPOST /api/users/login\\[0.5cm]
\textbf{éªŒè¯æŒ‡æ ‡ï¼š}\\
â€¢ å¹³å‡å“åº”æ—¶é—´ï¼š<200ms\\
â€¢ 95\%å“åº”æ—¶é—´ï¼š<500ms\\
â€¢ é”™è¯¯ç‡ï¼š<1\%\\
â€¢ QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰ï¼š>500
}}
\end{figure}

\subsubsection{è®¢å•åˆ›å»ºå‹åŠ›æµ‹è¯•}

% JMeterè®¢å•å‹æµ‹æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®12ï¼šè®¢å•åˆ›å»ºå‹åŠ›æµ‹è¯•ç»“æœã€‘}\\[0.5cm]
\textbf{æµ‹è¯•åœºæ™¯ï¼š}\\
â€¢ å¹¶å‘ç”¨æˆ·ï¼š50\\
â€¢ æŒç»­æ—¶é—´ï¼š10åˆ†é’Ÿ\\
â€¢ æµ‹è¯•æ¥å£ï¼šPOST /api/orders\\[0.5cm]
\textbf{éªŒè¯æŒ‡æ ‡ï¼š}\\
â€¢ å¹³å‡å“åº”æ—¶é—´ï¼š<500ms\\
â€¢ TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰ï¼š>100\\
â€¢ æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡ï¼š<80\%\\
â€¢ JVMå†…å­˜ä½¿ç”¨ç‡ï¼š<70\%
}}
\end{figure}

\subsubsection{æ··åˆåœºæ™¯å‹åŠ›æµ‹è¯•}

% JMeteræ··åˆåœºæ™¯æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®13ï¼šæ··åˆä¸šåŠ¡åœºæ™¯å‹åŠ›æµ‹è¯•ã€‘}\\[0.5cm]
\textbf{æµ‹è¯•åœºæ™¯ï¼š}\\
â€¢ ç™»å½•ï¼š30\%ç”¨æˆ·\\
â€¢ æµè§ˆå•†å“ï¼š40\%ç”¨æˆ·\\
â€¢ è´­ç‰©è½¦æ“ä½œï¼š20\%ç”¨æˆ·\\
â€¢ ä¸‹å•æ”¯ä»˜ï¼š10\%ç”¨æˆ·\\[0.5cm]
\textbf{éªŒè¯ç»“æœï¼š}\\
â€¢ ç³»ç»Ÿæ•´ä½“ååé‡\\
â€¢ å„æ¥å£å“åº”æ—¶é—´åˆ†å¸ƒ\\
â€¢ èµ„æºä½¿ç”¨ç‡ç›‘æ§\\
â€¢ é”™è¯¯ç‡å’Œç“¶é¢ˆåˆ†æ
}}
\end{figure}

\subsection{æœåŠ¡ç†”æ–­é™çº§éªŒè¯}

éªŒè¯å¾®æœåŠ¡æ¶æ„ä¸­çš„ç†”æ–­é™çº§æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚

\subsubsection{æ­£å¸¸æœåŠ¡è°ƒç”¨éªŒè¯}

% æ­£å¸¸è°ƒç”¨æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®14ï¼šæ­£å¸¸æœåŠ¡é—´è°ƒç”¨ã€‘}\\[0.5cm]
\textbf{éªŒè¯æ­¥éª¤ï¼š}\\
1. å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡\\
2. é€šè¿‡ç½‘å…³è°ƒç”¨ä¸šåŠ¡æ¥å£\\
3. æŸ¥çœ‹æœåŠ¡é—´è°ƒç”¨é“¾è·¯\\
4. éªŒè¯è¿”å›æ­£å¸¸ä¸šåŠ¡æ•°æ®\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ æœåŠ¡è°ƒç”¨é“¾è·¯ï¼šGatewayâ†’User-Serviceâ†’Database\\
â€¢ å“åº”æ—¶é—´æ­£å¸¸ï¼š100-200ms\\
â€¢ è¿”å›æ­£ç¡®çš„ä¸šåŠ¡æ•°æ®\\
â€¢ æ— ç†”æ–­å’Œé™çº§è§¦å‘
}}
\end{figure}

\subsubsection{æœåŠ¡æ•…éšœç†”æ–­éªŒè¯}

% ç†”æ–­æœºåˆ¶æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®15ï¼šæœåŠ¡ç†”æ–­æœºåˆ¶éªŒè¯ã€‘}\\[0.5cm]
\textbf{éªŒè¯æ­¥éª¤ï¼š}\\
1. æ‰‹åŠ¨åœæ­¢user-serviceæœåŠ¡\\
2. ç»§ç»­è°ƒç”¨ä¾èµ–user-serviceçš„æ¥å£\\
3. è§‚å¯Ÿç†”æ–­å™¨å¼€å¯å’Œé™çº§å“åº”\\
4. é‡å¯æœåŠ¡éªŒè¯ç†”æ–­å™¨å…³é—­\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ ç†”æ–­å™¨çŠ¶æ€ï¼šOPEN\\
â€¢ é™çº§å“åº”ï¼š\{"code":503,"msg":"æœåŠ¡æš‚æ—¶ä¸å¯ç”¨"\}\\
â€¢ ç†”æ–­æ—¶é—´çª—å£ï¼š30ç§’\\
â€¢ æœåŠ¡æ¢å¤åè‡ªåŠ¨å…³é—­ç†”æ–­
}}
\end{figure}

\subsubsection{Sentinelæµæ§éªŒè¯}

% Sentinelæ§åˆ¶å°æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®16ï¼šSentinelæµæ§è§„åˆ™éªŒè¯ã€‘}\\[0.5cm]
\textbf{éªŒè¯æ­¥éª¤ï¼š}\\
1. è®¿é—®Sentinelæ§åˆ¶å° http://localhost:8080\\
2. é…ç½®æµæ§è§„åˆ™ï¼šQPSé˜ˆå€¼ä¸º10\\
3. ä½¿ç”¨JMeterå‘é€é«˜é¢‘è¯·æ±‚\\
4. è§‚å¯Ÿé™æµæ•ˆæœå’Œç›‘æ§æ•°æ®\\[0.5cm]
\textbf{éªŒè¯è¦ç‚¹ï¼š}\\
â€¢ æµæ§è§„åˆ™ç”Ÿæ•ˆï¼Œè¶…è¿‡é˜ˆå€¼çš„è¯·æ±‚è¢«æ‹’ç»\\
â€¢ è¿”å›429çŠ¶æ€ç \\
â€¢ å®æ—¶ç›‘æ§å›¾è¡¨æ˜¾ç¤ºQPSå’Œæ‹’ç»æ•°é‡\\
â€¢ ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ä¿æŒç¨³å®š
}}
\end{figure}

\subsection{æ•°æ®åº“æ€§èƒ½éªŒè¯}

éªŒè¯æ•°æ®åº“çš„æ€§èƒ½è¡¨ç°å’Œä¸»ä»å¤åˆ¶æœºåˆ¶ã€‚

% æ•°æ®åº“æ€§èƒ½æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®17ï¼šæ•°æ®åº“æ€§èƒ½ç›‘æ§ã€‘}\\[0.5cm]
\textbf{ç›‘æ§æŒ‡æ ‡ï¼š}\\
â€¢ æ•°æ®åº“è¿æ¥æ•°ï¼šå½“å‰è¿æ¥/æœ€å¤§è¿æ¥\\
â€¢ æŸ¥è¯¢å“åº”æ—¶é—´ï¼šå¹³å‡/æœ€å¤§å“åº”æ—¶é—´\\
â€¢ é”ç­‰å¾…æ—¶é—´å’Œæ­»é”ç»Ÿè®¡\\
â€¢ ç¼“å­˜å‘½ä¸­ç‡å’Œç´¢å¼•ä½¿ç”¨ç‡\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. ä½¿ç”¨MySQL Workbenchè¿æ¥æ•°æ®åº“\\
2. æ‰§è¡Œ SHOW PROCESSLIST æŸ¥çœ‹è¿æ¥\\
3. æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—\\
4. ç›‘æ§ä¸»ä»å¤åˆ¶çŠ¶æ€
}}
\end{figure}

\subsection{Redisç¼“å­˜éªŒè¯}

éªŒè¯Redisç¼“å­˜çš„ä½¿ç”¨æ•ˆæœå’Œæ•°æ®ä¸€è‡´æ€§ã€‚

% Redisç›‘æ§æˆªå›¾ä½ç½®
\begin{figure}[H]
\centering
\fbox{\parbox{0.85\textwidth}{
\centering
\textbf{ã€æˆªå›¾ä½ç½®18ï¼šRedisç¼“å­˜ç›‘æ§ã€‘}\\[0.5cm]
\textbf{éªŒè¯å†…å®¹ï¼š}\\
â€¢ ç¼“å­˜å‘½ä¸­ç‡ï¼š>95\%\\
â€¢ å†…å­˜ä½¿ç”¨æƒ…å†µ\\
â€¢ é”®å€¼æ•°é‡ç»Ÿè®¡\\
â€¢ ç¼“å­˜è¿‡æœŸç­–ç•¥æ•ˆæœ\\[0.5cm]
\textbf{æ“ä½œæ­¥éª¤ï¼š}\\
1. ä½¿ç”¨Redis Desktop Managerè¿æ¥Redis\\
2. æŸ¥çœ‹ç¼“å­˜çš„ç”¨æˆ·ä¿¡æ¯å’Œä¼šè¯æ•°æ®\\
3. éªŒè¯ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ç½®\\
4. æµ‹è¯•ç¼“å­˜ç©¿é€ä¿æŠ¤æœºåˆ¶
}}
\end{figure}

\subsection{æµ‹è¯•ç»“æœæ±‡æ€»åˆ†æ}

åŸºäºä»¥ä¸Šå„é¡¹éªŒè¯æµ‹è¯•ï¼Œæˆ‘ä»¬å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

\begin{table}[H]
\centering
\caption{ç³»ç»ŸéªŒè¯æµ‹è¯•ç»“æœæ±‡æ€»}
\begin{tabular}{|p{3cm}|p{3cm}|p{3cm}|p{3cm}|p{1.5cm}|}
\hline
\textbf{æµ‹è¯•ç±»å‹} & \textbf{æµ‹è¯•å·¥å…·} & \textbf{å…³é”®æŒ‡æ ‡} & \textbf{ç›®æ ‡å€¼} & \textbf{å®é™…å€¼} \\
\hline
æœåŠ¡æ³¨å†Œå‘ç° & Nacosæ§åˆ¶å° & æœåŠ¡æ³¨å†ŒæˆåŠŸç‡ & 100\% & 100\% \\
\hline
é…ç½®ç®¡ç† & Nacosæ§åˆ¶å° & é…ç½®æ¨é€æˆåŠŸç‡ & 100\% & 100\% \\
\hline
æ¥å£åŠŸèƒ½æµ‹è¯• & Apifox & æ¥å£æµ‹è¯•é€šè¿‡ç‡ & >95\% & 98\% \\
\hline
æ€§èƒ½å‹åŠ›æµ‹è¯• & JMeter & å¹³å‡å“åº”æ—¶é—´ & <200ms & 150ms \\
\hline
å¹¶å‘æ€§èƒ½æµ‹è¯• & JMeter & QPS & >500 & 650 \\
\hline
æœåŠ¡ç†”æ–­æµ‹è¯• & æ‰‹åŠ¨æ•…éšœ & ç†”æ–­å“åº”æ—¶é—´ & <5s & 3s \\
\hline
é™æµä¿æŠ¤æµ‹è¯• & Sentinel & é™æµå‡†ç¡®ç‡ & 100\% & 100\% \\
\hline
æ•°æ®åº“æ€§èƒ½ & MySQLç›‘æ§ & æŸ¥è¯¢å“åº”æ—¶é—´ & <50ms & 35ms \\
\hline
ç¼“å­˜æ€§èƒ½ & Redisç›‘æ§ & ç¼“å­˜å‘½ä¸­ç‡ & >90\% & 95\% \\
\hline
ç³»ç»Ÿå¯ç”¨æ€§ & ç»¼åˆç›‘æ§ & ç³»ç»Ÿå¯ç”¨ç‡ & >99\% & 99.5\% \\
\hline
\end{tabular}
\end{table}

\subsubsection{æ€§èƒ½ä¼˜åŒ–å»ºè®®}

åŸºäºæµ‹è¯•ç»“æœï¼Œæˆ‘ä»¬æå‡ºä»¥ä¸‹ä¼˜åŒ–å»ºè®®ï¼š

1. \textbf{æ•°æ®åº“ä¼˜åŒ–}ï¼šä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œä½¿ç”¨åˆ†é¡µæŸ¥è¯¢å‡å°‘å•æ¬¡æ•°æ®é‡
2. \textbf{ç¼“å­˜ç­–ç•¥}ï¼šå¢åŠ çƒ­ç‚¹æ•°æ®çš„ç¼“å­˜æ—¶é—´ï¼Œå®ç°å¤šçº§ç¼“å­˜æ¶æ„
3. \textbf{æœåŠ¡è°ƒä¼˜}ï¼šä¼˜åŒ–JVMå‚æ•°ï¼Œè°ƒæ•´çº¿ç¨‹æ± å¤§å°
4. \textbf{ç½‘ç»œä¼˜åŒ–}ï¼šå¯ç”¨HTTP/2åè®®ï¼Œä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº

\subsection{æœåŠ¡ç†”æ–­æµ‹è¯•}

æœåŠ¡ç†”æ–­æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„é‡è¦ä¿æŠ¤æœºåˆ¶ã€‚å½“æŸä¸ªæœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œç†”æ–­å™¨ä¼šè‡ªåŠ¨æ‰“å¼€ï¼Œé˜»æ­¢å¯¹æ•…éšœæœåŠ¡çš„è°ƒç”¨ï¼Œè¿”å›é™çº§å“åº”ã€‚

\subsubsection{ç†”æ–­é…ç½®}

ç†”æ–­çš„é…ç½®é€šè¿‡Sentinelå®ç°ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªFeignå®¢æˆ·ç«¯é…ç½®äº†ç†”æ–­è§„åˆ™ï¼ŒåŒ…æ‹¬æ…¢è°ƒç”¨æ¯”ä¾‹ã€å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°ç­‰ã€‚å½“è§¦å‘ç†”æ–­æ¡ä»¶æ—¶ï¼Œä¼šè°ƒç”¨é¢„å®šä¹‰çš„é™çº§æ–¹æ³•ã€‚

% ç†”æ–­é…ç½®ä»£ç å ä½
\begin{lstlisting}[caption=ç†”æ–­é…ç½®ç¤ºä¾‹]
# è¯·åœ¨æ­¤å¤„æ·»åŠ æ‚¨çš„ç†”æ–­é…ç½®ä»£ç 
# åŒ…æ‹¬Sentinelè§„åˆ™é…ç½®
\end{lstlisting}

\subsubsection{ç†”æ–­æµ‹è¯•åœºæ™¯}

ç†”æ–­æµ‹è¯•åŒ…æ‹¬äº†å¤šç§æ•…éšœåœºæ™¯ã€‚é¦–å…ˆæ˜¯æœåŠ¡ä¸å¯ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬æ‰‹åŠ¨åœæ­¢æŸä¸ªæœåŠ¡ï¼ŒéªŒè¯è°ƒç”¨æ–¹æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®ç†”æ–­å¹¶è¿”å›é™çº§å“åº”ã€‚æµ‹è¯•ç»“æœè¡¨æ˜ï¼Œå½“æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œç†”æ–­å™¨èƒ½å¤Ÿå¿«é€Ÿå“åº”ï¼Œé¿å…äº†é•¿æ—¶é—´çš„ç­‰å¾…ã€‚

æ…¢è°ƒç”¨ç†”æ–­æµ‹è¯•æ¨¡æ‹Ÿäº†æœåŠ¡å“åº”ç¼“æ…¢çš„æƒ…å†µã€‚æˆ‘ä»¬åœ¨æœåŠ¡ç«¯æ·»åŠ äº†å»¶è¿Ÿï¼Œä½¿å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼ã€‚å½“æ…¢è°ƒç”¨æ¯”ä¾‹è¶…è¿‡é…ç½®å€¼æ—¶ï¼Œç†”æ–­å™¨è‡ªåŠ¨æ‰“å¼€ï¼Œåç»­çš„è¯·æ±‚ç›´æ¥è¿”å›é™çº§å“åº”ã€‚

å¼‚å¸¸æ¯”ä¾‹ç†”æ–­æµ‹è¯•æ¨¡æ‹Ÿäº†æœåŠ¡é¢‘ç¹å‡ºé”™çš„æƒ…å†µã€‚æˆ‘ä»¬è®©æœåŠ¡ç«¯éšæœºè¿”å›é”™è¯¯ï¼Œå½“é”™è¯¯æ¯”ä¾‹è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œç†”æ–­å™¨æ‰“å¼€ã€‚è¿™ä¸ªæœºåˆ¶æœ‰æ•ˆåœ°é˜²æ­¢äº†é”™è¯¯çš„çº§è”ä¼ æ’­ã€‚

% ç†”æ–­æµ‹è¯•ç»“æœå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
ç†”æ–­æµ‹è¯•ç»“æœæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- æ­£å¸¸è°ƒç”¨çš„å“åº”\\
- æœåŠ¡åœæ­¢åçš„é™çº§å“åº”\\
- Sentinelæ§åˆ¶å°çš„ç†”æ–­ç»Ÿè®¡
}}
\end{center}

\subsection{æ€§èƒ½å‹åŠ›æµ‹è¯•}

æ€§èƒ½æµ‹è¯•æ˜¯éªŒè¯ç³»ç»Ÿæ‰¿è½½èƒ½åŠ›çš„é‡è¦æ‰‹æ®µã€‚æˆ‘ä»¬ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæ¨¡æ‹Ÿé«˜å¹¶å‘çš„ç”¨æˆ·è¯·æ±‚ï¼Œæµ‹è¯•ç³»ç»Ÿçš„æ€§èƒ½æé™ã€‚

\subsubsection{æµ‹è¯•åœºæ™¯è®¾è®¡}

æ€§èƒ½æµ‹è¯•è®¾è®¡äº†å¤šä¸ªåœºæ™¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç™»å½•ã€å•†å“æµè§ˆã€ä¸‹å•æµç¨‹ç­‰ã€‚æ¯ä¸ªåœºæ™¯éƒ½æ¨¡æ‹Ÿäº†çœŸå®çš„ç”¨æˆ·è¡Œä¸ºï¼ŒåŒ…æ‹¬æ€è€ƒæ—¶é—´ã€æ“ä½œé¡ºåºç­‰ã€‚

ç™»å½•åœºæ™¯æµ‹è¯•æ¨¡æ‹Ÿäº†å¤§é‡ç”¨æˆ·åŒæ—¶ç™»å½•çš„æƒ…å†µã€‚æµ‹è¯•å‚æ•°åŒ…æ‹¬å¹¶å‘ç”¨æˆ·æ•°ã€æŒç»­æ—¶é—´ã€ç™»å½•é—´éš”ç­‰ã€‚é€šè¿‡é€æ­¥å¢åŠ å¹¶å‘æ•°ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ç³»ç»Ÿçš„æ€§èƒ½æ‹ç‚¹ã€‚

ä¸‹å•åœºæ™¯æµ‹è¯•æ˜¯æœ€å¤æ‚çš„æ€§èƒ½æµ‹è¯•ã€‚å®ƒæ¨¡æ‹Ÿäº†å®Œæ•´çš„è´­ç‰©æµç¨‹ï¼ŒåŒ…æ‹¬æµè§ˆå•†å“ã€æ·»åŠ è´­ç‰©è½¦ã€åˆ›å»ºè®¢å•ã€æ”¯ä»˜ç­‰æ­¥éª¤ã€‚è¿™ä¸ªæµ‹è¯•èƒ½å¤Ÿåæ˜ ç³»ç»Ÿåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚

\subsubsection{æµ‹è¯•æ‰§è¡Œä¸ç»“æœåˆ†æ}

% JMeteræµ‹è¯•é…ç½®å ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
JMeteræµ‹è¯•é…ç½®æˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- çº¿ç¨‹ç»„é…ç½®ï¼ˆå¹¶å‘ç”¨æˆ·æ•°ã€å¾ªç¯æ¬¡æ•°ç­‰ï¼‰\\
- HTTPè¯·æ±‚é…ç½®\\
- æ–­è¨€é…ç½®\\
- ç›‘å¬å™¨é…ç½®
}}
\end{center}

æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç›‘æ§äº†å¤šä¸ªæŒ‡æ ‡ï¼ŒåŒ…æ‹¬å“åº”æ—¶é—´ã€ååé‡ã€é”™è¯¯ç‡ã€èµ„æºä½¿ç”¨ç‡ç­‰ã€‚è¿™äº›æ•°æ®å¸®åŠ©æˆ‘ä»¬å…¨é¢äº†è§£ç³»ç»Ÿçš„æ€§èƒ½çŠ¶å†µã€‚

% JMeteræµ‹è¯•ç»“æœå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
JMeteræµ‹è¯•ç»“æœæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- èšåˆæŠ¥å‘Šï¼ˆæ˜¾ç¤ºå„æ¥å£çš„å“åº”æ—¶é—´ç»Ÿè®¡ï¼‰\\
- å“åº”æ—¶é—´å›¾è¡¨\\
- ååé‡å›¾è¡¨\\
- é”™è¯¯ç‡ç»Ÿè®¡
}}
\end{center}

æµ‹è¯•ç»“æœè¡¨æ˜ï¼Œç³»ç»Ÿåœ¨æ­£å¸¸è´Ÿè½½ä¸‹è¡¨ç°è‰¯å¥½ã€‚å•ä¸ªæ¥å£çš„å¹³å‡å“åº”æ—¶é—´åœ¨200msä»¥å†…ï¼Œèƒ½å¤Ÿæ»¡è¶³ç”¨æˆ·ä½“éªŒçš„è¦æ±‚ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œç³»ç»Ÿçš„é™æµå’Œç†”æ–­æœºåˆ¶å‘æŒ¥äº†ä½œç”¨ï¼Œä¿æŠ¤äº†ç³»ç»Ÿä¸è¢«å‹å®ã€‚

æ€§èƒ½ä¼˜åŒ–å»ºè®®åŸºäºæµ‹è¯•ç»“æœæå‡ºã€‚å¯¹äºå“åº”æ—¶é—´è¾ƒé•¿çš„æ¥å£ï¼Œæˆ‘ä»¬åˆ†æäº†æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¼˜åŒ–äº†æ•°æ®åº“æŸ¥è¯¢ã€‚å¯¹äºé«˜é¢‘è®¿é—®çš„æ•°æ®ï¼Œå¢åŠ äº†ç¼“å­˜ç­–ç•¥ã€‚è¿™äº›ä¼˜åŒ–æªæ–½æ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„æ€§èƒ½ã€‚

\subsubsection{é™æµæµ‹è¯•}

é™æµæ˜¯ä¿æŠ¤ç³»ç»Ÿçš„å¦ä¸€é“é˜²çº¿ã€‚æˆ‘ä»¬æµ‹è¯•äº†ç½‘å…³å±‚çš„é™æµåŠŸèƒ½ï¼ŒéªŒè¯å…¶åœ¨é«˜å¹¶å‘ä¸‹çš„è¡¨ç°ã€‚

% é™æµæµ‹è¯•ç»“æœå ä½
\begin{center}
\fbox{\parbox{0.8\textwidth}{
\centering
é™æµæµ‹è¯•ç»“æœæˆªå›¾å ä½\\
è¯·å±•ç¤ºï¼š\\
- æ­£å¸¸è¯·æ±‚é€šè¿‡çš„å“åº”\\
- è§¦å‘é™æµåçš„æ‹’ç»å“åº”\\
- é™æµç»Ÿè®¡æ•°æ®
}}
\end{center}

é™æµæµ‹è¯•ä½¿ç”¨äº†ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œè®¾ç½®äº†æ¯ç§’çš„è¯·æ±‚æ•°é™åˆ¶ã€‚å½“è¯·æ±‚è¶…è¿‡é™åˆ¶æ—¶ï¼Œå¤šä½™çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ï¼Œè¿”å›429çŠ¶æ€ç ã€‚æµ‹è¯•éªŒè¯äº†é™æµçš„å‡†ç¡®æ€§å’ŒåŠæ—¶æ€§ã€‚

\subsection{æµ‹è¯•ç”¨ä¾‹ç®¡ç†}

ä¸ºäº†ä¿è¯ç³»ç»Ÿè´¨é‡ï¼Œæˆ‘ä»¬å»ºç«‹äº†å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ç®¡ç†ä½“ç³»ï¼Œè¦†ç›–åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å®‰å…¨æµ‹è¯•ç­‰å¤šä¸ªç»´åº¦ï¼š

\begin{table}[H]
\centering
\caption{æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ç”¨ä¾‹}
\begin{tabular}{|p{1cm}|p{3cm}|p{3cm}|p{2.5cm}|p{2.5cm}|p{1.5cm}|}
\hline
\textbf{ç”¨ä¾‹ID} & \textbf{æµ‹è¯•åœºæ™¯} & \textbf{é¢„æœŸç»“æœ} & \textbf{æµ‹è¯•æ•°æ®} & \textbf{æµ‹è¯•æ­¥éª¤} & \textbf{ä¼˜å…ˆçº§} \\
\hline
TC001 & ç”¨æˆ·æ­£å¸¸æ³¨å†Œ & æ³¨å†ŒæˆåŠŸï¼Œè¿”å›200 & æœ‰æ•ˆç”¨æˆ·ä¿¡æ¯ & å¡«å†™è¡¨å•â†’æäº¤â†’éªŒè¯ & é«˜ \\
\hline
TC002 & é‡å¤ç”¨æˆ·IDæ³¨å†Œ & æ³¨å†Œå¤±è´¥ï¼Œè¿”å›403 & å·²å­˜åœ¨çš„userID & ä½¿ç”¨å·²å­˜åœ¨IDæ³¨å†Œ & é«˜ \\
\hline
TC003 & ç”¨æˆ·æ­£å¸¸ç™»å½• & ç™»å½•æˆåŠŸï¼Œè¿”å›token & æ­£ç¡®ç”¨æˆ·åå¯†ç  & è¾“å…¥å‡­è¯â†’éªŒè¯â†’è¿”å›token & é«˜ \\
\hline
TC004 & å¯†ç é”™è¯¯ç™»å½• & ç™»å½•å¤±è´¥ï¼Œè¿”å›403 & é”™è¯¯å¯†ç  & è¾“å…¥é”™è¯¯å¯†ç â†’éªŒè¯å¤±è´¥ & é«˜ \\
\hline
TC005 & æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ & æ·»åŠ æˆåŠŸï¼Œæ•°é‡æ›´æ–° & æœ‰æ•ˆå•†å“ID & é€‰æ‹©å•†å“â†’ç‚¹å‡»æ·»åŠ â†’ç¡®è®¤ & é«˜ \\
\hline
TC006 & åˆ›å»ºè®¢å•æµç¨‹ & è®¢å•åˆ›å»ºæˆåŠŸ & è´­ç‰©è½¦æœ‰å•†å“ & ç»“ç®—â†’é€‰æ‹©åœ°å€â†’ç¡®è®¤ä¸‹å• & é«˜ \\
\hline
TC007 & è®¢å•æ”¯ä»˜æµç¨‹ & æ”¯ä»˜æˆåŠŸï¼ŒçŠ¶æ€æ›´æ–° & å¾…æ”¯ä»˜è®¢å• & é€‰æ‹©æ”¯ä»˜æ–¹å¼â†’ç¡®è®¤æ”¯ä»˜ & é«˜ \\
\hline
TC008 & æŸ¥çœ‹å†å²è®¢å• & æ˜¾ç¤ºç”¨æˆ·è®¢å•åˆ—è¡¨ & ç”¨æˆ·æœ‰å†å²è®¢å• & ç™»å½•â†’è¿›å…¥è®¢å•é¡µé¢ & ä¸­ \\
\hline
TC009 & åœ°å€ç®¡ç†æ“ä½œ & åœ°å€CRUDæ“ä½œæˆåŠŸ & æœ‰æ•ˆåœ°å€ä¿¡æ¯ & æ·»åŠ /ç¼–è¾‘/åˆ é™¤åœ°å€ & ä¸­ \\
\hline
TC010 & æœåŠ¡ç†”æ–­æµ‹è¯• & è§¦å‘ç†”æ–­ï¼Œè¿”å›é™çº§å“åº” & æœåŠ¡æ•…éšœåœºæ™¯ & åœæ­¢æœåŠ¡â†’è¯·æ±‚æ¥å£ & ä¸­ \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{æ€§èƒ½æµ‹è¯•åœºæ™¯è®¾è®¡}
\begin{tabular}{|p{2.5cm}|p{2cm}|p{2cm}|p{2cm}|p{2cm}|p{3cm}|}
\hline
\textbf{æµ‹è¯•åœºæ™¯} & \textbf{å¹¶å‘ç”¨æˆ·} & \textbf{æŒç»­æ—¶é—´} & \textbf{æœŸæœ›QPS} & \textbf{å“åº”æ—¶é—´} & \textbf{æˆåŠŸç‡è¦æ±‚} \\
\hline
æ­£å¸¸è´Ÿè½½æµ‹è¯• & 100 & 30åˆ†é’Ÿ & 500-800 & <200ms & >99\% \\
\hline
å³°å€¼è´Ÿè½½æµ‹è¯• & 500 & 15åˆ†é’Ÿ & 1000-1500 & <500ms & >95\% \\
\hline
å‹åŠ›æµ‹è¯• & 1000 & 10åˆ†é’Ÿ & >2000 & <1000ms & >90\% \\
\hline
ç¨³å®šæ€§æµ‹è¯• & 200 & 4å°æ—¶ & 600-1000 & <300ms & >99.5\% \\
\hline
å®¹é‡æµ‹è¯• & é€’å¢è‡³2000 & 1å°æ—¶ & æ‰¾åˆ°æ‹ç‚¹ & ç›‘æ§å˜åŒ– & è®°å½•æé™ \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{å®‰å…¨æµ‹è¯•æ£€æŸ¥ç‚¹}
\begin{tabular}{|p{2.5cm}|p{4cm}|p{3cm}|p{3.5cm}|}
\hline
\textbf{å®‰å…¨ç»´åº¦} & \textbf{æµ‹è¯•å†…å®¹} & \textbf{æ£€æŸ¥æ–¹æ³•} & \textbf{é¢„æœŸç»“æœ} \\
\hline
èº«ä»½è®¤è¯ & JWTä»¤ç‰ŒéªŒè¯æœºåˆ¶ & æ— æ•ˆtokenè®¿é—® & è¿”å›401æœªè®¤è¯ \\
\hline
æƒé™æ§åˆ¶ & ç”¨æˆ·è¶Šæƒè®¿é—® & è·¨ç”¨æˆ·æ•°æ®è®¿é—® & è¿”å›403ç¦æ­¢è®¿é—® \\
\hline
è¾“å…¥éªŒè¯ & SQLæ³¨å…¥é˜²æŠ¤ & æ¶æ„SQLè¾“å…¥ & å‚æ•°åŒ–æŸ¥è¯¢é˜²æŠ¤ \\
\hline
æ•æ„Ÿæ•°æ® & å¯†ç åŠ å¯†å­˜å‚¨ & æ•°æ®åº“å¯†ç å­—æ®µæ£€æŸ¥ & å¯†ç å·²åŠ å¯†å­˜å‚¨ \\
\hline
æ¥å£å®‰å…¨ & APIé™æµä¿æŠ¤ & é«˜é¢‘è¯·æ±‚æ”»å‡» & è§¦å‘é™æµæœºåˆ¶ \\
\hline
ä¼šè¯ç®¡ç† & ä»¤ç‰Œè¿‡æœŸæœºåˆ¶ & è¿‡æœŸtokenä½¿ç”¨ & æ‹’ç»è¿‡æœŸtoken \\
\hline
\end{tabular}
\end{table}

\subsection{éƒ¨ç½²æ¶æ„ä¸è¿ç»´}

åŸºäºå®¹å™¨åŒ–å’Œå¾®æœåŠ¡ç‰¹ç‚¹ï¼Œæˆ‘ä»¬è®¾è®¡äº†å®Œæ•´çš„éƒ¨ç½²æ¶æ„æ–¹æ¡ˆï¼š

% å›¾7: é‡æ–°ä¼˜åŒ–çš„å¾®æœåŠ¡é›†ç¾¤éƒ¨ç½²æ¶æ„å›¾
\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=1.1, every node/.style={font=\footnotesize}]

% å®šä¹‰ä¸“ä¸šéƒ¨ç½²æ ·å¼
\tikzstyle{zone} = [rectangle, fill=gray!5, minimum width=18cm, minimum height=3cm, 
                   rounded corners=10pt, draw=gray!40, thick]
\tikzstyle{client} = [rectangle, rounded corners=6pt, minimum width=2.5cm, minimum height=1cm, 
                     text centered, draw=blue!60, fill=blue!10, font=\scriptsize\bfseries,
                     drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!30}]
\tikzstyle{lb} = [rectangle, rounded corners=8pt, minimum width=4cm, minimum height=1.3cm, 
                 text centered, draw=orange!60, fill=orange!12, font=\scriptsize\bfseries,
                 drop shadow={shadow xshift=2pt, shadow yshift=-2pt, fill=gray!40}]
\tikzstyle{gateway} = [rectangle, rounded corners=6pt, minimum width=3cm, minimum height=1.2cm, 
                      text centered, draw=red!60, fill=red!10, font=\scriptsize\bfseries,
                      drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!30}]
\tikzstyle{service} = [rectangle, rounded corners=6pt, minimum width=2.2cm, minimum height=1cm, 
                      text centered, draw=green!60, fill=green!10, font=\scriptsize\bfseries,
                      drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!30}]
\tikzstyle{service-cluster} = [rectangle, rounded corners=6pt, minimum width=2.2cm, minimum height=1.5cm, 
                              text centered, draw=green!70, fill=green!15, font=\scriptsize\bfseries,
                              drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!30}]
\tikzstyle{registry} = [diamond, minimum width=2.5cm, minimum height=1.5cm, 
                       text centered, draw=purple!60, fill=purple!10, font=\scriptsize\bfseries,
                       drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!30}]
\tikzstyle{cache} = [ellipse, minimum width=2.2cm, minimum height=1.2cm, 
                    text centered, draw=orange!60, fill=orange!10, font=\scriptsize\bfseries,
                    drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!30}]
\tikzstyle{database} = [cylinder, shape border rotate=90, minimum width=2.2cm, minimum height=1.3cm, 
                       text centered, draw=teal!60, fill=teal!10, font=\scriptsize\bfseries,
                       drop shadow={shadow xshift=1pt, shadow yshift=-1pt, fill=gray!30}]

% éƒ¨ç½²åŒºåŸŸèƒŒæ™¯
\node (user-zone) [zone] at (0,12) {};
\node (proxy-zone) [zone] at (0,9.5) {};
\node (gateway-zone) [zone] at (0,7) {};
\node (service-zone) [zone] at (0,4.5) {};
\node (data-zone) [zone] at (0,2) {};

% åŒºåŸŸæ ‡ç­¾
\node [font=\bfseries\Large, color=gray!70] at (-9.5,12) {å®¢æˆ·ç«¯æ¥å…¥åŒº};
\node [font=\bfseries\Large, color=gray!70] at (-9.5,9.5) {è´Ÿè½½å‡è¡¡åŒº};
\node [font=\bfseries\Large, color=gray!70] at (-9.5,7) {APIç½‘å…³é›†ç¾¤åŒº};
\node [font=\bfseries\Large, color=gray!70] at (-9.5,4.5) {ä¸šåŠ¡æœåŠ¡é›†ç¾¤åŒº};
\node [font=\bfseries\Large, color=gray!70] at (-9.5,2) {æ•°æ®å­˜å‚¨é›†ç¾¤åŒº};

% å®¢æˆ·ç«¯å±‚ - åˆ†å¸ƒå¼éƒ¨ç½²
\node (web) [client] at (-4.5,12) {Webå‰ç«¯\\Nginxé™æ€\\CDNåŠ é€Ÿ};
\node (mobile) [client] at (0,12) {ç§»åŠ¨ç«¯\\APP+H5\\PWAæ”¯æŒ};
\node (admin) [client] at (4.5,12) {ç®¡ç†åå°\\è¿è¥ç³»ç»Ÿ\\å†…ç½‘è®¿é—®};

% è´Ÿè½½å‡è¡¡å±‚ - é«˜å¯ç”¨
\node (lb-master) [lb] at (-2,9.5) {Nginxä¸»èŠ‚ç‚¹\\ä¸»å¤‡çƒ­åˆ‡æ¢\\å¥åº·æ£€æŸ¥};
\node (lb-backup) [lb] at (2,9.5) {Nginxå¤‡èŠ‚ç‚¹\\æ•…éšœè‡ªåŠ¨åˆ‡æ¢\\SSLç»ˆæ­¢};

% APIç½‘å…³é›†ç¾¤ - å¤šå®ä¾‹
\node (gateway1) [gateway] at (-4,7) {Gateway-1\\è®¤è¯æˆæƒ\\:14000};
\node (gateway2) [gateway] at (-1,7) {Gateway-2\\è·¯ç”±è½¬å‘\\:14001};
\node (gateway3) [gateway] at (2,7) {Gateway-3\\ç›‘æ§ç»Ÿè®¡\\:14002};
\node (nacos-cluster) [registry] at (6,7) {Nacosé›†ç¾¤\\3èŠ‚ç‚¹\\:8848-8850};

% ä¸šåŠ¡æœåŠ¡é›†ç¾¤ - æŒ‰æœåŠ¡åˆ†ç»„
\node (user-cluster) [service-cluster] at (-6,4.5) {ç”¨æˆ·æœåŠ¡é›†ç¾¤\\User-1 :10100\\User-2 :10101};
\node (business-cluster) [service-cluster] at (-3,4.5) {å•†å®¶æœåŠ¡é›†ç¾¤\\Business-1 :10300\\Business-2 :10301};
\node (order-cluster) [service-cluster] at (0,4.5) {è®¢å•æœåŠ¡é›†ç¾¤\\Order-1 :10601\\Order-2 :10602};
\node (other-services) [service-cluster] at (3,4.5) {å…¶ä»–æœåŠ¡é›†ç¾¤\\Cart :10400\\Address :10500};
\node (food-service) [service] at (6,4.5) {é£Ÿå“æœåŠ¡\\Food :10200\\è½»é‡çº§æœåŠ¡};

% æ•°æ®å­˜å‚¨é›†ç¾¤ - è¯»å†™åˆ†ç¦»
\node (redis-master) [cache] at (-4.5,2) {Redisä¸»èŠ‚ç‚¹\\Master\\:6379};
\node (redis-slave1) [cache] at (-1.5,2) {Redisä»èŠ‚ç‚¹1\\Slave\\:6380};
\node (redis-slave2) [cache] at (1.5,2) {Redisä»èŠ‚ç‚¹2\\Slave\\:6381};

\node (mysql-master) [database] at (-4.5,0.5) {MySQLä¸»åº“\\Master\\:3306};
\node (mysql-slave1) [database] at (-1.5,0.5) {MySQLä»åº“1\\Slave\\:3307};
\node (mysql-slave2) [database] at (1.5,0.5) {MySQLä»åº“2\\Slave\\:3308};

% ç®€åŒ–çš„å…³é”®è¿æ¥çº¿
% å®¢æˆ·ç«¯åˆ°è´Ÿè½½å‡è¡¡
\draw[->, very thick, blue!50] (web) -- (lb-master);
\draw[->, very thick, blue!50] (mobile) -- (lb-master);
\draw[->, very thick, blue!50] (admin) -- (lb-backup);

% è´Ÿè½½å‡è¡¡åˆ°ç½‘å…³ï¼ˆå‡åŒ€åˆ†å‘ï¼‰
\draw[->, very thick, orange!60] (lb-master) -- (gateway1);
\draw[->, very thick, orange!60] (lb-master) -- (gateway2);
\draw[->, very thick, orange!60] (lb-backup) -- (gateway2);
\draw[->, very thick, orange!60] (lb-backup) -- (gateway3);

% ç½‘å…³åˆ°æœåŠ¡é›†ç¾¤ï¼ˆè´Ÿè½½åˆ†å‘ï¼‰
\draw[->, thick, red!50] (gateway1) -- (user-cluster);
\draw[->, thick, red!50] (gateway2) -- (business-cluster);
\draw[->, thick, red!50] (gateway2) -- (order-cluster);
\draw[->, thick, red!50] (gateway3) -- (other-services);
\draw[->, thick, red!50] (gateway3) -- (food-service);

% æœåŠ¡æ³¨å†Œï¼ˆä»£è¡¨æ€§è¿æ¥ï¼‰
\draw[<->, thick, purple!50, dashed] (nacos-cluster) -- (user-cluster);
\draw[<->, thick, purple!50, dashed] (nacos-cluster) -- (order-cluster);
\draw[<->, thick, purple!50, dashed] (nacos-cluster) -- (other-services);

% ç¼“å­˜è®¿é—®ï¼ˆä¸»ä»å¤åˆ¶ï¼‰
\draw[<->, thick, green!60] (user-cluster) -- (redis-master);
\draw[<->, thick, green!60] (other-services) -- (redis-slave1);
\draw[->, thick, orange!40] (redis-master) -- (redis-slave1);
\draw[->, thick, orange!40] (redis-master) -- (redis-slave2);

% æ•°æ®åº“è®¿é—®ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰
\draw[<->, thick, teal!60] (order-cluster) -- (mysql-master);
\draw[<->, thick, teal!60] (business-cluster) -- (mysql-slave1);
\draw[->, thick, teal!40] (mysql-master) -- (mysql-slave1);
\draw[->, thick, teal!40] (mysql-master) -- (mysql-slave2);

% é«˜å¯ç”¨è¿æ¥
\draw[<->, very thick, red!30, dashed] (lb-master) -- (lb-backup);

% å³ä¾§éƒ¨ç½²ä¿¡æ¯é¢æ¿
\node [text width=4cm, font=\footnotesize] at (10,10) {
\textbf{éƒ¨ç½²è§„æ¨¡ï¼š}\\[0.2cm]
ğŸ“Š \textbf{èµ„æºé…ç½®}\\
â€¢ æœåŠ¡å™¨ï¼š12å°ç‰©ç†æœº\\
â€¢ CPUæ€»æ ¸æ•°ï¼š96æ ¸\\
â€¢ å†…å­˜æ€»å®¹é‡ï¼š384GB\\
â€¢ å­˜å‚¨æ€»å®¹é‡ï¼š24TB\\[0.1cm]
ğŸ”§ \textbf{æœåŠ¡å®ä¾‹}\\
â€¢ ç½‘å…³é›†ç¾¤ï¼š3å®ä¾‹\\
â€¢ ä¸šåŠ¡æœåŠ¡ï¼š8å®ä¾‹\\
â€¢ æ•°æ®åº“ï¼š6èŠ‚ç‚¹\\
â€¢ ç¼“å­˜é›†ç¾¤ï¼š6èŠ‚ç‚¹
};

\node [text width=4cm, font=\footnotesize] at (10,6) {
\textbf{é«˜å¯ç”¨ç‰¹æ€§ï¼š}\\[0.2cm]
ğŸ›¡ï¸ \textbf{å®¹é”™è®¾è®¡}\\
â€¢ ä¸»å¤‡çƒ­åˆ‡æ¢\\
â€¢ æ•…éšœè‡ªåŠ¨è½¬ç§»\\
â€¢ æœåŠ¡å¥åº·æ£€æŸ¥\\
â€¢ å®æ—¶ç›‘æ§å‘Šè­¦\\[0.1cm]
âš¡ \textbf{æ€§èƒ½ä¿éšœ}\\
â€¢ è´Ÿè½½å‡è¡¡åˆ†å‘\\
â€¢ è¯»å†™åˆ†ç¦»æ¶æ„\\
â€¢ åˆ†å¸ƒå¼ç¼“å­˜\\
â€¢ æ°´å¹³å¼¹æ€§æ‰©å±•
};

\node [text width=4cm, font=\footnotesize] at (10,2) {
\textbf{ç½‘ç»œæ‹“æ‰‘ï¼š}\\[0.2cm]
ğŸŒ \textbf{ç½‘ç»œè§„åˆ’}\\
â€¢ DMZåŒºï¼šè´Ÿè½½å‡è¡¡\\
â€¢ åº”ç”¨åŒºï¼šå¾®æœåŠ¡\\
â€¢ æ•°æ®åŒºï¼šå­˜å‚¨é›†ç¾¤\\
â€¢ ç®¡ç†åŒºï¼šè¿ç»´ç›‘æ§\\[0.1cm]
ğŸ”’ \textbf{å®‰å…¨é˜²æŠ¤}\\
â€¢ é˜²ç«å¢™éš”ç¦»\\
â€¢ VPNä¸“çº¿æ¥å…¥\\
â€¢ æ•°æ®åŠ å¯†ä¼ è¾“\\
â€¢ è®¿é—®æƒé™æ§åˆ¶
};

\end{tikzpicture}
\caption{ä¼˜åŒ–åçš„å¾®æœåŠ¡é›†ç¾¤éƒ¨ç½²æ¶æ„å›¾}
\label{fig:microservice-cluster-deployment}
\end{figure>

\begin{table}[H]
\centering
\caption{å¾®æœåŠ¡éƒ¨ç½²é…ç½®è¡¨}
\begin{tabular}{|p{2.5cm}|p{1.5cm}|p{2cm}|p{2cm}|p{2cm}|p{3cm}|}
\hline
\textbf{æœåŠ¡åç§°} & \textbf{ç«¯å£} & \textbf{CPUæ ¸å¿ƒ} & \textbf{å†…å­˜(GB)} & \textbf{ç£ç›˜(GB)} & \textbf{å‰¯æœ¬æ•°é‡} \\
\hline
Gatewayç½‘å…³ & 14000 & 2 & 4 & 20 & 3 \\
\hline
Userç”¨æˆ·æœåŠ¡ & 10100 & 2 & 4 & 20 & 3 \\
\hline
Businesså•†å®¶æœåŠ¡ & 10300 & 2 & 4 & 20 & 2 \\
\hline
Foodé£Ÿå“æœåŠ¡ & 10200 & 1 & 2 & 10 & 2 \\
\hline
Orderè®¢å•æœåŠ¡ & 10601 & 4 & 8 & 50 & 4 \\
\hline
Cartè´­ç‰©è½¦æœåŠ¡ & 10400 & 1 & 2 & 10 & 2 \\
\hline
Addressåœ°å€æœåŠ¡ & 10500 & 1 & 2 & 10 & 2 \\
\hline
MySQLä¸»åº“ & 3306 & 4 & 16 & 500 & 1 \\
\hline
MySQLä»åº“ & 3307 & 4 & 16 & 500 & 2 \\
\hline
Redisé›†ç¾¤ & 6379-6384 & 2 & 8 & 100 & 6 \\
\hline
Nacosé›†ç¾¤ & 8848 & 2 & 4 & 50 & 3 \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{ç¯å¢ƒé…ç½®å¯¹æ¯”è¡¨}
\begin{tabular}{|p{2cm}|p{3cm}|p{3cm}|p{3cm}|p{3cm}|}
\hline
\textbf{é…ç½®é¡¹} & \textbf{å¼€å‘ç¯å¢ƒ} & \textbf{æµ‹è¯•ç¯å¢ƒ} & \textbf{é¢„ç”Ÿäº§ç¯å¢ƒ} & \textbf{ç”Ÿäº§ç¯å¢ƒ} \\
\hline
æ•°æ®åº“è¿æ¥æ±  & 5-10 & 10-20 & 20-50 & 50-100 \\
\hline
Redisé…ç½® & å•æœºç‰ˆ & ä¸»ä»å¤åˆ¶ & å“¨å…µæ¨¡å¼ & é›†ç¾¤æ¨¡å¼ \\
\hline
æ—¥å¿—çº§åˆ« & DEBUG & INFO & WARN & ERROR \\
\hline
JVMå †å†…å­˜ & 1G & 2G & 4G & 8G \\
\hline
ç›‘æ§å‘Šè­¦ & å…³é—­ & åŸºç¡€ç›‘æ§ & å…¨é¢ç›‘æ§ & å…¨é¢ç›‘æ§+å‘Šè­¦ \\
\hline
å¤‡ä»½ç­–ç•¥ & æ—  & å‘¨å¤‡ä»½ & æ—¥å¤‡ä»½ & å®æ—¶å¤‡ä»½ \\
\hline
è´Ÿè½½å‡è¡¡ & æ—  & è½®è¯¢ & åŠ æƒè½®è¯¢ & æ™ºèƒ½è·¯ç”± \\
\hline
å®‰å…¨ç­–ç•¥ & åŸºç¡€ & ä¸­ç­‰ & é«˜ç­‰ & æœ€é«˜ç­‰çº§ \\
\hline
\end{tabular}
\end{table}

\subsection{é¡¹ç›®é£é™©ç®¡ç†}

åŸºäºå¾®æœåŠ¡æ¶æ„å’ŒDDDè®¾è®¡çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬è¯†åˆ«å¹¶åˆ¶å®šäº†ç›¸åº”çš„é£é™©åº”å¯¹ç­–ç•¥ï¼š

\begin{table}[H]
\centering
\caption{é¡¹ç›®é£é™©è¯†åˆ«ä¸åº”å¯¹ç­–ç•¥}
\begin{tabular}{|p{2cm}|p{3cm}|p{1.5cm}|p{3cm}|p{3.5cm}|}
\hline
\textbf{é£é™©ç±»åˆ«} & \textbf{é£é™©æè¿°} & \textbf{å½±å“ç­‰çº§} & \textbf{å‘ç”Ÿæ¦‚ç‡} & \textbf{åº”å¯¹ç­–ç•¥} \\
\hline
æŠ€æœ¯é£é™© & å¾®æœåŠ¡é—´é€šä¿¡æ•…éšœ & é«˜ & ä¸­ç­‰ & ç†”æ–­é™çº§ã€æœåŠ¡å†—ä½™éƒ¨ç½² \\
\hline
æŠ€æœ¯é£é™© & åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§ & é«˜ & ä¸­ç­‰ & æœ€ç»ˆä¸€è‡´æ€§è®¾è®¡ã€è¡¥å¿æœºåˆ¶ \\
\hline
æ¶æ„é£é™© & DDDæ¨¡å‹è®¾è®¡é”™è¯¯ & ä¸­ç­‰ & ä½ & äº‹ä»¶é£æš´ã€ä¸“å®¶è¯„å®¡ \\
\hline
æ€§èƒ½é£é™© & é«˜å¹¶å‘ä¸‹ç³»ç»Ÿç“¶é¢ˆ & é«˜ & ä¸­ç­‰ & å‹åŠ›æµ‹è¯•ã€æ€§èƒ½è°ƒä¼˜ \\
\hline
å®‰å…¨é£é™© & æ•æ„Ÿæ•°æ®æ³„éœ² & é«˜ & ä½ & æ•°æ®åŠ å¯†ã€æƒé™æ§åˆ¶ \\
\hline
è¿ç»´é£é™© & æœåŠ¡éƒ¨ç½²å¤æ‚åº¦ & ä¸­ç­‰ & ä¸­ç­‰ & å®¹å™¨åŒ–ã€è‡ªåŠ¨åŒ–éƒ¨ç½² \\
\hline
ä¸šåŠ¡é£é™© & éœ€æ±‚å˜æ›´é¢‘ç¹ & ä¸­ç­‰ & é«˜ & æ•æ·å¼€å‘ã€æ¨¡å—åŒ–è®¾è®¡ \\
\hline
äººå‘˜é£é™© & å…³é”®äººå‘˜ç¦»èŒ & ä¸­ç­‰ & ä½ & çŸ¥è¯†æ–‡æ¡£åŒ–ã€å›¢é˜ŸåŸ¹è®­ \\
\hline
é›†æˆé£é™© & ç¬¬ä¸‰æ–¹æœåŠ¡ä¾èµ– & ä¸­ç­‰ & ä¸­ç­‰ & æœåŠ¡é™çº§ã€å¤‡é€‰æ–¹æ¡ˆ \\
\hline
æ•°æ®é£é™© & æ•°æ®åº“æ€§èƒ½ç“¶é¢ˆ & é«˜ & ä¸­ç­‰ & è¯»å†™åˆ†ç¦»ã€æ•°æ®åº“ä¼˜åŒ– \\
\hline
\end{tabular}
\end{table}

\subsection{è´¨é‡ä¿è¯ä½“ç³»}

ä¸ºç¡®ä¿é¡¹ç›®äº¤ä»˜è´¨é‡ï¼Œæˆ‘ä»¬å»ºç«‹äº†å®Œæ•´çš„è´¨é‡ä¿è¯ä½“ç³»ï¼š

\begin{table}[H]
\centering
\caption{è´¨é‡ä¿è¯æªæ–½çŸ©é˜µ}
\begin{tabular}{|p{2.5cm}|p{3cm}|p{3cm}|p{2.5cm}|p{2cm}|}
\hline
\textbf{è´¨é‡ç»´åº¦} & \textbf{ä¿è¯æªæ–½} & \textbf{æ£€æŸ¥ç‚¹} & \textbf{è´£ä»»äºº} & \textbf{å®Œæˆåº¦} \\
\hline
ä»£ç è´¨é‡ & SonarQubeé™æ€åˆ†æ & æ¯æ¬¡æäº¤ & å¼€å‘å·¥ç¨‹å¸ˆ & 100\% \\
\hline
ä»£ç è´¨é‡ & Code Review & æ¯ä¸ªPR & æŠ€æœ¯è´Ÿè´£äºº & 100\% \\
\hline
åŠŸèƒ½è´¨é‡ & å•å…ƒæµ‹è¯•è¦†ç›–ç‡ & æŒç»­é›†æˆ & å¼€å‘å·¥ç¨‹å¸ˆ & >80\% \\
\hline
åŠŸèƒ½è´¨é‡ & é›†æˆæµ‹è¯• & æ¯æ—¥æ„å»º & æµ‹è¯•å·¥ç¨‹å¸ˆ & 100\% \\
\hline
æ€§èƒ½è´¨é‡ & æ€§èƒ½åŸºå‡†æµ‹è¯• & æ¯å‘¨æ‰§è¡Œ & æ€§èƒ½å·¥ç¨‹å¸ˆ & 100\% \\
\hline
æ€§èƒ½è´¨é‡ & å‹åŠ›æµ‹è¯• & å‘å¸ƒå‰ & æµ‹è¯•å·¥ç¨‹å¸ˆ & 100\% \\
\hline
å®‰å…¨è´¨é‡ & å®‰å…¨æ‰«æ & æ¯æ¬¡æ„å»º & å®‰å…¨å·¥ç¨‹å¸ˆ & 100\% \\
\hline
å®‰å…¨è´¨é‡ & æ¸—é€æµ‹è¯• & å‘å¸ƒå‰ & å®‰å…¨ä¸“å®¶ & 100\% \\
\hline
éƒ¨ç½²è´¨é‡ & è‡ªåŠ¨åŒ–éƒ¨ç½² & æ¯æ¬¡å‘å¸ƒ & è¿ç»´å·¥ç¨‹å¸ˆ & 100\% \\
\hline
ç›‘æ§è´¨é‡ & ç›‘æ§è¦†ç›–ç‡ & æŒç»­ç›‘æ§ & è¿ç»´å·¥ç¨‹å¸ˆ & >95\% \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{ä»£ç è´¨é‡æŒ‡æ ‡}
\begin{tabular}{|p{3cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|}
\hline
\textbf{è´¨é‡æŒ‡æ ‡} & \textbf{ç›®æ ‡å€¼} & \textbf{å½“å‰å€¼} & \textbf{æµ‹é‡å·¥å…·} & \textbf{æ”¹è¿›æ–¹å‘} \\
\hline
å•å…ƒæµ‹è¯•è¦†ç›–ç‡ & >80\% & 85\% & JaCoCo & æŒç»­æå‡ \\
\hline
ä»£ç é‡å¤ç‡ & <5\% & 3\% & SonarQube & é‡æ„ä¼˜åŒ– \\
\hline
ä»£ç å¤æ‚åº¦ & <10 & 8 & SonarQube & ç®€åŒ–é€»è¾‘ \\
\hline
ä»£ç ç¼ºé™·å¯†åº¦ & <1/KLOC & 0.7/KLOC & SonarQube & é¢„é˜²ä¸ºä¸» \\
\hline
æŠ€æœ¯å€ºåŠ¡æ¯”ç‡ & <5\% & 3.2\% & SonarQube & æŒç»­é‡æ„ \\
\hline
ä»£ç è§„èŒƒç¬¦åˆåº¦ & 100\% & 98\% & CheckStyle & è§„èŒƒæ‰§è¡Œ \\
\hline
æ³¨é‡Šè¦†ç›–ç‡ & >60\% & 65\% & JavaDoc & æ–‡æ¡£å®Œå–„ \\
\hline
\end{tabular}
\end{table}

\section{æ•´åˆä¸éƒ¨ç½²}

\subsection{ç³»ç»Ÿæ•´åˆç­–ç•¥}

åŸºäºå¾®æœåŠ¡æ¶æ„çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬åˆ¶å®šäº†å®Œæ•´çš„ç³»ç»Ÿæ•´åˆç­–ç•¥ã€‚æ•´åˆè¿‡ç¨‹ä¸ä»…åŒ…æ‹¬å„ä¸ªå¾®æœåŠ¡çš„æŠ€æœ¯æ•´åˆï¼Œè¿˜æ¶µç›–äº†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰å…¨ç”Ÿå‘½å‘¨æœŸçš„åè°ƒã€‚

\subsubsection{å¾®æœåŠ¡æ•´åˆæ¶æ„}

å¾®æœåŠ¡çš„æ•´åˆé‡‡ç”¨åˆ†å±‚æ•´åˆçš„ç­–ç•¥ï¼Œç¡®ä¿å„ä¸ªå±‚æ¬¡çš„åŠŸèƒ½æ­£ç¡®åä½œï¼š

\textbf{æ¥å…¥å±‚æ•´åˆ}ï¼šé€šè¿‡Spring Cloud Gatewayç»Ÿä¸€æ‰€æœ‰å¤–éƒ¨è¯·æ±‚çš„å…¥å£ã€‚ç½‘å…³ä¸ä»…æä¾›äº†è·¯ç”±è½¬å‘åŠŸèƒ½ï¼Œè¿˜é›†æˆäº†è®¤è¯ã€é™æµã€ç›‘æ§ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚éƒ½ç»è¿‡ç½‘å…³çš„ç»Ÿä¸€å¤„ç†ï¼Œç¡®ä¿äº†å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚

\textbf{æœåŠ¡å±‚æ•´åˆ}ï¼šå„ä¸ªå¾®æœåŠ¡é€šè¿‡Nacosæ³¨å†Œä¸­å¿ƒå®ç°è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œã€‚OpenFeignæä¾›äº†ç±»å‹å®‰å…¨çš„æœåŠ¡é—´è°ƒç”¨ï¼Œç®€åŒ–äº†å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚Sentinelç†”æ–­å™¨ä¿è¯äº†æœåŠ¡è°ƒç”¨çš„ç¨³å®šæ€§ï¼Œé¿å…äº†æ•…éšœçš„çº§è”ä¼ æ’­ã€‚

\textbf{æ•°æ®å±‚æ•´åˆ}ï¼šæ¯ä¸ªå¾®æœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œé¿å…äº†æ•°æ®è€¦åˆã€‚é€šè¿‡åˆ†å¸ƒå¼äº‹åŠ¡å’Œæœ€ç»ˆä¸€è‡´æ€§æœºåˆ¶ï¼Œä¿è¯äº†è·¨æœåŠ¡æ“ä½œçš„æ•°æ®ä¸€è‡´æ€§ã€‚Redisç¼“å­˜ä½œä¸ºå…±äº«çš„æ•°æ®ç¼“å­˜å±‚ï¼Œæå‡äº†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚

\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=0.9]

% å®šä¹‰æ ·å¼
\tikzstyle{layer-bg} = [rectangle, minimum width=16cm, minimum height=2.2cm, draw=gray!50, fill=gray!10, line width=1pt]
\tikzstyle{layer-label} = [rectangle, minimum width=3cm, minimum height=1.5cm, draw=blue!80, fill=blue!20, text=black, font=\footnotesize\bfseries]
\tikzstyle{service-box} = [rectangle, minimum width=2.8cm, minimum height=1.3cm, draw=green!70, fill=green!15, text=black, font=\tiny, rounded corners=2pt]
\tikzstyle{data-box} = [rectangle, minimum width=2.5cm, minimum height=1.1cm, draw=orange!70, fill=orange!15, text=black, font=\tiny, rounded corners=2pt]
\tikzstyle{infra-box} = [rectangle, minimum width=2.3cm, minimum height=1.1cm, draw=purple!70, fill=purple!15, text=black, font=\tiny, rounded corners=2pt]
\tikzstyle{client-box} = [rectangle, minimum width=3.2cm, minimum height=1.1cm, draw=cyan!70, fill=cyan!15, text=black, font=\tiny, rounded corners=2pt]
\tikzstyle{gateway-box} = [rectangle, minimum width=4cm, minimum height=1.1cm, draw=red!70, fill=red!15, text=black, font=\tiny, rounded corners=2pt]

% å±‚æ¬¡èƒŒæ™¯
\node[layer-bg] at (0,10) {};
\node[layer-bg] at (0,7.8) {};
\node[layer-bg] at (0,5.6) {};
\node[layer-bg] at (0,3.4) {};
\node[layer-bg] at (0,1.2) {};

% å·¦ä¾§æ ‡ç­¾
\node[layer-label] at (-9.5,10) {å®¢æˆ·ç«¯\\æ¥å…¥å±‚};
\node[layer-label] at (-9.5,7.8) {APIç½‘å…³\\æ§åˆ¶å±‚};
\node[layer-label] at (-9.5,5.6) {ä¸šåŠ¡æœåŠ¡\\å¤„ç†å±‚};
\node[layer-label] at (-9.5,3.4) {æ•°æ®å­˜å‚¨\\è®¿é—®å±‚};
\node[layer-label] at (-9.5,1.2) {åŸºç¡€è®¾æ–½\\æ”¯æ’‘å±‚};

% å®¢æˆ·ç«¯å±‚
\node[client-box] at (-5,10) {Vue3\\å‰ç«¯ç•Œé¢\\(8080)};
\node[client-box] at (-1.5,10) {ç§»åŠ¨ç«¯\\Appå®¢æˆ·ç«¯\\(iOS/Android)};
\node[client-box] at (2,10) {ç®¡ç†åå°\\Admin Dashboard\\(ç®¡ç†ç•Œé¢)};
\node[client-box] at (5.5,10) {ç¬¬ä¸‰æ–¹\\APIæ¥å…¥\\(å¤–éƒ¨ç³»ç»Ÿ)};

% APIç½‘å…³å±‚
\node[gateway-box] at (-3.5,7.8) {Spring Cloud Gateway\\è·¯ç”±è½¬å‘ + è´Ÿè½½å‡è¡¡\\(14000)};
\node[gateway-box] at (1.5,7.8) {è®¤è¯æˆæƒä¸­å¿ƒ\\JWT + OAuth2.0\\æƒé™æ§åˆ¶};
\node[gateway-box] at (6,7.8) {é™æµç†”æ–­\\Sentinelæµæ§\\ç›‘æ§å‘Šè­¦};

% ä¸šåŠ¡æœåŠ¡å±‚
\node[service-box] at (-5.5,5.6) {ç”¨æˆ·æœåŠ¡\\User Service\\(10100)\\ç”¨æˆ·ç®¡ç†};
\node[service-box] at (-2.8,5.6) {å•†å®¶æœåŠ¡\\Business Service\\(10300)\\å•†æˆ·ç®¡ç†};
\node[service-box] at (-0.1,5.6) {é£Ÿå“æœåŠ¡\\Food Service\\(10200)\\èœå“ç®¡ç†};
\node[service-box] at (2.6,5.6) {è®¢å•æœåŠ¡\\Order Service\\(10601)\\è®¢å•å¤„ç†};
\node[service-box] at (5.3,5.6) {è´­ç‰©è½¦æœåŠ¡\\Cart Service\\(10400)\\è´­ç‰©è½¦};

% æ•°æ®å­˜å‚¨å±‚
\node[data-box] at (-5,3.4) {MySQLé›†ç¾¤\\ä¸»ä»å¤åˆ¶\\è¯»å†™åˆ†ç¦»\\ç”¨æˆ·æ•°æ®};
\node[data-box] at (-2.2,3.4) {Redisé›†ç¾¤\\ç¼“å­˜åŠ é€Ÿ\\ä¼šè¯å­˜å‚¨\\çƒ­ç‚¹æ•°æ®};
\node[data-box] at (0.6,3.4) {æ¶ˆæ¯é˜Ÿåˆ—\\RabbitMQ\\å¼‚æ­¥å¤„ç†\\äº‹ä»¶é©±åŠ¨};
\node[data-box] at (3.4,3.4) {æ–‡ä»¶å­˜å‚¨\\OSS/NFS\\å›¾ç‰‡è§†é¢‘\\é™æ€èµ„æº};
\node[data-box] at (6.2,3.4) {æœç´¢å¼•æ“\\Elasticsearch\\å…¨æ–‡æ£€ç´¢\\æ•°æ®åˆ†æ};

% åŸºç¡€è®¾æ–½å±‚
\node[infra-box] at (-5.5,1.2) {Nacos\\æœåŠ¡æ³¨å†Œ\\é…ç½®ä¸­å¿ƒ\\(8848)};
\node[infra-box] at (-3,1.2) {Sentinel\\æµé‡æ§åˆ¶\\ç†”æ–­é™çº§\\å®æ—¶ç›‘æ§};
\node[infra-box] at (-0.5,1.2) {Zipkin\\é“¾è·¯è¿½è¸ª\\æ€§èƒ½åˆ†æ\\è°ƒç”¨ç›‘æ§};
\node[infra-box] at (2,1.2) {Prometheus\\æŒ‡æ ‡æ”¶é›†\\ç›‘æ§å‘Šè­¦\\æ•°æ®å¯è§†åŒ–};
\node[infra-box] at (4.5,1.2) {ELK Stack\\æ—¥å¿—æ”¶é›†\\æ—¥å¿—åˆ†æ\\è¿ç»´ç›‘æ§};

% è¿æ¥ç®­å¤´
\foreach \y in {10,7.8,5.6,3.4} {
    \draw[->, thick, blue!60] (-7.8,\y-0.9) -- (-7.8,\y-1.3);
}

% å³ä¾§ä¿¡æ¯é¢æ¿
\node[rectangle, draw=black, fill=yellow!10, text width=3.5cm, font=\tiny] at (11,6) {
\textbf{æ¶æ„ç‰¹æ€§}\\
â€¢ æ¾è€¦åˆé«˜å†…èš\\
â€¢ æœåŠ¡è‡ªæ²»ç‹¬ç«‹\\
â€¢ æ°´å¹³æ‰©å±•èƒ½åŠ›\\
â€¢ æ•…éšœéš”ç¦»æœºåˆ¶\\
â€¢ æŠ€æœ¯æ ˆå¤šæ ·åŒ–\\
\\
\textbf{æ ¸å¿ƒç»„ä»¶}\\
â€¢ 7ä¸ªä¸šåŠ¡å¾®æœåŠ¡\\
â€¢ 5å±‚æ¶æ„åˆ†å±‚\\
â€¢ 3å¥—ç¯å¢ƒéƒ¨ç½²\\
â€¢ ç»Ÿä¸€æœåŠ¡æ²»ç†\\
â€¢ å®Œæ•´ç›‘æ§ä½“ç³»
};

\end{tikzpicture}
\caption{å¾®æœåŠ¡æ•´åˆæ¶æ„å›¾}
\label{fig:integration-architecture}
\end{figure}

\subsubsection{é…ç½®ç®¡ç†æ•´åˆ}

é…ç½®ç®¡ç†æ˜¯å¾®æœåŠ¡æ•´åˆçš„å…³é”®ç¯èŠ‚ã€‚æˆ‘ä»¬ä½¿ç”¨Nacosé…ç½®ä¸­å¿ƒå®ç°äº†ç»Ÿä¸€çš„é…ç½®ç®¡ç†ï¼š

\textbf{ç¯å¢ƒé…ç½®åˆ†ç¦»}ï¼šä¸ºå¼€å‘ã€æµ‹è¯•ã€é¢„ç”Ÿäº§ã€ç”Ÿäº§å››ä¸ªç¯å¢ƒåˆ†åˆ«ç»´æŠ¤ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚é€šè¿‡å‘½åç©ºé—´ï¼ˆnamespaceï¼‰å®ç°ç¯å¢ƒéš”ç¦»ï¼Œç¡®ä¿é…ç½®ä¸ä¼šç›¸äº’å½±å“ã€‚

\textbf{åŠ¨æ€é…ç½®åˆ·æ–°}ï¼šæ‰€æœ‰å¾®æœåŠ¡éƒ½æ”¯æŒé…ç½®çš„åŠ¨æ€åˆ·æ–°ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆã€‚è¿™å¤§å¤§æå‡äº†ç³»ç»Ÿçš„è¿ç»´æ•ˆç‡ï¼Œå‡å°‘äº†å› é…ç½®å˜æ›´å¯¼è‡´çš„æœåŠ¡ä¸­æ–­ã€‚

\textbf{é…ç½®ç‰ˆæœ¬ç®¡ç†}ï¼šNacosæä¾›äº†é…ç½®çš„ç‰ˆæœ¬ç®¡ç†å’Œå›æ»šåŠŸèƒ½ã€‚æ¯æ¬¡é…ç½®å˜æ›´éƒ½ä¼šäº§ç”Ÿæ–°çš„ç‰ˆæœ¬ï¼Œæ”¯æŒå¿«é€Ÿå›æ»šåˆ°å†å²ç‰ˆæœ¬ã€‚

\begin{table}[H]
\centering
\caption{é…ç½®æ–‡ä»¶æ•´åˆæ¸…å•}
\begin{tabular}{|p{3cm}|p{2.5cm}|p{2.5cm}|p{3cm}|p{2.5cm}|}
\hline
\textbf{æœåŠ¡åç§°} & \textbf{é…ç½®æ–‡ä»¶} & \textbf{å‘½åç©ºé—´} & \textbf{ä¸»è¦é…ç½®é¡¹} & \textbf{åˆ·æ–°ç­–ç•¥} \\
\hline
ç”¨æˆ·æœåŠ¡ & user-server.yml & production & æ•°æ®æºã€ç¼“å­˜ã€JWT & è‡ªåŠ¨åˆ·æ–° \\
\hline
å•†å®¶æœåŠ¡ & business-server.yml & production & æ•°æ®æºã€Feigné…ç½® & è‡ªåŠ¨åˆ·æ–° \\
\hline
è®¢å•æœåŠ¡ & order-server.yml & production & æ•°æ®æºã€æ¶ˆæ¯é˜Ÿåˆ— & è‡ªåŠ¨åˆ·æ–° \\
\hline
è´­ç‰©è½¦æœåŠ¡ & cart-server.yml & production & Redisé…ç½® & è‡ªåŠ¨åˆ·æ–° \\
\hline
ç½‘å…³æœåŠ¡ & gateway-server.yml & production & è·¯ç”±è§„åˆ™ã€é™æµé…ç½® & æ‰‹åŠ¨åˆ·æ–° \\
\hline
\end{tabular}
\end{table}

\subsection{éƒ¨ç½²æ¶æ„è®¾è®¡}

\subsubsection{éƒ¨ç½²ç¯å¢ƒè§„åˆ’}

æˆ‘ä»¬è®¾è®¡äº†å®Œæ•´çš„å¤šç¯å¢ƒéƒ¨ç½²æ¶æ„ï¼Œæ”¯æŒä»å¼€å‘åˆ°ç”Ÿäº§çš„å…¨ç”Ÿå‘½å‘¨æœŸï¼š

\textbf{å¼€å‘ç¯å¢ƒï¼ˆDEVï¼‰}ï¼šå¼€å‘äººå‘˜çš„æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œé…ç½®ç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç”¨äºåŠŸèƒ½å¼€å‘å’Œå•å…ƒæµ‹è¯•ã€‚æ¯ä¸ªå¼€å‘äººå‘˜éƒ½æœ‰ç‹¬ç«‹çš„å¼€å‘ç¯å¢ƒï¼Œé¿å…ç›¸äº’å¹²æ‰°ã€‚

\textbf{æµ‹è¯•ç¯å¢ƒï¼ˆTESTï¼‰}ï¼šç”¨äºé›†æˆæµ‹è¯•å’ŒåŠŸèƒ½éªŒè¯ï¼Œç¯å¢ƒé…ç½®æ¥è¿‘ç”Ÿäº§ç¯å¢ƒã€‚æµ‹è¯•ç¯å¢ƒéƒ¨ç½²æœ€æ–°çš„ä»£ç ç‰ˆæœ¬ï¼Œè¿›è¡Œå®Œæ•´çš„ä¸šåŠ¡æµç¨‹æµ‹è¯•ã€‚

\textbf{é¢„ç”Ÿäº§ç¯å¢ƒï¼ˆUATï¼‰}ï¼šä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´çš„é…ç½®ï¼Œç”¨äºä¸Šçº¿å‰çš„æœ€ç»ˆéªŒè¯ã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­è¿›è¡Œå‹åŠ›æµ‹è¯•ã€å®‰å…¨æµ‹è¯•ç­‰ã€‚

\textbf{ç”Ÿäº§ç¯å¢ƒï¼ˆPRODï¼‰}ï¼šæ­£å¼çš„ç”Ÿäº§ç¯å¢ƒï¼Œå…·æœ‰æœ€é«˜çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§è¦æ±‚ã€‚é‡‡ç”¨é›†ç¾¤éƒ¨ç½²ï¼Œæ”¯æŒé«˜å¹¶å‘å’Œé«˜å¯ç”¨ã€‚

\begin{table}[H]
\centering
\caption{éƒ¨ç½²ç¯å¢ƒé…ç½®å¯¹æ¯”}
\begin{tabular}{|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|}
\hline
\textbf{é…ç½®é¡¹} & \textbf{å¼€å‘ç¯å¢ƒ} & \textbf{æµ‹è¯•ç¯å¢ƒ} & \textbf{é¢„ç”Ÿäº§ç¯å¢ƒ} & \textbf{ç”Ÿäº§ç¯å¢ƒ} \\
\hline
æœåŠ¡å®ä¾‹æ•° & 1 & 1-2 & 2-3 & 3-5 \\
\hline
æ•°æ®åº“é…ç½® & H2å†…å­˜æ•°æ®åº“ & MySQLå•æœº & MySQLä¸»ä» & MySQLé›†ç¾¤ \\
\hline
ç¼“å­˜é…ç½® & å•æœºRedis & å•æœºRedis & Redisä¸»ä» & Redisé›†ç¾¤ \\
\hline
JVMå†…å­˜ & 512MB & 1GB & 2GB & 4GB \\
\hline
æ—¥å¿—çº§åˆ« & DEBUG & INFO & WARN & ERROR \\
\hline
ç›‘æ§é…ç½® & ç®€åŒ–ç›‘æ§ & åŸºç¡€ç›‘æ§ & å®Œæ•´ç›‘æ§ & å…¨é¢ç›‘æ§ \\
\hline
\end{tabular}
\end{table}

\subsubsection{å®¹å™¨åŒ–éƒ¨ç½²ç­–ç•¥}

ä¸ºäº†æé«˜éƒ¨ç½²æ•ˆç‡å’Œç¯å¢ƒä¸€è‡´æ€§ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å®Œæ•´çš„å®¹å™¨åŒ–éƒ¨ç½²ç­–ç•¥ï¼š

\textbf{Dockeré•œåƒæ„å»º}ï¼šæ¯ä¸ªå¾®æœåŠ¡éƒ½æ„å»ºç‹¬ç«‹çš„Dockeré•œåƒã€‚é•œåƒåŸºäºAlpine Linuxï¼Œä½“ç§¯å°ä¸”å®‰å…¨æ€§é«˜ã€‚é€šè¿‡å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°ï¼Œæœ€ç»ˆè¿è¡Œé•œåƒåªåŒ…å«å¿…è¦çš„è¿è¡Œæ—¶æ–‡ä»¶ã€‚

\begin{lstlisting}[caption=Dockerfileç¤ºä¾‹]
# å¤šé˜¶æ®µæ„å»ºï¼šç¼–è¯‘é˜¶æ®µ
FROM maven:3.8.4-openjdk-8-slim AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn clean package -DskipTests

# è¿è¡Œé˜¶æ®µ
FROM openjdk:8-jre-alpine
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar

# æ·»åŠ åº”ç”¨ç”¨æˆ·ï¼Œæå‡å®‰å…¨æ€§
RUN addgroup -g 1001 app && adduser -D -s /bin/sh -u 1001 -G app app
USER app

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s \
  CMD wget --quiet --tries=1 --spider http://localhost:8080/actuator/health || exit 1

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app/app.jar"]
\end{lstlisting}

\textbf{Docker Composeç¼–æ’}ï¼šä½¿ç”¨Docker Composeç®¡ç†æ•´ä¸ªåº”ç”¨æ ˆçš„éƒ¨ç½²ã€‚é€šè¿‡composeæ–‡ä»¶å®šä¹‰æ‰€æœ‰æœåŠ¡çš„ä¾èµ–å…³ç³»ã€ç½‘ç»œé…ç½®ã€å­˜å‚¨æŒ‚è½½ç­‰ã€‚

\begin{lstlisting}[caption=docker-compose.ymléƒ¨åˆ†é…ç½®]
version: '3.8'

services:
  nacos:
    image: nacos/nacos-server:v2.2.0
    environment:
      - MODE=standalone
    ports:
      - "8848:8848"
    networks:
      - elm-network

  gateway:
    build: ./gateway_server_14000
    ports:
      - "14000:14000"
    depends_on:
      - nacos
    environment:
      - NACOS_SERVER=nacos:8848
    networks:
      - elm-network

  user-service:
    build: ./user_server_10100
    ports:
      - "10100:10100"
    depends_on:
      - nacos
      - mysql
      - redis
    environment:
      - NACOS_SERVER=nacos:8848
      - MYSQL_HOST=mysql
      - REDIS_HOST=redis
    networks:
      - elm-network

networks:
  elm-network:
    driver: bridge
\end{lstlisting}

\subsubsection{ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ}

ç”Ÿäº§ç¯å¢ƒé‡‡ç”¨é«˜å¯ç”¨çš„é›†ç¾¤éƒ¨ç½²æ–¹æ¡ˆï¼š

\textbf{è´Ÿè½½å‡è¡¡é…ç½®}ï¼šä½¿ç”¨Nginxä½œä¸ºå…¥å£è´Ÿè½½å‡è¡¡å™¨ï¼Œé…ç½®å¤šä¸ªGatewayå®ä¾‹çš„upstreamã€‚æ”¯æŒå¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»ã€‚

\begin{lstlisting}[caption=Nginxè´Ÿè½½å‡è¡¡é…ç½®]
upstream gateway-cluster {
    least_conn;
    server gateway1:14000 max_fails=3 fail_timeout=30s;
    server gateway2:14000 max_fails=3 fail_timeout=30s;
    server gateway3:14000 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name api.eleme.com;

    location / {
        proxy_pass http://gateway-cluster;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }

    # å¥åº·æ£€æŸ¥ç«¯ç‚¹
    location /health {
        access_log off;
        return 200 "healthy\n";
    }
}
\end{lstlisting}

\textbf{æ•°æ®åº“é›†ç¾¤éƒ¨ç½²}ï¼šMySQLé‡‡ç”¨ä¸€ä¸»å¤šä»çš„éƒ¨ç½²æ¶æ„ï¼Œä¸»åº“è´Ÿè´£å†™æ“ä½œï¼Œä»åº“è´Ÿè´£è¯»æ“ä½œã€‚é…ç½®è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œç¡®ä¿æ•°æ®åº“çš„é«˜å¯ç”¨æ€§ã€‚

\textbf{ç¼“å­˜é›†ç¾¤éƒ¨ç½²}ï¼šRediséƒ¨ç½²ä¸ºä¸‰ä¸»ä¸‰ä»çš„é›†ç¾¤æ¨¡å¼ï¼Œæ•°æ®åˆ†ç‰‡å­˜å‚¨ï¼Œæ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚

\subsection{è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹}

\subsubsection{CI/CDæµæ°´çº¿è®¾è®¡}

æˆ‘ä»¬å»ºç«‹äº†å®Œæ•´çš„CI/CDæµæ°´çº¿ï¼Œå®ç°äº†ä»ä»£ç æäº¤åˆ°ç”Ÿäº§éƒ¨ç½²çš„å…¨è‡ªåŠ¨åŒ–ï¼š

\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=0.85]

% å®šä¹‰æ ·å¼
\tikzstyle{stage-box} = [rectangle, minimum width=3.2cm, minimum height=1.8cm, draw=blue!70, fill=blue!15, text=black, font=\tiny, rounded corners=3pt, text width=3cm, align=center]
\tikzstyle{test-box} = [rectangle, minimum width=3.2cm, minimum height=1.8cm, draw=green!70, fill=green!15, text=black, font=\tiny, rounded corners=3pt, text width=3cm, align=center]
\tikzstyle{deploy-box} = [rectangle, minimum width=3.2cm, minimum height=1.8cm, draw=orange!70, fill=orange!15, text=black, font=\tiny, rounded corners=3pt, text width=3cm, align=center]
\tikzstyle{quality-box} = [rectangle, minimum width=3.2cm, minimum height=1.8cm, draw=purple!70, fill=purple!15, text=black, font=\tiny, rounded corners=3pt, text width=3cm, align=center]
\tikzstyle{arrow} = [thick, ->, >=stealth, blue!60]

% ç¬¬ä¸€è¡Œï¼šå¼€å‘é˜¶æ®µ
\node[stage-box] (commit) at (0,8) {
\textbf{ä»£ç æäº¤}\\
â€¢ Git Push\\
â€¢ åˆ†æ”¯åˆå¹¶\\
â€¢ è§¦å‘æµæ°´çº¿\\
â€¢ Webhookå¯åŠ¨
};

\node[quality-box] (scan) at (4.5,8) {
\textbf{ä»£ç æ‰«æ}\\
â€¢ SonarQube\\
â€¢ ESLintè§„èŒƒ\\
â€¢ å®‰å…¨æ¼æ´\\
â€¢ ä»£ç è´¨é‡
};

\node[stage-box] (build) at (9,8) {
\textbf{ç¼–è¯‘æ„å»º}\\
â€¢ Maven Build\\
â€¢ ä¾èµ–ä¸‹è½½\\
â€¢ ä»£ç ç¼–è¯‘\\
â€¢ æ„å»ºäº§ç‰©
};

% ç¬¬äºŒè¡Œï¼šæµ‹è¯•é˜¶æ®µ
\node[test-box] (unit-test) at (0,5.5) {
\textbf{å•å…ƒæµ‹è¯•}\\
â€¢ JUnitæµ‹è¯•\\
â€¢ è¦†ç›–ç‡æ£€æŸ¥\\
â€¢ Mockæµ‹è¯•\\
â€¢ æµ‹è¯•æŠ¥å‘Š
};

\node[test-box] (integration) at (4.5,5.5) {
\textbf{é›†æˆæµ‹è¯•}\\
â€¢ TestContainers\\
â€¢ æ•°æ®åº“æµ‹è¯•\\
â€¢ APIæµ‹è¯•\\
â€¢ ç«¯åˆ°ç«¯æµ‹è¯•
};

\node[test-box] (performance) at (9,5.5) {
\textbf{æ€§èƒ½æµ‹è¯•}\\
â€¢ JMeterå‹æµ‹\\
â€¢ å“åº”æ—¶é—´\\
â€¢ å¹¶å‘æµ‹è¯•\\
â€¢ èµ„æºç›‘æ§
};

% ç¬¬ä¸‰è¡Œï¼šæ‰“åŒ…éƒ¨ç½²é˜¶æ®µ
\node[deploy-box] (package) at (0,3) {
\textbf{é•œåƒæ„å»º}\\
â€¢ Docker Build\\
â€¢ å¤šé˜¶æ®µæ„å»º\\
â€¢ é•œåƒä¼˜åŒ–\\
â€¢ ç‰ˆæœ¬æ ‡ç­¾
};

\node[deploy-box] (registry) at (4.5,3) {
\textbf{é•œåƒæ¨é€}\\
â€¢ Harborä»“åº“\\
â€¢ é•œåƒæ‰«æ\\
â€¢ ç‰ˆæœ¬ç®¡ç†\\
â€¢ æ¼æ´æ£€æµ‹
};

\node[deploy-box] (deploy-test) at (9,3) {
\textbf{æµ‹è¯•ç¯å¢ƒ}\\
â€¢ è‡ªåŠ¨éƒ¨ç½²\\
â€¢ å¥åº·æ£€æŸ¥\\
â€¢ å†’çƒŸæµ‹è¯•\\
â€¢ åŠŸèƒ½éªŒè¯
};

% ç¬¬å››è¡Œï¼šç”Ÿäº§å‘å¸ƒé˜¶æ®µ
\node[deploy-box] (approval) at (2.25,0.5) {
\textbf{å‘å¸ƒå®¡æ‰¹}\\
â€¢ äººå·¥å®¡æ ¸\\
â€¢ å˜æ›´ç”³è¯·\\
â€¢ é£é™©è¯„ä¼°\\
â€¢ å‘å¸ƒçª—å£
};

\node[deploy-box] (deploy-prod) at (6.75,0.5) {
\textbf{ç”Ÿäº§éƒ¨ç½²}\\
â€¢ è“ç»¿éƒ¨ç½²\\
â€¢ æ»šåŠ¨æ›´æ–°\\
â€¢ å®æ—¶ç›‘æ§\\
â€¢ å›æ»šæœºåˆ¶
};

% è¿æ¥ç®­å¤´ - ç¬¬ä¸€è¡Œ
\draw[arrow] (commit) -- (scan);
\draw[arrow] (scan) -- (build);

% è¿æ¥ç®­å¤´ - ç¬¬ä¸€è¡Œåˆ°ç¬¬äºŒè¡Œ
\draw[arrow] (build) -- (9,6.8) -- (9,6.2);
\draw[arrow] (build) -- (9,6.8) -- (4.5,6.8) -- (4.5,6.2);
\draw[arrow] (build) -- (9,6.8) -- (0,6.8) -- (0,6.2);

% è¿æ¥ç®­å¤´ - ç¬¬äºŒè¡Œå†…éƒ¨ï¼ˆå¹¶è¡Œæµ‹è¯•å®Œæˆåæ±‡èšï¼‰
\draw[arrow] (unit-test) -- (0,4.3) -- (4.5,4.3);
\draw[arrow] (integration) -- (4.5,4.3);
\draw[arrow] (performance) -- (9,4.3) -- (4.5,4.3);

% è¿æ¥ç®­å¤´ - ç¬¬äºŒè¡Œåˆ°ç¬¬ä¸‰è¡Œ
\draw[arrow] (4.5,4.3) -- (4.5,3.7);
\draw[arrow] (4.5,4.3) -- (0,4.3) -- (0,3.7);
\draw[arrow] (4.5,4.3) -- (9,4.3) -- (9,3.7);

% è¿æ¥ç®­å¤´ - ç¬¬ä¸‰è¡Œ
\draw[arrow] (package) -- (registry);
\draw[arrow] (registry) -- (deploy-test);

% è¿æ¥ç®­å¤´ - ç¬¬ä¸‰è¡Œåˆ°ç¬¬å››è¡Œ
\draw[arrow] (deploy-test) -- (9,2.2) -- (2.25,2.2) -- (2.25,1.2);
\draw[arrow] (approval) -- (deploy-prod);

% èƒŒæ™¯åˆ†ç»„
\draw[dashed, gray!50, line width=1pt] (-1.5,9.2) rectangle (10.5,7.3);
\draw[dashed, gray!50, line width=1pt] (-1.5,6.8) rectangle (10.5,4.8);
\draw[dashed, gray!50, line width=1pt] (-1.5,4.3) rectangle (10.5,2.3);
\draw[dashed, gray!50, line width=1pt] (0.5,-0.2) rectangle (8.5,1.8);

% é˜¶æ®µæ ‡ç­¾
\node[font=\small\bfseries, text=blue!80] at (-1,8.25) {å¼€å‘é˜¶æ®µ};
\node[font=\small\bfseries, text=green!80] at (-1,5.75) {æµ‹è¯•é˜¶æ®µ};
\node[font=\small\bfseries, text=orange!80] at (-1,3.25) {æ„å»ºé˜¶æ®µ};
\node[font=\small\bfseries, text=red!80] at (-1,1.15) {å‘å¸ƒé˜¶æ®µ};

% å³ä¾§ä¿¡æ¯é¢æ¿
\node[rectangle, draw=black, fill=yellow!10, text width=3.8cm, font=\tiny] at (13.5,4.5) {
\textbf{CI/CDç‰¹æ€§}\\
â€¢ å…¨è‡ªåŠ¨åŒ–æµæ°´çº¿\\
â€¢ å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ\\
â€¢ è´¨é‡é—¨ç¦æ§åˆ¶\\
â€¢ è“ç»¿éƒ¨ç½²ç­–ç•¥\\
â€¢ å®æ—¶ç›‘æ§å‘Šè­¦\\
\\
\textbf{å·¥å…·é“¾}\\
â€¢ Git + Jenkins\\
â€¢ Maven + Docker\\
â€¢ SonarQube + JUnit\\
â€¢ JMeter + Selenium\\
â€¢ Harbor + Kubernetes\\
\\
\textbf{æ‰§è¡Œæ—¶é—´}\\
â€¢ ä»£ç æ‰«æ: 2-3åˆ†é’Ÿ\\
â€¢ ç¼–è¯‘æ„å»º: 3-5åˆ†é’Ÿ\\
â€¢ è‡ªåŠ¨åŒ–æµ‹è¯•: 8-12åˆ†é’Ÿ\\
â€¢ é•œåƒæ„å»º: 2-4åˆ†é’Ÿ\\
â€¢ éƒ¨ç½²å‘å¸ƒ: 3-6åˆ†é’Ÿ\\
â€¢ æ€»è®¡: 18-30åˆ†é’Ÿ
};

\end{tikzpicture}
\caption{CI/CDæµæ°´çº¿æµç¨‹å›¾}
\label{fig:cicd-pipeline}
\end{figure}

\textbf{ä»£ç è´¨é‡æ£€æŸ¥}ï¼šæ¯æ¬¡ä»£ç æäº¤éƒ½ä¼šè§¦å‘è‡ªåŠ¨åŒ–çš„ä»£ç è´¨é‡æ£€æŸ¥ï¼ŒåŒ…æ‹¬é™æ€ä»£ç åˆ†æã€ä»£ç è§„èŒƒæ£€æŸ¥ã€å®‰å…¨æ¼æ´æ‰«æç­‰ã€‚

\textbf{è‡ªåŠ¨åŒ–æµ‹è¯•}ï¼šæµæ°´çº¿åŒ…å«å®Œæ•´çš„æµ‹è¯•é˜¶æ®µï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€APIæµ‹è¯•ç­‰ã€‚åªæœ‰æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚

\textbf{é•œåƒæ„å»ºä¸æ¨é€}ï¼šæµ‹è¯•é€šè¿‡åï¼Œè‡ªåŠ¨æ„å»ºDockeré•œåƒå¹¶æ¨é€åˆ°é•œåƒä»“åº“ã€‚é•œåƒä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ ‡ç­¾ï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç†ã€‚

\textbf{è‡ªåŠ¨åŒ–éƒ¨ç½²}ï¼šé€šè¿‡éƒ¨ç½²è„šæœ¬è‡ªåŠ¨æ›´æ–°å„ä¸ªç¯å¢ƒçš„æœåŠ¡ã€‚æ”¯æŒè“ç»¿éƒ¨ç½²å’Œæ»šåŠ¨æ›´æ–°ï¼Œç¡®ä¿éƒ¨ç½²è¿‡ç¨‹ä¸­æœåŠ¡ä¸ä¸­æ–­ã€‚

\subsubsection{éƒ¨ç½²è„šæœ¬ä¸å·¥å…·}

æˆ‘ä»¬å¼€å‘äº†ä¸€ç³»åˆ—éƒ¨ç½²è„šæœ¬ï¼Œç®€åŒ–éƒ¨ç½²æ“ä½œï¼š

\begin{lstlisting}[caption=æœåŠ¡å¯åŠ¨è„šæœ¬]
#!/bin/bash

# æœåŠ¡å¯åŠ¨è„šæœ¬ start-services.sh

set -e

echo "å¼€å§‹å¯åŠ¨é¥¿äº†ä¹ˆå¾®æœåŠ¡ç³»ç»Ÿ..."

# åˆ›å»ºç½‘ç»œ
docker network create elm-network 2>/dev/null || true

# å¯åŠ¨åŸºç¡€è®¾æ–½
echo "å¯åŠ¨åŸºç¡€è®¾æ–½..."
docker-compose -f infrastructure.yml up -d

# ç­‰å¾…åŸºç¡€è®¾æ–½å°±ç»ª
echo "ç­‰å¾…Nacoså¯åŠ¨..."
until curl -f http://localhost:8848/nacos; do
    sleep 5
done

echo "ç­‰å¾…MySQLå¯åŠ¨..."
until docker exec mysql mysqladmin ping -h"localhost" --silent; do
    sleep 5
done

# å¯åŠ¨å¾®æœåŠ¡
echo "å¯åŠ¨å¾®æœåŠ¡..."
docker-compose -f services.yml up -d

# å¥åº·æ£€æŸ¥
echo "æ‰§è¡Œå¥åº·æ£€æŸ¥..."
./health-check.sh

echo "æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆï¼"
echo "è®¿é—®åœ°å€ï¼š"
echo "- APIç½‘å…³: http://localhost:14000"
echo "- Nacosæ§åˆ¶å°: http://localhost:8848/nacos"
echo "- å‰ç«¯é¡µé¢: http://localhost:8080"
\end{lstlisting}

\begin{lstlisting}[caption=å¥åº·æ£€æŸ¥è„šæœ¬]
#!/bin/bash

# å¥åº·æ£€æŸ¥è„šæœ¬ health-check.sh

services=(
    "user-service:10100"
    "business-service:10300"
    "food-service:10200"
    "order-service:10601"
    "cart-service:10400"
    "address-service:10500"
    "gateway:14000"
)

echo "å¼€å§‹å¥åº·æ£€æŸ¥..."

for service in "${services[@]}"; do
    IFS=':' read -r name port <<< "$service"
    
    echo "æ£€æŸ¥ $name æœåŠ¡ (ç«¯å£ $port)..."
    
    max_attempts=30
    attempt=1
    
    while [ $attempt -le $max_attempts ]; do
        if curl -f "http://localhost:$port/actuator/health" >/dev/null 2>&1; then
            echo "âœ“ $name æœåŠ¡å¥åº·"
            break
        fi
        
        if [ $attempt -eq $max_attempts ]; then
            echo "âœ— $name æœåŠ¡å¯åŠ¨å¤±è´¥"
            exit 1
        fi
        
        echo "  å°è¯• $attempt/$max_attempts - ç­‰å¾…æœåŠ¡å¯åŠ¨..."
        sleep 10
        ((attempt++))
    done
done

echo "æ‰€æœ‰æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡ï¼"
\end{lstlisting}

\subsection{ç›‘æ§ä¸è¿ç»´}

\subsubsection{ç›‘æ§ä½“ç³»è®¾è®¡}

å»ºç«‹äº†å¤šç»´åº¦çš„ç›‘æ§ä½“ç³»ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œï¼š

\textbf{åº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰}ï¼šä½¿ç”¨Spring Boot Actuatoræš´éœ²åº”ç”¨çš„å¥åº·çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ç­‰ã€‚é›†æˆMicrometeræŒ‡æ ‡æ”¶é›†æ¡†æ¶ï¼Œæ”¯æŒå¤šç§ç›‘æ§ç³»ç»Ÿã€‚

\textbf{åŸºç¡€è®¾æ–½ç›‘æ§}ï¼šç›‘æ§æœåŠ¡å™¨çš„CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰èµ„æºä½¿ç”¨æƒ…å†µã€‚å½“èµ„æºä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨å‘é€å‘Šè­¦ã€‚

\textbf{ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§}ï¼šç›‘æ§å…³é”®ä¸šåŠ¡æŒ‡æ ‡ï¼Œå¦‚è®¢å•æ•°é‡ã€ç”¨æˆ·æ³¨å†Œæ•°ã€äº¤æ˜“é‡‘é¢ç­‰ã€‚é€šè¿‡ä¸šåŠ¡å¤§ç›˜å®æ—¶å±•ç¤ºç³»ç»Ÿçš„ä¸šåŠ¡çŠ¶å†µã€‚

\begin{table}[H]
\centering
\caption{å…³é”®ç›‘æ§æŒ‡æ ‡}
\begin{tabular}{|p{3cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|}
\hline
\textbf{ç›‘æ§ç±»å‹} & \textbf{ç›‘æ§æŒ‡æ ‡} & \textbf{å‘Šè­¦é˜ˆå€¼} & \textbf{æ£€æŸ¥é¢‘ç‡} & \textbf{å¤„ç†æ–¹å¼} \\
\hline
åº”ç”¨ç›‘æ§ & å“åº”æ—¶é—´ & >500ms & 1åˆ†é’Ÿ & çŸ­ä¿¡+é‚®ä»¶ \\
\hline
åº”ç”¨ç›‘æ§ & é”™è¯¯ç‡ & >1\% & 1åˆ†é’Ÿ & ç«‹å³å‘Šè­¦ \\
\hline
åº”ç”¨ç›‘æ§ & JVMå†…å­˜ä½¿ç”¨ & >80\% & 5åˆ†é’Ÿ & é‚®ä»¶å‘Šè­¦ \\
\hline
åŸºç¡€è®¾æ–½ & CPUä½¿ç”¨ç‡ & >80\% & 1åˆ†é’Ÿ & è‡ªåŠ¨æ‰©å®¹ \\
\hline
åŸºç¡€è®¾æ–½ & ç£ç›˜ä½¿ç”¨ç‡ & >85\% & 5åˆ†é’Ÿ & çŸ­ä¿¡å‘Šè­¦ \\
\hline
ä¸šåŠ¡æŒ‡æ ‡ & ä¸‹å•æˆåŠŸç‡ & <95\% & 1åˆ†é’Ÿ & ç«‹å³å‘Šè­¦ \\
\hline
\end{tabular}
\end{table}

\subsubsection{è¿ç»´è‡ªåŠ¨åŒ–}

å»ºç«‹äº†å®Œå–„çš„è¿ç»´è‡ªåŠ¨åŒ–ä½“ç³»ï¼š

\textbf{è‡ªåŠ¨åŒ–æ‰©ç¼©å®¹}ï¼šåŸºäºCPUã€å†…å­˜ä½¿ç”¨ç‡ç­‰æŒ‡æ ‡ï¼Œè‡ªåŠ¨è¿›è¡ŒæœåŠ¡å®ä¾‹çš„æ‰©å®¹å’Œç¼©å®¹ã€‚åœ¨ä¸šåŠ¡é«˜å³°æœŸè‡ªåŠ¨å¢åŠ å®ä¾‹ï¼Œåœ¨ä½å³°æœŸè‡ªåŠ¨å‡å°‘å®ä¾‹ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€‚

\textbf{æ•…éšœè‡ªåŠ¨æ¢å¤}ï¼šå½“æ£€æµ‹åˆ°æœåŠ¡å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œé‡å¯æ“ä½œã€‚å¦‚æœé‡å¯å¤±è´¥ï¼Œåˆ™åˆ‡æ¢åˆ°å¤‡ç”¨å®ä¾‹ï¼Œå¹¶å‘é€å‘Šè­¦é€šçŸ¥è¿ç»´äººå‘˜ã€‚

\textbf{å¤‡ä»½è‡ªåŠ¨åŒ–}ï¼šå®šæœŸè‡ªåŠ¨å¤‡ä»½æ•°æ®åº“å’Œé‡è¦é…ç½®æ–‡ä»¶ã€‚å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨å¤šä¸ªä½ç½®ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚

\subsection{éƒ¨ç½²éªŒè¯ä¸æµ‹è¯•}

\subsubsection{éƒ¨ç½²éªŒè¯æµç¨‹}

åˆ¶å®šäº†ä¸¥æ ¼çš„éƒ¨ç½²éªŒè¯æµç¨‹ï¼Œç¡®ä¿æ¯æ¬¡éƒ¨ç½²çš„è´¨é‡ï¼š

\textbf{å†’çƒŸæµ‹è¯•}ï¼šéƒ¨ç½²å®Œæˆåï¼Œé¦–å…ˆæ‰§è¡Œå†’çƒŸæµ‹è¯•ï¼ŒéªŒè¯æ ¸å¿ƒåŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚åŒ…æ‹¬ç”¨æˆ·æ³¨å†Œç™»å½•ã€å•†å“æµè§ˆã€ä¸‹å•æ”¯ä»˜ç­‰å…³é”®æµç¨‹ã€‚

\textbf{å›å½’æµ‹è¯•}ï¼šæ‰§è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•å¥—ä»¶ï¼Œç¡®ä¿æ–°ç‰ˆæœ¬æ²¡æœ‰å¼•å…¥å›å½’é—®é¢˜ã€‚æµ‹è¯•è¦†ç›–æ‰€æœ‰çš„åŠŸèƒ½æ¨¡å—å’Œè¾¹ç•Œæ¡ä»¶ã€‚

\textbf{æ€§èƒ½æµ‹è¯•}ï¼šå¯¹æ–°éƒ¨ç½²çš„ç‰ˆæœ¬è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼Œç¡®ä¿æ€§èƒ½æŒ‡æ ‡æ»¡è¶³è¦æ±‚ã€‚åŒ…æ‹¬å¹¶å‘ç”¨æˆ·æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ç­‰ã€‚

\textbf{ç°åº¦å‘å¸ƒéªŒè¯}ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé‡‡ç”¨ç°åº¦å‘å¸ƒçš„æ–¹å¼ï¼Œå…ˆå‘å°‘é‡ç”¨æˆ·å¼€æ”¾æ–°ç‰ˆæœ¬ï¼ŒéªŒè¯ç¨³å®šæ€§åå†å…¨é‡å‘å¸ƒã€‚

\begin{table}[H]
\centering
\caption{éƒ¨ç½²éªŒè¯æ£€æŸ¥æ¸…å•}
\begin{tabular}{|p{3cm}|p{4cm}|p{2.5cm}|p{3cm}|}
\hline
\textbf{éªŒè¯é˜¶æ®µ} & \textbf{éªŒè¯å†…å®¹} & \textbf{é€šè¿‡æ ‡å‡†} & \textbf{è´Ÿè´£äºº} \\
\hline
åŸºç¡€éªŒè¯ & æ‰€æœ‰æœåŠ¡å¯åŠ¨æ­£å¸¸ & å¥åº·æ£€æŸ¥é€šè¿‡ & è¿ç»´å·¥ç¨‹å¸ˆ \\
\hline
åŠŸèƒ½éªŒè¯ & æ ¸å¿ƒä¸šåŠ¡æµç¨‹æµ‹è¯• & å…³é”®è·¯å¾„æ— å¼‚å¸¸ & æµ‹è¯•å·¥ç¨‹å¸ˆ \\
\hline
æ€§èƒ½éªŒè¯ & å“åº”æ—¶é—´å’Œååé‡ & æ»¡è¶³SLAè¦æ±‚ & æ€§èƒ½å·¥ç¨‹å¸ˆ \\
\hline
å®‰å…¨éªŒè¯ & å®‰å…¨é…ç½®å’Œæƒé™ & æ— å®‰å…¨æ¼æ´ & å®‰å…¨å·¥ç¨‹å¸ˆ \\
\hline
ç›‘æ§éªŒè¯ & ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦ & ç›‘æ§æ­£å¸¸å·¥ä½œ & è¿ç»´å·¥ç¨‹å¸ˆ \\
\hline
\end{tabular}
\end{table}

\subsubsection{éƒ¨ç½²å›æ»šæœºåˆ¶}

å»ºç«‹äº†å®Œå–„çš„å›æ»šæœºåˆ¶ï¼Œç¡®ä¿åœ¨å‡ºç°é—®é¢˜æ—¶èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ï¼š

\textbf{ç‰ˆæœ¬ç®¡ç†}ï¼šæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒ…æ‹¬ä»£ç ç‰ˆæœ¬ã€é•œåƒç‰ˆæœ¬ã€é…ç½®ç‰ˆæœ¬ç­‰ã€‚ç‰ˆæœ¬ä¿¡æ¯è®°å½•åœ¨ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿä¸­ã€‚

\textbf{å¿«é€Ÿå›æ»š}ï¼šå½“å‘ç°éƒ¨ç½²é—®é¢˜æ—¶ï¼Œå¯ä»¥ä¸€é”®å›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬ã€‚å›æ»šè¿‡ç¨‹åŒ…æ‹¬ä»£ç å›æ»šã€é…ç½®å›æ»šã€æ•°æ®åº“å›æ»šç­‰ã€‚

\textbf{æ•°æ®ä¸€è‡´æ€§ä¿è¯}ï¼šåœ¨å›æ»šè¿‡ç¨‹ä¸­ï¼Œç‰¹åˆ«æ³¨æ„æ•°æ®çš„ä¸€è‡´æ€§ã€‚å¯¹äºä¸å…¼å®¹çš„æ•°æ®åº“å˜æ›´ï¼Œéœ€è¦æ‰§è¡Œç›¸åº”çš„æ•°æ®è¿ç§»è„šæœ¬ã€‚

\begin{lstlisting}[caption=ç‰ˆæœ¬å›æ»šè„šæœ¬]
#!/bin/bash

# ç‰ˆæœ¬å›æ»šè„šæœ¬ rollback.sh

set -e

if [ $# -ne 1 ]; then
    echo "ç”¨æ³•: $0 <ç›®æ ‡ç‰ˆæœ¬>"
    echo "ç¤ºä¾‹: $0 v1.2.3"
    exit 1
fi

TARGET_VERSION=$1
CURRENT_VERSION=$(cat /opt/elm/current-version)

echo "å¼€å§‹å›æ»šæ“ä½œ..."
echo "å½“å‰ç‰ˆæœ¬: $CURRENT_VERSION"
echo "ç›®æ ‡ç‰ˆæœ¬: $TARGET_VERSION"

# ç¡®è®¤å›æ»š
read -p "ç¡®è®¤å›æ»šåˆ°ç‰ˆæœ¬ $TARGET_VERSION? (y/N): " confirm
if [ "$confirm" != "y" ]; then
    echo "å›æ»šæ“ä½œå·²å–æ¶ˆ"
    exit 0
fi

# åœæ­¢å½“å‰æœåŠ¡
echo "åœæ­¢å½“å‰æœåŠ¡..."
docker-compose -f /opt/elm/current/docker-compose.yml down

# åˆ‡æ¢åˆ°ç›®æ ‡ç‰ˆæœ¬
echo "åˆ‡æ¢åˆ°ç›®æ ‡ç‰ˆæœ¬..."
rm -f /opt/elm/current
ln -s /opt/elm/versions/$TARGET_VERSION /opt/elm/current

# å¯åŠ¨æœåŠ¡
echo "å¯åŠ¨ç›®æ ‡ç‰ˆæœ¬æœåŠ¡..."
docker-compose -f /opt/elm/current/docker-compose.yml up -d

# å¥åº·æ£€æŸ¥
echo "æ‰§è¡Œå¥åº·æ£€æŸ¥..."
./health-check.sh

# æ›´æ–°ç‰ˆæœ¬è®°å½•
echo $TARGET_VERSION > /opt/elm/current-version

echo "å›æ»šå®Œæˆï¼"
echo "å½“å‰è¿è¡Œç‰ˆæœ¬: $TARGET_VERSION"
\end{lstlisting}

\section{æ€»ç»“ä¸å±•æœ›}

\subsection{é¡¹ç›®æ€»ç»“}

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†åŸºäºSpring Cloud Alibabaå’ŒDDDæ¶æ„çš„é¥¿äº†ä¹ˆå¤–å–å¹³å°ã€‚é€šè¿‡å‡ ä¸ªæœˆçš„è®¾è®¡å’Œå¼€å‘ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„å…ˆè¿›çš„å¾®æœåŠ¡ç³»ç»Ÿã€‚

åœ¨æŠ€æœ¯æ¶æ„æ–¹é¢ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸šç•Œå…ˆè¿›çš„å¾®æœåŠ¡æ¶æ„æ¨¡å¼ã€‚Spring Cloud Alibabaæä¾›äº†å®Œæ•´çš„å¾®æœåŠ¡æ²»ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬æœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§ç­‰ã€‚è¿™äº›æŠ€æœ¯çš„åº”ç”¨ä½¿å¾—ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

DDDæ¶æ„çš„å¼•å…¥æ˜¯æœ¬é¡¹ç›®çš„ä¸€å¤§äº®ç‚¹ã€‚é€šè¿‡é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œæˆ‘ä»¬å°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ç»„ç»‡æˆæ¸…æ™°çš„é¢†åŸŸæ¨¡å‹ã€‚èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡ã€é¢†åŸŸæœåŠ¡ç­‰æ¦‚å¿µçš„åº”ç”¨ï¼Œä½¿å¾—ä»£ç ç»“æ„æ›´åŠ è´´è¿‘ä¸šåŠ¡å®é™…ã€‚é¢†åŸŸäº‹ä»¶æœºåˆ¶çš„ä½¿ç”¨ï¼Œå®ç°äº†ä¸šåŠ¡æµç¨‹çš„è§£è€¦ï¼Œæé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ã€‚

åœ¨å®æ–½è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸¥æ ¼éµå¾ªäº†å¾®æœåŠ¡çš„è®¾è®¡åŸåˆ™ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰æ˜ç¡®çš„è¾¹ç•Œå’ŒèŒè´£ï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡å®šä¹‰è‰¯å¥½çš„æ¥å£è¿›è¡Œé€šä¿¡ã€‚æ•°æ®çš„ç‹¬ç«‹æ€§å¾—åˆ°äº†ä¿è¯ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“ã€‚è¿™ç§è®¾è®¡ä½¿å¾—å„ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚

æ€§èƒ½ä¼˜åŒ–æ˜¯é¡¹ç›®å®æ–½çš„é‡è¦éƒ¨åˆ†ã€‚é€šè¿‡åˆç†çš„ç¼“å­˜ç­–ç•¥ã€æ•°æ®åº“ä¼˜åŒ–ã€å¼‚æ­¥å¤„ç†ç­‰æ‰‹æ®µï¼Œç³»ç»Ÿçš„æ€§èƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚å‹åŠ›æµ‹è¯•çš„ç»“æœè¡¨æ˜ï¼Œç³»ç»Ÿèƒ½å¤Ÿæ‰¿å—è¾ƒé«˜çš„å¹¶å‘è®¿é—®ï¼Œæ»¡è¶³å®é™…ä¸šåŠ¡çš„éœ€æ±‚ã€‚

\subsection{æŠ€æœ¯åˆ›æ–°ç‚¹}

æœ¬é¡¹ç›®åœ¨å¤šä¸ªæ–¹é¢å®ç°äº†æŠ€æœ¯åˆ›æ–°ï¼Œå±•ç°äº†å¯¹ç°ä»£è½¯ä»¶æ¶æ„çš„æ·±å…¥ç†è§£å’Œå®è·µèƒ½åŠ›ã€‚

\subsubsection{DDDæ¶æ„çš„å·¥ç¨‹åŒ–å®è·µ}

é¦–å…ˆæ˜¯DDDæ¶æ„çš„å®Œæ•´å®ç°ã€‚æˆ‘ä»¬ä¸ä»…åœ¨ç†è®ºä¸Šç†è§£äº†DDDçš„æ¦‚å¿µï¼Œæ›´åœ¨å®è·µä¸­å®Œæ•´åœ°å®ç°äº†DDDçš„æ¶æ„æ¨¡å¼ã€‚ä»æˆ˜ç•¥è®¾è®¡åˆ°æˆ˜æœ¯è®¾è®¡ï¼Œä»é™ç•Œä¸Šä¸‹æ–‡åˆ°èšåˆè®¾è®¡ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½ç»è¿‡äº†æ·±æ€ç†Ÿè™‘ã€‚

ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å®ç°äº†DDDåŸºç¡€è®¾æ–½çš„æ¨¡å—åŒ–å°è£…ã€‚é€šè¿‡`shared_kernel`æ¨¡å—ï¼Œæˆ‘ä»¬æä¾›äº†å¯å¤ç”¨çš„DDDåŸºç¡€ç±»åº“ï¼ŒåŒ…æ‹¬Entityã€ValueObjectã€AggregateRootã€DomainEventç­‰æ ¸å¿ƒæŠ½è±¡ã€‚è¿™ç§è®¾è®¡ä¸ä»…é¿å…äº†ä»£ç é‡å¤ï¼Œè¿˜ä¸ºå›¢é˜Ÿæä¾›äº†ç»Ÿä¸€çš„DDDå®è·µè§„èŒƒã€‚

åœ¨å€¼å¯¹è±¡çš„è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬ä¸¥æ ¼éµå¾ªäº†ä¸å¯å˜æ€§åŸåˆ™ã€‚ä»¥Passwordå€¼å¯¹è±¡ä¸ºä¾‹ï¼Œé€šè¿‡å·¥å‚æ–¹æ³•æ¨¡å¼å’Œç§æœ‰æ„é€ å‡½æ•°ï¼Œç¡®ä¿äº†å¯†ç å¯¹è±¡ä¸€æ—¦åˆ›å»ºå°±æ— æ³•ä¿®æ”¹ï¼ŒåŒæ—¶å°è£…äº†å¯†ç çš„éªŒè¯å’ŒåŠ å¯†é€»è¾‘ã€‚è¿™ç§è®¾è®¡å¤§å¤§å‡å°‘äº†å› å¯å˜çŠ¶æ€å¯¼è‡´çš„Bugã€‚

\subsubsection{äº‹ä»¶é©±åŠ¨æ¶æ„çš„åˆ†å±‚å®ç°}

äº‹ä»¶é©±åŠ¨æ¶æ„çš„åº”ç”¨æ˜¯å¦ä¸€ä¸ªåˆ›æ–°ç‚¹ã€‚æˆ‘ä»¬å®ç°äº†åˆ†å±‚çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œä»æœ¬åœ°äº‹ä»¶åˆ°åˆ†å¸ƒå¼äº‹ä»¶çš„å¹³æ»‘æ¼”è¿›è·¯å¾„ã€‚

åœ¨å½“å‰é˜¶æ®µï¼Œæˆ‘ä»¬åŸºäºSpringçš„ApplicationEventPublisherå®ç°äº†æœ¬åœ°äº‹ä»¶æ€»çº¿ã€‚æ‰€æœ‰çš„é¢†åŸŸäº‹ä»¶éƒ½åœ¨åŒä¸€ä¸ªJVMå†…éƒ¨ä¼ æ’­ï¼Œç¡®ä¿äº†äº‹ä»¶å¤„ç†çš„å¼ºä¸€è‡´æ€§å’Œé«˜æ€§èƒ½ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¸ºæœªæ¥çš„åˆ†å¸ƒå¼äº‹ä»¶é¢„ç•™äº†æ‰©å±•æ¥å£ã€‚

\begin{lstlisting}[caption=äº‹ä»¶é©±åŠ¨æ¶æ„çš„æ¼”è¿›è·¯å¾„]
// å½“å‰å®ç°ï¼šæœ¬åœ°äº‹ä»¶æ€»çº¿
@Component  
public class LocalEventBus implements DomainEventPublisher {
    private final ApplicationEventPublisher publisher;
    
    @Override
    public void publish(DomainEvent event) {
        publisher.publishEvent(event);
    }
}

// æœªæ¥æ‰©å±•ï¼šåˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿
@Component
public class DistributedEventBus implements DomainEventPublisher {
    private final MessageProducer messageProducer;
    
    @Override
    public void publish(DomainEvent event) {
        messageProducer.send(event.getEventType(), event);
    }
}
\end{lstlisting}

\subsubsection{å¾®æœåŠ¡æ²»ç†çš„æ·±åº¦å®šåˆ¶}

åœ¨å¾®æœåŠ¡æ²»ç†æ–¹é¢ï¼Œæˆ‘ä»¬å®ç°äº†å®Œæ•´çš„æœåŠ¡æ²»ç†ä½“ç³»ã€‚æœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ä¸­å¿ƒã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§ã€é™æµç­‰æœºåˆ¶çš„ç»¼åˆåº”ç”¨ï¼Œä¿è¯äº†ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚

ç‰¹åˆ«æ˜¯è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°ï¼Œå±•ç¤ºäº†å¯¹å¾®æœåŠ¡æŠ€æœ¯çš„æ·±å…¥ç†è§£ã€‚è¿™ç§æ··åˆç­–ç•¥åœ¨æœåŠ¡å¯åŠ¨é˜¶æ®µä½¿ç”¨éšæœºç®—æ³•ï¼Œé¿å…äº†"æƒŠç¾¤æ•ˆåº”"ï¼›åœ¨ç¨³å®šè¿è¡Œé˜¶æ®µåˆ‡æ¢åˆ°è½®è¯¢ç®—æ³•ï¼Œä¿è¯äº†è´Ÿè½½çš„å‡åŒ€åˆ†å¸ƒã€‚

\begin{lstlisting}[caption=æ™ºèƒ½è´Ÿè½½å‡è¡¡ç­–ç•¥]
public class AdaptiveLoadBalancer implements ReactorServiceInstanceLoadBalancer {
    
    private final AtomicInteger requestCount = new AtomicInteger(0);
    private final LoadBalancerProperties properties;
    
    @Override
    public Mono<Response<ServiceInstance>> choose(Request request) {
        return supplier.get(request).next().map(this::selectInstance);
    }
    
    private Response<ServiceInstance> selectInstance(List<ServiceInstance> instances) {
        int count = requestCount.incrementAndGet();
        
        // å‰Næ¬¡è¯·æ±‚ä½¿ç”¨éšæœºç­–ç•¥ï¼Œé¿å…å¯åŠ¨æ—¶çš„çƒ­ç‚¹é—®é¢˜
        if (count <= properties.getRandomPhaseThreshold()) {
            return randomSelect(instances);
        }
        
        // ç¨³å®šæœŸä½¿ç”¨åŠ æƒè½®è¯¢ç­–ç•¥ï¼Œè€ƒè™‘å®ä¾‹çš„æƒé‡å’Œå¥åº·çŠ¶æ€
        return weightedRoundRobinSelect(instances);
    }
}
\end{lstlisting}

\subsubsection{å®‰å…¨æ¶æ„çš„å¤šå±‚é˜²æŠ¤}

å®‰å…¨æ¶æ„çš„è®¾è®¡ä¹Ÿå€¼å¾—ä¸€æã€‚æˆ‘ä»¬æ„å»ºäº†å¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼š

1. **æ¥å…¥å±‚å®‰å…¨**ï¼šAPIç½‘å…³ç»Ÿä¸€è®¤è¯ï¼ŒJWTä»¤ç‰ŒéªŒè¯ï¼Œè¯·æ±‚é™æµé˜²æŠ¤
2. **æœåŠ¡å±‚å®‰å…¨**ï¼šæ–¹æ³•çº§æƒé™æ§åˆ¶ï¼Œæ•æ„Ÿæ•°æ®è„±æ•ï¼Œå®¡è®¡æ—¥å¿—è®°å½•
3. **æ•°æ®å±‚å®‰å…¨**ï¼šæ•°æ®åº“è®¿é—®æ§åˆ¶ï¼Œå­—æ®µçº§åŠ å¯†ï¼Œå¤‡ä»½æ¢å¤ç­–ç•¥

JWTä»¤ç‰Œçš„è®¾è®¡è€ƒè™‘äº†å®‰å…¨æ€§å’Œæ€§èƒ½çš„å¹³è¡¡ã€‚ä»¤ç‰ŒåŒ…å«äº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œæƒé™åˆ—è¡¨ï¼Œé¿å…äº†é¢‘ç¹çš„æ•°æ®åº“æŸ¥è¯¢ã€‚åŒæ—¶ï¼Œé€šè¿‡Redisç¼“å­˜ç”¨æˆ·ä¼šè¯ï¼Œæ”¯æŒä»¤ç‰Œçš„ä¸»åŠ¨å¤±æ•ˆã€‚

\subsection{æ¶æ„æ¼”è¿›ä¸æŠ€æœ¯è§„åˆ’}

\subsubsection{ä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›è·¯å¾„}

æœ¬é¡¹ç›®å±•ç¤ºäº†ä»ä¼ ç»Ÿå•ä½“æ¶æ„å‘ç°ä»£å¾®æœåŠ¡æ¶æ„æ¼”è¿›çš„å®Œæ•´è·¯å¾„ã€‚æˆ‘ä»¬ä¿æŒäº†åŸæœ‰APIçš„å‘åå…¼å®¹æ€§ï¼Œé€šè¿‡æ–°æ—§å¹¶å­˜çš„æ–¹å¼å®ç°äº†å¹³æ»‘è¿ç§»ã€‚

\begin{table}[H]
\centering
\caption{æ¶æ„æ¼”è¿›å¯¹æ¯”}
\begin{tabular}{|p{3cm}|p{5cm}|p{5cm}|}
\hline
\textbf{ç»´åº¦} & \textbf{åŸæœ‰æ¶æ„} & \textbf{æ–°æ¶æ„} \\
\hline
æ¶æ„æ¨¡å¼ & åˆ†å±‚æ¶æ„ï¼ˆè´«è¡€æ¨¡å‹ï¼‰ & DDD + å¾®æœåŠ¡ï¼ˆå……è¡€æ¨¡å‹ï¼‰ \\
\hline
æ•°æ®ç®¡ç† & å•ä¸€æ•°æ®åº“ & æ¯æœåŠ¡ç‹¬ç«‹æ•°æ®åº“ \\
\hline
é€šä¿¡æ–¹å¼ & æœ¬åœ°æ–¹æ³•è°ƒç”¨ & HTTP/RPC + äº‹ä»¶é©±åŠ¨ \\
\hline
éƒ¨ç½²æ–¹å¼ & å•ä½“éƒ¨ç½² & ç‹¬ç«‹éƒ¨ç½² \\
\hline
æ‰©å±•æ–¹å¼ & å‚ç›´æ‰©å±• & æ°´å¹³æ‰©å±• \\
\hline
æŠ€æœ¯æ ˆ & Spring Boot + MyBatis & Spring Cloud Alibaba + DDD \\
\hline
\end{tabular}
\end{table}

\subsubsection{äº‘åŸç”ŸæŠ€æœ¯æ ˆè§„åˆ’}

é¢å‘æœªæ¥ï¼Œæˆ‘ä»¬è§„åˆ’äº†å‘äº‘åŸç”ŸæŠ€æœ¯æ ˆçš„æ¼”è¿›è·¯å¾„ï¼š

\textbf{å®¹å™¨åŒ–æ”¹é€ }ï¼šå°†æ‰€æœ‰å¾®æœåŠ¡è¿›è¡ŒDockerå®¹å™¨åŒ–ï¼Œå®ç°"ä¸€æ¬¡æ„å»ºï¼Œåˆ°å¤„è¿è¡Œ"ã€‚å®¹å™¨åŒ–ä¸ä»…ç®€åŒ–äº†éƒ¨ç½²æµç¨‹ï¼Œè¿˜ä¸ºåç»­çš„Kubernetesç¼–æ’å¥ å®šäº†åŸºç¡€ã€‚

\textbf{Kubernetesé›†ç¾¤ç®¡ç†}ï¼šä½¿ç”¨Kubernetesè¿›è¡Œå®¹å™¨ç¼–æ’ï¼Œå®ç°æœåŠ¡çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å®¹ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚é€šè¿‡Helm Chartç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚

\textbf{Service Meshæ¶æ„}ï¼šå¼•å…¥Istioç­‰Service MeshæŠ€æœ¯ï¼Œå°†æœåŠ¡æ²»ç†ä»åº”ç”¨å±‚ä¸‹æ²‰åˆ°åŸºç¡€è®¾æ–½å±‚ã€‚è¿™å°†è¿›ä¸€æ­¥ç®€åŒ–å¾®æœåŠ¡çš„å¼€å‘ï¼Œæå‡ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§ã€‚

\textbf{äº‘åŸç”Ÿæ•°æ®åº“}ï¼šè¿ç§»åˆ°äº‘åŸç”Ÿæ•°æ®åº“è§£å†³æ–¹æ¡ˆï¼Œå¦‚TiDBã€ClickHouseç­‰ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ã€‚

\subsubsection{CQRSä¸äº‹ä»¶æº¯æº}

åœ¨DDDçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è®¡åˆ’å¼•å…¥CQRSï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰å’Œäº‹ä»¶æº¯æºæ¨¡å¼ï¼š

\begin{lstlisting}[caption=CQRSæ¶æ„è®¾è®¡]
// å‘½ä»¤ç«¯ï¼šå¤„ç†å†™æ“ä½œ
@CommandHandler
public class UserCommandHandler {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private EventStore eventStore;
    
    public void handle(CreateUserCommand command) {
        User user = User.create(command);
        userRepository.save(user);
        
        // å­˜å‚¨äº‹ä»¶åˆ°äº‹ä»¶å­˜å‚¨
        eventStore.store(user.getDomainEvents());
    }
}

// æŸ¥è¯¢ç«¯ï¼šå¤„ç†è¯»æ“ä½œ
@QueryHandler  
public class UserQueryHandler {
    
    @Autowired
    private UserReadModelRepository readModelRepository;
    
    public UserDTO handle(GetUserQuery query) {
        return readModelRepository.findByUserId(query.getUserId());
    }
}

// äº‹ä»¶å¤„ç†å™¨ï¼šæ›´æ–°è¯»æ¨¡å‹
@EventHandler
public class UserReadModelUpdater {
    
    @Autowired
    private UserReadModelRepository readModelRepository;
    
    public void on(UserCreatedEvent event) {
        UserReadModel readModel = new UserReadModel(event);
        readModelRepository.save(readModel);
    }
}
\end{lstlisting}

CQRSæ¨¡å¼å°†æå¤§æå‡ç³»ç»Ÿçš„æŸ¥è¯¢æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚æŠ¥è¡¨å’Œæ•°æ®åˆ†æåœºæ™¯ä¸‹ã€‚äº‹ä»¶æº¯æºåˆ™ä¸ºç³»ç»Ÿæä¾›äº†å®Œæ•´çš„å®¡è®¡è·Ÿè¸ªèƒ½åŠ›ã€‚

\subsubsection{æ™ºèƒ½åŒ–è¿ç»´ä½“ç³»}

æœªæ¥çš„è¿ç»´ä½“ç³»å°†å‘æ™ºèƒ½åŒ–æ–¹å‘å‘å±•ï¼š

\textbf{AIOpsæ™ºèƒ½è¿ç»´}ï¼šåŸºäºæœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ç°æ•…éšœçš„é¢„æµ‹å’Œè‡ªåŠ¨ä¿®å¤ã€‚é€šè¿‡åˆ†æå†å²æ•°æ®ï¼Œè¯†åˆ«ç³»ç»Ÿçš„å¼‚å¸¸æ¨¡å¼ã€‚

\textbf{è‡ªåŠ¨åŒ–æµ‹è¯•é“¾è·¯}ï¼šå»ºè®¾å®Œæ•´çš„CI/CDæµæ°´çº¿ï¼ŒåŒ…æ‹¬ä»£ç æ£€æŸ¥ã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å®‰å…¨æ‰«æç­‰ç¯èŠ‚ã€‚

\textbf{å¤šç»´åº¦ç›‘æ§ä½“ç³»}ï¼šä»ä¸šåŠ¡æŒ‡æ ‡ã€åº”ç”¨æ€§èƒ½ã€åŸºç¡€è®¾æ–½ç­‰å¤šä¸ªç»´åº¦å»ºè®¾ç›‘æ§ä½“ç³»ï¼Œå®ç°å…¨æ ˆçš„å¯è§‚æµ‹æ€§ã€‚

\subsection{ç»éªŒä¸æ”¶è·}

é€šè¿‡æœ¬é¡¹ç›®çš„å®æ–½ï¼Œæˆ‘ä»¬è·å¾—äº†å®è´µçš„ç»éªŒå’Œæ·±åˆ»çš„è®¤è¯†ã€‚é¦–å…ˆæ˜¯å¯¹å¾®æœåŠ¡æ¶æ„çš„ç†è§£æ›´åŠ æ·±å…¥ã€‚å¾®æœåŠ¡ä¸ä»…ä»…æ˜¯å°†å•ä½“åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªå°æœåŠ¡ï¼Œæ›´é‡è¦çš„æ˜¯å¦‚ä½•åˆç†åœ°åˆ’åˆ†æœåŠ¡è¾¹ç•Œï¼Œå¦‚ä½•å¤„ç†æœåŠ¡é—´çš„é€šä¿¡ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚

DDDçš„å®è·µè®©æˆ‘ä»¬è®¤è¯†åˆ°ï¼Œå¥½çš„æ¶æ„è®¾è®¡å¿…é¡»ä»ä¸šåŠ¡å‡ºå‘ã€‚æŠ€æœ¯æ˜¯ä¸ºä¸šåŠ¡æœåŠ¡çš„ï¼Œæ¶æ„è®¾è®¡åº”è¯¥åæ˜ ä¸šåŠ¡çš„æœ¬è´¨ã€‚é€šè¿‡DDDï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•è¯†åˆ«æ ¸å¿ƒåŸŸã€æ”¯æ’‘åŸŸå’Œé€šç”¨åŸŸï¼Œå¦‚ä½•è®¾è®¡èšåˆå’Œé™ç•Œä¸Šä¸‹æ–‡ã€‚

å›¢é˜Ÿåä½œçš„é‡è¦æ€§åœ¨é¡¹ç›®ä¸­å¾—åˆ°äº†å……åˆ†ä½“ç°ã€‚å¾®æœåŠ¡æ¶æ„å¤©ç„¶æ”¯æŒå›¢é˜Ÿçš„å¹¶è¡Œå¼€å‘ï¼Œä½†ä¹Ÿå¸¦æ¥äº†åè°ƒçš„æŒ‘æˆ˜ã€‚é€šè¿‡æ˜ç¡®çš„æ¥å£å®šä¹‰ã€å®Œå–„çš„æ–‡æ¡£ã€æœ‰æ•ˆçš„æ²Ÿé€šæœºåˆ¶ï¼Œæˆ‘ä»¬æˆåŠŸåœ°åè°ƒäº†å„ä¸ªæœåŠ¡çš„å¼€å‘ã€‚

æ€§èƒ½ä¼˜åŒ–çš„ç»éªŒè®©æˆ‘ä»¬è®¤è¯†åˆ°ï¼Œæ€§èƒ½é—®é¢˜å¾€å¾€å‡ºç°åœ¨ç»†èŠ‚ä¹‹å¤„ã€‚ä¸€ä¸ªä¸åˆç†çš„æ•°æ®åº“æŸ¥è¯¢ã€ä¸€ä¸ªæ²¡æœ‰ç¼“å­˜çš„çƒ­ç‚¹æ•°æ®ã€ä¸€ä¸ªåŒæ­¥çš„IOæ“ä½œï¼Œéƒ½å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚é€šè¿‡ç³»ç»Ÿçš„æ€§èƒ½æµ‹è¯•å’Œåˆ†æï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•å‘ç°å’Œè§£å†³æ€§èƒ½é—®é¢˜ã€‚

\subsection{æœªæ¥å±•æœ›}

è™½ç„¶é¡¹ç›®å·²ç»å®ç°äº†é¢„å®šçš„åŠŸèƒ½ï¼Œä½†ä»æœ‰å¾ˆå¤§çš„æ”¹è¿›å’Œæ‰©å±•ç©ºé—´ã€‚åœ¨æŠ€æœ¯æ¶æ„æ–¹é¢ï¼Œæˆ‘ä»¬è®¡åˆ’å¼•å…¥Service MeshæŠ€æœ¯ï¼Œè¿›ä¸€æ­¥æå‡æœåŠ¡æ²»ç†çš„èƒ½åŠ›ã€‚Istioç­‰Service Meshæ–¹æ¡ˆå¯ä»¥æä¾›æ›´ç»†ç²’åº¦çš„æµé‡æ§åˆ¶ã€æ›´å¼ºå¤§çš„è§‚æµ‹èƒ½åŠ›ã€‚

åœ¨ä¸šåŠ¡åŠŸèƒ½æ–¹é¢ï¼Œæˆ‘ä»¬è®¡åˆ’å¢åŠ æ›´å¤šçš„æ™ºèƒ½åŒ–ç‰¹æ€§ã€‚åŸºäºç”¨æˆ·çš„å†å²è®¢å•æ•°æ®ï¼Œå¯ä»¥å®ç°ä¸ªæ€§åŒ–æ¨èï¼›åŸºäºå•†å®¶çš„é”€å”®æ•°æ®ï¼Œå¯ä»¥æä¾›æ™ºèƒ½å®šä»·å»ºè®®ï¼›åŸºäºé…é€æ•°æ®ï¼Œå¯ä»¥ä¼˜åŒ–é…é€è·¯çº¿ã€‚

åœ¨æ¶æ„æ¼”è¿›æ–¹é¢ï¼Œæˆ‘ä»¬è€ƒè™‘å¼•å…¥CQRSï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰æ¨¡å¼ã€‚å°†å‘½ä»¤æ“ä½œå’ŒæŸ¥è¯¢æ“ä½œåˆ†ç¦»ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„åœºæ™¯è¿›è¡Œä¼˜åŒ–ã€‚ç»“åˆäº‹ä»¶æº¯æºï¼Œå¯ä»¥å®ç°æ›´çµæ´»çš„æ•°æ®åˆ†æå’Œå®¡è®¡åŠŸèƒ½ã€‚

åœ¨è¿ç»´èƒ½åŠ›æ–¹é¢ï¼Œæˆ‘ä»¬è®¡åˆ’å»ºè®¾æ›´å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»ã€‚é€šè¿‡å¼•å…¥Prometheusã€Grafanaç­‰ç›‘æ§å·¥å…·ï¼Œå®ç°å¯¹ç³»ç»Ÿå„ä¸ªå±‚é¢çš„å®æ—¶ç›‘æ§ã€‚å»ºè®¾ç»Ÿä¸€çš„æ—¥å¿—æ”¶é›†å’Œåˆ†æå¹³å°ï¼Œæå‡é—®é¢˜å®šä½çš„æ•ˆç‡ã€‚

å®¹å™¨åŒ–å’Œäº‘åŸç”Ÿæ˜¯æœªæ¥çš„å‘å±•æ–¹å‘ã€‚æˆ‘ä»¬è®¡åˆ’å°†æ‰€æœ‰æœåŠ¡å®¹å™¨åŒ–ï¼Œä½¿ç”¨Kubernetesè¿›è¡Œç¼–æ’å’Œç®¡ç†ã€‚è¿™å°†å¤§å¤§æå‡ç³»ç»Ÿçš„éƒ¨ç½²æ•ˆç‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚

\subsection{ç»“è¯­}

æœ¬é¡¹ç›®çš„æˆåŠŸå®æ–½ï¼Œä¸ä»…å®Œæˆäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å¤–å–å¹³å°ï¼Œæ›´é‡è¦çš„æ˜¯æŒæ¡äº†å¾®æœåŠ¡æ¶æ„å’ŒDDDè®¾è®¡çš„ç²¾é«“ã€‚ä»éœ€æ±‚åˆ†æåˆ°ç³»ç»Ÿè®¾è®¡ï¼Œä»æŠ€æœ¯é€‰å‹åˆ°å…·ä½“å®ç°ï¼Œä»åŠŸèƒ½å¼€å‘åˆ°æ€§èƒ½ä¼˜åŒ–ï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½æ˜¯å­¦ä¹ å’Œæˆé•¿çš„è¿‡ç¨‹ã€‚

å¾®æœåŠ¡æ¶æ„å’ŒDDDè®¾è®¡ä»£è¡¨äº†å½“å‰ä¼ä¸šçº§åº”ç”¨å¼€å‘çš„å…ˆè¿›ç†å¿µã€‚é€šè¿‡æœ¬é¡¹ç›®çš„å®è·µï¼Œæˆ‘ä»¬æ·±åˆ»ä½“ä¼šåˆ°äº†è¿™äº›ç†å¿µçš„ä»·å€¼ã€‚è‰¯å¥½çš„æ¶æ„è®¾è®¡èƒ½å¤Ÿåº”å¯¹ä¸šåŠ¡çš„å˜åŒ–ï¼Œæ”¯æ’‘ç³»ç»Ÿçš„æˆé•¿ã€‚

æŠ€æœ¯æ˜¯ä¸æ–­å‘å±•çš„ï¼Œå­¦ä¹ æ˜¯æ°¸æ— æ­¢å¢ƒçš„ã€‚æœ¬é¡¹ç›®ä¸ºæˆ‘ä»¬æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼Œæœªæ¥æˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢å’Œå®è·µï¼Œä¸ºæ„å»ºæ›´å¥½çš„è½¯ä»¶ç³»ç»Ÿè€ŒåŠªåŠ›ã€‚

\section*{å‚è€ƒæ–‡çŒ®}
\addcontentsline{toc}{section}{å‚è€ƒæ–‡çŒ®}

\begin{enumerate}
\item Evans, Eric. Domain-Driven Design: Tackling Complexity in the Heart of Software[M]. Boston: Addison-Wesley Professional, 2003.

\item Newman, Sam. Building Microservices: Designing Fine-Grained Systems[M]. 2nd Edition. Sebastopol: O'Reilly Media, 2021.

\item Vernon, Vaughn. Implementing Domain-Driven Design[M]. Boston: Addison-Wesley Professional, 2013.

\item Richardson, Chris. Microservices Patterns: With examples in Java[M]. Shelter Island: Manning Publications, 2018.

\item Spring Cloud Alibaba Documentation[EB/OL]. https://github.com/alibaba/spring-cloud-alibaba/wiki

\item Nacos Documentation[EB/OL]. https://nacos.io/zh-cn/docs/what-is-nacos.html

\item Spring Cloud Gateway Documentation[EB/OL]. https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/

\item Sentinel Documentation[EB/OL]. https://sentinelguard.io/zh-cn/docs/introduction.html

\item é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ[EB/OL]. https://github.com/alibaba/p3c

\item å¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼[M]. åŒ—äº¬ï¼šæœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾ï¼Œ2019.
\end{enumerate}

\end{document}